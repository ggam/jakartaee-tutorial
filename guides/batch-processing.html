<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.2">
<title>Batch Processing</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement when using as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Batch Processing</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel2">
<li><a href="#batch-processing">Batch Processing</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect2">
<h3 id="batch-processing"><a class="anchor" href="#batch-processing"></a>Batch Processing</h3>
<div class="paragraph">
<p><a id="GKJIQ6"></a><a id="batch-processing"></a></p>
</div>
<div class="paragraph">
<p>This chapter describes Jakarta Batch,
which provides support for defining, implementing, and running
batch jobs. Batch jobs are tasks that can be executed without user
interaction. The batch framework is composed of a job specification
language based on XML, a Java API, and a batch runtime.</p>
</div>
<div class="paragraph">
<p><a id="BCGJDEEH"></a><a id="introduction-to-batch-processing"></a></p>
</div>
<div class="sect3">
<h4 id="introduction-to-batch-processing"><a class="anchor" href="#introduction-to-batch-processing"></a>Introduction to Batch Processing</h4>
<div class="paragraph">
<p>Some enterprise applications contain tasks that can be executed without
user interaction. These tasks are executed periodically or when resource
usage is low, and they often process large amounts of information such
as log files, database records, or images. Examples include billing,
report generation, data format conversion, and image processing. These
tasks are called batch jobs.</p>
</div>
<div class="paragraph">
<p>Batch processing refers to running batch jobs on a computer system. Jakarta
EE includes a batch processing framework that provides the batch
execution infrastructure common to all batch applications, enabling
developers to concentrate on the business logic of their batch
applications. The batch framework consists of a job specification
language based on XML, a set of batch annotations and interfaces for
application classes that implement the business logic, a batch container
that manages the execution of batch jobs, and supporting classes and
interfaces to interact with the batch container.</p>
</div>
<div class="paragraph">
<p>A batch job can be completed without user intervention. For example,
consider a telephone billing application that reads phone call records
from the enterprise information systems and generates a monthly bill for
each account. Since this application does not require any user
interaction, it can run as a batch job.</p>
</div>
<div class="paragraph">
<p>The phone billing application consists of two phases: The first phase
associates each call from the registry with a monthly bill, and the
second phase calculates the tax and total amount due for each bill. Each
of these phases is a step of the batch job.</p>
</div>
<div class="paragraph">
<p>Batch applications specify a set of steps and their execution order.
Different batch frameworks may specify additional elements, like
decision elements or groups of steps that run in parallel. The following
sections describe steps in more detail and provide information about
other common characteristics of batch frameworks.</p>
</div>
<div class="paragraph">
<p><a id="sthref261"></a><a id="steps-in-batch-jobs"></a></p>
</div>
<div class="sect4">
<h5 id="steps-in-batch-jobs"><a class="anchor" href="#steps-in-batch-jobs"></a>Steps in Batch Jobs</h5>
<div class="paragraph">
<p>A step is an independent and sequential phase of a batch job. Batch jobs
contain chunk-oriented steps and task-oriented steps.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Chunk-oriented steps (chunk steps) process data by reading items from
a data source, applying some business logic to each item, and storing
the results. Chunk steps read and process one item at a time and group
the results into a chunk. The results are stored when the chunk reaches
a configurable size. Chunk-oriented processing makes storing results
more efficient and facilitates transaction demarcation.</p>
<div class="paragraph">
<p>Chunk steps have three parts.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The input retrieval part reads one item at a time from a data source,
such as entries on a database, files in a directory, or entries in a log
file.</p>
</li>
<li>
<p>The business processing part manipulates one item at a time using the
business logic defined by the application. Examples include filtering,
formatting, and accessing data from the item for computing a result.</p>
</li>
<li>
<p>The output writing part stores a chunk of processed items at a time.</p>
<div class="paragraph">
<p>Chunk steps are often long-running because they process large amounts of
data. Batch frameworks enable chunk steps to bookmark their progress
using checkpoints. A chunk step that is interrupted can be restarted
from the last checkpoint. The input retrieval and output writing parts
of a chunk step save their current position after the processing of each
chunk, and can recover it when the step is restarted.</p>
</div>
<div class="paragraph">
<p><a href="#BABFJBAH">Figure 58-1</a> shows the three parts of two steps in a
batch job.</p>
</div>
<div id="BABFJBAH" class="paragraph">
<div class="title"><strong>Figure 58-1 Chunk Steps in a Batch Job</strong></div>
<p><span class="image"><img src="data:image/png;base64," alt="This figure shows a batch job that contains two chunk steps: step A and step B. Step A has the three parts of a chunk-oriented step: input retrieval A, business processing A, and output writing A. Step B also has the three parts of a chunk-oriented step: input retrieval B, business processing B, and output writing B."></span></p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the phone billing application consists of two chunk steps.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the first step, the input retrieval part reads call records from
the registry; the business processing part associates each call with a
bill and creates a bill if one does not exist for an account; and the
output writing part stores each bill in a database.</p>
</li>
<li>
<p>In the second step, the input retrieval part reads bills from the
database; the business processing part calculates the tax and total
amount due for each bill; and the output writing part updates the
database records and generates printable versions of each bill.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This application could also contain a task step that cleaned up the
files from the bills generated for the previous month.</p>
</div>
<div class="paragraph">
<p><a id="sthref263"></a><a id="parallel-processing"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="parallel-processing"><a class="anchor" href="#parallel-processing"></a>Parallel Processing</h5>
<div class="paragraph">
<p>Batch jobs often process large amounts of data or perform
computationally expensive operations. Batch applications can benefit
from parallel processing in two scenarios.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Steps that do not depend on each other can run on different threads.</p>
</li>
<li>
<p>Chunk-oriented steps where the processing of each item does not depend
on the results of processing previous items can run on more than one
thread.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Batch frameworks provide mechanisms for developers to define groups of
independent steps and to split chunk-oriented steps in parts that can
run in parallel.</p>
</div>
<div class="paragraph">
<p><a id="sthref264"></a><a id="status-and-decision-elements"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="status-and-decision-elements"><a class="anchor" href="#status-and-decision-elements"></a>Status and Decision Elements</h5>
<div class="paragraph">
<p>Batch frameworks keep track of a status for every step in a job. The
status indicates if a step is running or if it has completed. If the
step has completed, the status indicates one of the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The execution of the step was successful.</p>
</li>
<li>
<p>The step was interrupted.</p>
</li>
<li>
<p>An error occurred in the execution of the step.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to steps, batch jobs can also contain decision elements.
Decision elements use the exit status of the previous step to determine
the next step or to terminate the batch job. Decision elements set the
status of the batch job when terminating it. Like a step, a batch job
can terminate successfully, be interrupted, or fail.</p>
</div>
<div class="paragraph">
<p><a href="#BCGDCDCA">Figure 58-2</a> shows an example of a job that contains
chunk steps, task steps and a decision element.</p>
</div>
<div id="BCGDCDCA" class="paragraph">
<div class="title"><strong>Figure 58-2 Steps and Decision Elements in a Job</strong></div>
<p><span class="image"><img src="data:image/png;base64," alt="This figure shows a batch job that contains two chunk steps, a task step and a decision element. The job starts with chunk step A, continues with chunk step B, and then decision element D evaluates condition 1. The condition is based on the status of step B. If condition 1 is true, the job terminates; otherwise the job continues with step C and then the job ends."></span></p>
</div>
<div class="paragraph">
<p><a id="sthref266"></a><a id="batch-framework-functionality"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="batch-framework-functionality"><a class="anchor" href="#batch-framework-functionality"></a>Batch Framework Functionality</h5>
<div class="paragraph">
<p>Batch applications have the following common requirements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define jobs, steps, decision elements, and the relationships between
them.</p>
</li>
<li>
<p>Execute some groups of steps or parts of a step in parallel.</p>
</li>
<li>
<p>Maintain state information for jobs and steps.</p>
</li>
<li>
<p>Launch jobs and resume interrupted jobs.</p>
</li>
<li>
<p>Handle errors.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Batch frameworks provide the batch execution infrastructure that
addresses the common requirements of all batch applications, enabling
developers to concentrate on the business logic of their applications.
Batch frameworks consist of a format to specify jobs and steps, an
application programming interface (API), and a service available at
runtime that manages the execution of batch jobs.</p>
</div>
<div class="paragraph">
<p><a id="BCGGIBHA"></a><a id="batch-processing-in-jakarta-ee"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="batch-processing-in-jakarta-ee"><a class="anchor" href="#batch-processing-in-jakarta-ee"></a>Batch Processing in Jakarta EE</h4>
<div class="paragraph">
<p>This section lists the components of the batch processing framework in
Jakarta EE and provides an overview of the steps you have to follow to
create a batch application.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BABEAFJI">The Batch Processing Framework</a></p>
</li>
<li>
<p><a href="#BABCGDHJ">Creating Batch Applications</a></p>
</li>
<li>
<p><a href="#BABDGDJB">Elements of a Batch Job</a></p>
</li>
<li>
<p><a href="#BABHJEJC">Properties and Parameters</a></p>
</li>
<li>
<p><a href="#BABHJGDH">Job Instances and Job Executions</a></p>
</li>
<li>
<p><a href="#BABBFGEF">Batch and Exit Status</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BABEAFJI"></a><a id="the-batch-processing-framework"></a></p>
</div>
<div class="sect4">
<h5 id="the-batch-processing-framework"><a class="anchor" href="#the-batch-processing-framework"></a>The Batch Processing Framework</h5>
<div class="paragraph">
<p>Jakarta EE includes a batch processing framework that consists of the
following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A batch runtime that manages the execution of jobs</p>
</li>
<li>
<p>A job specification language based on XML</p>
</li>
<li>
<p>A Java API to interact with the batch runtime</p>
</li>
<li>
<p>A Java API to implement steps, decision elements, and other batch
artifacts</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Batch applications in Jakarta EE contain XML files and Java classes. The
XML files define the structure of a job in terms of batch artifacts and
the relationships between them. (A batch artifact is a part of a
chunk-oriented step, a task-oriented step, a decision element, or
another component of a batch application). The Java classes implement
the application logic of the batch artifacts defined in the XML files.
The batch runtime parses the XML files and loads the batch artifacts as
Java classes to run the jobs in a batch application.</p>
</div>
<div class="paragraph">
<p><a id="BABCGDHJ"></a><a id="creating-batch-applications"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="creating-batch-applications"><a class="anchor" href="#creating-batch-applications"></a>Creating Batch Applications</h5>
<div class="paragraph">
<p>The process for creating a batch application in Jakarta EE is the
following.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Design the batch application.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Identify the input sources, the format of the input data, the desired final result, and the required processing phases.</p>
</li>
<li>
<p>Organize the application as a job with chunk-oriented steps, task-oriented steps, and decision elements. Determine the dependencies between them.</p>
</li>
<li>
<p>Determine the order of execution in terms of transitions between steps.</p>
</li>
<li>
<p>Identify steps that can run in parallel and steps that can run in more than one thread.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create the batch artifacts as Java classes by implementing the interfaces specified by the framework for steps, decision elements, and so on. These Java classes contain the code to read data from input sources, format items, process items, and store results. Batch artifacts can access context objects from the batch runtime using dependency injection.</p>
</li>
<li>
<p>Define jobs, steps, and their execution flow in XML files using the Job Specification Language. The elements in the XML files reference batch artifacts implemented as Java classes. The batch artifacts can access properties declared in the XML files, such as names of files and databases.</p>
</li>
<li>
<p>Use the Java API provided by the batch runtime to launch the batch
application.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following sections describe in detail how to use the components of
the batch processing framework in Jakarta EE to create batch applications.</p>
</div>
<div class="paragraph">
<p><a id="BABDGDJB"></a><a id="elements-of-a-batch-job"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="elements-of-a-batch-job"><a class="anchor" href="#elements-of-a-batch-job"></a>Elements of a Batch Job</h5>
<div class="paragraph">
<p>A batch job can contain one or more of the following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Steps</p>
</li>
<li>
<p>Flows</p>
</li>
<li>
<p>Splits</p>
</li>
<li>
<p>Decision elements</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Steps are described in
<a href="#BCGJDEEH">Introduction to Batch Processing</a>,
and can be chunk-oriented or task-oriented. Chunk-oriented steps can be
partitioned steps. In a partitioned chunk step, the processing of one
item does not depend on other items, so these steps can run in more than
one thread.</p>
</div>
<div class="paragraph">
<p>A flow is a sequence of steps that execute as a unit. A sequence of
related steps can be grouped together into a flow. The steps in a flow
cannot transition to steps outside the flow. The flow transitions to the
next element when its last step completes.</p>
</div>
<div class="paragraph">
<p>A split is a set of flows that execute in parallel; each flow runs on a
separate thread. The split transitions to the next element when all its
flows complete.</p>
</div>
<div class="paragraph">
<p>Decision elements use the exit status of the previous step to determine
the next step or to terminate the batch job.</p>
</div>
<div class="paragraph">
<p><a id="BABHJEJC"></a><a id="properties-and-parameters"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="properties-and-parameters"><a class="anchor" href="#properties-and-parameters"></a>Properties and Parameters</h5>
<div class="paragraph">
<p>Jobs and steps can have a number of properties associated with them. You
define properties in the job definition file, and batch artifacts access
these properties using context objects from the batch runtime. Using
properties in this manner enables you to decouple static parameters of
the job from the business logic and to reuse batch artifacts in
different job definition files.</p>
</div>
<div class="paragraph">
<p>Specifying properties is described in
<a href="#BCGDDBBG">Using the Job Specification
Language</a>, and accessing properties in batch artifacts is described in
<a href="#BCGHDHGH">Creating Batch Artifacts</a>.</p>
</div>
<div class="paragraph">
<p>Jakarta EE applications can also pass parameters to a job when they submit
it to the batch runtime. This enables you to specify dynamic parameters
that are only known at runtime. Parameters are also necessary for
partitioned steps, since each partition needs to know, for example, what
range of items to process.</p>
</div>
<div class="paragraph">
<p>Specifying parameters when submitting jobs is described in
<a href="#BCGCAHCB">Submitting Jobs to the Batch
Runtime</a>. Specifying parameters for partitioned steps and accessing them
in batch artifacts is demonstrated in
<a href="#BCGFCACD">The phonebilling Example
Application</a>.</p>
</div>
<div class="paragraph">
<p><a id="BABHJGDH"></a><a id="job-instances-and-job-executions"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="job-instances-and-job-executions"><a class="anchor" href="#job-instances-and-job-executions"></a>Job Instances and Job Executions</h5>
<div class="paragraph">
<p>A job definition can have multiple instances, each with different
parameters. A job execution is an attempt to run a job instance. The
batch runtime maintains information about job instances and job
executions, as described in
<a href="#BCGIBGFC">Checking the Status of a Job</a>.</p>
</div>
<div class="paragraph">
<p><a id="BABBFGEF"></a><a id="batch-and-exit-status"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="batch-and-exit-status"><a class="anchor" href="#batch-and-exit-status"></a>Batch and Exit Status</h5>
<div class="paragraph">
<p>The state of jobs, steps, splits, and flows is represented in the batch
runtime as a batch status value. Batch status values are listed
<a href="#BCGJBGDF">Table 58-1</a>. They are represented as strings.</p>
</div>
<div class="paragraph">
<p><a id="sthref267"></a><a id="BCGJBGDF"></a></p>
</div>
<div class="paragraph">
<p><strong>Table 58-1 Batch Status Values</strong></p>
</div>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Value</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STARTING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The job has been submitted to the batch runtime.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STARTED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The job is running.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STOPPING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The job has been requested to stop.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STOPPED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The job has stopped.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FAILED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The job finished executing because of an error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COMPLETED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The job finished executing successfully.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ABANDONED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The job was marked abandoned.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Jakarta EE applications can submit jobs and access the batch status of a
job using the <code>JobOperator</code> interface, as described in
<a href="#BCGCAHCB">Submitting Jobs to the Batch
Runtime</a>. Job definition files can refer to batch status values using
the Job Specification Language (JSL), as described in
<a href="#BCGDDBBG">Using the Job Specification
Language</a>. Batch artifacts can access batch status values using context
objects, as described in <a href="#BCGCJEEF">Using the
Context Objects from the Batch Runtime</a>.</p>
</div>
<div class="paragraph">
<p>For flows, the batch status is that of its last step. For splits, the
batch status is the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>COMPLETED</code>: If all its flows have a batch status of <code>COMPLETED</code></p>
</li>
<li>
<p><code>FAILED</code>: If any flow has a batch status of <code>FAILED</code></p>
</li>
<li>
<p><code>STOPPED</code>: If any flow has a batch status of <code>STOPPED</code>, and no flows
have a batch status of <code>FAILED</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The batch status for jobs, steps, splits, and flows is set by the batch
runtime. Jobs, steps, splits, and flows also have an exit status, which
is a user-defined value based on the batch status. You can set the exit
status inside batch artifacts or in the job definition file. You can
access the exit status in the same manner as the batch status, described
above. The default value for the exit status is the same as the batch
status.</p>
</div>
<div class="paragraph">
<p><a id="BCGHBJIG"></a><a id="simple-use-case"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="simple-use-case"><a class="anchor" href="#simple-use-case"></a>Simple Use Case</h4>
<div class="paragraph">
<p>This section demonstrates how to define a simple job using the Job
Specification Language (JSL) and how to implement the corresponding
batch artifacts. Refer to the rest of the sections in this chapter for
detailed descriptions of the elements in the batch framework.</p>
</div>
<div class="paragraph">
<p>The following job definition specifies a chunk step and a task step as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simplejob</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;properties&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">input_file</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">input.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">output_file</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">output.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/properties&gt;</span>
  <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mychunk</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mytask</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;chunk&gt;</span>
      <span class="tag">&lt;reader</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/reader&gt;</span>
      <span class="tag">&lt;processor</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/processor&gt;</span>
      <span class="tag">&lt;writer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyWriter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/writer&gt;</span>
    <span class="tag">&lt;/chunk&gt;</span>
  <span class="tag">&lt;/step&gt;</span>
  <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mytask</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;batchlet</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyBatchlet</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/batchlet&gt;</span>
    <span class="tag">&lt;end</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="sthref268"></a><a id="chunk-step"></a></p>
</div>
<div class="sect4">
<h5 id="chunk-step"><a class="anchor" href="#chunk-step"></a>Chunk Step</h5>
<div class="paragraph">
<p>In most cases, you have to implement a checkpoint class for
chunk-oriented steps. The following class just keeps track of the line
number in a text file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyCheckpoint</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    <span class="directive">private</span> <span class="type">long</span> lineNum = <span class="integer">0</span>;
    <span class="directive">public</span> <span class="type">void</span> increase() { lineNum++; }
    <span class="directive">public</span> <span class="type">long</span> getLineNum() { <span class="keyword">return</span> lineNum; }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following item reader implementation continues reading the input
file from the provided checkpoint if the job was restarted. The items
consist of each line in the text file (in more complex scenarios, the
items are custom Java types and the input source can be a database):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyReader</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyReader</span> <span class="directive">implements</span> javax.batch.api.chunk.ItemReader {
    <span class="directive">private</span> MyCheckpoint checkpoint;
    <span class="directive">private</span> <span class="predefined-type">BufferedReader</span> breader;
    <span class="annotation">@Inject</span>
    JobContext jobCtx;

    <span class="directive">public</span> MyReader() {}

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> open(<span class="predefined-type">Serializable</span> ckpt) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">if</span> (ckpt == <span class="predefined-constant">null</span>)
            checkpoint = <span class="keyword">new</span> MyCheckpoint();
        <span class="keyword">else</span>
            checkpoint = (MyCheckpoint) ckpt;
        <span class="predefined-type">String</span> fileName = jobCtx.getProperties()
                                .getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">input_file</span><span class="delimiter">&quot;</span></span>);
        breader = <span class="keyword">new</span> <span class="predefined-type">BufferedReader</span>(<span class="keyword">new</span> <span class="predefined-type">FileReader</span>(fileName));
        <span class="keyword">for</span> (<span class="type">long</span> i = <span class="integer">0</span>; i &lt; checkpoint.getLineNum(); i++)
            breader.readLine();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> close() <span class="directive">throws</span> <span class="exception">Exception</span> {
        breader.close();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> readItem() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">String</span> line = breader.readLine();
        <span class="keyword">return</span> line;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following case, the item processor only converts the line to
uppercase. More complex examples can process items in different ways or
transform them into custom output Java types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyProcessor</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyProcessor</span> <span class="directive">implements</span> javax.batch.api.chunk.ItemProcessor {
    <span class="directive">public</span> MyProcessor() {}

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> processItem(<span class="predefined-type">Object</span> obj) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">String</span> line = (<span class="predefined-type">String</span>) obj;
        <span class="keyword">return</span> line.toUpperCase();
    }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Note:</p>
</div>
<div class="paragraph">
<p>The batch processing API does not support generics. In most cases, you
need to cast items to their specific type before processing them.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The item writer writes the processed items to the output file. It
overwrites the output file if no checkpoint is provided; otherwise, it
resumes writing at the end of the file. Items are written in chunks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyWriter</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyWriter</span> <span class="directive">implements</span> javax.batch.api.chunk.ItemWriter {
    <span class="directive">private</span> <span class="predefined-type">BufferedWriter</span> bwriter;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> JobContext jobCtx;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> open(<span class="predefined-type">Serializable</span> ckpt) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">String</span> fileName = jobCtx.getProperties()
                                .getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">output_file</span><span class="delimiter">&quot;</span></span>);
        bwriter = <span class="keyword">new</span> <span class="predefined-type">BufferedWriter</span>(<span class="keyword">new</span> <span class="predefined-type">FileWriter</span>(fileName,
                                                    (ckpt != <span class="predefined-constant">null</span>)));
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> writeItems(<span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span>&gt; items) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; items.size(); i++) {
            <span class="predefined-type">String</span> line = (<span class="predefined-type">String</span>) items.get(i);
            bwriter.write(line);
            bwriter.newLine();
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Serializable</span> checkpointInfo() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">return</span> <span class="keyword">new</span> MyCheckpoint();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="sthref269"></a><a id="task-step"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="task-step"><a class="anchor" href="#task-step"></a>Task Step</h5>
<div class="paragraph">
<p>The task step displays the length of the output file. In more complex
scenarios, task steps perform any task that does not fit the chunk
processing programming model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyBatchlet</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyBatchlet</span> <span class="directive">implements</span> javax.batch.api.chunk.Batchlet {
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> JobContext jobCtx;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> process() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">String</span> fileName = jobCtx.getProperties()
                                .getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">output_file</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>+(<span class="keyword">new</span> <span class="predefined-type">File</span>(fileName)).length());
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="BCGDDBBG"></a><a id="using-the-job-specification-language"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-the-job-specification-language"><a class="anchor" href="#using-the-job-specification-language"></a>Using the Job Specification Language</h4>
<div class="paragraph">
<p>The Job Specification Language (JSL) enables you to define the steps in
a job and their execution order using an XML file. The following example
shows how to define a simple job that contains one chunk step and one
task step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">loganalysis</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;properties&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">input_file</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">input1.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">output_file</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">output2.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/properties&gt;</span>

  <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">logprocessor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cleanup</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;chunk</span> <span class="attribute-name">checkpoint-policy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">item</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">item-count</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;reader</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.pkg.LogItemReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/reader&gt;</span>
      <span class="tag">&lt;processor</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.pkg.LogItemProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/processor&gt;</span>
      <span class="tag">&lt;writer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.pkg.LogItemWriter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/writer&gt;</span>
    <span class="tag">&lt;/chunk&gt;</span>
  <span class="tag">&lt;/step&gt;</span>

  <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cleanup</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;batchlet</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.pkg.CleanUp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/batchlet&gt;</span>
    <span class="tag">&lt;end</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example defines the <code>loganalysis</code> batch job, which consists of the
<code>logprocessor</code> chunk step and the <code>cleanup</code> task step. The
<code>logprocessor</code> step transitions to the <code>cleanup</code> step, which terminates
the job when completed.</p>
</div>
<div class="paragraph">
<p>The <code>job</code> element defines two properties, <code>input_file</code> and
<code>output_file</code>. Specifying properties in this manner enables you to run a
batch job with different configuration parameters without having to
recompile its Java batch artifacts. The batch artifacts can access these
properties using the context objects from the batch runtime.</p>
</div>
<div class="paragraph">
<p>The <code>logprocessor</code> step is a chunk step that specifies batch artifacts
for the reader (<code>LogItemReader</code>), the processor (<code>LogItemProcessor</code>),
and the writer (<code>LogItemWriter</code>). This step creates a checkpoint for
every ten items processed.</p>
</div>
<div class="paragraph">
<p>The <code>cleanup</code> step is a task step that specifies the <code>CleanUp</code> class as
its batch artifact. The job terminates when this step completes.</p>
</div>
<div class="paragraph">
<p>The following sections describe the elements of the Job Specification
Language (JSL) in more detail and show the most common attributes and
child elements.</p>
</div>
<div class="paragraph">
<p><a id="sthref270"></a><a id="the-job-element"></a></p>
</div>
<div class="sect4">
<h5 id="the-job-element"><a class="anchor" href="#the-job-element"></a>The job Element</h5>
<div class="paragraph">
<p>The <code>job</code> element is always the top-level element in a job definition
file. Its main attributes are <code>id</code> and <code>restartable</code>. The <code>job</code> element
can contain one <code>properties</code> element and zero or more of each of the
following elements: <code>listener</code>, <code>step</code>, <code>flow</code>, and <code>split</code>. For
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobname</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">restartable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;listeners&gt;</span>
    <span class="tag">&lt;listener</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.pkg.ListenerBatchArtifact</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/listeners&gt;</span>
  <span class="tag">&lt;properties&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">propertyName1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">propertyValue1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">propertyName2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">propertyValue2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/properties&gt;</span>
  <span class="tag">&lt;step</span> <span class="attribute-name">...</span><span class="tag">&gt;</span> ... <span class="tag">&lt;/step&gt;</span>
  <span class="tag">&lt;step</span> <span class="attribute-name">...</span><span class="tag">&gt;</span> ... <span class="tag">&lt;/step&gt;</span>
  <span class="tag">&lt;decision</span> <span class="attribute-name">...</span><span class="tag">&gt;</span> ... <span class="tag">&lt;/decision&gt;</span>
  <span class="tag">&lt;flow</span> <span class="attribute-name">...</span><span class="tag">&gt;</span> ... <span class="tag">&lt;/flow&gt;</span>
  <span class="tag">&lt;split</span> <span class="attribute-name">...</span><span class="tag">&gt;</span> ... <span class="tag">&lt;/split&gt;</span>
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>listener</code> element specifies a batch artifact whose methods are
invoked before and after the execution of the job. The batch artifact is
an implementation of the <code>javax.batch.api.listener.JobListener</code>
interface. See <a href="#BCGCCFAC">The Listener Batch
Artifacts</a> for an example of a job listener implementation.</p>
</div>
<div class="paragraph">
<p>The first <code>step</code>, <code>flow</code>, or <code>split</code> element inside the <code>job</code> element
executes first.</p>
</div>
<div class="paragraph">
<p><a id="sthref271"></a><a id="the-step-element"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="the-step-element"><a class="anchor" href="#the-step-element"></a>The step Element</h5>
<div class="paragraph">
<p>The <code>step</code> element can be a child of the <code>job</code> and <code>flow</code> elements. Its
main attributes are <code>id</code> and <code>next</code>. The <code>step</code> element can contain the
following elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One <code>chunk</code> element for chunk-oriented steps or one <code>batchlet</code> element
for task-oriented steps.</p>
</li>
<li>
<p>One <code>properties</code> element (optional).</p>
<div class="paragraph">
<p>This element specifies a set of properties that batch artifacts can
access using batch context objects.</p>
</div>
</li>
<li>
<p>One <code>listener</code> element (optional); one <code>listeners</code> element if more
than one listener is specified.</p>
<div class="paragraph">
<p>This element specifies listener artifacts that intercept various phases
of step execution.</p>
</div>
<div class="paragraph">
<p>For chunk steps, the batch artifacts for these listeners can be
implementations of the following interfaces: <code>StepListener</code>,
<code>ItemReadListener</code>, <code>ItemProcessListener</code>, <code>ItemWriteListener</code>,
<code>ChunkListener</code>, <code>RetryReadListener</code>, <code>RetryProcessListener</code>,
<code>RetryWriteListener</code>, <code>SkipReadListener</code>, <code>SkipProcessListener</code>, and
<code>SkipWriteListener</code>.</p>
</div>
<div class="paragraph">
<p>For task steps, the batch artifact for these listeners must be an
implementation of the <code>StepListener</code> interface.</p>
</div>
<div class="paragraph">
<p>See <a href="#BCGCCFAC">The Listener Batch Artifacts</a>
for an example of an item processor listener implementation.</p>
</div>
</li>
<li>
<p>One <code>partition</code> element (optional).</p>
<div class="paragraph">
<p>This element is used in partitioned steps which execute in more than one
thread.</p>
</div>
</li>
<li>
<p>One <code>end</code> element if this is the last step in a job.</p>
<div class="paragraph">
<p>This element sets the batch status to <code>COMPLETED</code>.</p>
</div>
</li>
<li>
<p>One <code>stop</code> element (optional) to stop a job at this step.</p>
<div class="paragraph">
<p>This element sets the batch status to <code>STOPPED</code>.</p>
</div>
</li>
<li>
<p>One <code>fail</code> element (optional) to terminate a job at this step.</p>
<div class="paragraph">
<p>This element sets the batch status to <code>FAILED</code>.</p>
</div>
</li>
<li>
<p>One or more <code>next</code> elements if the <code>next</code> attribute is not specified.</p>
<div class="paragraph">
<p>This element is associated with an exit status and refers to another
step, a flow, a split, or a decision element.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example of a chunk step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepB</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;properties&gt;</span> ... <span class="tag">&lt;/properties&gt;</span>
  <span class="tag">&lt;listeners&gt;</span>
    <span class="tag">&lt;listener</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyItemReadListenerImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    ...
  <span class="tag">&lt;/listeners&gt;</span>
  <span class="tag">&lt;chunk</span> <span class="attribute-name">...</span><span class="tag">&gt;</span> ... <span class="tag">&lt;/chunk&gt;</span>
  <span class="tag">&lt;partition&gt;</span> ... <span class="tag">&lt;/partition&gt;</span>
  <span class="tag">&lt;end</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">exit-status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MY_COMPLETED_EXIT_STATUS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;stop</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MY_TEMP_ISSUE_EXIST_STATUS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">restart</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;fail</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MY_ERROR_EXIT_STATUS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">exit-status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MY_ERROR_EXIT_STATUS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of a task step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepB</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepC</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;batchlet</span> <span class="attribute-name">...</span><span class="tag">&gt;</span> ... <span class="tag">&lt;/batchlet&gt;</span>
  <span class="tag">&lt;properties&gt;</span> ... <span class="tag">&lt;/properties&gt;</span>
  <span class="tag">&lt;listener</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyStepListenerImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="sthref272"></a><a id="the-chunk-element"></a></p>
</div>
<div class="sect5">
<h6 id="the-chunk-element"><a class="anchor" href="#the-chunk-element"></a>The chunk Element</h6>
<div class="paragraph">
<p>The <code>chunk</code> element is a child of the <code>step</code> element for chunk-oriented
steps. The attributes of this element are listed in <a href="#BCGJCIEI">Table
58-2</a>.</p>
</div>
<div class="paragraph">
<p><a id="sthref273"></a><a id="BCGJCIEI"></a></p>
</div>
<div class="paragraph">
<p><strong>Table 58-2 Attributes of the chunk Element</strong></p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<colgroup>
<col style="width: 15%;">
<col style="width: 75%;">
<col style="width: 10%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Attribute Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Default Value</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>checkpoint-policy</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies how to commit the results of processing each chunk:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"item"</code>: the chunk is committed after processing <code>item-count</code> items</p>
</li>
<li>
<p><code>"custom"</code>: the chunk is committed according to a checkpoint algorithm
specified with the <code>checkpoint-algorithm</code> element</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The checkpoint is updated when the results of a chunk are committed.</p>
</div>
<div class="paragraph">
<p>Every chunk is processed in a global Jakarta EE transaction. If the
processing of one item in the chunk fails, the transaction is rolled
back and no processed items from this chunk are stored.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"item"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>item-count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the number of items to process before
committing the chunk and taking a checkpoint.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>time-limit</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies the number of seconds before committing the chunk and taking a
checkpoint when <code>checkpoint-policy="item"</code>.</p>
</div>
<div class="paragraph">
<p>If <code>item-count</code> items have not been processed by <code>time-limit</code> seconds,
the chunk is committed and a checkpoint is taken.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 (no limit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>buffer-items</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies if processed items are buffered until it is
time to take a checkpoint. If true, a single call to the item writer is
made with a list of the buffered items before committing the chunk and
taking a checkpoint.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>skip-limit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the number of skippable exceptions to skip in
this step during chunk processing. Skippable exception classes are
specified with the <code>skippable-exception-classes</code> element.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No limit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry-limit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the number of attempts to execute this step if
retryable exceptions occur. Retryable exception classes are specified
with the <code>retryable-exception-classes</code> element.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No limit</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>chunk</code> element can contain the following elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One <code>reader</code> element.</p>
<div class="paragraph">
<p>This element specifies a batch artifact that implements the <code>ItemReader</code>
interface.</p>
</div>
</li>
<li>
<p>One <code>processor</code> element.</p>
<div class="paragraph">
<p>This element specifies a batch artifact that implements the
<code>ItemProcessor</code> interface.</p>
</div>
</li>
<li>
<p>One <code>writer</code> element.</p>
<div class="paragraph">
<p>This element specifies a batch artifact that implements the <code>ItemWriter</code>
interface.</p>
</div>
</li>
<li>
<p>One <code>checkpoint-algorithm</code> element (optional).</p>
<div class="paragraph">
<p>This element specifies a batch artifact that implements the
<code>CheckpointAlgorithm</code> interface and provides a custom checkpoint policy.</p>
</div>
</li>
<li>
<p>One <code>skippable-exception-classes</code> element (optional).</p>
<div class="paragraph">
<p>This element specifies a set of exceptions thrown from the reader,
writer, and processor batch artifacts that chunk processing should skip.
The <code>skip-limit</code> attribute from the <code>chunk</code> element specifies the
maximum number of skipped exceptions.</p>
</div>
</li>
<li>
<p>One <code>retryable-exception-classes</code> element (optional).</p>
<div class="paragraph">
<p>This element specifies a set of exceptions thrown from the reader,
writer, and processor batch artifacts that chunk processing will retry.
The <code>retry-limit</code> attribute from the <code>chunk</code> element specifies the
maximum number of attempts.</p>
</div>
</li>
<li>
<p>One <code>no-rollback-exception-classes</code> element (optional).</p>
<div class="paragraph">
<p>This element specifies a set of exceptions thrown from the reader,
writer, and processor batch artifacts that should not cause the batch
runtime to roll back the current chunk, but to retry the current
operation without a rollback instead.</p>
</div>
<div class="paragraph">
<p>For exception types not specified in this element, the current chunk is
rolled back by default when an exception occurs.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example of a chunk-oriented step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepD</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;chunk</span> <span class="attribute-name">checkpoint-policy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">item</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">item-count</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">time-limit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">180</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">buffer-items</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">skip-limit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">retry-limit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;reader</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pkg.MyItemReaderImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/reader&gt;</span>
    <span class="tag">&lt;processor</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pkg.MyItemProcessorImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/processor&gt;</span>
    <span class="tag">&lt;writer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pkg.MyItemWriterImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/writer&gt;</span>
    <span class="tag">&lt;skippable-exception-classes&gt;</span>
      <span class="tag">&lt;include</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pkg.MyItemException</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;exclude</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pkg.MyItemSeriousSubException</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/skippable-exception-classes&gt;</span>
    <span class="tag">&lt;retryable-exception-classes&gt;</span>
      <span class="tag">&lt;include</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pkg.MyResourceTempUnavailable</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/retryable-exception-classes&gt;</span>
  <span class="tag">&lt;/chunk&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example defines a chunk step and specifies its reader, processor,
and writer artifacts. The step updates a checkpoint and commits each
chunk after processing five items. It skips all <code>MyItemException</code>
exceptions and all its subtypes, except for <code>MyItemSeriousSubException</code>,
up to a maximum of ten skipped exceptions. The step retries a chunk when
a <code>MyResourceTempUnavailable</code> exception occurs, up to a maximum of three
attempts.</p>
</div>
<div class="paragraph">
<p><a id="sthref274"></a><a id="the-batchlet-element"></a></p>
</div>
</div>
<div class="sect5">
<h6 id="the-batchlet-element"><a class="anchor" href="#the-batchlet-element"></a>The batchlet Element</h6>
<div class="paragraph">
<p>The <code>batchlet</code> element is a child of the <code>step</code> element for
task-oriented steps. This element only has the <code>ref</code> attribute, which
specifies a batch artifact that implements the <code>Batchlet</code> interface. The
<code>batch</code> element can contain a <code>properties</code> element.</p>
</div>
<div class="paragraph">
<p>The following is an example of a task-oriented step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepD</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepE</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;batchlet</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pkg.MyBatchletImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;properties&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pname</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pvalue</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/properties&gt;</span>
  <span class="tag">&lt;/batchlet&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example defines a batch step and specifies its batch artifact.</p>
</div>
<div class="paragraph">
<p><a id="sthref275"></a><a id="the-partition-element"></a></p>
</div>
</div>
<div class="sect5">
<h6 id="the-partition-element"><a class="anchor" href="#the-partition-element"></a>The partition Element</h6>
<div class="paragraph">
<p>The <code>partition</code> element is a child of the <code>step</code> element. It indicates
that a step is partitioned. Most partitioned steps are chunk steps where
the processing of each item does not depend on the results of processing
previous items. You specify the number of partitions in a step and
provide each partition with specific information on which items to
process, such as the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A range of items. For example, partition 1 processes items 1 through
500, and partition 2 processes items 501 through 1000.</p>
</li>
<li>
<p>An input source. For example, partition 1 processes the items in
<code>input1.txt</code> and partition 2 processes the items in <code>input2.txt</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the number of partitions, the number of items, and the input
sources for a partitioned step are known at development or deployment
time, you can use partition properties in the job definition file to
specify partition-specific information and access these properties from
the step batch artifacts. The runtime creates as many instances of the
step batch artifacts (reader, processor, and writer) as partitions, and
each artifact instance receives the properties specific to its
partition.</p>
</div>
<div class="paragraph">
<p>In most cases, the number of partitions, the number of items, or the
input sources for a partitioned step can only be determined at runtime.
Instead of specifying partition-specific properties statically in the
job definition file, you provide a batch artifact that can access your
data sources at runtime and determine how many partitions are needed and
what range of items each partition should process. This batch artifact
is an implementation of the <code>PartitionMapper</code> interface. The batch
runtime invokes this artifact and then uses the information it provides
to instantiate the step batch artifacts (reader, writer, and processor)
for each partition and to pass them partition-specific data as
parameters.</p>
</div>
<div class="paragraph">
<p>The rest of this section describes the <code>partition</code> element in detail and
shows two examples of job definition files: one that uses partition
properties to specify a range of items for each partition, and one that
relies on a <code>PartitionMapper</code> implementation to determine
partition-specific information.</p>
</div>
<div class="paragraph">
<p>See <a href="#BCGGGAHB">The Phone Billing Chunk Step</a>
in <a href="#BCGFCACD">The phonebilling Example
Application</a> for a complete example of a partitioned chunk step.</p>
</div>
<div class="paragraph">
<p>The <code>partition</code> element can contain the following elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One <code>plan</code> element, if the <code>mapper</code> element is not specified.</p>
<div class="paragraph">
<p>This element defines the number of partitions, the number of threads,
and the properties for each partition in the job definition file. The
<code>plan</code> element is useful when this information is known at development
or deployment time.</p>
</div>
</li>
<li>
<p>One <code>mapper</code> element, if the <code>plan</code> element is not specified.</p>
<div class="paragraph">
<p>This element specifies a batch artifact that provides the number of
partitions, the number of threads, and the properties for each
partition. The batch artifact is an implementation of the
<code>PartitionMapper</code> interface. You use this option when the information
required for each partition is only known at runtime.</p>
</div>
</li>
<li>
<p>One <code>reducer</code> element (optional).</p>
<div class="paragraph">
<p>This element specifies a batch artifact that receives control when a
partitioned step begins, ends, or rolls back. The batch artifact enables
you to merge results from different partitions and perform other related
operations. The batch artifact is an implementation of the
<code>PartitionReducer</code> interface.</p>
</div>
</li>
<li>
<p>One <code>collector</code> element (optional).</p>
<div class="paragraph">
<p>This element specifies a batch artifact that sends intermediary results
from each partition to a partition analyzer. The batch artifact sends
the intermediary results after each checkpoint for chunk steps and at
the end of the step for task steps. The batch artifact is an
implementation of the <code>PartitionCollector</code> interface.</p>
</div>
</li>
<li>
<p>One <code>analyzer</code> element (optional).</p>
<div class="paragraph">
<p>This element specifies a batch artifact that analyzes the intermediary
results from the partition collector instances. The batch artifact is an
implementation of the <code>PartitionAnalyzer</code> interface.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example of a partitioned step using the <code>plan</code>
element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepE</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepF</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;chunk&gt;</span>
    <span class="tag">&lt;reader</span> <span class="attribute-name">...</span><span class="tag">&gt;</span><span class="tag">&lt;/reader&gt;</span>
    <span class="tag">&lt;processor</span> <span class="attribute-name">...</span><span class="tag">&gt;</span><span class="tag">&lt;/processor&gt;</span>
    <span class="tag">&lt;writer</span> <span class="attribute-name">...</span><span class="tag">&gt;</span><span class="tag">&lt;/writer&gt;</span>
  <span class="tag">&lt;/chunk&gt;</span>
  <span class="tag">&lt;partition&gt;</span>
    <span class="tag">&lt;plan</span> <span class="attribute-name">partitions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">threads</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;properties</span> <span class="attribute-name">partition</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">firstItem</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lastItem</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/properties&gt;</span>
      <span class="tag">&lt;properties</span> <span class="attribute-name">partition</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">firstItem</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">501</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lastItem</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">999</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;/plan&gt;</span>
  <span class="tag">&lt;/partition&gt;</span>
  <span class="tag">&lt;reducer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyPartitionReducerImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;collector</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyPartitionCollectorImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;analyzer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyPartitionAnalyzerImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>plan</code> element specifies the properties for each
partition in the job definition file.</p>
</div>
<div class="paragraph">
<p>The following example uses a <code>mapper</code> element instead of a <code>plan</code>
element. The <code>PartitionMapper</code> implementation dynamically provides the
same information as the <code>plan</code> element provides in the job definition
file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepE</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepF</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;chunk&gt;</span>
    <span class="tag">&lt;reader</span> <span class="attribute-name">...</span><span class="tag">&gt;</span><span class="tag">&lt;/reader&gt;</span>
    <span class="tag">&lt;processor</span> <span class="attribute-name">...</span><span class="tag">&gt;</span><span class="tag">&lt;/processor&gt;</span>
    <span class="tag">&lt;writer</span> <span class="attribute-name">...</span><span class="tag">&gt;</span><span class="tag">&lt;/writer&gt;</span>
  <span class="tag">&lt;/chunk&gt;</span>
  <span class="tag">&lt;partition&gt;</span>
    <span class="tag">&lt;mapper</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyPartitionMapperImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;reducer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyPartitionReducerImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;collector</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyPartitionCollectorImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;analyzer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyPartitionAnalyzerImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/partition&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Refer to <a href="#BCGFCACD">The phonebilling Example
Application</a> for an example implementation of the <code>PartitionMapper</code>
interface.</p>
</div>
<div class="paragraph">
<p><a id="sthref276"></a><a id="the-flow-element"></a></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-flow-element"><a class="anchor" href="#the-flow-element"></a>The flow Element</h5>
<div class="paragraph">
<p>The <code>flow</code> element can be a child of the <code>job</code>, <code>flow</code>, and <code>split</code>
elements. Its attributes are <code>id</code> and <code>next</code>. Flows can transition to
flows, steps, splits, and decision elements. The <code>flow</code> element can
contain the following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One or more <code>step</code> elements</p>
</li>
<li>
<p>One or more <code>flow</code> elements (optional)</p>
</li>
<li>
<p>One or more <code>split</code> elements (optional)</p>
</li>
<li>
<p>One or more <code>decision</code> elements (optional)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The last <code>step</code> in a flow is the one with no <code>next</code> attribute or <code>next</code>
element. Steps and other elements in a flow cannot transition to
elements outside the flow.</p>
</div>
<div class="paragraph">
<p>The following is an example of the <code>flow</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;flow</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flowA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepE</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flowAstepA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flowAstepB</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>...<span class="tag">&lt;/step&gt;</span>
  <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flowAstepB</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flowAflowC</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>...<span class="tag">&lt;/step&gt;</span>
  <span class="tag">&lt;flow</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flowAflowC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flowAsplitD</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>...<span class="tag">&lt;/flow&gt;</span>
  <span class="tag">&lt;split</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flowAsplitD</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flowAstepE</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>...<span class="tag">&lt;/split&gt;</span>
  <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flowAstepE</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>...<span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/flow&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example flow contains three steps, one flow, and one split. The
last step does not have the <code>next</code> attribute. The flow transitions to
<code>stepE</code> when its last step completes.</p>
</div>
<div class="paragraph">
<p><a id="sthref277"></a><a id="the-split-element"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="the-split-element"><a class="anchor" href="#the-split-element"></a>The split Element</h5>
<div class="paragraph">
<p>The <code>split</code> element can be a child of the <code>job</code> and <code>flow</code> elements. Its
attributes are <code>id</code> and <code>next</code>. Splits can transition to splits, steps,
flows, and decision elements. The <code>split</code> element can only contain one
or more <code>flow</code> elements that can only transition to other <code>flow</code>
elements in the split.</p>
</div>
<div class="paragraph">
<p>The following is an example of a split with three flows that execute
concurrently:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;split</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">splitA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepB</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;flow</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">splitAflowA</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>...<span class="tag">&lt;/flow&gt;</span>
  <span class="tag">&lt;flow</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">splitAflowB</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>...<span class="tag">&lt;/flow&gt;</span>
  <span class="tag">&lt;flow</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">splitAflowC</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>...<span class="tag">&lt;/flow&gt;</span>
<span class="tag">&lt;/split&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="sthref278"></a><a id="the-decision-element"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="the-decision-element"><a class="anchor" href="#the-decision-element"></a>The decision Element</h5>
<div class="paragraph">
<p>The <code>decision</code> element can be a child of the <code>job</code> and <code>flow</code> elements.
Its attributes are <code>id</code> and <code>next</code>. Steps, flows, and splits can
transition to a <code>decision</code> element. This element specifies a batch
artifact that decides the next step, flow, or split to execute based on
information from the execution of the previous step, flow, or split. The
batch artifact implements the <code>Decider</code> interface. The <code>decision</code>
element can contain the following elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One or more <code>end</code> elements (optional).</p>
<div class="paragraph">
<p>This element sets the batch status to <code>COMPLETED</code>.</p>
</div>
</li>
<li>
<p>One or more <code>stop</code> elements (optional).</p>
<div class="paragraph">
<p>This element sets the batch status to <code>STOPPED</code>.</p>
</div>
</li>
<li>
<p>One or more <code>fail</code> elements (optional).</p>
<div class="paragraph">
<p>This element sets the batch status to <code>FAILED</code>.</p>
</div>
</li>
<li>
<p>One or more <code>next</code> elements (optional).</p>
</li>
<li>
<p>One <code>properties</code> element (optional).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example of the <code>decider</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;decision</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">decisionA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyDeciderImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;fail</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FAILED</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">exit-status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FAILED_AT_DECIDER</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;end</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">exit-status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED_AT_DECIDER</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;stop</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MY_TEMP_ISSUE_EXIST_STATUS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">restart</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/decision&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="BCGHDHGH"></a><a id="creating-batch-artifacts"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="creating-batch-artifacts"><a class="anchor" href="#creating-batch-artifacts"></a>Creating Batch Artifacts</h4>
<div class="paragraph">
<p>After you define a job in terms of its batch artifacts using the Job
Specification Language (JSL), you create these artifacts as Java classes
that implement the interfaces in the <code>javax.batch.api</code> package and its
subpackages.</p>
</div>
<div class="paragraph">
<p>This section lists the main batch artifact interfaces, demonstrates how
to access context objects from the batch runtime, and provides some
examples.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BABDAIBI">Batch Artifact Interfaces</a></p>
</li>
<li>
<p><a href="#BCGIFJBB">Dependency Injection in Batch Artifacts</a></p>
</li>
<li>
<p><a href="#BCGCJEEF">Using the Context Objects from the Batch Runtime</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BABDAIBI"></a><a id="batch-artifact-interfaces"></a></p>
</div>
<div class="sect4">
<h5 id="batch-artifact-interfaces"><a class="anchor" href="#batch-artifact-interfaces"></a>Batch Artifact Interfaces</h5>
<div class="paragraph">
<p>The following tables list the interfaces that you implement to create
batch artifacts. The interface implementations are referenced from the
elements described in <a href="#BCGDDBBG">Using the
Job Specification Language</a>.</p>
</div>
<div class="paragraph">
<p><a href="#BCGGCIDC">Table 58-3</a> lists the interfaces to implement batch
artifacts for chunk steps, task steps, and decision elements.</p>
</div>
<div class="paragraph">
<p><a href="#BCGEAAEA">Table 58-4</a> lists the interfaces to implement batch
artifacts for partitioned steps.</p>
</div>
<div class="paragraph">
<p><a href="#BCGCAEDI">Table 58-5</a> lists the interfaces to implement batch
artifacts for job and step listeners.</p>
</div>
<div class="paragraph">
<p><a id="sthref279"></a><a id="BCGGCIDC"></a></p>
</div>
<div class="paragraph">
<p><strong>Table 58-3 Main Batch Artifact Interfaces</strong></p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 70%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Package</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Interface</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batchlet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implements the business logic of a
task-oriented step. It is referenced from the <code>batchlet</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Decider</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Decides the next step, flow, or split to
execute based on information from the execution of the previous step,
flow, or split. It is referenced from the <code>decision</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.chunk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CheckPointAlgorithm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implements a custom
checkpoint policy for chunk steps. It is referenced from the
<code>checkpoint-algorithm</code> element inside the <code>chunk</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.chunk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ItemReader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reads items from an input source
in a chunk step. It is referenced from the <code>reader</code> element inside the
<code>chunk</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.chunk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ItemProcessor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processes input items to
obtain output items in chunk steps. It is referenced from the
<code>processor</code> element inside the <code>chunk</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.chunk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ItemWriter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Writes output items in chunk
steps. It is referenced from the <code>writer</code> element inside the <code>chunk</code>
element.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="sthref280"></a><a id="BCGEAAEA"></a></p>
</div>
<div class="paragraph">
<p>Table 58-4 Partition Batch Artifact Interfaces</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 70%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Package</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Interface</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.partition</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PartitionPlan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides details on how
to execute a partitioned step, such as the number of partitions, the
number of threads, and the parameters for each partition. This artifact
is not referenced directly from the job definition file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.partition</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PartitionMapper</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides a
<code>PartitionPlan</code> object. It is referenced from the <code>mapper</code> element
inside the <code>partition</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.partition</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PartitionReducer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receives control when
a partitioned step begins, ends, or rolls back. It is referenced from
the <code>reducer</code> element inside the <code>partition</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.partition</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PartitionCollector</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sends intermediary
results from each partition to a partition analyzer. It is referenced
from the <code>collector</code> element inside the <code>partition</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.partition</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PartitionAnalyzer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processes data and
final results from each partition. It is referenced from the <code>analyzer</code>
element inside the <code>partition</code> element.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="sthref281"></a><a id="BCGCAEDI"></a></p>
</div>
<div class="paragraph">
<p><strong>Table 58-5 Listener Batch Artifact Interfaces</strong></p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 70%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Package</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Interface</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JobListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts job execution
before and after running a job. It is referenced from the <code>listener</code>
element inside the <code>job</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StepListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts step execution
before and after running a step. It is referenced from the <code>listener</code>
element inside the <code>step</code> element</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.chunk.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ChunkListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts chunk
processing in chunk steps before and after processing each chunk, and on
errors. It is referenced from the <code>listener</code> element inside the <code>step</code>
element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.chunk.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ItemReadListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts item
reading in chunk steps before and after reading each item, and on
errors. It is referenced from the <code>listener</code> element inside the <code>step</code>
element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.chunk.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ItemProcessListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts
item processing in chunk steps before and after processing each item,
and on errors. It is referenced from the <code>listener</code> element inside the
<code>step</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.chunk.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ItemWriteListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts item
writing in chunk steps before and after writing each item, and on
errors. It is referenced from the <code>listener</code> element inside the <code>step</code>
element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.chunk.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RetryReadListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts retry
item reading in chunk steps when an exception occurs. It is referenced
from the <code>listener</code> element inside the <code>step</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.chunk.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RetryProcessListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts
retry item processing in chunk steps when an exception occurs. It is
referenced from the <code>listener</code> element inside the <code>step</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.chunk.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RetryWriteListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts
retry item writing in chunk steps when an exception occurs. It is
referenced from the <code>listener</code> element inside the <code>step</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.chunk.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SkipReadListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts
skippable exception handling for item readers in chunk steps. It is
referenced from the <code>listener</code> element inside the <code>step</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.chunk.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SkipProcessListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts
skippable exception handling for item processors in chunk steps. It is
referenced from the <code>listener</code> element inside the <code>step</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.batch.api.chunk.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SkipWriteListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts
skippable exception handling for item writers in chunk steps. It is
referenced from the <code>listener</code> element inside the <code>step</code> element.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="BCGIFJBB"></a><a id="dependency-injection-in-batch-artifacts"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="dependency-injection-in-batch-artifacts"><a class="anchor" href="#dependency-injection-in-batch-artifacts"></a>Dependency Injection in Batch Artifacts</h5>
<div class="paragraph">
<p>To ensure that Jakarta Contexts and Dependency Injection (CDI) works in your
batch artifacts, follow these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Define your batch artifact implementations as CDI named beans using
the <code>Named</code> annotation.</p>
<div class="paragraph">
<p>For example, define an item reader implementation in a chunk step as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyItemReaderImpl</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyItemReaderImpl</span> <span class="directive">implements</span> ItemReader {
    <span class="comment">/* ... Override the ItemReader interface methods ... */</span>
}</code></pre>
</div>
</div>
</li>
<li>
<p>Provide a public, empty, no-argument constructor for your batch
artifacts.</p>
<div class="paragraph">
<p>For example, provide the following constructor for the artifact above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> MyItemReaderImpl() {}</code></pre>
</div>
</div>
</li>
<li>
<p>Specify the CDI name for the batch artifacts in the job definition
file, instead of using the fully qualified name of the class.</p>
<div class="paragraph">
<p>For example, define the step for the artifact above as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepB</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;chunk&gt;</span>
    <span class="tag">&lt;reader</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyItemReaderImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/reader&gt;</span>
    ...
  <span class="tag">&lt;/chunk&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example uses the CDI name (<code>MyItemReaderImpl</code>) instead of the fully
qualified name of the class (<code>com.example.pkg.MyItemReaderImpl</code>) to
specify a batch artifact.</p>
</div>
</li>
<li>
<p>Ensure that your module is a CDI bean archive by annotating your
batch artifacts with the <code>javax.enterprise.context.Dependent</code> annotation
or by including an empty <code>beans.xml</code> deployment description with your
application. For example, the following batch artifact is annotated with
<code>@Dependent</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyItemReaderImpl</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyItemReaderImpl</span> <span class="directive">implements</span> ItemReader { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on bean archives, see
<a href="#CACDCFDE">Packaging CDI Applications</a> in
<a href="#GJEHI">Chapter 27, "Jakarta Contexts and Dependency Injection: Advanced Topics"</a>.</p>
</div>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Note:</p>
</div>
<div class="paragraph">
<p>Jakarta Contexts and Dependency Injection (CDI) is required in order to access
context objects from the batch runtime in batch artifacts.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You may encounter the following errors if you do not follow this
procedure.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The batch runtime cannot locate some batch artifacts.</p>
</li>
<li>
<p>The batch artifacts throw null pointer exceptions when accessing
injected objects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BCGCJEEF"></a><a id="using-the-context-objects-from-the-batch-runtime"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="using-the-context-objects-from-the-batch-runtime"><a class="anchor" href="#using-the-context-objects-from-the-batch-runtime"></a>Using the Context Objects from the Batch Runtime</h5>
<div class="paragraph">
<p>The batch runtime provides context objects that implement the
<code>JobContext</code> and <code>StepContext</code> interfaces in the
<code>javax.batch.runtime.context</code> package. These objects are associated with
the current job and step, respectively, and enable you to do the
following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Get information from the current job or step, such as its name,
instance ID, execution ID, batch status, and exit status</p>
</li>
<li>
<p>Set the user-defined exit status</p>
</li>
<li>
<p>Store user data</p>
</li>
<li>
<p>Get property values from the job or step definition</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can inject context objects from the batch runtime inside batch
artifact implementations like item readers, item processors, item
writers, batchlets, listeners, and so on. The following example
demonstrates how to access property values from the job definition file
in an item reader implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyItemReaderImpl</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyItemReaderImpl</span> <span class="directive">implements</span> ItemReader {
    <span class="annotation">@Inject</span>
    JobContext jobCtx;

    <span class="directive">public</span> MyItemReaderImpl() {}

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> open(<span class="predefined-type">Serializable</span> checkpoint) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">String</span> fileName = jobCtx.getProperties()
                                .getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">log_file_name</span><span class="delimiter">&quot;</span></span>);
        ...
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#BCGIFJBB">Dependency Injection in Batch Artifacts</a> for
instructions on how to define your batch artifacts to use dependency
injection.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Note</strong>:</p>
</div>
<div class="paragraph">
<p>Do not access batch context objects inside artifact constructors.</p>
</div>
<div class="paragraph">
<p>Because the job does not run until you submit it to the batch runtime,
the batch context objects are not available when CDI instantiates your
artifacts upon loading your application. The instantiation of these
beans fails and the batch runtime cannot find your batch artifacts when
your application submits the job.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="BCGCAHCB"></a><a id="submitting-jobs-to-the-batch-runtime"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="submitting-jobs-to-the-batch-runtime"><a class="anchor" href="#submitting-jobs-to-the-batch-runtime"></a>Submitting Jobs to the Batch Runtime</h4>
<div class="paragraph">
<p>The <code>JobOperator</code> interface in the <code>javax.batch.operations</code> package
enables you to submit jobs to the batch runtime and obtain information
about existing jobs. This interface provides the following
functionality.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Obtain the names of all known jobs.</p>
</li>
<li>
<p>Start, stop, restart, and abandon jobs.</p>
</li>
<li>
<p>Obtain job instances and job executions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>BatchRuntime</code> class in the <code>javax.batch.runtime</code> package provides
the <code>getJobOperator</code> factory method to obtain <code>JobOperator</code> objects.</p>
</div>
<div class="paragraph">
<p><a id="sthref282"></a><a id="starting-a-job"></a></p>
</div>
<div class="sect4">
<h5 id="starting-a-job"><a class="anchor" href="#starting-a-job"></a>Starting a Job</h5>
<div class="paragraph">
<p>The following example code demonstrates how to obtain a <code>JobOperator</code>
object and submit a batch job:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">JobOperator jobOperator = BatchRuntime.getJobOperator();
<span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
props.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">parameter1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>);
...
long execID = jobOperator.start(<span class="string"><span class="delimiter">&quot;</span><span class="content">simplejob</span><span class="delimiter">&quot;</span></span>, props);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first argument of the <code>JobOperator.start</code> method is the name of the
job as specified in its job definition file. The second parameter is a
<code>Properties</code> object that represents the parameters for this job
execution. You can use job parameters to pass to a job information that
is only known at runtime.</p>
</div>
<div class="paragraph">
<p><a id="BCGIBGFC"></a><a id="checking-the-status-of-a-job"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="checking-the-status-of-a-job"><a class="anchor" href="#checking-the-status-of-a-job"></a>Checking the Status of a Job</h5>
<div class="paragraph">
<p>The <code>JobExecution</code> interface in the <code>javax.batch.runtime</code> package
provides methods to obtain information about submitted jobs. This
interface provides the following functionality.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Obtain the batch and exit status of a job execution.</p>
</li>
<li>
<p>Obtain the time the execution was started, updated, or ended.</p>
</li>
<li>
<p>Obtain the job name.</p>
</li>
<li>
<p>Obtain the execution ID.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example code demonstrates how to obtain the batch status
of a job using its execution ID:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">JobExecution jobExec = jobOperator.getJobExecution(execID);
<span class="predefined-type">String</span> status = jobExec.getBatchStatus().toString();</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="sthref283"></a><a id="invoking-the-batch-runtime-in-your-application"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="invoking-the-batch-runtime-in-your-application"><a class="anchor" href="#invoking-the-batch-runtime-in-your-application"></a>Invoking the Batch Runtime in Your Application</h5>
<div class="paragraph">
<p>The component from which you invoke the batch runtime depends on the
architecture of your particular application. For example, you can invoke
the batch runtime from an enterprise bean, a servlet, a managed bean,
and so on.</p>
</div>
<div class="paragraph">
<p>See <a href="#BCGJHEHJ">The webserverlog Example
Application</a> and <a href="#BCGFCACD">The phonebilling
Example Application</a> for details on how to invoke the batch runtime from
a managed bean driven by a Jakarta Server Faces user interface.</p>
</div>
<div class="paragraph">
<p><a id="BCGBBGJI"></a><a id="packaging-batch-applications"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="packaging-batch-applications"><a class="anchor" href="#packaging-batch-applications"></a>Packaging Batch Applications</h4>
<div class="paragraph">
<p>Job definition files and batch artifacts do not require separate
packaging and can be included in any Jakarta EE application.</p>
</div>
<div class="paragraph">
<p>Package the batch artifact classes with the rest of the classes of your
application, and include the job definition files in one of the
following directories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>META-INF/batch-jobs/</code> for <code>jar</code> packages</p>
</li>
<li>
<p><code>WEB-INF/classes/META-INF/batch-jobs/</code> for <code>war</code> packages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The name of each job definition file must match its job ID. For example,
if you define a job as follows, and you are packaging your application
as a WAR file, include the job definition file in
<code>WEB-INF/classes/META-INF/batch-jobs/simplejob.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simplejob</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="BCGJHEHJ"></a><a id="the-webserverlog-example-application"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="the-webserverlog-example-application"><a class="anchor" href="#the-webserverlog-example-application"></a>The webserverlog Example Application</h4>
<div class="paragraph">
<p>The <code>webserverlog</code> example application, located in the
tut-install`/examples/batch/webserverlog/` directory, demonstrates how
to use the batch framework in Jakarta EE to analyze the log file from a web
server. This example application reads a log file and finds what
percentage of page views from tablet devices are product sales.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BABCHDFB">Architecture of the webserverlog Example Application</a></p>
</li>
<li>
<p><a href="#BABFIHJA">Running the webserverlog Example Application</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BABCHDFB"></a><a id="architecture-of-the-webserverlog-example-application"></a></p>
</div>
<div class="sect4">
<h5 id="architecture-of-the-webserverlog-example-application"><a class="anchor" href="#architecture-of-the-webserverlog-example-application"></a>Architecture of the webserverlog Example Application</h5>
<div class="paragraph">
<p>The <code>webserverlog</code> example application consists of the following
elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A job definition file (<code>webserverlog.xml</code>) that uses the Job
Specification Language (JSL) to define a batch job with a chunk step and
a task step. The chunk step acts as a filter, and the task step
calculates statistics on the remaining entries.</p>
</li>
<li>
<p>A log file (<code>log1.txt</code>) that serves as input data to the batch job.</p>
</li>
<li>
<p>Two Java classes (<code>LogLine</code> and <code>LogFilteredLine</code>) that represent
input items and output items for the chunk step.</p>
</li>
<li>
<p>Three batch artifacts (<code>LogLineReader</code>, <code>LogLineProcessor</code>, and
<code>LogFilteredLineWriter</code>) that implement the chunk step of the
application. This step reads items from the web server log file, filters
them by the web browser used by the client, and writes the results to a
text file.</p>
</li>
<li>
<p>Two batch artifacts (<code>InfoJobListener</code> and <code>InfoItemProcessListener</code>)
that implement two simple listeners.</p>
</li>
<li>
<p>A batch artifact (<code>MobileBatchlet.java</code>) that calculates statistics on
the filtered items.</p>
</li>
<li>
<p>Two Facelets pages (<code>index.xhtml</code> and <code>jobstarted.xhtml</code>) that provide
the front end of the batch application. The first page shows the log
file that will be processed by the batch job, and the second page
enables the user to check on the status of the job and shows the
results.</p>
</li>
<li>
<p>A managed bean (<code>JsfBean</code>) that is accessed from the Facelets pages.
The bean submits the job to the batch runtime, checks on the status of
the job, and reads the results from a text file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BABFGCEC"></a><a id="the-job-definition-file"></a></p>
</div>
<div class="sect5">
<h6 id="the-job-definition-file"><a class="anchor" href="#the-job-definition-file"></a>The Job Definition File</h6>
<div class="paragraph">
<p>The <code>webserverlog.xml</code> job definition file is located in the
<code>WEB-INF/classes/META-INF/batch-jobs/</code> directory. The file specifies
seven job-level properties and two steps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">webserverlog</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;properties&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">log_file_name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">log1.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">filtered_file_name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">filtered1.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">num_browsers</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">browser_1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Tablet Browser D</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">browser_2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Tablet Browser E</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">buy_page</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/auth/buy.html</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">out_file_name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result1.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;listeners&gt;</span>
        <span class="tag">&lt;listener</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">InfoJobListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/listeners&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mobilefilter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mobileanalyzer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> ... <span class="tag">&lt;/step&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mobileanalyzer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> ... <span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first step is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mobilefilter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mobileanalyzer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;listeners&gt;</span>
        <span class="tag">&lt;listener</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">InfoItemProcessListeners</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/listeners&gt;</span>
    <span class="tag">&lt;chunk</span> <span class="attribute-name">checkpoint-policy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">item</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">item-count</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;reader</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LogLineReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/reader&gt;</span>
        <span class="tag">&lt;processor</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LogLineProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/processor&gt;</span>
        <span class="tag">&lt;writer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LogFilteredLineWriter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/writer&gt;</span>
    <span class="tag">&lt;/chunk&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This step is a normal chunk step that specifies the batch artifacts that
implement each phase of the step. The batch artifact names are not fully
qualified class names, so the batch artifacts are CDI beans annotated
with <code>@Named</code>.</p>
</div>
<div class="paragraph">
<p>The second step is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;step id=<span class="string"><span class="delimiter">&quot;</span><span class="content">mobileanalyzer</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;batchlet ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">MobileBatchlet</span><span class="delimiter">&quot;</span></span>&gt;&lt;/batchlet&gt;
    &lt;end on=<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/step&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step is a task step that specifies the batch artifact that
implements it. This is the last step of the job.</p>
</div>
<div class="paragraph">
<p><a id="BABIHBFF"></a><a id="the-logline-and-logfilteredline-items"></a></p>
</div>
</div>
<div class="sect5">
<h6 id="the-logline-and-logfilteredline-items"><a class="anchor" href="#the-logline-and-logfilteredline-items"></a>The LogLine and LogFilteredLine Items</h6>
<div class="paragraph">
<p>The <code>LogLine</code> class represents entries in the web server log file and it
is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LogLine</span> {
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> datetime;
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> ipaddr;
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> browser;
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> url;

    <span class="comment">/* ... Constructor, getters, and setters ... */</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>LogFileteredLine</code> class is similar to this class but only has two
fields: the IP address of the client and the URL.</p>
</div>
<div class="paragraph">
<p><a id="sthref284"></a><a id="the-chunk-step-batch-artifacts"></a></p>
</div>
</div>
<div class="sect5">
<h6 id="the-chunk-step-batch-artifacts"><a class="anchor" href="#the-chunk-step-batch-artifacts"></a>The Chunk Step Batch Artifacts</h6>
<div class="paragraph">
<p>The first step is composed of the <code>LogLineReader</code>, <code>LogLineProcessor</code>,
and <code>LogFilteredLineWriter</code> batch artifacts.</p>
</div>
<div class="paragraph">
<p>The <code>LogLineReader</code> artifact reads records from the web server log file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">LogLineReader</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">LogLineReader</span> <span class="directive">implements</span> ItemReader {
    <span class="directive">private</span> ItemNumberCheckpoint checkpoint;
    <span class="directive">private</span> <span class="predefined-type">String</span> fileName;
    <span class="directive">private</span> <span class="predefined-type">BufferedReader</span> breader;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> JobContext jobCtx;

    <span class="directive">public</span> LogLineReader() { }

    <span class="comment">/* ... Override the open, close, readItem, and
     *     checkpointInfo methods ... */</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>open</code> method reads the <code>log_file_name</code> property and opens the log
file with a buffered reader. In this example, the log file has been
included with the application under
<code>webserverlog/WEB-INF/classes/log1.txt</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">fileName = jobCtx.getProperties().getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">log_file_name</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">ClassLoader</span> classLoader = <span class="predefined-type">Thread</span>.currentThread().getContextClassLoader();
<span class="predefined-type">InputStream</span> iStream = classLoader.getResourceAsStream(fileName);
breader = <span class="keyword">new</span> <span class="predefined-type">BufferedReader</span>(<span class="keyword">new</span> <span class="predefined-type">InputStreamReader</span>(iStream));</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a checkpoint object is provided, the <code>open</code> method advances the
reader up to the last checkpoint. Otherwise, this method creates a new
checkpoint object. The checkpoint object keeps track of the line number
from the last committed chunk.</p>
</div>
<div class="paragraph">
<p>The <code>readItem</code> method returns a new <code>LogLine</code> object or null at the end
of the log file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">Object</span> readItem() <span class="directive">throws</span> <span class="exception">Exception</span> {
    <span class="predefined-type">String</span> entry = breader.readLine();
    <span class="keyword">if</span> (entry != <span class="predefined-constant">null</span>) {
        checkpoint.nextLine();
        <span class="keyword">return</span> <span class="keyword">new</span> LogLine(entry);
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>LogLineProcessor</code> artifact obtains a list of browsers from the job
properties and filters the log entries according to the list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">Object</span> processItem(<span class="predefined-type">Object</span> item) {
    <span class="comment">/* Obtain a list of browsers we are interested in */</span>
    <span class="keyword">if</span> (nbrowsers == <span class="integer">0</span>) {
        <span class="predefined-type">Properties</span> props = jobCtx.getProperties();
        nbrowsers = <span class="predefined-type">Integer</span>.parseInt(props.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">num_browsers</span><span class="delimiter">&quot;</span></span>));
        browsers = <span class="keyword">new</span> <span class="predefined-type">String</span>[nbrowsers];
        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">1</span>; i &lt; nbrowsers + <span class="integer">1</span>; i++)
            browsers[i - <span class="integer">1</span>] = props.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">browser_</span><span class="delimiter">&quot;</span></span> + i);
    }

    LogLine logline = (LogLine) item;
    <span class="comment">/* Filter for only the mobile/tablet browsers as specified */</span>
    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; nbrowsers; i++) {
        <span class="keyword">if</span> (logline.getBrowser().equals(browsers[i])) {
            <span class="keyword">return</span> <span class="keyword">new</span> LogFilteredLine(logline);
        }
    }
    <span class="keyword">return</span> <span class="predefined-constant">null</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>LogFilteredLineWriter</code> artifact reads the name of the output file
from the job properties. The <code>open</code> method opens the file for writing.
If a checkpoint object is provided, the artifact continues writing at
the end of the file; otherwise, it overwrites the file if it exists. The
<code>writeItems</code> method writes filtered items to the output file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> writeItems(<span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span>&gt; items) <span class="directive">throws</span> <span class="exception">Exception</span> {
    <span class="comment">/* Write the filtered lines to the output file */</span>
    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; items.size(); i++) {
        LogFilteredLine filtLine = (LogFilteredLine) items.get(i);
        bwriter.write(filtLine.toString());
        bwriter.newLine();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="BCGCCFAC"></a><a id="the-listener-batch-artifacts"></a></p>
</div>
</div>
<div class="sect5">
<h6 id="the-listener-batch-artifacts"><a class="anchor" href="#the-listener-batch-artifacts"></a>The Listener Batch Artifacts</h6>
<div class="paragraph">
<p>The <code>InfoJobListener</code> batch artifact implements a simple listener that
writes log messages when the job starts and when it ends:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">InfoJobListener</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">InfoJobListener</span> <span class="directive">implements</span> JobListener {
    ...
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> beforeJob() <span class="directive">throws</span> <span class="exception">Exception</span> {
        logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">The job is starting</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> afterJob() <span class="directive">throws</span> <span class="exception">Exception</span> { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>InfoItemProcessListener</code> batch artifact implements the
<code>ItemProcessListener</code> interface for chunk steps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">InfoItemProcessListener</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">InfoItemProcessListener</span> <span class="directive">implements</span> ItemProcessListener {
    ...
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> beforeProcess(<span class="predefined-type">Object</span> o) <span class="directive">throws</span> <span class="exception">Exception</span> {
        LogLine logline = (LogLine) o;
        llogger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Processing entry {0}</span><span class="delimiter">&quot;</span></span>, logline);
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="sthref285"></a><a id="the-task-step-batch-artifact"></a></p>
</div>
</div>
<div class="sect5">
<h6 id="the-task-step-batch-artifact"><a class="anchor" href="#the-task-step-batch-artifact"></a>The Task Step Batch Artifact</h6>
<div class="paragraph">
<p>The task step is implemented by the <code>MobileBatchlet</code> artifact, which
computes what percentage of the filtered log entries are purchases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">String</span> process() <span class="directive">throws</span> <span class="exception">Exception</span> {
    <span class="comment">/* Get properties from the job definition file */</span>
    ...
    <span class="comment">/* Count from the output of the previous chunk step */</span>
    breader = <span class="keyword">new</span> <span class="predefined-type">BufferedReader</span>(<span class="keyword">new</span> <span class="predefined-type">FileReader</span>(fileName));
    <span class="predefined-type">String</span> line = breader.readLine();
    <span class="keyword">while</span> (line != <span class="predefined-constant">null</span>) {
        <span class="predefined-type">String</span><span class="type">[]</span> lineSplit = line.split(<span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">if</span> (buyPage.compareTo(lineSplit[<span class="integer">1</span>]) == <span class="integer">0</span>)
            pageVisits++;
        totalVisits++;
        line = breader.readLine();
    }
    breader.close();
    <span class="comment">/* Write the result */</span>
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="sthref286"></a><a id="the-javaserver-faces-pages"></a></p>
</div>
</div>
<div class="sect5">
<h6 id="the-jakarta-server-faces-pages"><a class="anchor" href="#the-jakarta-server-faces-pages"></a>The Jakarta Server Faces Pages</h6>
<div class="paragraph">
<p>The <code>index.xhtml</code> page contains a text area that shows the web server
log. The page provides a button for the user to submit the batch job and
navigate to the next page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;body&gt;</span>
    ...
    <span class="tag">&lt;textarea</span> <span class="attribute-name">cols</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">90</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">rows</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">25</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">readonly</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>#{jsfBean.getInputLog()}<span class="tag">&lt;/textarea&gt;</span>
    <span class="tag">&lt;p&gt;</span> <span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;h:form&gt;</span>
        <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Start Batch Job</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jsfBean.startBatchJob()}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/h:form&gt;</span>
<span class="tag">&lt;/body&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This page calls the methods of the managed bean to show the log file and
submit the batch job.</p>
</div>
<div class="paragraph">
<p>The <code>jobstarted.xhtml</code> page provides a button to check the current
status of the batch job and displays the results when the job finishes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;p&gt;</span>Current Status of the Job: <span class="tag">&lt;b&gt;</span>#{jsfBean.jobStatus}<span class="tag">&lt;/b&gt;</span><span class="tag">&lt;/p&gt;</span>
<span class="tag">&lt;p&gt;</span>#{jsfBean.showResults()}<span class="tag">&lt;/p&gt;</span>
<span class="tag">&lt;h:form&gt;</span>
    <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Check Status</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobstarted</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jsfBean.completed==false}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="sthref287"></a><a id="the-managed-bean"></a></p>
</div>
</div>
<div class="sect5">
<h6 id="the-managed-bean"><a class="anchor" href="#the-managed-bean"></a>The Managed Bean</h6>
<div class="paragraph">
<p>The <code>JsfBean</code> managed bean submits the job to the batch runtime, checks
on the status of the job, and reads the results from a text file.</p>
</div>
<div class="paragraph">
<p>The <code>startBatchJob</code> method submits the job to the batch runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/* Submit the batch job to the batch runtime.
 * JSF Navigation method (return the name of the next page) */</span>
<span class="directive">public</span> <span class="predefined-type">String</span> startBatchJob() {
    jobOperator = BatchRuntime.getJobOperator();
    execID = jobOperator.start(<span class="string"><span class="delimiter">&quot;</span><span class="content">webserverlog</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>);
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">jobstarted</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getJobStatus</code> method checks the status of the job:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/* Get the status of the job from the batch runtime */</span>
<span class="directive">public</span> <span class="predefined-type">String</span> getJobStatus() {
    <span class="keyword">return</span> jobOperator.getJobExecution(execID).getBatchStatus().toString();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>showResults</code> method reads the results from a text file.</p>
</div>
<div class="paragraph">
<p><a id="BABFIHJA"></a><a id="running-the-webserverlog-example-application"></a></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="running-the-webserverlog-example-application"><a class="anchor" href="#running-the-webserverlog-example-application"></a>Running the webserverlog Example Application</h5>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and
run the <code>webserverlog</code> example application.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BABHIJBE">To Run the webserverlog Example Application Using
NetBeans IDE</a></p>
</li>
<li>
<p><a href="#BABGACCD">To Run the webserverlog Example Application Using
Maven</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BABHIJBE"></a><a id="to-run-the-webserverlog-example-application-using-netbeans-ide"></a></p>
</div>
<div class="sect5">
<h6 id="to-run-the-webserverlog-example-application-using-netbeans-ide"><a class="anchor" href="#to-run-the-webserverlog-example-application-using-netbeans-ide"></a>To Run the webserverlog Example Application Using NetBeans IDE</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/batch</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>webserverlog</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>webserverlog</code> project and
select Run.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file,
<code>webserverlog.war</code>, located in the <code>target/</code> directory; deploys it to
the server; and launches a web browser window at the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/webserverlog/</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BABGACCD"></a><a id="to-run-the-webserverlog-example-application-using-maven"></a></p>
</div>
</div>
<div class="sect5">
<h6 id="to-run-the-webserverlog-example-application-using-maven"><a class="anchor" href="#to-run-the-webserverlog-example-application-using-maven"></a>To Run the webserverlog Example Application Using Maven</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/batch/webserverlog/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Open a web browser window at the following URL:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/webserverlog/</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BCGFCACD"></a><a id="the-phonebilling-example-application"></a></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-phonebilling-example-application"><a class="anchor" href="#the-phonebilling-example-application"></a>The phonebilling Example Application</h4>
<div class="paragraph">
<p>The <code>phonebilling</code> example application, located in the
tut-install`/examples/batch/phonebilling/` directory, demonstrates how
to use the batch framework in Jakarta EE to implement a phone billing
system. This example application processes a log file of phone calls and
creates a bill for each customer.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BABDEIFG">Architecture of the phonebilling Example Application</a></p>
</li>
<li>
<p><a href="#BABBGDAA">Running the phonebilling Example Application</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BABDEIFG"></a><a id="architecture-of-the-phonebilling-example-application"></a></p>
</div>
<div class="sect4">
<h5 id="architecture-of-the-phonebilling-example-application"><a class="anchor" href="#architecture-of-the-phonebilling-example-application"></a>Architecture of the phonebilling Example Application</h5>
<div class="paragraph">
<p>The <code>phonebilling</code> example application consists of the following
elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A job definition file (<code>phonebilling.xml</code>) that uses the Job
Specification Language (JSL) to define a batch job with two chunk steps.
The first step reads call records from a log file and associates them
with a bill. The second step computes the amount due and writes each
bill to a text file.</p>
</li>
<li>
<p>A Java class (<code>CallRecordLogCreator</code>) that creates the log file for
the batch job. This is an auxiliary component that does not demonstrate
any key functionality in this example.</p>
</li>
<li>
<p>Two Jakarta Persistence entities (<code>CallRecord</code> and <code>PhoneBill</code>)
that represent call records and customer bills. The application uses a
Jakarta Persistence entity manager to store instances of these entities in a database.</p>
</li>
<li>
<p>Three batch artifacts (<code>CallRecordReader</code>, <code>CallRecordProcessor</code>, and
<code>CallRecordWriter</code>) that implement the first step of the application.
This step reads call records from the log file, associates them with a
bill, and stores them in a database.</p>
</li>
<li>
<p>Four batch artifacts (<code>BillReader</code>, <code>BillProcessor</code>, <code>BillWriter</code>, and
<code>BillPartitionMapper</code>) that implement the second step of the
application. This step is a partitioned step that gets each bill from
the database, calculates the amount due, and writes it to a text file.</p>
</li>
<li>
<p>Two Facelets pages (<code>index.xhtml</code> and <code>jobstarted.xhtml</code>) that provide
the front end of the batch application. The first page shows the log
file that will be processed by the batch job, and the second page
enables the user to check on the status of the job and shows the
resulting bill for each customer.</p>
</li>
<li>
<p>A managed bean (<code>JsfBean</code>) that is accessed from the Facelets pages.
The bean submits the job to the batch runtime, checks on the status of
the job, and reads the text files for each bill.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="sthref288"></a><a id="the-job-definition-file"></a></p>
</div>
<div class="sect5">
<h6 id="the-job-definition-file-2"><a class="anchor" href="#the-job-definition-file-2"></a>The Job Definition File</h6>
<div class="paragraph">
<p>The <code>phonebilling.xml</code> job definition file is located in the
<code>WEB-INF/classes/META-INF/batch-jobs/</code> directory. The file specifies
three job-level properties and two steps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">phonebilling</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;properties&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">log_file_name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">log1.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">airtime_price</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0.08</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tax_rate</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0.07</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">callrecords</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bills</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> ... <span class="tag">&lt;/step&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bills</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> ... <span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first step is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">callrecords</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bills</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;chunk</span> <span class="attribute-name">checkpoint-policy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">item</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">item-count</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;reader</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CallRecordReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/reader&gt;</span>
        <span class="tag">&lt;processor</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CallRecordProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/processor&gt;</span>
        <span class="tag">&lt;writer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CallRecordWriter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/writer&gt;</span>
    <span class="tag">&lt;/chunk&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This step is a normal chunk step that specifies the batch artifacts that
implement each phase of the step. The batch artifact names are not fully
qualified class names, so the batch artifacts are CDI beans annotated
with <code>@Named</code>.</p>
</div>
<div class="paragraph">
<p>The second step is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bills</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;chunk</span> <span class="attribute-name">checkpoint-policy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">item</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">item-count</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;reader</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BillReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;properties&gt;</span>                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">firstItem</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{partitionPlan['firstItem']}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">numItems</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{partitionPlan['numItems']}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>            <span class="tag">&lt;/properties&gt;</span>        <span class="tag">&lt;/reader&gt;</span>
        <span class="tag">&lt;processor</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BillProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/processor&gt;</span>
        <span class="tag">&lt;writer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BillWriter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/writer&gt;</span>
    <span class="tag">&lt;/chunk&gt;</span>
    <span class="tag">&lt;partition&gt;</span>
        <span class="tag">&lt;mapper</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BillPartitionMapper</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/partition&gt;</span>
    <span class="tag">&lt;end</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This step is a partitioned chunk step. The partition plan is specified
through the <code>BillPartitionMapper</code> artifact instead of using the <code>plan</code>
element.</p>
</div>
<div class="paragraph">
<p><a id="sthref289"></a><a id="the-callrecord-and-phonebill-entities"></a></p>
</div>
</div>
<div class="sect5">
<h6 id="the-callrecord-and-phonebill-entities"><a class="anchor" href="#the-callrecord-and-phonebill-entities"></a>The CallRecord and PhoneBill Entities</h6>
<div class="paragraph">
<p>The <code>CallRecord</code> entity is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CallRecord</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    <span class="annotation">@Id</span> <span class="annotation">@GeneratedValue</span>
    <span class="directive">private</span> <span class="predefined-type">Long</span> id;
    <span class="annotation">@Temporal</span>(TemporalType.DATE)
    <span class="directive">private</span> <span class="predefined-type">Date</span> datetime;
    <span class="directive">private</span> <span class="predefined-type">String</span> fromNumber;
    <span class="directive">private</span> <span class="predefined-type">String</span> toNumber;
    <span class="directive">private</span> <span class="type">int</span> minutes;
    <span class="directive">private</span> <span class="type">int</span> seconds;
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> price;

    <span class="directive">public</span> CallRecord() { }

    <span class="directive">public</span> CallRecord(<span class="predefined-type">String</span> datetime, <span class="predefined-type">String</span> from,
            <span class="predefined-type">String</span> to, <span class="type">int</span> min, <span class="type">int</span> sec)             <span class="directive">throws</span> <span class="exception">ParseException</span> { ... }

    <span class="directive">public</span> CallRecord(<span class="predefined-type">String</span> jsonData) <span class="directive">throws</span> <span class="exception">ParseException</span> { ... }

    <span class="comment">/* ... Getters and setters ... */</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>id</code> field is generated automatically by the JPA implementation to
store and retrieve <code>CallRecord</code> objects to and from a database.</p>
</div>
<div class="paragraph">
<p>The second constructor creates a <code>CallRecord</code> object from an entry of
JSON data in the log file using Jakarta JSON Processing. Log entries
look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">{<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">03/01/2013 04:03</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">from</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">555-0101</span><span class="delimiter">&quot;</span></span>,
<span class="string"><span class="delimiter">&quot;</span><span class="content">to</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">555-0114</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">length</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">03:39</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>PhoneBill</code> entity is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PhoneBill</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    <span class="annotation">@Id</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> phoneNumber;
    <span class="annotation">@OneToMany</span>(fetch = FetchType.EAGER, cascade = CascadeType.PERSIST)
    <span class="annotation">@OrderBy</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime ASC</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;CallRecord&gt; calls;
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> amountBase;
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> taxRate;
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> tax;
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> amountTotal;

    <span class="directive">public</span> PhoneBill() { }

    <span class="directive">public</span> PhoneBill(<span class="predefined-type">String</span> number) {
        <span class="local-variable">this</span>.phoneNumber = number;
        calls = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
    }

    <span class="directive">public</span> <span class="type">void</span> addCall(CallRecord call) {
        calls.add(call);
    }

    <span class="directive">public</span> <span class="type">void</span> calculate(<span class="predefined-type">BigDecimal</span> taxRate) { ... }

    <span class="comment">/* ... Getters and setters ... *
}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>OneToMany</code> annotation defines the relationship between a bill and
its call records. The <code>FetchType.EAGER</code> attribute specifies that the
collection should be retrieved eagerly. The <code>CascadeType.PERSIST</code>
attribute indicates that the elements in the call list should be
automatically persisted when the phone bill is persisted. The <code>OrderBy</code>
annotation defines an order for retrieving the elements of the call list
from the database.</p>
</div>
<div class="paragraph">
<p>The batch artifacts use instances of these two entities as items to
read, process, and write.</p>
</div>
<div class="paragraph">
<p>For more information on Jakarta Persistence, see
<a href="#BNBPZ">Chapter 40, "Introduction to Jakarta
Persistence"</a>. For more information on Jakarta JSON Processing, see
<a href="#GLRBB">Chapter 20, "JSON Processing"</a>.</p>
</div>
<div class="paragraph">
<p><a id="sthref290"></a><a id="the-call-records-chunk-step"></a></p>
</div>
</div>
<div class="sect5">
<h6 id="the-call-records-chunk-step"><a class="anchor" href="#the-call-records-chunk-step"></a>The Call Records Chunk Step</h6>
<div class="paragraph">
<p>The first step is composed of the <code>CallRecordReader</code>,
<code>CallRecordProcessor</code>, and <code>CallRecordWriter</code> batch artifacts.</p>
</div>
<div class="paragraph">
<p>The <code>CallRecordReader</code> artifact reads call records from the log file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">CallRecordReader</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CallRecordReader</span> <span class="directive">implements</span> ItemReader {
    <span class="directive">private</span> ItemNumberCheckpoint checkpoint;
    <span class="directive">private</span> <span class="predefined-type">String</span> fileName;
    <span class="directive">private</span> <span class="predefined-type">BufferedReader</span> breader;
    <span class="annotation">@Inject</span>
    JobContext jobCtx;

    <span class="comment">/* ... Override the open, close, readItem,
     *     and checkpointInfo methods ... */</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>open</code> method reads the <code>log_filename</code> property and opens the log
file with a buffered reader:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">fileName = jobCtx.getProperties().getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">log_file_name</span><span class="delimiter">&quot;</span></span>);
breader = <span class="keyword">new</span> <span class="predefined-type">BufferedReader</span>(<span class="keyword">new</span> <span class="predefined-type">FileReader</span>(fileName));</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a checkpoint object is provided, the <code>open</code> method advances the
reader up to the last checkpoint. Otherwise, this method creates a new
checkpoint object. The checkpoint object keeps track of the line number
from the last committed chunk.</p>
</div>
<div class="paragraph">
<p>The <code>readItem</code> method returns a new <code>CallRecord</code> object or null at the
end of the log file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">Object</span> readItem() <span class="directive">throws</span> <span class="exception">Exception</span> {
    <span class="comment">/* Read a line from the log file and
     * create a CallRecord from JSON */</span>
    <span class="predefined-type">String</span> callEntryJson = breader.readLine();
    <span class="keyword">if</span> (callEntryJson != <span class="predefined-constant">null</span>) {
        checkpoint.nextItem();
        <span class="keyword">return</span> <span class="keyword">new</span> CallRecord(callEntryJson);
    } <span class="keyword">else</span>
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CallRecordProcessor</code> artifact obtains the airtime price from the
job properties, calculates the price of each call, and returns the call
object. This artifact overrides only the <code>processItem</code> method.</p>
</div>
<div class="paragraph">
<p>The <code>CallRecordWriter</code> artifact associates each call record with a bill
and stores the bill in the database. This artifact overrides the <code>open</code>,
<code>close</code>, <code>writeItems</code>, and <code>checkpointInfo</code> methods. The <code>writeItems</code>
method looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> writeItems(<span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span>&gt; callList) <span class="directive">throws</span> <span class="exception">Exception</span> {

    <span class="keyword">for</span> (<span class="predefined-type">Object</span> callObject : callList) {
        CallRecord call = (CallRecord) callObject;
        PhoneBill bill = em.find(PhoneBill.class, call.getFromNumber());
        <span class="keyword">if</span> (bill == <span class="predefined-constant">null</span>) {
            <span class="comment">/* No bill for this customer yet, create one */</span>
            bill = <span class="keyword">new</span> PhoneBill(call.getFromNumber());
            bill.addCall(call);
            em.persist(bill);
        } <span class="keyword">else</span> {
            <span class="comment">/* Add call to existing bill */</span>
            bill.addCall(call);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="BCGGGAHB"></a><a id="the-phone-billing-chunk-step"></a></p>
</div>
</div>
<div class="sect5">
<h6 id="the-phone-billing-chunk-step"><a class="anchor" href="#the-phone-billing-chunk-step"></a>The Phone Billing Chunk Step</h6>
<div class="paragraph">
<p>The second step is composed of the <code>BillReader</code>, <code>BillProcessor</code>,
<code>BillWriter</code>, and <code>BillPartitionMapper</code> batch artifacts. This step gets
the phone bills from the database, computes the tax and total amount
due, and writes each bill to a text file. Since the processing of each
bill is independent of the others, this step can be partitioned and run
in more than one thread.</p>
</div>
<div class="paragraph">
<p>The <code>BillPartitionMapper</code> artifact specifies the number of partitions
and the parameters for each partition. In this example, the parameters
represent the range of items each partition should process. The artifact
obtains the number of bills in the database to calculate these ranges.
It provides a partition plan object that overrides the <code>getPartitions</code>
and <code>getPartitionProperties</code> methods of the <code>PartitionPlan</code> interface.
The <code>getPartitions</code> method looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">Properties</span><span class="type">[]</span> getPartitionProperties() {
    <span class="comment">/* Assign an (approximately) equal number of elements
     * to each partition. */</span>
    <span class="type">long</span> totalItems = getBillCount();
    <span class="type">long</span> partItems = (<span class="type">long</span>) totalItems / getPartitions();
    <span class="type">long</span> remItems = totalItems % getPartitions();

    <span class="comment">/* Populate a Properties array. Each Properties element
     * in the array corresponds to a partition. */</span>
    <span class="predefined-type">Properties</span><span class="type">[]</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>[getPartitions()];

    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; getPartitions(); i++) {
        props[i] = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        props[i].setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstItem</span><span class="delimiter">&quot;</span></span>,
                <span class="predefined-type">String</span>.valueOf(i * partItems));
        <span class="comment">/* Last partition gets the remainder elements */</span>
        <span class="keyword">if</span> (i == getPartitions() - <span class="integer">1</span>) {
            props[i].setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">numItems</span><span class="delimiter">&quot;</span></span>,
                    <span class="predefined-type">String</span>.valueOf(partItems + remItems));
        } <span class="keyword">else</span> {
            props[i].setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">numItems</span><span class="delimiter">&quot;</span></span>,
                    <span class="predefined-type">String</span>.valueOf(partItems));
    }
    <span class="keyword">return</span> props;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>BillReader</code> artifact obtains the partition parameters as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">BillReader</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">BillReader</span> <span class="directive">implements</span> ItemReader {
    <span class="annotation">@Inject</span>    <span class="annotation">@BatchProperty</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">firstItem</span><span class="delimiter">&quot;</span></span>)    <span class="directive">private</span> <span class="predefined-type">String</span> firstItemValue;    <span class="annotation">@Inject</span>    <span class="annotation">@BatchProperty</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">numItems</span><span class="delimiter">&quot;</span></span>)    <span class="directive">private</span> <span class="predefined-type">String</span> numItemsValue;
    <span class="directive">private</span> ItemNumberCheckpoint checkpoint;    <span class="annotation">@PersistenceContext</span>    <span class="directive">private</span> EntityManager em;    <span class="directive">private</span> <span class="predefined-type">Iterator</span> iterator;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> open(<span class="predefined-type">Serializable</span> ckpt) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="comment">/* Get the range of items to work on in this partition */</span>
        <span class="type">long</span> firstItem0 = <span class="predefined-type">Long</span>.parseLong(firstItemValue);
        <span class="type">long</span> numItems0 = <span class="predefined-type">Long</span>.parseLong(numItemsValue);

        <span class="keyword">if</span> (ckpt == <span class="predefined-constant">null</span>) {
            <span class="comment">/* Create a checkpoint object for this partition */</span>
            checkpoint = <span class="keyword">new</span> ItemNumberCheckpoint();
            checkpoint.setItemNumber(firstItem0);
            checkpoint.setNumItems(numItems0);
        } <span class="keyword">else</span> {
            checkpoint = (ItemNumberCheckpoint) ckpt;
        }

        <span class="comment">/* Adjust range for this partition from the checkpoint */</span>
        <span class="type">long</span> firstItem = checkpoint.getItemNumber();
        <span class="type">long</span> numItems = numItems0 - (firstItem - firstItem0);
        ...
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This artifact also obtains an iterator to read items from the Jakarta Persistence entity
manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/* Obtain an iterator for the bills in this partition */</span>
<span class="predefined-type">String</span> query = <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT b FROM PhoneBill b ORDER BY b.phoneNumber</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">Query</span> q = em.createQuery(query).setFirstResult((<span class="type">int</span>) firstItem)
        .setMaxResults((<span class="type">int</span>) numItems);
iterator = q.getResultList().iterator();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>BillProcessor</code> artifact iterates over the list of call records in a
bill and calculates the tax and total amount due for each bill.</p>
</div>
<div class="paragraph">
<p>The <code>BillWriter</code> artifact writes each bill to a plain text file.</p>
</div>
<div class="paragraph">
<p><a id="sthref291"></a><a id="the-javaserver-faces-pages"></a></p>
</div>
</div>
<div class="sect5">
<h6 id="the-jakarta-server-faces-pages-2"><a class="anchor" href="#the-jakarta-server-faces-pages-2"></a>The Jakarta Server Faces Pages</h6>
<div class="paragraph">
<p>The <code>index.xhtml</code> page contains a text area that shows the log file of
call records. The page provides a button for the user to submit the
batch job and navigate to the next page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;body&gt;</span>
    <span class="tag">&lt;h1&gt;</span>The Phone Billing Example Application<span class="tag">&lt;/h1&gt;</span>
    <span class="tag">&lt;h2&gt;</span>Log file<span class="tag">&lt;/h2&gt;</span>
    <span class="tag">&lt;p&gt;</span>The batch job analyzes the following log file:<span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;textarea</span> <span class="attribute-name">cols</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">90</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">rows</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">25</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">readonly</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>#{jsfBean.createAndShowLog()}<span class="tag">&lt;/textarea&gt;</span>
    <span class="tag">&lt;p&gt;</span> <span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;h:form&gt;</span>
        <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Start Batch Job</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jsfBean.startBatchJob()}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/h:form&gt;</span>
<span class="tag">&lt;/body&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This page calls the methods of the managed bean to show the log file and
submit the batch job.</p>
</div>
<div class="paragraph">
<p>The <code>jobstarted.xhtml</code> page provides a button to check the current
status of the batch job and displays the bills when the job finishes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;p&gt;</span>Current Status of the Job: <span class="tag">&lt;b&gt;</span>#{jsfBean.jobStatus}<span class="tag">&lt;/b&gt;</span><span class="tag">&lt;/p&gt;</span>
<span class="tag">&lt;h:dataTable</span> <span class="attribute-name">var</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">_row</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jsfBean.rowList}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">border</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jsfBean.completed}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- ... show results from jsfBean.rowList ... --&gt;</span>
<span class="tag">&lt;/h:dataTable&gt;</span>
<span class="comment">&lt;!-- Render the check status button if the job has not finished --&gt;</span>
<span class="tag">&lt;h:form&gt;</span>
    <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Check Status</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jsfBean.completed==false}</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobstarted</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="sthref292"></a><a id="the-managed-bean"></a></p>
</div>
</div>
<div class="sect5">
<h6 id="the-managed-bean-2"><a class="anchor" href="#the-managed-bean-2"></a>The Managed Bean</h6>
<div class="paragraph">
<p>The <code>JsfBean</code> managed bean submits the job to the batch runtime, checks
on the status of the job, and reads the text files for each bill.</p>
</div>
<div class="paragraph">
<p>The <code>startBatchJob</code> method of the bean submits the job to the batch
runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/* Submit the batch job to the batch runtime.
 * JSF Navigation method (return the name of the next page) */</span>
<span class="directive">public</span> <span class="predefined-type">String</span> startBatchJob() {
    jobOperator = BatchRuntime.getJobOperator();
    execID = jobOperator.start(<span class="string"><span class="delimiter">&quot;</span><span class="content">phonebilling</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>);
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">jobstarted</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getJobStatus</code> method of the bean checks the status of the job:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/* Get the status of the job from the batch runtime */</span>
<span class="directive">public</span> <span class="predefined-type">String</span> getJobStatus() {
    <span class="keyword">return</span> jobOperator.getJobExecution(execID).getBatchStatus().toString();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getRowList</code> method of the bean creates a list of bills to be
displayed on the <code>jobstarted.xhtml</code> server faces page using a table.</p>
</div>
<div class="paragraph">
<p><a id="BABBGDAA"></a><a id="running-the-phonebilling-example-application"></a></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="running-the-phonebilling-example-application"><a class="anchor" href="#running-the-phonebilling-example-application"></a>Running the phonebilling Example Application</h5>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and
run the <code>phonebilling</code> example application.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BABIBBBG">To Run the phonebilling Example Application Using
NetBeans IDE</a></p>
</li>
<li>
<p><a href="#BABFHIIB">To Run the phonebilling Example Application Using
Maven</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BABIBBBG"></a><a id="to-run-the-phonebilling-example-application-using-netbeans-ide"></a></p>
</div>
<div class="sect5">
<h6 id="to-run-the-phonebilling-example-application-using-netbeans-ide"><a class="anchor" href="#to-run-the-phonebilling-example-application-using-netbeans-ide"></a>To Run the phonebilling Example Application Using NetBeans IDE</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/batch</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>phonebilling</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>phonebilling</code> project and
select Run.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file,
<code>phonebilling.war</code>, located in the <code>target/</code> directory; deploys it to
the server; and launches a web browser window at the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/phonebilling/</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BABFHIIB"></a><a id="to-run-the-phonebilling-example-application-using-maven"></a></p>
</div>
</div>
<div class="sect5">
<h6 id="to-run-the-phonebilling-example-application-using-maven"><a class="anchor" href="#to-run-the-phonebilling-example-application-using-maven"></a>To Run the phonebilling Example Application Using Maven</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/batch/phonebilling/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Open a web browser window at the following URL:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/phonebilling/</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BCGHCHAJ"></a><a id="further-information-about-batch-processing"></a></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="further-information-about-batch-processing"><a class="anchor" href="#further-information-about-batch-processing"></a>Further Information about Batch Processing</h4>
<div class="paragraph">
<p>For more information on batch processing in Jakarta EE, see Jakarta Batch:</p>
</div>
<div class="paragraph">
<p><code><a href="https://jakarta.ee/specifications/batch/1.0/" class="bare">https://jakarta.ee/specifications/batch/1.0/</a></code></p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-04-26 15:37:21 UTC
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</body>
</html>