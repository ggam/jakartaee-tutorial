<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.2">
<title>Jakarta Enterprise Beans</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement when using as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Jakarta Enterprise Beans</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_enterprise_beans">1. Enterprise Beans</a>
<ul class="sectlevel2">
<li><a href="#_what_is_an_enterprise_bean">1.1. What Is an Enterprise Bean?</a></li>
<li><a href="#_what_is_a_session_bean">1.2. What Is a Session Bean?</a></li>
<li><a href="#_what_is_a_message_driven_bean">1.3. What Is a Message-Driven Bean?</a></li>
<li><a href="#_accessing_enterprise_beans">1.4. Accessing Enterprise Beans</a></li>
<li><a href="#_the_contents_of_an_enterprise_bean">1.5. The Contents of an Enterprise Bean</a></li>
<li><a href="#_naming_conventions_for_enterprise_beans">1.6. Naming Conventions for Enterprise Beans</a></li>
<li><a href="#_the_lifecycles_of_enterprise_beans">1.7. The Lifecycles of Enterprise Beans</a></li>
<li><a href="#_further_information_about_enterprise_beans">1.8. Further Information about Enterprise Beans</a></li>
</ul>
</li>
<li><a href="#_getting_started_with_enterprise_beans">2. Getting Started with Enterprise Beans</a>
<ul class="sectlevel2">
<li><a href="#_starting_with_enterprise_beans">2.1. Starting With Enterprise Beans</a></li>
<li><a href="#_creating_the_enterprise_bean">2.2. Creating the Enterprise Bean</a></li>
<li><a href="#_modifying_the_jakarta_ee_application">2.3. Modifying the Jakarta EE Application</a></li>
</ul>
</li>
<li><a href="#_running_the_enterprise_bean_examples">3. Running the Enterprise Bean Examples</a>
<ul class="sectlevel2">
<li><a href="#_overview_of_the_jakarta_enterprise_beans_examples">3.1. Overview of the Jakarta Enterprise Beans Examples</a></li>
<li><a href="#_the_cart_example">3.2. The cart Example</a></li>
<li><a href="#_a_singleton_session_bean_example_counter">3.3. A Singleton Session Bean Example: counter</a></li>
<li><a href="#_a_web_service_example_helloservice">3.4. A Web Service Example: helloservice</a></li>
<li><a href="#_using_the_timer_service">3.5. Using the Timer Service</a></li>
<li><a href="#_handling_exceptions">3.6. Handling Exceptions</a></li>
</ul>
</li>
<li><a href="#_using_the_embedded_enterprise_bean_container">4. Using the Embedded Enterprise Bean Container</a>
<ul class="sectlevel2">
<li><a href="#_overview_of_the_embedded_enterprise_bean_container">4.1. Overview of the Embedded Enterprise Bean Container</a></li>
<li><a href="#_developing_embeddable_enterprise_bean_applications">4.2. Developing Embeddable Enterprise Bean Applications</a></li>
<li><a href="#_the_standalone_example_application">4.3. The standalone Example Application</a></li>
</ul>
</li>
<li><a href="#_using_asynchronous_method_invocation_in_session_beans">5. Using Asynchronous Method Invocation in Session Beans</a>
<ul class="sectlevel2">
<li><a href="#_asynchronous_method_invocation">5.1. Asynchronous Method Invocation</a></li>
<li><a href="#_the_async_example_application">5.2. The async Example Application</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_enterprise_beans">1. Enterprise Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="GIJSZ"></a><a id="enterprise-beans"></a></p>
</div>
<div class="paragraph">
<p>Enterprise beans are Jakarta EE components that implement Jakarta Enterprise Beans
technology. Enterprise beans run in the Enterprise Bean container, a
runtime environment within GlassFish Server (see
<a href="#BNABQ">Container Types</a>). Although transparent to
the application developer, the Enterprise Bean container provides system-level
services, such as transactions and security, to its enterprise beans.
These services enable you to quickly build and deploy enterprise beans,
which form the core of transactional Jakarta EE applications.</p>
</div>
<div class="paragraph">
<p><a id="GIPMB"></a><a id="what-is-an-enterprise-bean"></a></p>
</div>
<div class="sect2">
<h3 id="_what_is_an_enterprise_bean">1.1. What Is an Enterprise Bean?</h3>
<div class="paragraph">
<p>Written in the Java programming language, an enterprise bean is a
server-side component that encapsulates the business logic of an
application. The business logic is the code that fulfills the purpose of
the application. In an inventory control application, for example, the
enterprise beans might implement the business logic in methods called
<code>checkInventoryLevel</code> and <code>orderProduct</code>. By invoking these methods,
clients can access the inventory services provided by the application.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#GIPLK">Benefits of Enterprise Beans</a></p>
</li>
<li>
<p><a href="#GIPKN">When to Use Enterprise Beans</a></p>
</li>
<li>
<p><a href="#GIPNM">Types of Enterprise Beans</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GIPLK"></a><a id="benefits-of-enterprise-beans"></a></p>
</div>
<div class="sect3">
<h4 id="_benefits_of_enterprise_beans">1.1.1. Benefits of Enterprise Beans</h4>
<div class="paragraph">
<p>For several reasons, enterprise beans simplify the development of large,
distributed applications. First, because the Enterprise Bean container provides
system-level services to enterprise beans, the bean developer can
concentrate on solving business problems. The Enterprise Bean container, rather than
the bean developer, is responsible for system-level services, such as
transaction management and security authorization.</p>
</div>
<div class="paragraph">
<p>Second, because the beans rather than the clients contain the
application&#8217;s business logic, the client developer can focus on the
presentation of the client. The client developer does not have to code
the routines that implement business rules or access databases. As a
result, the clients are thinner, a benefit that is particularly
important for clients that run on small devices.</p>
</div>
<div class="paragraph">
<p>Third, because enterprise beans are portable components, the application
assembler can build new applications from existing beans. Provided that
they use the standard APIs, these applications can run on any compliant
Jakarta EE server.</p>
</div>
<div class="paragraph">
<p><a id="GIPKN"></a><a id="when-to-use-enterprise-beans"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_when_to_use_enterprise_beans">1.1.2. When to Use Enterprise Beans</h4>
<div class="paragraph">
<p>You should consider using enterprise beans if your application has any
of the following requirements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The application must be scalable. To accommodate a growing number of
users, you may need to distribute an application&#8217;s components across
multiple machines. Not only can the enterprise beans of an application
run on different machines, but also their location will remain
transparent to the clients.</p>
</li>
<li>
<p>Transactions must ensure data integrity. Enterprise beans support
transactions, the mechanisms that manage the concurrent access of shared
objects.</p>
</li>
<li>
<p>The application will have a variety of clients. With only a few lines
of code, remote clients can easily locate enterprise beans. These
clients can be thin, various, and numerous.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GIPNM"></a><a id="types-of-enterprise-beans"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_types_of_enterprise_beans">1.1.3. Types of Enterprise Beans</h4>
<div class="paragraph">
<p><a href="#GIPLZ">Table 35-1</a> summarizes the two types of enterprise beans.
The following sections discuss each type in more detail.</p>
</div>
<div class="paragraph">
<p><a id="sthref150"></a><a id="GIPLZ"></a></p>
</div>
<div class="paragraph">
<p>Table 35-1 Enterprise Bean Types</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 75%;">
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enterprise Bean Type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Purpose</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Performs a task for a client; optionally, may implement a web
service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message-driven</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Acts as a listener for a particular messaging type,
such as Jakarta Messaging</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="GIPJG"></a><a id="what-is-a-session-bean"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_what_is_a_session_bean">1.2. What Is a Session Bean?</h3>
<div class="paragraph">
<p>A session bean encapsulates business logic that can be invoked
programmatically by a client over local, remote, or web service client
views. To access an application that is deployed on the server, the
client invokes the session bean&#8217;s methods. The session bean performs
work for its client, shielding it from complexity by executing business
tasks inside the server.</p>
</div>
<div class="paragraph">
<p>A session bean is not persistent. (That is, its data is not saved to a
database.)</p>
</div>
<div class="paragraph">
<p>For code samples, see <a href="#GIJRB">Chapter 37,
"Running the Enterprise Bean Examples"</a>.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#GIPKR">Types of Session Beans</a></p>
</li>
<li>
<p><a href="#GIPMT">When to Use Session Beans</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GIPKR"></a><a id="types-of-session-beans"></a></p>
</div>
<div class="sect3">
<h4 id="_types_of_session_beans">1.2.1. Types of Session Beans</h4>
<div class="paragraph">
<p>Session beans are of three types: stateful, stateless, and singleton.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#GIPNL">Stateful Session Beans</a></p>
</li>
<li>
<p><a href="#GIPIN">Stateless Session Beans</a></p>
</li>
<li>
<p><a href="#GIPIM">Singleton Session Beans</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GIPNL"></a><a id="stateful-session-beans"></a></p>
</div>
<div class="sect4">
<h5 id="_stateful_session_beans">Stateful Session Beans</h5>
<div class="paragraph">
<p>The state of an object consists of the values of its instance variables.
In a stateful session bean, the instance variables represent the state
of a unique client/bean session. Because the client interacts ("talks")
with its bean, this state is often called the conversational state.</p>
</div>
<div class="paragraph">
<p>As its name suggests, a session bean is similar to an interactive
session. A session bean is not shared; it can have only one client, in
the same way that an interactive session can have only one user. When
the client terminates, its session bean appears to terminate and is no
longer associated with the client.</p>
</div>
<div class="paragraph">
<p>The state is retained for the duration of the client/bean session. If
the client removes the bean, the session ends and the state disappears.
This transient nature of the state is not a problem, however, because
when the conversation between the client and the bean ends, there is no
need to retain the state.</p>
</div>
<div class="paragraph">
<p><a id="GIPIN"></a><a id="stateless-session-beans"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_stateless_session_beans">Stateless Session Beans</h5>
<div class="paragraph">
<p>A stateless session bean does not maintain a conversational state with
the client. When a client invokes the methods of a stateless bean, the
bean&#8217;s instance variables may contain a state specific to that client
but only for the duration of the invocation. When the method is
finished, the client-specific state should not be retained. Clients may,
however, change the state of instance variables in pooled stateless
beans, and this state is held over to the next invocation of the pooled
stateless bean. Except during method invocation, all instances of a
stateless bean are equivalent, allowing the Enterprise Bean container to assign an
instance to any client. That is, the state of a stateless session bean
should apply across all clients.</p>
</div>
<div class="paragraph">
<p>Because they can support multiple clients, stateless session beans can
offer better scalability for applications that require large numbers of
clients. Typically, an application requires fewer stateless session
beans than stateful session beans to support the same number of clients.</p>
</div>
<div class="paragraph">
<p>A stateless session bean can implement a web service, but a stateful
session bean cannot.</p>
</div>
<div class="paragraph">
<p><a id="GIPIM"></a><a id="singleton-session-beans"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_singleton_session_beans">Singleton Session Beans</h5>
<div class="paragraph">
<p>A singleton session bean is instantiated once per application and exists
for the lifecycle of the application. Singleton session beans are
designed for circumstances in which a single enterprise bean instance is
shared across and concurrently accessed by clients.</p>
</div>
<div class="paragraph">
<p>Singleton session beans offer similar functionality to stateless session
beans but differ from them in that there is only one singleton session
bean per application, as opposed to a pool of stateless session beans,
any of which may respond to a client request. Like stateless session
beans, singleton session beans can implement web service endpoints.</p>
</div>
<div class="paragraph">
<p>Singleton session beans maintain their state between client invocations
but are not required to maintain their state across server crashes or
shutdowns.</p>
</div>
<div class="paragraph">
<p>Applications that use a singleton session bean may specify that the
singleton should be instantiated upon application startup, which allows
the singleton to perform initialization tasks for the application. The
singleton may perform cleanup tasks on application shutdown as well,
because the singleton will operate throughout the lifecycle of the
application.</p>
</div>
<div class="paragraph">
<p><a id="GIPMT"></a><a id="when-to-use-session-beans"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_when_to_use_session_beans">1.2.2. When to Use Session Beans</h4>
<div class="paragraph">
<p>Stateful session beans are appropriate if any of the following
conditions are true.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The bean&#8217;s state represents the interaction between the bean and a
specific client.</p>
</li>
<li>
<p>The bean needs to hold information about the client across method
invocations.</p>
</li>
<li>
<p>The bean mediates between the client and the other components of the
application, presenting a simplified view to the client.</p>
</li>
<li>
<p>Behind the scenes, the bean manages the work flow of several
enterprise beans.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To improve performance, you might choose a stateless session bean if it
has any of these traits.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The bean&#8217;s state has no data for a specific client.</p>
</li>
<li>
<p>In a single method invocation, the bean performs a generic task for
all clients. For example, you might use a stateless session bean to send
an email that confirms an online order.</p>
</li>
<li>
<p>The bean implements a web service.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Singleton session beans are appropriate in the following circumstances.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>State needs to be shared across the application.</p>
</li>
<li>
<p>A single enterprise bean needs to be accessed by multiple threads
concurrently.</p>
</li>
<li>
<p>The application needs an enterprise bean to perform tasks upon
application startup and shutdown.</p>
</li>
<li>
<p>The bean implements a web service.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GIPKO"></a><a id="what-is-a-message-driven-bean"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_what_is_a_message_driven_bean">1.3. What Is a Message-Driven Bean?</h3>
<div class="paragraph">
<p>A message-driven bean is an enterprise bean that allows Jakarta EE
applications to process messages asynchronously. This type of bean
normally acts as a Jakarta Messaging message listener, which is similar to an event
listener but receives Jakarta Messaging messages instead of events. The messages can
be sent by any Jakarta EE component (an application client, another
enterprise bean, or a web component) or by a Jakarta Messaging application or system
that does not use Jakarta EE technology. Message-driven beans can process
Jakarta Messaging messages or other kinds of messages.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#GIPMJ">What Makes Message-Driven Beans Different from Session
Beans?</a></p>
</li>
<li>
<p><a href="#GIPJX">When to Use Message-Driven Beans</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GIPMJ"></a><a id="what-makes-message-driven-beans-different-from-session-beans"></a></p>
</div>
<div class="sect3">
<h4 id="_what_makes_message_driven_beans_different_from_session_beans">1.3.1. What Makes Message-Driven Beans Different from Session Beans?</h4>
<div class="paragraph">
<p>The most visible difference between message-driven beans and session
beans is that clients do not access message-driven beans through
interfaces. Interfaces are described in the section
<a href="#GIPJF">Accessing Enterprise Beans</a>. Unlike a
session bean, a message-driven bean has only a bean class.</p>
</div>
<div class="paragraph">
<p>In several respects, a message-driven bean resembles a stateless session
bean.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A message-driven bean&#8217;s instances retain no data or conversational
state for a specific client.</p>
</li>
<li>
<p>All instances of a message-driven bean are equivalent, allowing the
Enterprise Bean container to assign a message to any message-driven bean instance.
The container can pool these instances to allow streams of messages to
be processed concurrently.</p>
</li>
<li>
<p>A single message-driven bean can process messages from multiple
clients.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The instance variables of the message-driven bean instance can contain
some state across the handling of client messages, such as a Jakarta Messaging
connection, an open database connection, or an object reference to an
enterprise bean object.</p>
</div>
<div class="paragraph">
<p>Client components do not locate message-driven beans and invoke methods
directly on them. Instead, a client accesses a message-driven bean
through, for example, Jakarta Messaging by sending messages to the message destination
for which the message-driven bean class is the <code>MessageListener</code>. You
assign a message-driven bean&#8217;s destination during deployment by using
GlassFish Server resources.</p>
</div>
<div class="paragraph">
<p>Message-driven beans have the following characteristics.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>They execute upon receipt of a single client message.</p>
</li>
<li>
<p>They are invoked asynchronously.</p>
</li>
<li>
<p>They are relatively short-lived.</p>
</li>
<li>
<p>They do not represent directly shared data in the database, but they
can access and update this data.</p>
</li>
<li>
<p>They can be transaction-aware.</p>
</li>
<li>
<p>They are stateless.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a message arrives, the container calls the message-driven bean&#8217;s
<code>onMessage</code> method to process the message. The <code>onMessage</code> method
normally casts the message to one of the five Jakarta Messaging message types and
handles it in accordance with the application&#8217;s business logic. The
<code>onMessage</code> method can call helper methods or can invoke a session bean
to process the information in the message or to store it in a database.</p>
</div>
<div class="paragraph">
<p>A message can be delivered to a message-driven bean within a transaction
context, so all operations within the <code>onMessage</code> method are part of a
single transaction. If message processing is rolled back, the message
will be redelivered. For more information, see
<a href="#BNBPK">Receiving Messages Asynchronously Using a
Message-Driven Bean</a> and <a href="#BNCIH">Chapter 54,
"Transactions"</a>.</p>
</div>
<div class="paragraph">
<p><a id="GIPJX"></a><a id="when-to-use-message-driven-beans"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_when_to_use_message_driven_beans">1.3.2. When to Use Message-Driven Beans</h4>
<div class="paragraph">
<p>Session beans allow you to send Jakarta Messaging messages and to receive them
synchronously but not asynchronously. To avoid tying up server
resources, do not to use blocking synchronous receives in a server-side
component; in general, Jakarta Messaging messages should not be sent or received
synchronously. To receive messages asynchronously, use a message-driven
bean.</p>
</div>
<div class="paragraph">
<p><a id="GIPJF"></a><a id="accessing-enterprise-beans"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_accessing_enterprise_beans">1.4. Accessing Enterprise Beans</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Note:</p>
</div>
<div class="paragraph">
<p>The material in this section applies only to session beans and not to
message-driven beans. Because they have a different programming model,
message-driven beans do not have interfaces or no-interface views that
define client access.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Clients access enterprise beans either through a no-interface view or
through a business interface. A no-interface view of an enterprise bean
exposes the public methods of the enterprise bean implementation class
to clients. Clients using the no-interface view of an enterprise bean
may invoke any public methods in the enterprise bean implementation
class or any superclasses of the implementation class. A business
interface is a standard Java programming language interface that
contains the business methods of the enterprise bean.</p>
</div>
<div class="paragraph">
<p>A client can access a session bean only through the methods defined in
the bean&#8217;s business interface or through the public methods of an
enterprise bean that has a no-interface view. The business interface or
no-interface view defines the client&#8217;s view of an enterprise bean. All
other aspects of the enterprise bean (method implementations and
deployment settings) are hidden from the client.</p>
</div>
<div class="paragraph">
<p>Well-designed interfaces and no-interface views simplify the development
and maintenance of Jakarta EE applications. Not only do clean interfaces
and no-interface views shield the clients from any complexities in the
Enterprise Bean tier, but they also allow the enterprise beans to change internally
without affecting the clients. For example, if you change the
implementation of a session bean business method, you won&#8217;t have to
alter the client code. But if you were to change the method definitions
in the interfaces, you might have to modify the client code as well.
Therefore, it is important that you design the interfaces and
no-interface views carefully to isolate your clients from possible
changes in the enterprise beans.</p>
</div>
<div class="paragraph">
<p>Session beans can have more than one business interface. Session beans
should, but are not required to, implement their business interface or
interfaces.</p>
</div>
<div class="paragraph">
<p><a id="GIRFL"></a><a id="using-enterprise-beans-in-clients"></a></p>
</div>
<div class="sect3">
<h4 id="_using_enterprise_beans_in_clients">1.4.1. Using Enterprise Beans in Clients</h4>
<div class="paragraph">
<p>The client of an enterprise bean obtains a reference to an instance of
an enterprise bean through either dependency injection, using Java
programming language annotations, or JNDI lookup, using the Java Naming
and Directory Interface syntax to find the enterprise bean instance.</p>
</div>
<div class="paragraph">
<p>Dependency injection is the simplest way of obtaining an enterprise bean
reference. Clients that run within a Jakarta EE server-managed environment,
Jakarta Server Faces web applications, Jakarta RESTful web services, other enterprise
beans, or Jakarta EE application clients support dependency injection using
the <code>javax.ejb.EJB</code> annotation.</p>
</div>
<div class="paragraph">
<p>Applications that run outside a Jakarta EE server-managed environment, such
as Java SE applications, must perform an explicit lookup. JNDI supports
a global syntax for identifying Jakarta EE components to simplify this
explicit lookup.</p>
</div>
<div class="paragraph">
<p><a id="GIRGN"></a><a id="portable-jndi-syntax"></a></p>
</div>
<div class="sect4">
<h5 id="_portable_jndi_syntax">Portable JNDI Syntax</h5>
<div class="paragraph">
<p>Three JNDI namespaces are used for portable JNDI lookups: <code>java:global</code>,
<code>java:module</code>, and <code>java:app</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>java:global</code> JNDI namespace is the portable way of finding remote
enterprise beans using JNDI lookups. JNDI addresses are of the following
form:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">java:global[/application name]/module name /enterprise bean name[/<span class="type">interface</span> <span class="class">name</span> ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Application name and module name default to the name of the application
and module minus the file extension. Application names are required only
if the application is packaged within an EAR. The interface name is
required only if the enterprise bean implements more than one business
interface.</p>
</div>
</li>
<li>
<p>The <code>java:module</code> namespace is used to look up local enterprise beans
within the same module. JNDI addresses using the <code>java:module</code> namespace
are of the following form:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">java:module/enterprise bean name/[<span class="type">interface</span> <span class="class">name</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The interface name is required only if the enterprise bean implements
more than one business interface.</p>
</div>
</li>
<li>
<p>The <code>java:app</code> namespace is used to look up local enterprise beans
packaged within the same application. That is, the enterprise bean is
packaged within an EAR file containing multiple Jakarta EE modules. JNDI
addresses using the <code>java:app</code> namespace are of the following form:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">java:app[/module name]/enterprise bean name [/<span class="type">interface</span> <span class="class">name</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The module name is optional. The interface name is required only if the
enterprise bean implements more than one business interface.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if an enterprise bean, <code>MyBean</code>, is packaged within the web
application archive <code>myApp.war</code>, the module name is <code>myApp</code>. The
portable JNDI name is <code>java:module/MyBean</code>. An equivalent JNDI name
using the <code>java:global</code> namespace is <code>java:global/myApp/MyBean</code>.</p>
</div>
<div class="paragraph">
<p><a id="GIPIZ"></a><a id="deciding-on-remote-or-local-access"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_deciding_on_remote_or_local_access">1.4.2. Deciding on Remote or Local Access</h4>
<div class="paragraph">
<p>When you design a Jakarta EE application, one of the first decisions you
make is the type of client access allowed by the enterprise beans:
remote, local, or web service.</p>
</div>
<div class="paragraph">
<p>Whether to allow local or remote access depends on the following
factors.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tight or loose coupling of related beans: Tightly coupled beans depend
on one another. For example, if a session bean that processes sales
orders calls a session bean that emails a confirmation message to the
customer, these beans are tightly coupled. Tightly coupled beans are
good candidates for local access. Because they fit together as a logical
unit, they typically call each other often and would benefit from the
increased performance that is possible with local access.</p>
</li>
<li>
<p>Type of client: If an enterprise bean is accessed by application
clients, it should allow remote access. In a production environment,
these clients almost always run on machines other than those on which
GlassFish Server is running. If an enterprise bean&#8217;s clients are web
components or other enterprise beans, the type of access depends on how
you want to distribute your components.</p>
</li>
<li>
<p>Component distribution: Jakarta EE applications are scalable because
their server-side components can be distributed across multiple
machines. In a distributed application, for example, the server that the
web components run on may not be the one on which the enterprise beans
they access are deployed. In this distributed scenario, the enterprise
beans should allow remote access.</p>
</li>
<li>
<p>Performance: Owing to such factors as network latency, remote calls
may be slower than local calls. On the other hand, if you distribute
components among different servers, you may improve the application&#8217;s
overall performance. Both of these statements are generalizations;
performance can vary in different operational environments.
Nevertheless, you should keep in mind how your application design might
affect performance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you aren&#8217;t sure which type of access an enterprise bean should have,
choose remote access. This decision gives you more flexibility. In the
future, you can distribute your components to accommodate the growing
demands on your application.</p>
</div>
<div class="paragraph">
<p>Although it is uncommon, it is possible for an enterprise bean to allow
both remote and local access. If this is the case, either the business
interface of the bean must be explicitly designated as a business
interface by being decorated with the <code>@Remote</code> or <code>@Local</code> annotations,
or the bean class must explicitly designate the business interfaces by
using the <code>@Remote</code> and <code>@Local</code> annotations. The same business
interface cannot be both a local and a remote business interface.</p>
</div>
<div class="paragraph">
<p><a id="GIPMZ"></a><a id="local-clients"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_local_clients">1.4.3. Local Clients</h4>
<div class="paragraph">
<p>A local client has these characteristics.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It must run in the same application as the enterprise bean it
accesses.</p>
</li>
<li>
<p>It can be a web component or another enterprise bean.</p>
</li>
<li>
<p>To the local client, the location of the enterprise bean it accesses
is not transparent.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The no-interface view of an enterprise bean is a local view. The public
methods of the enterprise bean implementation class are exposed to local
clients that access the no-interface view of the enterprise bean.
Enterprise beans that use the no-interface view do not implement a
business interface.</p>
</div>
<div class="paragraph">
<p>The local business interface defines the bean&#8217;s business and lifecycle
methods. If the bean&#8217;s business interface is not decorated with <code>@Local</code>
or <code>@Remote</code>, and if the bean class does not specify the interface using
<code>@Local</code> or <code>@Remote</code>, the business interface is by default a local
interface.</p>
</div>
<div class="paragraph">
<p>To build an enterprise bean that allows only local access, you may, but
are not required to, do one of the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create an enterprise bean implementation class that does not implement
a business interface, indicating that the bean exposes a no-interface
view to clients. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Session</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyBean</span> { ... }</code></pre>
</div>
</div>
</li>
<li>
<p>Annotate the business interface of the enterprise bean as a <code>@Local</code>
interface. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Local</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">InterfaceName</span> { ... }</code></pre>
</div>
</div>
</li>
<li>
<p>Specify the interface by decorating the bean class with <code>@Local</code> and
specify the interface name. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Local</span>(InterfaceName.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">BeanName</span> <span class="directive">implements</span> InterfaceName  { ... }</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GIPSC"></a><a id="accessing-local-enterprise-beans-using-the-no-interface-view"></a></p>
</div>
<div class="sect4">
<h5 id="_accessing_local_enterprise_beans_using_the_no_interface_view">Accessing Local Enterprise Beans Using the No-Interface View</h5>
<div class="paragraph">
<p>Client access to an enterprise bean that exposes a local, no-interface
view is accomplished through either dependency injection or JNDI lookup.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To obtain a reference to the no-interface view of an enterprise bean
through dependency injection, use the <code>javax.ejb.EJB</code> annotation and
specify the enterprise bean&#8217;s implementation class:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EJB</span>
ExampleBean exampleBean;</code></pre>
</div>
</div>
</li>
<li>
<p>To obtain a reference to the no-interface view of an enterprise bean
through JNDI lookup, use the <code>javax.naming.InitialContext</code> interface&#8217;s
<code>lookup</code> method:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExampleBean exampleBean = (ExampleBean)
        <span class="predefined-type">InitialContext</span>.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:module/ExampleBean</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Clients do not use the <code>new</code> operator to obtain a new instance of an
enterprise bean that uses a no-interface view.</p>
</div>
<div class="paragraph">
<p><a id="GIPSE"></a><a id="accessing-local-enterprise-beans-that-implement-business-interfaces"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_accessing_local_enterprise_beans_that_implement_business_interfaces">Accessing Local Enterprise Beans That Implement Business Interfaces</h5>
<div class="paragraph">
<p>Client access to enterprise beans that implement local business
interfaces is accomplished through either dependency injection or JNDI
lookup.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To obtain a reference to the local business interface of an enterprise
bean through dependency injection, use the <code>javax.ejb.EJB</code> annotation
and specify the enterprise bean&#8217;s local business interface name:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EJB</span>
Example example;</code></pre>
</div>
</div>
</li>
<li>
<p>To obtain a reference to a local business interface of an enterprise
bean through JNDI lookup, use the <code>javax.naming.InitialContext</code>
interface&#8217;s <code>lookup</code> method:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExampleLocal example = (ExampleLocal)
         <span class="predefined-type">InitialContext</span>.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:module/ExampleLocal</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GIPIU"></a><a id="remote-clients"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_remote_clients">1.4.4. Remote Clients</h4>
<div class="paragraph">
<p>A remote client of an enterprise bean has the following traits.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It can run on a different machine and a different JVM from the
enterprise bean it accesses. (It is not required to run on a different
JVM.)</p>
</li>
<li>
<p>It can be a web component, an application client, or another
enterprise bean.</p>
</li>
<li>
<p>To a remote client, the location of the enterprise bean is
transparent.</p>
</li>
<li>
<p>The enterprise bean must implement a business interface. That is,
remote clients may not access an enterprise bean through a no-interface
view.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To create an enterprise bean that allows remote access, you must either</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Decorate the business interface of the enterprise bean with the
<code>@Remote</code> annotation:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Remote</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">InterfaceName</span> { ... }</code></pre>
</div>
</div>
</li>
<li>
<p>Or decorate the bean class with <code>@Remote</code>, specifying the business
interface or interfaces:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Remote</span>(InterfaceName.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">BeanName</span> <span class="directive">implements</span> InterfaceName { ... }</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The remote interface defines the business and lifecycle methods that are
specific to the bean. For example, the remote interface of a bean named
<code>BankAccountBean</code> might have business methods named <code>deposit</code> and
<code>credit</code>. <a href="#GIPNO">Figure 35-1</a> shows how the interface controls the
client&#8217;s view of an enterprise bean.</p>
</div>
<div id="GIPNO" class="paragraph">
<div class="title"><strong>Figure 35-1 Interfaces for an Enterprise Bean with Remote Access</strong></div>
<p><span class="image"><img src="../images/jakartaeett_dt_020.png" alt="Diagram showing a remote client accessing an enterprise bean&#8217;s methods through its remote interface."></span></p>
</div>
<div class="paragraph">
<p>Client access to an enterprise bean that implements a remote business
interface is accomplished through either dependency injection or JNDI
lookup.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To obtain a reference to the remote business interface of an
enterprise bean through dependency injection, use the <code>javax.ejb.EJB</code>
annotation and specify the enterprise bean&#8217;s remote business interface
name:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EJB</span>
Example example;</code></pre>
</div>
</div>
</li>
<li>
<p>To obtain a reference to a remote business interface of an enterprise
bean through JNDI lookup, use the <code>javax.naming.InitialContext</code>
interface&#8217;s <code>lookup</code> method:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExampleRemote example = (ExampleRemote)
        <span class="predefined-type">InitialContext</span>.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/myApp/ExampleRemote</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GIPKD"></a><a id="web-service-clients"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_web_service_clients">1.4.5. Web Service Clients</h4>
<div class="paragraph">
<p>A web service client can access a Jakarta EE application in two ways.
First, the client can access a web service created with Jakarta XML Web Services. (For
more information on Jakarta XML Web Services, see <a href="#BNAYL">Chapter 31,
"Building Web Services with Jakarta XML Web Services"</a>.) Second, a web service client can
invoke the business methods of a stateless session bean. Message beans
cannot be accessed by web service clients.</p>
</div>
<div class="paragraph">
<p>Provided that it uses the correct protocols (SOAP, HTTP, WSDL), any web
service client can access a stateless session bean, whether or not the
client is written in the Java programming language. The client doesn&#8217;t
even "know" what technology implements the service: stateless session
bean, Jakarta XML Web Services, or some other technology. In addition, enterprise beans
and web components can be clients of web services. This flexibility
enables you to integrate Jakarta EE applications with web services.</p>
</div>
<div class="paragraph">
<p>A web service client accesses a stateless session bean through the
bean&#8217;s web service endpoint implementation class. By default, all public
methods in the bean class are accessible to web service clients. The
<code>@WebMethod</code> annotation may be used to customize the behavior of web
service methods. If the <code>@WebMethod</code> annotation is used to decorate the
bean class&#8217;s methods, only those methods decorated with <code>@WebMethod</code> are
exposed to web service clients.</p>
</div>
<div class="paragraph">
<p>For a code sample, see <a href="#BNBOR">A Web Service
Example: helloservice</a>.</p>
</div>
<div class="paragraph">
<p><a id="GIPLY"></a><a id="method-parameters-and-access"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_method_parameters_and_access">1.4.6. Method Parameters and Access</h4>
<div class="paragraph">
<p>The type of access affects the parameters of the bean methods that are
called by clients. The following sections apply not only to method
parameters but also to method return values.</p>
</div>
<div class="paragraph">
<p><a id="GIPLX"></a><a id="isolation"></a></p>
</div>
<div class="sect4">
<h5 id="_isolation">Isolation</h5>
<div class="paragraph">
<p>The parameters of remote calls are more isolated than those of local
calls. With remote calls, the client and the bean operate on different
copies of a parameter object. If the client changes the value of the
object, the value of the copy in the bean does not change. This layer of
isolation can help protect the bean if the client accidentally modifies
the data.</p>
</div>
<div class="paragraph">
<p>In a local call, both the client and the bean can modify the same
parameter object. In general, you should not rely on this side effect of
local calls. Perhaps someday you will want to distribute your
components, replacing the local calls with remote ones.</p>
</div>
<div class="paragraph">
<p>As with remote clients, web service clients operate on different copies
of parameters than does the bean that implements the web service.</p>
</div>
<div class="paragraph">
<p><a id="GIPKV"></a><a id="granularity-of-accessed-data"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_granularity_of_accessed_data">Granularity of Accessed Data</h5>
<div class="paragraph">
<p>Because remote calls are likely to be slower than local calls, the
parameters in remote methods should be relatively coarse-grained. A
coarse-grained object contains more data than a fine-grained one, so
fewer access calls are required. For the same reason, the parameters of
the methods called by web service clients should also be coarse-grained.</p>
</div>
<div class="paragraph">
<p><a id="GIPIO"></a><a id="the-contents-of-an-enterprise-bean"></a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_contents_of_an_enterprise_bean">1.5. The Contents of an Enterprise Bean</h3>
<div class="paragraph">
<p>To develop an enterprise bean, you must provide the following files.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enterprise bean class: Implements the business methods of the
enterprise bean and any lifecycle callback methods.</p>
</li>
<li>
<p>Business interfaces: Define the business methods implemented by the
enterprise bean class. A business interface is not required if the
enterprise bean exposes a local, no-interface view.</p>
</li>
<li>
<p>Helper classes: Other classes needed by the enterprise bean class,
such as exception and utility classes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Package the programming artifacts in the preceding list either into an
Enterprise Bean JAR file (a stand-alone module that stores the enterprise bean) or
within a web application archive (WAR) module. See
<a href="#CHDFCDBG">Packaging Enterprise Beans in Enterprise Bean JAR
Modules</a> and <a href="#CHDJABEJ">Packaging Enterprise Beans
in WAR Modules</a> for more information.</p>
</div>
<div class="paragraph">
<p><a id="GIPKS"></a><a id="naming-conventions-for-enterprise-beans"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_naming_conventions_for_enterprise_beans">1.6. Naming Conventions for Enterprise Beans</h3>
<div class="paragraph">
<p>Because enterprise beans are composed of multiple parts, it&#8217;s useful to
follow a naming convention for your applications. <a href="#GIPLL">Table
35-2</a> summarizes the conventions for the example beans in this tutorial.</p>
</div>
<div class="paragraph">
<p><a id="sthref152"></a><a id="GIPLL"></a></p>
</div>
<div class="paragraph">
<p>Table 35-2 Naming Conventions for Enterprise Beans</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 63%;">
<colgroup>
<col style="width: 40%;">
<col style="width: 30%;">
<col style="width: 30%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Item</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Syntax</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Example</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enterprise bean name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name`Bean`</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AccountBean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enterprise bean class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name`Bean`</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AccountBean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Business interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Account</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="GIPLJ"></a><a id="the-lifecycles-of-enterprise-beans"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_the_lifecycles_of_enterprise_beans">1.7. The Lifecycles of Enterprise Beans</h3>
<div class="paragraph">
<p>An enterprise bean goes through various stages during its lifetime, or
lifecycle. Each type of enterprise bean (stateful session, stateless
session, singleton session, or message-driven) has a different
lifecycle.</p>
</div>
<div class="paragraph">
<p>The descriptions that follow refer to methods that are explained along
with the code examples in the next two chapters. If you are new to
enterprise beans, you should skip this section and run the code examples
first.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#GIPLN">The Lifecycle of a Stateful Session Bean</a></p>
</li>
<li>
<p><a href="#GIPLM">The Lifecycle of a Stateless Session Bean</a></p>
</li>
<li>
<p><a href="#GIPRX">The Lifecycle of a Singleton Session Bean</a></p>
</li>
<li>
<p><a href="#GIPKW">The Lifecycle of a Message-Driven Bean</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GIPLN"></a><a id="the-lifecycle-of-a-stateful-session-bean"></a></p>
</div>
<div class="sect3">
<h4 id="_the_lifecycle_of_a_stateful_session_bean">1.7.1. The Lifecycle of a Stateful Session Bean</h4>
<div class="paragraph">
<p><a href="#GIPMI">Figure 35-2</a> illustrates the stages that a stateful session
bean passes through during its lifetime. The client initiates the
lifecycle by obtaining a reference to a stateful session bean. The
container performs any dependency injection and then invokes the method
annotated with <code>@PostConstruct</code>, if any. The bean is now ready to have
its business methods invoked by the client.</p>
</div>
<div id="GIPMI" class="paragraph">
<div class="title"><strong>Figure 35-2 Lifecycle of a Stateful Session Bean</strong></div>
<p><span class="image"><img src="../images/jakartaeett_dt_021.png" alt="Diagram showing the lifecycle of a stateful session bean."></span></p>
</div>
<div class="paragraph">
<p>While in the ready stage, the Enterprise Bean container may decide to deactivate, or
passivate, the bean by moving it from memory to secondary storage.
(Typically, the Enterprise Bean container uses a least-recently-used algorithm to
select a bean for passivation.) The Enterprise Bean container invokes the method
annotated <code>@PrePassivate</code>, if any, immediately before passivating it. If
a client invokes a business method on the bean while it is in the
passive stage, the Enterprise Bean container activates the bean, calls the method
annotated <code>@PostActivate</code>, if any, and then moves it to the ready stage.</p>
</div>
<div class="paragraph">
<p>At the end of the lifecycle, the client invokes a method annotated
<code>@Remove</code>, and the Enterprise Bean container calls the method annotated
<code>@PreDestroy</code>, if any. The bean&#8217;s instance is then ready for garbage
collection.</p>
</div>
<div class="paragraph">
<p>Your code controls the invocation of only one lifecycle method: the
method annotated <code>@Remove</code>. All other methods in <a href="#GIPMI">Figure
35-2</a> are invoked by the Enterprise Bean container. See
<a href="#BNCJH">Chapter 55, "Resource Adapters and Contracts"</a>
for more information.</p>
</div>
<div class="paragraph">
<p><a id="GIPLM"></a><a id="the-lifecycle-of-a-stateless-session-bean"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_the_lifecycle_of_a_stateless_session_bean">1.7.2. The Lifecycle of a Stateless Session Bean</h4>
<div class="paragraph">
<p>Because a stateless session bean is never passivated, its lifecycle has
only two stages: nonexistent and ready for the invocation of business
methods. <a href="#GIPNI">Figure 35-3</a> illustrates the stages of a stateless
session bean.</p>
</div>
<div id="GIPNI" class="paragraph">
<div class="title"><strong>Figure 35-3 Lifecycle of a Stateless or Singleton Session Bean</strong></div>
<p><span class="image"><img src="../images/jakartaeett_dt_022.png" alt="Diagram showing the lifecycle of a stateless or singleton session bean."></span></p>
</div>
<div class="paragraph">
<p>The Enterprise Bean container typically creates and maintains a pool of stateless
session beans, beginning the stateless session bean&#8217;s lifecycle. The
container performs any dependency injection and then invokes the method
annotated <code>@PostConstruct</code>, if it exists. The bean is now ready to have
its business methods invoked by a client.</p>
</div>
<div class="paragraph">
<p>At the end of the lifecycle, the Enterprise Bean container calls the method
annotated <code>@PreDestroy</code>, if it exists. The bean&#8217;s instance is then ready
for garbage collection.</p>
</div>
<div class="paragraph">
<p><a id="GIPRX"></a><a id="the-lifecycle-of-a-singleton-session-bean"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_the_lifecycle_of_a_singleton_session_bean">1.7.3. The Lifecycle of a Singleton Session Bean</h4>
<div class="paragraph">
<p>Like a stateless session bean, a singleton session bean is never
passivated and has only two stages, nonexistent and ready for the
invocation of business methods, as shown in <a href="#GIPNI">Figure 35-3</a>.</p>
</div>
<div class="paragraph">
<p>The Enterprise Bean container initiates the singleton session bean lifecycle by
creating the singleton instance. This occurs upon application deployment
if the singleton is annotated with the <code>@Startup</code> annotation. The
container performs any dependency injection and then invokes the method
annotated <code>@PostConstruct</code>, if it exists. The singleton session bean is
now ready to have its business methods invoked by the client.</p>
</div>
<div class="paragraph">
<p>At the end of the lifecycle, the Enterprise Bean container calls the method
annotated <code>@PreDestroy</code>, if it exists. The singleton session bean is now
ready for garbage collection.</p>
</div>
<div class="paragraph">
<p><a id="GIPKW"></a><a id="the-lifecycle-of-a-message-driven-bean"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_the_lifecycle_of_a_message_driven_bean">1.7.4. The Lifecycle of a Message-Driven Bean</h4>
<div class="paragraph">
<p><a href="#GIPLR">Figure 35-4</a> illustrates the stages in the lifecycle of a
message-driven bean.</p>
</div>
<div id="GIPLR" class="paragraph">
<div class="title"><strong>Figure 35-4 Lifecycle of a Message-Driven Bean</strong></div>
<p><span class="image"><img src="../images/jakartaeett_dt_023.png" alt="Diagram showing the lifecycle of a message-driven bean."></span></p>
</div>
<div class="paragraph">
<p>The Enterprise Bean container usually creates a pool of message-driven bean
instances. For each instance, the Enterprise Bean container performs these tasks.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the message-driven bean uses dependency injection, the container
injects these references before instantiating the instance.</p>
</li>
<li>
<p>The container calls the method annotated <code>@PostConstruct</code>, if any.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Like a stateless session bean, a message-driven bean is never passivated
and has only two states: nonexistent and ready to receive messages.</p>
</div>
<div class="paragraph">
<p>At the end of the lifecycle, the container calls the method annotated
<code>@PreDestroy</code>, if any. The bean&#8217;s instance is then ready for garbage
collection.</p>
</div>
<div class="paragraph">
<p><a id="GIPLG"></a><a id="further-information-about-enterprise-beans"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_further_information_about_enterprise_beans">1.8. Further Information about Enterprise Beans</h3>
<div class="paragraph">
<p>For more information on Jakarta Enterprise Beans technology, see the Jakarta Enterprise Beans 3.2 specification:</p>
</div>
<div class="paragraph">
<p>+
<code><a href="https://jakarta.ee/specifications/enterprise-beans/3.2/" class="bare">https://jakarta.ee/specifications/enterprise-beans/3.2/</a></code></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started_with_enterprise_beans">2. Getting Started with Enterprise Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="GIJRE"></a><a id="getting-started-with-enterprise-beans"></a></p>
</div>
<div class="paragraph">
<p>This chapter shows how to develop, deploy, and run a simple Jakarta EE
application named <code>converter</code> that uses an enterprise bean for its business logic.
The purpose of <code>converter</code> is to calculate currency conversions among
Japanese yen, euros, and US dollars. The <code>converter</code> application
consists of an enterprise bean, which performs the calculations, and a
web client.</p>
</div>
<div class="paragraph">
<p><a id="A1249349"></a><a id="starting-with-enterprise-beans"></a></p>
</div>
<div class="sect2">
<h3 id="_starting_with_enterprise_beans">2.1. Starting With Enterprise Beans</h3>
<div class="paragraph">
<p>Here&#8217;s an overview of the steps you&#8217;ll follow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the enterprise bean: <code>ConverterBean</code>.</p>
</li>
<li>
<p>Create the web client.</p>
</li>
<li>
<p>Deploy <code>converter</code> onto the server.</p>
</li>
<li>
<p>Using a browser, run the web client.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Before proceeding, make sure that you&#8217;ve done the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Read <a href="#BNAAW">Chapter 1, "Overview"</a></p>
</li>
<li>
<p>Become familiar with enterprise beans (see
<a href="#GIJSZ">Chapter 35, "Enterprise Beans"</a>)</p>
</li>
<li>
<p>Started the server (see <a href="#BNADI">Starting and
Stopping GlassFish Server</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#GIPSS">Creating the Enterprise Bean</a></p>
</li>
<li>
<p><a href="#GIPTI">Modifying the Jakarta EE
Application</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GIPSS"></a><a id="creating-the-enterprise-bean"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_the_enterprise_bean">2.2. Creating the Enterprise Bean</h3>
<div class="paragraph">
<p>The enterprise bean in our example is a stateless session bean called
<code>ConverterBean</code>. The source code for <code>ConverterBean</code> is in the
<code><em>tut-install</em>/examples/ejb/converter/src/main/java/</code> directory.</p>
</div>
<div class="paragraph">
<p>Creating <code>ConverterBean</code> requires these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Coding the bean&#8217;s implementation class (the source code is provided)</p>
</li>
<li>
<p>Compiling the source code</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GIPSX"></a><a id="coding-the-enterprise-bean-class"></a></p>
</div>
<div class="sect3">
<h4 id="_coding_the_enterprise_bean_class">2.2.1. Coding the Enterprise Bean Class</h4>
<div class="paragraph">
<p>The enterprise bean class for this example is called <code>ConverterBean</code>.
This class implements two business methods: <code>dollarToYen</code> and
<code>yenToEuro</code>. Because the enterprise bean class doesn&#8217;t implement a
business interface, the enterprise bean exposes a local, no-interface
view. The public methods in the enterprise bean class are available to
clients that obtain a reference to <code>ConverterBean</code>. The source code for
the <code>ConverterBean</code> class is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">jakarta.tutorial.converter.ejb</span>;

<span class="keyword">import</span> <span class="include">java.math.BigDecimal</span>;
<span class="keyword">import</span> <span class="include">javax.ejb</span>.*;

<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ConverterBean</span> {
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> yenRate = <span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">83.0602</span><span class="delimiter">&quot;</span></span>);
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> euroRate = <span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">0.0093016</span><span class="delimiter">&quot;</span></span>);

    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> dollarToYen(<span class="predefined-type">BigDecimal</span> dollars) {
        <span class="predefined-type">BigDecimal</span> result = dollars.multiply(yenRate);
        <span class="keyword">return</span> result.setScale(<span class="integer">2</span>, <span class="predefined-type">BigDecimal</span>.ROUND_UP);
    }

    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> yenToEuro(<span class="predefined-type">BigDecimal</span> yen) {
        <span class="predefined-type">BigDecimal</span> result = yen.multiply(euroRate);
        <span class="keyword">return</span> result.setScale(<span class="integer">2</span>, <span class="predefined-type">BigDecimal</span>.ROUND_UP);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>@Stateless</code> annotation decorating the enterprise bean class.
This annotation lets the container know that <code>ConverterBean</code> is a
stateless session bean.</p>
</div>
<div class="paragraph">
<p><a id="GIPSI"></a><a id="creating-the-converter-web-client"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_creating_the_converter_web_client">2.2.2. Creating the converter Web Client</h4>
<div class="paragraph">
<p>The web client is contained in the following servlet class under the
<code><em>tut-install</em>/examples/ejb/converter/src/main/java/</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">converter/web/ConverterServlet.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>A Jakarta servlet is a web component that responds to HTTP requests.</p>
</div>
<div class="paragraph">
<p>The <code>ConverterServlet</code> class uses dependency injection to obtain a
reference to <code>ConverterBean</code>. The <code>javax.ejb.EJB</code> annotation is added to
the declaration of the private member variable <code>converter</code>, which is of
type <code>ConverterBean</code>. <code>ConverterBean</code> exposes a local, no-interface
view, so the enterprise bean implementation class is the variable type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(urlPatterns=<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ConverterServlet</span> <span class="directive">extends</span> HttpServlet {
  <span class="annotation">@EJB</span>
  ConverterBean converter;
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the user enters an amount to be converted to yen and euro, the
amount is retrieved from the request parameters; then the
<code>ConverterBean.dollarToYen</code> and the <code>ConverterBean.yenToEuro</code> methods
are called:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
try {
  <span class="predefined-type">String</span> amount = request.getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">amount</span><span class="delimiter">&quot;</span></span>);
  <span class="keyword">if</span> (amount != <span class="predefined-constant">null</span> &amp;&amp; amount.length()&gt; <span class="integer">0</span>) {
    <span class="comment">// convert the amount to a BigDecimal from the request parameter</span>
    <span class="predefined-type">BigDecimal</span> d = <span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(amount);
    <span class="comment">// call the ConverterBean.dollarToYen() method to get the amount</span>
    <span class="comment">// in Yen</span>
    <span class="predefined-type">BigDecimal</span> yenAmount = converter.dollarToYen(d);

    <span class="comment">// call the ConverterBean.yenToEuro() method to get the amount</span>
    <span class="comment">// in Euros</span>
    <span class="predefined-type">BigDecimal</span> euroAmount = converter.yenToEuro(yenAmount);
    ...
  }
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The results are displayed to the user.</p>
</div>
<div class="paragraph">
<p><a id="GIPVV"></a><a id="running-the-converter-example"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_running_the_converter_example">2.2.3. Running the converter Example</h4>
<div class="paragraph">
<p>Now you are ready to compile the enterprise bean class
(<code>ConverterBean.java</code>) and the servlet class (<code>ConverterServlet.java</code>)
and to package the compiled classes into a WAR file. You can use either
NetBeans IDE or Maven to build, package, deploy, and run the <code>converter</code>
example.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#GIPUM">To Run the converter Example Using NetBeans IDE</a></p>
</li>
<li>
<p><a href="#GIPVQ">To Run the converter Example Using Maven</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GIPUM"></a><a id="to-run-the-converter-example-using-netbeans-ide"></a></p>
</div>
<div class="sect4">
<h5 id="_to_run_the_converter_example_using_netbeans_ide">To Run the converter Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/ejb</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>converter</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>converter</code> project and select
Build.</p>
</li>
<li>
<p>Open a web browser to the following URL:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/converter</span></code></pre>
</div>
</div>
</li>
<li>
<p>On the Servlet ConverterServlet page, enter <code>100</code> in the field and
click Submit.</p>
<div class="paragraph">
<p>A second page opens, showing the converted values.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GIPVQ"></a><a id="to-run-the-converter-example-using-maven"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_run_the_converter_example_using_maven">To Run the converter Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/ejb/converter/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command compiles the source files for the enterprise bean and the
servlet, packages the project into a WAR module (<code>converter.war</code>), and
deploys the WAR to the server. For more information about Maven, see
<a href="#BNAAN">Building the Examples</a>.</p>
</div>
</li>
<li>
<p>Open a web browser to the following URL:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/converter</span></code></pre>
</div>
</div>
</li>
<li>
<p>On the Servlet ConverterServlet page, enter <code>100</code> in the field and
click Submit.</p>
<div class="paragraph">
<p>A second page opens, showing the converted values.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GIPTI"></a><a id="modifying-the-jakarta-ee-application"></a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_modifying_the_jakarta_ee_application">2.3. Modifying the Jakarta EE Application</h3>
<div class="paragraph">
<p>GlassFish Server supports iterative development. Whenever you make a
change to a Jakarta EE application, you must redeploy the application.</p>
</div>
<div class="paragraph">
<p><a id="GIPUK"></a><a id="to-modify-a-class-file"></a></p>
</div>
<div class="sect3">
<h4 id="_to_modify_a_class_file">2.3.1. To Modify a Class File</h4>
<div class="paragraph">
<p>To modify a class file in an enterprise bean, you change the source
code, recompile it, and redeploy the application. For example, to update
the exchange rate in the <code>dollarToYen</code> business method of the
<code>ConverterBean</code> class, you would follow these steps.</p>
</div>
<div class="paragraph">
<p>To modify <code>ConverterServlet</code>, the procedure is the same.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Edit <code>ConverterBean.java</code> and save the file.</p>
</li>
<li>
<p>Recompile the source file.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>To recompile <code>ConverterBean.java</code> in NetBeans IDE, right-click the
<code>converter</code> project and select Run.</p>
<div class="paragraph">
<p>This recompiles the <code>ConverterBean.java</code> file, replaces the old class file in the build directory, and redeploys the application to GlassFish Server.</p>
</div>
</li>
<li>
<p>Recompile <code>ConverterBean.java</code> using Maven.</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>In a terminal window, go to the
tut-install`/examples/ejb/converter/` directory.</p>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command repackages and deploys the application.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_the_enterprise_bean_examples">3. Running the Enterprise Bean Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="GIJRB"></a><a id="running-the-enterprise-bean-examples"></a></p>
</div>
<div class="paragraph">
<p>This chapter describes the Jakarta Enterprise Beans examples. Session beans provide a simple
but powerful way to encapsulate business logic within an application.
They can be accessed from remote Java clients, web service clients, and
components running in the same server.</p>
</div>
<div class="paragraph">
<p><a id="A1250776"></a><a id="overview-of-the-ejb-examples"></a></p>
</div>
<div class="sect2">
<h3 id="_overview_of_the_jakarta_enterprise_beans_examples">3.1. Overview of the Jakarta Enterprise Beans Examples</h3>
<div class="paragraph">
<p>In <a href="#GIJRE">Chapter 36, "Getting Started with
Enterprise Beans"</a>, you built a stateless session bean named
<code>ConverterBean</code>. This chapter examines the source code of four more
session beans:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CartBean</code>: a stateful session bean that is accessed by a remote
client</p>
</li>
<li>
<p><code>CounterBean</code>: a singleton session bean</p>
</li>
<li>
<p><code>HelloServiceBean</code>: a stateless session bean that implements a web
service</p>
</li>
<li>
<p><code>TimerSessionBean</code>: a stateless session bean that sets a timer</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BNBOD"></a><a id="the-cart-example"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_the_cart_example">3.2. The cart Example</h3>
<div class="paragraph">
<p>The <code>cart</code> example represents a shopping cart in an online bookstore and
uses a stateful session bean to manage the operations of the shopping
cart. The bean&#8217;s client can add a book to the cart, remove a book, or
retrieve the cart&#8217;s contents. To assemble <code>cart</code>, you need the following
code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Session bean class (<code>CartBean</code>)</p>
</li>
<li>
<p>Remote business interface (<code>Cart</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All session beans require a session bean class. All enterprise beans
that permit remote access must have a remote business interface. To meet
the needs of a specific application, an enterprise bean may also need
some helper classes. The <code>CartBean</code> session bean uses two helper
classes, <code>BookException</code> and <code>IdVerifier</code>, which are discussed in the
section <a href="#BNBOJ">Helper Classes</a>.</p>
</div>
<div class="paragraph">
<p>The source code for this example is in the
<code><em>tut-install</em>/examples/ejb/cart/</code> directory.</p>
</div>
<div class="paragraph">
<p><a id="BNBOE"></a><a id="the-business-interface"></a></p>
</div>
<div class="sect3">
<h4 id="_the_business_interface">3.2.1. The Business Interface</h4>
<div class="paragraph">
<p>The <code>Cart</code> business interface is a plain Java interface that defines all
the business methods implemented in the bean class. If the bean class
implements a single interface, that interface is assumed to the business
interface. The business interface is a local interface unless it is
annotated with the <code>javax.ejb.Remote</code> annotation; the <code>javax.ejb.Local</code>
annotation is optional in this case.</p>
</div>
<div class="paragraph">
<p>The bean class may implement more than one interface. In that case, the
business interfaces must either be explicitly annotated <code>@Local</code> or
<code>@Remote</code> or be specified by decorating the bean class with <code>@Local</code> or
<code>@Remote</code>. However, the following interfaces are excluded when
determining whether the bean class implements more than one interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.io.Serializable</code></p>
</li>
<li>
<p><code>java.io.Externalizable</code></p>
</li>
<li>
<p>Any of the interfaces defined by the <code>javax.ejb</code> package</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The source code for the <code>Cart</code> business interface is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">jakarta.tutorial.cart.ejb</span>;

<span class="keyword">import</span> <span class="include">cart.util.BookException</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.Remote</span>;

<span class="annotation">@Remote</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">Cart</span> {
    <span class="directive">public</span> <span class="type">void</span> initialize(<span class="predefined-type">String</span> person) <span class="directive">throws</span> BookException;
    <span class="directive">public</span> <span class="type">void</span> initialize(<span class="predefined-type">String</span> person, <span class="predefined-type">String</span> id) <span class="directive">throws</span> BookException;
    <span class="directive">public</span> <span class="type">void</span> addBook(<span class="predefined-type">String</span> title);
    <span class="directive">public</span> <span class="type">void</span> removeBook(<span class="predefined-type">String</span> title) <span class="directive">throws</span> BookException;
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getContents();
    <span class="directive">public</span> <span class="type">void</span> remove();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="BNBOF"></a><a id="session-bean-class"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_session_bean_class">3.2.2. Session Bean Class</h4>
<div class="paragraph">
<p>The session bean class for this example is called <code>CartBean</code>. Like any
stateful session bean, the <code>CartBean</code> class must meet the following
requirements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The class is annotated <code>@Stateful</code>.</p>
</li>
<li>
<p>The class implements the business methods defined in the business
interface.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Stateful session beans may also do the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Implement the business interface, a plain Java interface. It is good
practice to implement the bean&#8217;s business interface.</p>
</li>
<li>
<p>Implement any optional lifecycle callback methods, annotated
<code>@PostConstruct</code>, <code>@PreDestroy</code>, <code>@PostActivate</code>, and <code>@PrePassivate</code>.</p>
</li>
<li>
<p>Implement any optional business methods annotated <code>@Remove</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The source code for the <code>CartBean</code> class is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">jakarta.tutorial.cart.ejb</span>;

<span class="keyword">import</span> <span class="include">java.io.Serializable</span>;
<span class="keyword">import</span> <span class="include">java.util.ArrayList</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="keyword">import</span> <span class="include">jakarta.tutorial.cart.util.BookException</span>;
<span class="keyword">import</span> <span class="include">jakarta.tutorial.cart.util.IdVerifier</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.Remove</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.Stateful</span>;

<span class="annotation">@Stateful</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CartBean</span> <span class="directive">implements</span> Cart {
    <span class="predefined-type">String</span> customerId;
    <span class="predefined-type">String</span> customerName;
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; contents;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(<span class="predefined-type">String</span> person) <span class="directive">throws</span> BookException {
        <span class="keyword">if</span> (person == <span class="predefined-constant">null</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> BookException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Null person not allowed.</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">else</span> {
            customerName = person;
        }
        customerId = <span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>;
        contents = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(<span class="predefined-type">String</span> person, <span class="predefined-type">String</span> id)
                 <span class="directive">throws</span> BookException {
        <span class="keyword">if</span> (person == <span class="predefined-constant">null</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> BookException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Null person not allowed.</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">else</span> {
            customerName = person;
        }

        IdVerifier idChecker = <span class="keyword">new</span> IdVerifier();
        <span class="keyword">if</span> (idChecker.validate(id)) {
            customerId = id;
        } <span class="keyword">else</span> {
            <span class="keyword">throw</span> <span class="keyword">new</span> BookException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid id: </span><span class="delimiter">&quot;</span></span> + id);
        }

        contents = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> addBook(<span class="predefined-type">String</span> title) {
        contents.add(title);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> removeBook(<span class="predefined-type">String</span> title) <span class="directive">throws</span> BookException {
        <span class="type">boolean</span> result = contents.remove(title);
        <span class="keyword">if</span> (result == <span class="predefined-constant">false</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> BookException(<span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span> + title + <span class="string"><span class="delimiter">&quot;</span><span class="content"> not in cart.</span><span class="delimiter">&quot;</span></span>);
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getContents() {
        <span class="keyword">return</span> contents;
    }

    <span class="annotation">@Remove</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> remove() {
        contents = <span class="predefined-constant">null</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="BNBOG"></a><a id="lifecycle-callback-methods"></a></p>
</div>
<div class="sect4">
<h5 id="_lifecycle_callback_methods">Lifecycle Callback Methods</h5>
<div class="paragraph">
<p>A method in the bean class may be declared as a lifecycle callback
method by annotating the method with the following annotations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>javax.annotation.PostConstruct</code>: Methods annotated with
<code>@PostConstruct</code> are invoked by the container on newly constructed bean
instances after all dependency injection has completed and before the
first business method is invoked on the enterprise bean.</p>
</li>
<li>
<p><code>javax.annotation.PreDestroy</code>: Methods annotated with <code>@PreDestroy</code>
are invoked after any method annotated <code>@Remove</code> has completed and
before the container removes the enterprise bean instance.</p>
</li>
<li>
<p><code>javax.ejb.PostActivate</code>: Methods annotated with <code>@PostActivate</code> are
invoked by the container after the container moves the bean from
secondary storage to active status.</p>
</li>
<li>
<p><code>javax.ejb.PrePassivate</code>: Methods annotated with <code>@PrePassivate</code> are
invoked by the container before it passivates the enterprise bean,
meaning that the container temporarily removes the bean from the
environment and saves it to secondary storage.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Lifecycle callback methods must return <code>void</code> and have no parameters.</p>
</div>
<div class="paragraph">
<p><a id="BNBOH"></a><a id="business-methods"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_business_methods">Business Methods</h5>
<div class="paragraph">
<p>The primary purpose of a session bean is to run business tasks for the
client. The client invokes business methods on the object reference it
gets from dependency injection or JNDI lookup. From the client&#8217;s
perspective, the business methods appear to run locally, although they
run remotely in the session bean. The following code snippet shows how
the <code>CartClient</code> program invokes the business methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">cart.initialize(<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke DeEarl</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">123</span><span class="delimiter">&quot;</span></span>);
...
cart.addBook(<span class="string"><span class="delimiter">&quot;</span><span class="content">Bel Canto</span><span class="delimiter">&quot;</span></span>);
 ...
List&lt;<span class="predefined-type">String</span>&gt; bookList = cart.getContents();
...
cart.removeBook(<span class="string"><span class="delimiter">&quot;</span><span class="content">Gravity's Rainbow</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CartBean</code> class implements the business methods in the following
code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> addBook(<span class="predefined-type">String</span> title) {
   contents.add(title);
}

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> removeBook(<span class="predefined-type">String</span> title) <span class="directive">throws</span> BookException {
   <span class="type">boolean</span> result = contents.remove(title);
   <span class="keyword">if</span> (result == <span class="predefined-constant">false</span>) {
      <span class="keyword">throw</span> <span class="keyword">new</span> BookException(<span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span> + title + <span class="string"><span class="delimiter">&quot;</span><span class="content">not in cart.</span><span class="delimiter">&quot;</span></span>);
   }
}

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getContents() {
   <span class="keyword">return</span> contents;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The signature of a business method must conform to these rules.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The method name must not begin with <code>ejb</code>, to avoid conflicts with
callback methods defined by the Jakarta Enterprise Beans architecture. For example, you
cannot call a business method <code>ejbCreate</code> or <code>ejbActivate</code>.</p>
</li>
<li>
<p>The access control modifier must be <code>public</code>.</p>
</li>
<li>
<p>If the bean allows remote access through a remote business interface,
the arguments and return types must be legal types for the Java Remote
Method Invocation (RMI) API.</p>
</li>
<li>
<p>If the bean is a Jakarta XML Web Services endpoint, the arguments and return
types for the methods annotated <code>@WebMethod</code> must be legal types for
Jakarta XML Web Services.</p>
</li>
<li>
<p>If the bean is a Jakarta RESTful Web Services resource, the arguments and return types for
the resource methods must be legal types for Jakarta RESTful Web Services.</p>
</li>
<li>
<p>The modifier must not be <code>static</code> or <code>final</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>throws</code> clause can include exceptions that you define for your
application. The <code>removeBook</code> method, for example, throws a
<code>BookException</code> if the book is not in the cart.</p>
</div>
<div class="paragraph">
<p>To indicate a system-level problem, such as the inability to connect to
a database, a business method should throw a <code>javax.ejb.EJBException</code>.
The container will not wrap application exceptions, such as
<code>BookException</code>. Because <code>EJBException</code> is a subclass of
<code>RuntimeException</code>, you do not need to include it in the <code>throws</code> clause
of the business method.</p>
</div>
<div class="paragraph">
<p><a id="BNBOI"></a><a id="the-remove-method"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_remove_method">3.2.3. The @Remove Method</h4>
<div class="paragraph">
<p>Business methods annotated with <code>javax.ejb.Remove</code> in the stateful
session bean class can be invoked by enterprise bean clients to remove
the bean instance. The container will remove the enterprise bean after a
<code>@Remove</code> method completes, either normally or abnormally.</p>
</div>
<div class="paragraph">
<p>In <code>CartBean</code>, the <code>remove</code> method is a <code>@Remove</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Remove</span>
<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> remove() {
    contents = <span class="predefined-constant">null</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="BNBOJ"></a><a id="helper-classes"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_helper_classes">3.2.4. Helper Classes</h4>
<div class="paragraph">
<p>The <code>CartBean</code> session bean has two helper classes: <code>BookException</code> and
<code>IdVerifier</code>. The <code>BookException</code> is thrown by the <code>removeBook</code> method,
and the <code>IdVerifier</code> validates the <code>customerId</code> in one of the <code>create</code>
methods. Helper classes may reside in an EJB JAR file that contains the
enterprise bean class; a WAR file if the enterprise bean is packaged
within a WAR; or an EAR file that contains an EJB JAR, a WAR file, or a
separate library JAR file. In <code>cart</code>, the helper classes are included in
a library JAR used by the application client and the EJB JAR.</p>
</div>
<div class="paragraph">
<p><a id="BNBOK"></a><a id="running-the-cart-example"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_running_the_cart_example">3.2.5. Running the cart Example</h4>
<div class="paragraph">
<p>Now you are ready to compile the remote interface (<code>Cart.java</code>), the
enterprise bean class (<code>CartBean.java</code>), the client class
(<code>CartClient.java</code>), and the helper classes (<code>BookException.java</code> and
<code>IdVerifier.java</code>).</p>
</div>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and
run the <code>cart</code> application.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BNBOL">To Run the cart Example Using NetBeans IDE</a></p>
</li>
<li>
<p><a href="#BNBON">To Run the cart Example Using Maven</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BNBOL"></a><a id="to-run-the-cart-example-using-netbeans-ide"></a></p>
</div>
<div class="sect4">
<h5 id="_to_run_the_cart_example_using_netbeans_ide">To Run the cart Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/ejb</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>cart</code> folder.</p>
</li>
<li>
<p>Select the Open Required Projects check box.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>cart</code> project and select
Build.</p>
<div class="paragraph">
<p>This builds and packages the application into <code>cart.ear</code>, located in
<code><em>tut-install</em>/examples/ejb/cart/cart-ear/target/</code>, and deploys this EAR
file to your GlassFish Server instance.</p>
</div>
<div class="paragraph">
<p>You will see the output of the <code>cart-app-client</code> application client in
the Output tab:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
Retrieving book title from cart: Infinite Jest
Retrieving book title from cart: Bel Canto
Retrieving book title from cart: Kafka on the Shore
Removing <span class="string"><span class="delimiter">&quot;</span><span class="content">Gravity's Rainbow</span><span class="delimiter">&quot;</span></span> from cart.
Caught a BookException: <span class="string"><span class="delimiter">&quot;</span><span class="content">Gravity's Rainbow</span><span class="delimiter">&quot;</span></span> not in cart.</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BNBON"></a><a id="to-run-the-cart-example-using-maven"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_run_the_cart_example_using_maven">To Run the cart Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/ejb/cart/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command compiles and packages the application into an EAR file,
<code>cart.ear</code>, located in the <code>target</code> directory, and deploys the EAR to
your GlassFish Server instance.</p>
</div>
<div class="paragraph">
<p>Then, the client stubs are retrieved and run. This is equivalent to
running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">appclient -client cart-ear/target/cart-earClient.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client JAR, <code>cart-earClient.jar</code>, contains the application client
class, the helper class <code>BookException</code>, and the <code>Cart</code> business
interface.</p>
</div>
<div class="paragraph">
<p>When you run the client, the application client container injects any
component references declared in the application client class, in this
case the reference to the <code>Cart</code> enterprise bean.</p>
</div>
<div class="paragraph">
<p>You will see the output of the <code>cart-app-client</code> application client in
the terminal window:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
Retrieving book title from cart: Infinite Jest
Retrieving book title from cart: Bel Canto
Retrieving book title from cart: Kafka on the Shore
Removing <span class="string"><span class="delimiter">&quot;</span><span class="content">Gravity's Rainbow</span><span class="delimiter">&quot;</span></span> from cart.
Caught a BookException: <span class="string"><span class="delimiter">&quot;</span><span class="content">Gravity's Rainbow</span><span class="delimiter">&quot;</span></span> not in cart.</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GIPVI"></a><a id="a-singleton-session-bean-example-counter"></a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_a_singleton_session_bean_example_counter">3.3. A Singleton Session Bean Example: counter</h3>
<div class="paragraph">
<p>The <code>counter</code> example demonstrates how to create a singleton session
bean.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#GIPVC">Creating a Singleton Session Bean</a></p>
</li>
<li>
<p><a href="#GIPXL">The Architecture of the counter Example</a></p>
</li>
<li>
<p><a href="#GIPVL">Running the counter Example</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GIPVC"></a><a id="creating-a-singleton-session-bean"></a></p>
</div>
<div class="sect3">
<h4 id="_creating_a_singleton_session_bean">3.3.1. Creating a Singleton Session Bean</h4>
<div class="paragraph">
<p>The <code>javax.ejb.Singleton</code> annotation is used to specify that the
enterprise bean implementation class is a singleton session bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SingletonBean</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GIPPQ"></a><a id="initializing-singleton-session-beans"></a></p>
</div>
<div class="sect4">
<h5 id="_initializing_singleton_session_beans">Initializing Singleton Session Beans</h5>
<div class="paragraph">
<p>The Enterprise Bean container is responsible for determining when to initialize a
singleton session bean instance unless the singleton session bean
implementation class is annotated with the <code>javax.ejb.Startup</code>
annotation. In this case, sometimes called eager initialization, the EJB
container must initialize the singleton session bean upon application
startup. The singleton session bean is initialized before the EJB
container delivers client requests to any enterprise beans in the
application. This allows the singleton session bean to perform, for
example, application startup tasks.</p>
</div>
<div class="paragraph">
<p>The following singleton session bean stores the status of an application
and is eagerly initialized:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Startup</span>
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">StatusBean</span> {
  <span class="directive">private</span> <span class="predefined-type">String</span> status;

  <span class="annotation">@PostConstruct</span>
  <span class="type">void</span> init {
    status = <span class="string"><span class="delimiter">&quot;</span><span class="content">Ready</span><span class="delimiter">&quot;</span></span>;
  }
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sometimes multiple singleton session beans are used to initialize data
for an application and therefore must be initialized in a specific
order. In these cases, use the <code>javax.ejb.DependsOn</code> annotation to
declare the startup dependencies of the singleton session bean. The
<code>@DependsOn</code> annotation&#8217;s <code>value</code> attribute is one or more strings that
specify the name of the target singleton session bean. If more than one
dependent singleton bean is specified in <code>@DependsOn</code>, the order in
which they are listed is not necessarily the order in which the EJB
container will initialize the target singleton session beans.</p>
</div>
<div class="paragraph">
<p>The following singleton session bean, <code>PrimaryBean</code>, should be started
up first:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PrimaryBean</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>SecondaryBean</code> depends on <code>PrimaryBean</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="annotation">@DependsOn</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">PrimaryBean</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SecondaryBean</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This guarantees that the Enterprise Bean container will initialize <code>PrimaryBean</code>
before <code>SecondaryBean</code>.</p>
</div>
<div class="paragraph">
<p>The following singleton session bean, <code>TertiaryBean</code>, depends on
<code>PrimaryBean</code> and <code>SecondaryBean</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="annotation">@DependsOn</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">PrimaryBean</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">SecondaryBean</span><span class="delimiter">&quot;</span></span>})
<span class="directive">public</span> <span class="type">class</span> <span class="class">TertiaryBean</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>SecondaryBean</code> explicitly requires <code>PrimaryBean</code> to be initialized
before it is initialized, through its own <code>@DependsOn</code> annotation. In
this case, the Enterprise Bean container will first initialize <code>PrimaryBean</code>, then
<code>SecondaryBean</code>, and finally <code>TertiaryBean</code>.</p>
</div>
<div class="paragraph">
<p>If, however, <code>SecondaryBean</code> did not explicitly depend on <code>PrimaryBean</code>,
the Enterprise Bean container may initialize either <code>PrimaryBean</code> or <code>SecondaryBean</code>
first. That is, the Enterprise Bean container could initialize the singletons in the
following order: <code>SecondaryBean</code>, <code>PrimaryBean</code>, <code>TertiaryBean</code>.</p>
</div>
<div class="paragraph">
<p><a id="GIPSZ"></a><a id="managing-concurrent-access-in-a-singleton-session-bean"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_managing_concurrent_access_in_a_singleton_session_bean">Managing Concurrent Access in a Singleton Session Bean</h5>
<div class="paragraph">
<p>Singleton session beans are designed for concurrent access, situations
in which many clients need to access a single instance of a session bean
at the same time. A singleton&#8217;s client needs only a reference to a
singleton in order to invoke any business methods exposed by the
singleton and doesn&#8217;t need to worry about any other clients that may be
simultaneously invoking business methods on the same singleton.</p>
</div>
<div class="paragraph">
<p>When creating a singleton session bean, concurrent access to the
singleton&#8217;s business methods can be controlled in two ways:
container-managed concurrency and bean-managed concurrency.</p>
</div>
<div class="paragraph">
<p>The <code>javax.ejb.ConcurrencyManagement</code> annotation is used to specify
container-managed or bean-managed concurrency for the singleton. With
<code>@ConcurrencyManagement</code>, a type attribute must be set to either
<code>javax.ejb.ConcurrencyManagementType.CONTAINER</code> or
<code>javax.ejb.ConcurrencyManagementType.BEAN</code>. If no
<code>@ConcurrencyManagement</code> annotation is present on the singleton
implementation class, the Enterprise Bean container default of container-managed
concurrency is used.</p>
</div>
<div class="paragraph">
<p>Container-Managed Concurrency</p>
</div>
<div class="paragraph">
<p>If a singleton uses container-managed concurrency, the Enterprise Bean container
controls client access to the business methods of the singleton. The
<code>javax.ejb.Lock</code> annotation and a <code>javax.ejb.LockType</code> type are used to
specify the access level of the singleton&#8217;s business methods or
<code>@Timeout</code> methods. The <code>LockType</code> enumerated types are <code>READ</code> and
<code>WRITE</code>.</p>
</div>
<div class="paragraph">
<p>Annotate a singleton&#8217;s business or timeout method with
<code>@Lock(LockType.READ)</code> if the method can be concurrently accessed, or
shared, with many clients. Annotate the business or timeout method with
<code>@Lock(LockType.WRITE)</code> if the singleton session bean should be locked
to other clients while a client is calling that method. Typically, the
<code>@Lock(LockType.WRITE)</code> annotation is used when clients are modifying
the state of the singleton.</p>
</div>
<div class="paragraph">
<p>Annotating a singleton class with <code>@Lock</code> specifies that all the
business methods and any timeout methods of the singleton will use the
specified lock type unless they explicitly set the lock type with a
method-level <code>@Lock</code> annotation. If no <code>@Lock</code> annotation is present on
the singleton class, the default lock type, <code>@Lock(LockType.WRITE)</code>, is
applied to all business and timeout methods.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use the <code>@ConcurrencyManagement</code>,
<code>@Lock(LockType.READ)</code>, and <code>@Lock(LockType.WRITE)</code> annotations for a
singleton that uses container-managed concurrency.</p>
</div>
<div class="paragraph">
<p>Although by default singletons use container-managed concurrency, the
<code>@ConcurrencyManagement(CONTAINER)</code> annotation may be added at the class
level of the singleton to explicitly set the concurrency management
type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ConcurrencyManagement</span>(ConcurrencyManagementType.CONTAINER)
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleSingletonBean</span> {
  <span class="directive">private</span> <span class="predefined-type">String</span> state;

  <span class="annotation">@Lock</span>(LockType.READ)
  <span class="directive">public</span> <span class="predefined-type">String</span> getState() {
    <span class="keyword">return</span> state;
  }

  <span class="annotation">@Lock</span>(LockType.WRITE)
  <span class="directive">public</span> <span class="type">void</span> setState(<span class="predefined-type">String</span> newState) {
    state = newState;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getState</code> method can be accessed by many clients at the same time
because it is annotated with <code>@Lock(LockType.READ)</code>. When the <code>setState</code>
method is called, however, all the methods in <code>ExampleSingletonBean</code>
will be locked to other clients because <code>setState</code> is annotated with
<code>@Lock(LockType.WRITE)</code>. This prevents two clients from attempting to
simultaneously change the <code>state</code> variable of <code>ExampleSingletonBean</code>.</p>
</div>
<div class="paragraph">
<p>The <code>getData</code> and <code>getStatus</code> methods in the following singleton are of
type <code>READ</code>, and the <code>setStatus</code> method is of type <code>WRITE</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="annotation">@Lock</span>(LockType.READ)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SharedSingletonBean</span> {
  <span class="directive">private</span> <span class="predefined-type">String</span> data;
  <span class="directive">private</span> <span class="predefined-type">String</span> status;

  <span class="directive">public</span> <span class="predefined-type">String</span> getData() {
    <span class="keyword">return</span> data;
  }

  <span class="directive">public</span> <span class="predefined-type">String</span> getStatus() {
    <span class="keyword">return</span> status;
  }

  <span class="annotation">@Lock</span>(LockType.WRITE)
  <span class="directive">public</span> <span class="type">void</span> setStatus(<span class="predefined-type">String</span> newStatus) {
    status = newStatus;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a method is of locking type <code>WRITE</code>, client access to all the
singleton&#8217;s methods is blocked until the current client finishes its
method call or an access timeout occurs. When an access timeout occurs,
the Enterprise Bean container throws a <code>javax.ejb.ConcurrentAccessTimeoutException</code>.
The <code>javax.ejb.AccessTimeout</code> annotation is used to specify the number
of milliseconds before an access timeout occurs. If added at the class
level of a singleton, <code>@AccessTimeout</code> specifies the access timeout
value for all methods in the singleton unless a method explicitly
overrides the default with its own <code>@AccessTimeout</code> annotation.</p>
</div>
<div class="paragraph">
<p>The <code>@AccessTimeout</code> annotation can be applied to both
<code>@Lock(LockType.READ)</code> and <code>@Lock(LockType.WRITE)</code> methods. The
<code>@AccessTimeout</code> annotation has one required element, <code>value</code>, and one
optional element, <code>unit</code>. By default, the <code>value</code> is specified in
milliseconds. To change the <code>value</code> unit, set <code>unit</code> to one of the
<code>java.util.concurrent.TimeUnit</code> constants: <code>NANOSECONDS</code>,
<code>MICROSECONDS</code>, <code>MILLISECONDS</code>, or <code>SECONDS</code>.</p>
</div>
<div class="paragraph">
<p>The following singleton has a default access timeout value of 120,000
milliseconds, or 2 minutes. The <code>doTediousOperation</code> method overrides
the default access timeout and sets the value to 360,000 milliseconds,
or 6 minutes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="annotation">@AccessTimeout</span>(value=<span class="integer">120000</span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">StatusSingletonBean</span> {
  <span class="directive">private</span> <span class="predefined-type">String</span> status;

  <span class="annotation">@Lock</span>(LockType.WRITE)
  <span class="directive">public</span> <span class="type">void</span> setStatus(<span class="predefined-type">String</span> <span class="keyword">new</span> Status) {
    status = newStatus;
  }

  <span class="annotation">@Lock</span>(LockType.WRITE)
  <span class="annotation">@AccessTimeout</span>(value=<span class="integer">360000</span>)
  <span class="directive">public</span> <span class="type">void</span> doTediousOperation {
    ...
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following singleton has a default access timeout value of 60
seconds, specified using the <code>TimeUnit.SECONDS</code> constant:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="annotation">@AccessTimeout</span>(value=<span class="integer">60</span>, unit=<span class="predefined-type">TimeUnit</span>.SECONDS)
<span class="directive">public</span> <span class="type">class</span> <span class="class">StatusSingletonBean</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Bean-Managed Concurrency</p>
</div>
<div class="paragraph">
<p>Singletons that use bean-managed concurrency allow full concurrent
access to all the business and timeout methods in the singleton. The
developer of the singleton is responsible for ensuring that the state of
the singleton is synchronized across all clients. Developers who create
singletons with bean-managed concurrency are allowed to use the Java
programming language synchronization primitives, such as
<code>synchronization</code> and <code>volatile</code>, to prevent errors during concurrent
access.</p>
</div>
<div class="paragraph">
<p>Add a <code>@ConcurrencyManagement</code> annotation with the type set to
<code>ConcurrencyManagementType.BEAN</code> at the class level of the singleton to
specify bean-managed concurrency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ConcurrencyManagement</span>(ConcurrencyManagementType.BEAN)
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AnotherSingletonBean</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GIPVD"></a><a id="handling-errors-in-a-singleton-session-bean"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_handling_errors_in_a_singleton_session_bean">Handling Errors in a Singleton Session Bean</h5>
<div class="paragraph">
<p>If a singleton session bean encounters an error when initialized by the
Enterprise Bean container, that singleton instance will be destroyed.</p>
</div>
<div class="paragraph">
<p>Unlike other enterprise beans, once a singleton session bean instance is
initialized, it is not destroyed if the singleton&#8217;s business or
lifecycle methods cause system exceptions. This ensures that the same
singleton instance is used throughout the application lifecycle.</p>
</div>
<div class="paragraph">
<p><a id="GIPXL"></a><a id="the-architecture-of-the-counter-example"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_architecture_of_the_counter_example">3.3.2. The Architecture of the counter Example</h4>
<div class="paragraph">
<p>The <code>counter</code> example consists of a singleton session bean,
<code>CounterBean</code>, and a JavaServer Faces Facelets web front end.</p>
</div>
<div class="paragraph">
<p><code>CounterBean</code> is a simple singleton with one method, <code>getHits</code>, that
returns an integer representing the number of times a web page has been
accessed. Here is the code of <code>CounterBean</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">jakarta.tutorial.counter.ejb</span>;

<span class="keyword">import</span> <span class="include">javax.ejb.Singleton</span>;

<span class="comment">/**
 * CounterBean is a simple singleton session bean that records the number
 * of hits to a web page.
 */</span>
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CounterBean</span> {
    <span class="directive">private</span> <span class="type">int</span> hits = <span class="integer">1</span>;

    <span class="comment">// Increment and return the number of hits</span>
    <span class="directive">public</span> <span class="type">int</span> getHits() {
        <span class="keyword">return</span> hits++;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Singleton</code> annotation marks <code>CounterBean</code> as a singleton session
bean. <code>CounterBean</code> uses a local, no-interface view.</p>
</div>
<div class="paragraph">
<p><code>CounterBean</code> uses the Enterprise Bean container&#8217;s default metadata values for
singletons to simplify the coding of the singleton implementation class.
There is no <code>@ConcurrencyManagement</code> annotation on the class, so the
default of container-managed concurrency access is applied. There is no
<code>@Lock</code> annotation on the class or business method, so the default of
<code>@Lock(WRITE)</code> is applied to the only business method, <code>getHits</code>.</p>
</div>
<div class="paragraph">
<p>The following version of <code>CounterBean</code> is functionally equivalent to the
preceding version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">jakarta.tutorial.counter.ejb</span>;

<span class="keyword">import</span> <span class="include">javax.ejb.Singleton</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.ConcurrencyManagement</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">javax.ejb.ConcurrencyManagementType.CONTAINER</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.Lock</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.LockType.WRITE</span>;

<span class="comment">/**
 * CounterBean is a simple singleton session bean that records the number
 * of hits to a web page.
 */</span>
<span class="annotation">@Singleton</span>
<span class="annotation">@ConcurrencyManagement</span>(CONTAINER)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CounterBean</span> {
    <span class="directive">private</span> <span class="type">int</span> hits = <span class="integer">1</span>;

    <span class="comment">// Increment and return the number of hits</span>
    <span class="annotation">@Lock</span>(WRITE)
    <span class="directive">public</span> <span class="type">int</span> getHits() {
        <span class="keyword">return</span> hits++;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The web front end of <code>counter</code> consists of a JavaServer Faces managed
bean, <code>Count.java</code>, that is used by the Facelets XHTML files
<code>template.xhtml</code> and <code>index.xhtml</code>. The <code>Count</code> JavaServer Faces managed
bean obtains a reference to <code>CounterBean</code> through dependency injection.
<code>Count</code> defines a <code>hitCount</code> JavaBeans property. When the <code>getHitCount</code>
getter method is called from the XHTML files, <code>CounterBean&#8217;s `getHits</code>
method is called to return the current number of page hits.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the <code>Count</code> managed bean class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>
<span class="annotation">@ConversationScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Count</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    <span class="annotation">@EJB</span>
    <span class="directive">private</span> CounterBean counterBean;

    <span class="directive">private</span> <span class="type">int</span> hitCount;

    <span class="directive">public</span> Count() {
        <span class="local-variable">this</span>.hitCount = <span class="integer">0</span>;
    }

    <span class="directive">public</span> <span class="type">int</span> getHitCount() {
        hitCount = counterBean.getHits();
        <span class="keyword">return</span> hitCount;
    }

    <span class="directive">public</span> <span class="type">void</span> setHitCount(<span class="type">int</span> newHits) {
        <span class="local-variable">this</span>.hitCount = newHits;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>template.xhtml</code> and <code>index.xhtml</code> files are used to render a
Facelets view that displays the number of hits to that view. The
<code>index.xhtml</code> file uses an expression language statement,
<code>#{count.hitCount}</code>, to access the <code>hitCount</code> property of the <code>Count</code>
managed bean. Here is the content of <code>index.xhtml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:ui</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/facelets</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:h</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/html</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ui:composition</span> <span class="attribute-name">template</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/template.xhtml</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;ui:define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            This page has been accessed #{count.hitCount} time(s).
        <span class="tag">&lt;/ui:define&gt;</span>
        <span class="tag">&lt;ui:define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            Hooray!
        <span class="tag">&lt;/ui:define&gt;</span>
    <span class="tag">&lt;/ui:composition&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GIPVL"></a><a id="running-the-counter-example"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_running_the_counter_example">3.3.3. Running the counter Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and
run the <code>counter</code> example.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#GIPXT">To Run the counter Example Using NetBeans IDE</a></p>
</li>
<li>
<p><a href="#GIPZW">To Run the counter Example Using Maven</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GIPXT"></a><a id="to-run-the-counter-example-using-netbeans-ide"></a></p>
</div>
<div class="sect4">
<h5 id="_to_run_the_counter_example_using_netbeans_ide">To Run the counter Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/ejb</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>counter</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>counter</code> project and select
Run.</p>
<div class="paragraph">
<p>A web browser will open the URL <code><a href="http://localhost:8080/counter" class="bare">http://localhost:8080/counter</a></code>, which
displays the number of hits.</p>
</div>
</li>
<li>
<p>Reload the page to see the hit count increment.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GIPZW"></a><a id="to-run-the-counter-example-using-maven"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_run_the_counter_example_using_maven">To Run the counter Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/ejb/counter/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will build and deploy <code>counter</code> to your GlassFish Server instance.</p>
</div>
</li>
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/counter</span></code></pre>
</div>
</div>
</li>
<li>
<p>Reload the page to see the hit count increment.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BNBOR"></a><a id="a-web-service-example-helloservice"></a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_a_web_service_example_helloservice">3.4. A Web Service Example: helloservice</h3>
<div class="paragraph">
<p>This example demonstrates a simple web service that generates a response
based on information received from the client. <code>HelloServiceBean</code> is a
stateless session bean that implements a single method: <code>sayHello</code>. This
method matches the <code>sayHello</code> method invoked by the client described in
<a href="#BNAYX">A Simple Jakarta XML Web Services Application Client</a>.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BNBOS">The Web Service Endpoint Implementation Class</a></p>
</li>
<li>
<p><a href="#BNBOT">Stateless Session Bean Implementation Class</a></p>
</li>
<li>
<p><a href="#BNBOU">Running the helloservice Example</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BNBOS"></a><a id="the-web-service-endpoint-implementation-class"></a></p>
</div>
<div class="sect3">
<h4 id="_the_web_service_endpoint_implementation_class">3.4.1. The Web Service Endpoint Implementation Class</h4>
<div class="paragraph">
<p><code>HelloServiceBean</code> is the endpoint implementation class, typically the
primary programming artifact for enterprise bean web service endpoints.
The web service endpoint implementation class has the following
requirements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The class must be annotated with either the <code>javax.jws.WebService</code> or
the <code>javax.jws.WebServiceProvider</code> annotation.</p>
</li>
<li>
<p>The implementing class may explicitly reference an SEI through the
<code>endpointInterface</code> element of the <code>@WebService</code> annotation but is not
required to do so. If no <code>endpointInterface</code> is specified in
<code>@WebService</code>, an SEI is implicitly defined for the implementing class.</p>
</li>
<li>
<p>The business methods of the implementing class must be public and must
not be declared <code>static</code> or <code>final</code>.</p>
</li>
<li>
<p>Business methods that are exposed to web service clients must be
annotated with <code>javax.jws.WebMethod</code>.</p>
</li>
<li>
<p>Business methods that are exposed to web service clients must have
Jakarta XML Binding-compatible parameters and return types. See the list of Jakarta XML Binding
default data type bindings at <a href="#BNAZC">Types Supported by
Jakarta XML Web Services</a>.</p>
</li>
<li>
<p>The implementing class must not be declared <code>final</code> and must not be
<code>abstract</code>.</p>
</li>
<li>
<p>The implementing class must have a default public constructor.</p>
</li>
<li>
<p>The endpoint class must be annotated <code>@Stateless</code>.</p>
</li>
<li>
<p>The implementing class must not define the <code>finalize</code> method.</p>
</li>
<li>
<p>The implementing class may use the <code>javax.annotation.PostConstruct</code> or
<code>javax.annotation.PreDestroy</code> annotations on its methods for lifecycle
event callbacks.</p>
<div class="paragraph">
<p>The <code>@PostConstruct</code> method is called by the container before the
implementing class begins responding to web service clients.</p>
</div>
<div class="paragraph">
<p>The <code>@PreDestroy</code> method is called by the container before the endpoint
is removed from operation.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BNBOT"></a><a id="stateless-session-bean-implementation-class"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_stateless_session_bean_implementation_class">3.4.2. Stateless Session Bean Implementation Class</h4>
<div class="paragraph">
<p>The <code>HelloServiceBean</code> class implements the <code>sayHello</code> method, which is
annotated <code>@WebMethod</code>. The source code for the <code>HelloServiceBean</code> class
is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">jakarta.tutorial.helloservice.ejb</span>;

<span class="keyword">import</span> <span class="include">javax.ejb.Stateless</span>;
<span class="keyword">import</span> <span class="include">javax.jws.WebMethod</span>;
<span class="keyword">import</span> <span class="include">javax.jws.WebService</span>;

<span class="annotation">@Stateless</span>
<span class="annotation">@WebService</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloServiceBean</span> {
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> message = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello, </span><span class="delimiter">&quot;</span></span>;

    <span class="directive">public</span> <span class="type">void</span> HelloServiceBean() {}

    <span class="annotation">@WebMethod</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> sayHello(<span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> message + name + <span class="string"><span class="delimiter">&quot;</span><span class="content">.</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="BNBOU"></a><a id="running-the-helloservice-example"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_running_the_helloservice_example">3.4.3. Running the helloservice Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, and deploy
the <code>helloservice</code> example. You can then use the Administration Console
to test the web service endpoint methods.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BNBOV">To Build, Package, and Deploy the helloservice Example
Using NetBeans IDE</a></p>
</li>
<li>
<p><a href="#BNBOW">To Build, Package, and Deploy the helloservice Example
Using Maven</a></p>
</li>
<li>
<p><a href="#BNBOX">To Test the Service without a Client</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BNBOV"></a><a id="to-build-package-and-deploy-the-helloservice-example-using-netbeans-ide"></a></p>
</div>
<div class="sect4">
<h5 id="_to_build_package_and_deploy_the_helloservice_example_using_netbeans_ide">To Build, Package, and Deploy the helloservice Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/ejb</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>helloservice</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>helloservice</code> project and
select Build.</p>
<div class="paragraph">
<p>This builds and packages the application into <code>helloservice.ear</code>,
located in <code><em>tut-install</em>/examples/ejb/helloservice/target/</code>, and deploys
this EAR file to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BNBOW"></a><a id="to-build-package-and-deploy-the-helloservice-example-using-maven"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_build_package_and_deploy_the_helloservice_example_using_maven">To Build, Package, and Deploy the helloservice Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/ejb/helloservice/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This compiles the source files and packages the application into an enterprise bean
JAR file located at
<code><em>tut-install</em>/examples/ejb/helloservice/target/helloservice.jar</code>. Then
the enterprise bean JAR file is deployed to GlassFish Server.</p>
</div>
<div class="paragraph">
<p>Upon deployment, GlassFish Server generates additional artifacts
required for web service invocation, including the WSDL file.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BNBOX"></a><a id="to-test-the-service-without-a-client"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_test_the_service_without_a_client">To Test the Service without a Client</h5>
<div class="paragraph">
<p>The GlassFish Server Administration Console allows you to test the
methods of a web service endpoint. To test the <code>sayHello</code> method of
<code>HelloServiceBean</code>, follow these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the Administration Console by opening the following URL in a
web browser:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:4848/</span></code></pre>
</div>
</div>
</li>
<li>
<p>In the navigation tree, select the Applications node.</p>
</li>
<li>
<p>In the Applications table, click the <code>helloservice</code> link.</p>
</li>
<li>
<p>In the Modules and Components table, click the View Endpoint link.</p>
</li>
<li>
<p>On the Web Service Endpoint Information page, click the Tester link:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/HelloServiceBeanService/HelloServiceBean?Tester</code></pre>
</div>
</div>
</li>
<li>
<p>On the Web Service Test Links page, click the non-secure link (the
one that specifies port 8080).</p>
</li>
<li>
<p>On the HelloServiceBeanService Web Service Tester page, under
Methods, enter a name as the parameter to the <code>sayHello</code> method.</p>
</li>
<li>
<p>Click sayHello.</p>
<div class="paragraph">
<p>The sayHello Method invocation page opens. Under Method returned, you&#8217;ll
see the response from the endpoint.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BNBOY"></a><a id="using-the-timer-service"></a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_timer_service">3.5. Using the Timer Service</h3>
<div class="paragraph">
<p>Applications that model business work flows often rely on timed
notifications. The timer service of the enterprise bean container
enables you to schedule timed notifications for all types of enterprise
beans except for stateful session beans. You can schedule a timed
notification to occur according to a calendar schedule, at a specific
time, after a duration of time, or at timed intervals. For example, you
could set timers to go off at 10:30 a.m. on May 23, in 30 days, or every
12 hours.</p>
</div>
<div class="paragraph">
<p>Enterprise bean timers are either programmatic timers or automatic
timers. Programmatic timers are set by explicitly calling one of the
timer creation methods of the <code>TimerService</code> interface. Automatic timers
are created upon the successful deployment of an enterprise bean that
contains a method annotated with the <code>javax.ejb.Schedule</code> or
<code>javax.ejb.Schedules</code> annotations.</p>
</div>
<div class="paragraph">
<p><a id="GIQLK"></a><a id="creating-calendar-based-timer-expressions"></a></p>
</div>
<div class="sect3">
<h4 id="_creating_calendar_based_timer_expressions">3.5.1. Creating Calendar-Based Timer Expressions</h4>
<div class="paragraph">
<p>Timers can be set according to a calendar-based schedule, expressed
using a syntax similar to the UNIX <code>cron</code> utility. Both programmatic and
automatic timers can use calendar-based timer expressions.
<a href="#GIQLY">Table 37-1</a> shows the calendar-based timer attributes.</p>
</div>
<div class="paragraph">
<p><a id="sthref156"></a><a id="GIQLY"></a></p>
</div>
<div class="paragraph">
<p><strong>Table 37-1 Calendar-Based Timer Attributes</strong></p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<colgroup>
<col style="width: 15%;">
<col style="width: 35%;">
<col style="width: 15%;">
<col style="width: 35%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Attribute</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Default Value</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Allowable Values and Examples</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>second</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more seconds within a minute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> to <code>59</code>. For
example: <code>second="30"</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>minute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more minutes within an hour</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> to <code>59</code>. For
example: <code>minute="15"</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hour</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more hours within a day</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> to <code>23</code>. For example:
<code>hour="13"</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dayOfWeek</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more days within a week</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>*</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>0</code> to <code>7</code> (both 0 and 7 refer to Sunday). For example: <code>dayOfWeek="3"</code>.</p>
</div>
<div class="paragraph">
<p><code>Sun</code>, <code>Mon</code>, <code>Tue</code>, <code>Wed</code>, <code>Thu</code>, <code>Fri</code>, <code>Sat</code>. For example:
<code>dayOfWeek="Mon"</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dayOfMonth</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more days within a month</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>*</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>1</code> to <code>31</code>. For example: <code>dayOfMonth="15"</code>.</p>
</div>
<div class="paragraph">
<p><code>7</code> to <code>1</code> (a negative number means the nth day or days before the end
of the month). For example: <code>dayOfMonth="3"</code>.</p>
</div>
<div class="paragraph">
<p><code>Last</code>. For example: <code>dayOfMonth="Last"</code>.</p>
</div>
<div class="paragraph">
<p>[<code>1st</code>, <code>2nd</code>, <code>3rd</code>, <code>4th</code>, <code>5th</code>, <code>Last</code>] [<code>Sun</code>, <code>Mon</code>, <code>Tue</code>, <code>Wed</code>,
<code>Thu</code>, <code>Fri</code>, <code>Sat</code>]. For example: <code>dayOfMonth="2nd Fri"</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>month</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more months within a year</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>*</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>1</code> to <code>12</code>. For example: <code>month="7"</code>.</p>
</div>
<div class="paragraph">
<p><code>Jan</code>, <code>Feb</code>, <code>Mar</code>, <code>Apr</code>, <code>May</code>, <code>Jun</code>, <code>Jul</code>, <code>Aug</code>, <code>Sep</code>, <code>Oct</code>,
<code>Nov</code>, <code>Dec</code>. For example: <code>month="July"</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>year</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A particular calendar year</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>*</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A four-digit calendar year. For example: <code>year="2011"</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="GIQMX"></a><a id="specifying-multiple-values-in-calendar-expressions"></a></p>
</div>
<div class="sect4">
<h5 id="_specifying_multiple_values_in_calendar_expressions">Specifying Multiple Values in Calendar Expressions</h5>
<div class="paragraph">
<p>You can specify multiple values in calendar expressions, as described in
the following sections.</p>
</div>
<div class="paragraph">
<p>Using Wildcards in Calendar Expressions</p>
</div>
<div class="paragraph">
<p>Setting an attribute to an asterisk symbol (<code>*</code>) represents all
allowable values for the attribute.</p>
</div>
<div class="paragraph">
<p>The following expression represents every minute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">minute=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following expression represents every day of the week:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">dayOfWeek=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Specifying a List of Values</p>
</div>
<div class="paragraph">
<p>To specify two or more values for an attribute, use a comma (<code>,</code>) to
separate the values. A range of values is allowed as part of a list.
Wildcards and intervals, however, are not allowed.</p>
</div>
<div class="paragraph">
<p>Duplicates within a list are ignored.</p>
</div>
<div class="paragraph">
<p>The following expression sets the day of the week to Tuesday and
Thursday:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">dayOfWeek=<span class="string"><span class="delimiter">&quot;</span><span class="content">Tue, Thu</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following expression represents 4:00 a.m., every hour from 9:00 a.m.
to 5:00 p.m. using a range, and 10:00 p.m.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">4,9-17,22</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Specifying a Range of Values</p>
</div>
<div class="paragraph">
<p>Use a dash character (<code>-</code>) to specify an inclusive range of values for
an attribute. Members of a range cannot be wildcards, lists, or
intervals. A range of the form <code>x-x</code>, is equivalent to the single-valued
expression <code>x</code>. A range of the form <code>x-y</code> where <code>x</code> is greater than <code>y</code>
is equivalent to the expression <code>x-`maximumvalue</code>,` minimumvalue`-y`.
That is, the expression begins at <code>x</code>, rolls over to the beginning of
the allowable values, and continues up to <code>y</code>.</p>
</div>
<div class="paragraph">
<p>The following expression represents 9:00 a.m. to 5:00 p.m.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">9-17</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following expression represents Friday through Monday:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">dayOfWeek=<span class="string"><span class="delimiter">&quot;</span><span class="content">5-1</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following expression represents the twenty-fifth day of the month to
the end of the month, and the beginning of the month to the fifth day of
the month:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">dayOfMonth=<span class="string"><span class="delimiter">&quot;</span><span class="content">25-5</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is equivalent to the following expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">dayOfMonth=<span class="string"><span class="delimiter">&quot;</span><span class="content">25-Last,1-5</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Specifying Intervals</p>
</div>
<div class="paragraph">
<p>The forward slash (<code>/</code>) constrains an attribute to a starting point and
an interval and is used to specify every <code>N</code> seconds, minutes, or hours
within the minute, hour, or day. For an expression of the form <code>x/y</code>,
<code>x</code> represents the starting point and <code>y</code> represents the interval. The
wildcard character may be used in the <code>x</code> position of an interval and is
equivalent to setting <code>x</code> to <code>0</code>.</p>
</div>
<div class="paragraph">
<p>Intervals may be set only for <code>second</code>, <code>minute</code>, and <code>hour</code> attributes.</p>
</div>
<div class="paragraph">
<p>The following expression represents every 10 minutes within the hour:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">minute=<span class="string"><span class="delimiter">&quot;</span><span class="content">*/10</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is equivalent to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">minute=<span class="string"><span class="delimiter">&quot;</span><span class="content">0,10,20,30,40,50</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following expression represents every 2 hours starting at noon:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">12/2</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GIQLT"></a><a id="programmatic-timers"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_programmatic_timers">3.5.2. Programmatic Timers</h4>
<div class="paragraph">
<p>When a programmatic timer expires (goes off), the container calls the
method annotated <code>@Timeout</code> in the bean&#8217;s implementation class. The
<code>@Timeout</code> method contains the business logic that handles the timed
event.</p>
</div>
<div class="paragraph">
<p><a id="BNBOZ"></a><a id="the-timeout-method"></a></p>
</div>
<div class="sect4">
<h5 id="_the_timeout_method">The @Timeout Method</h5>
<div class="paragraph">
<p>Methods annotated <code>@Timeout</code> in the enterprise bean class must return
<code>void</code> and optionally take a <code>javax.ejb.Timer</code> object as the only
parameter. They may not throw application exceptions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Timeout</span>
<span class="directive">public</span> <span class="type">void</span> timeout(<span class="predefined-type">Timer</span> timer) {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">TimerBean: timeout occurred</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="BNBPA"></a><a id="creating-programmatic-timers"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_creating_programmatic_timers">Creating Programmatic Timers</h5>
<div class="paragraph">
<p>To create a timer, the bean invokes one of the <code>create</code> methods of the
<code>TimerService</code> interface. These methods allow single-action, interval,
or calendar-based timers to be created.</p>
</div>
<div class="paragraph">
<p>For single-action or interval timers, the expiration of the timer can be
expressed as either a duration or an absolute time. The duration is
expressed as a the number of milliseconds before a timeout event is
triggered. To specify an absolute time, create a <code>java.util.Date</code> object
and pass it to the <code>TimerService.createSingleActionTimer</code> or the
<code>TimerService.createTimer</code> method.</p>
</div>
<div class="paragraph">
<p>The following code sets a programmatic timer that will expire in 1
minute (60,000 milliseconds):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">long</span> duration = <span class="integer">60000</span>;
<span class="predefined-type">Timer</span> timer =
    timerService.createSingleActionTimer(duration, <span class="keyword">new</span> TimerConfig());</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code sets a programmatic timer that will expire at 12:05
p.m. on May 1, 2015, specified as a <code>java.util.Date</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SimpleDateFormatter formatter =
    <span class="keyword">new</span> SimpleDateFormatter(<span class="string"><span class="delimiter">&quot;</span><span class="content">MM/dd/yyyy 'at' HH:mm</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Date</span> date = formatter.parse(<span class="string"><span class="delimiter">&quot;</span><span class="content">05/01/2015 at 12:05</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Timer</span> timer = timerService.createSingleActionTimer(date, <span class="keyword">new</span> TimerConfig());</code></pre>
</div>
</div>
<div class="paragraph">
<p>For calendar-based timers, the expiration of the timer is expressed as a
<code>javax.ejb.ScheduleExpression</code> object, passed as a parameter to the
<code>TimerService.createCalendarTimer</code> method. The <code>ScheduleExpression</code>
class represents calendar-based timer expressions and has methods that
correspond to the attributes described in <a href="#GIQLK">Creating
Calendar-Based Timer Expressions</a>.</p>
</div>
<div class="paragraph">
<p>The following code creates a programmatic timer using the
<code>ScheduleExpression</code> helper class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ScheduleExpression schedule = <span class="keyword">new</span> ScheduleExpression();
schedule.dayOfWeek(<span class="string"><span class="delimiter">&quot;</span><span class="content">Mon</span><span class="delimiter">&quot;</span></span>);
schedule.hour(<span class="string"><span class="delimiter">&quot;</span><span class="content">12-17, 23</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Timer</span> timer = timerService.createCalendarTimer(schedule);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For details on the method signatures, see the <code>TimerService</code> API
documentation at
<code><a href="https://jakarta.ee/specifications/platform/8/apidocs/javax/ejb/TimerService.html" class="bare">https://jakarta.ee/specifications/platform/8/apidocs/javax/ejb/TimerService.html</a></code>.</p>
</div>
<div class="paragraph">
<p>The bean described in <a href="#BNBPE">The timersession Example</a> creates a
timer as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Timer</span> timer = timerService.createTimer(intervalDuration,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Created new programmatic timer</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>timersession</code> example, the method that calls <code>createTimer</code> is
invoked in a business method, which is called by a client.</p>
</div>
<div class="paragraph">
<p>Timers are persistent by default. If the server is shut down or crashes,
persistent timers are saved and will become active again when the server
is restarted. If a persistent timer expires while the server is down,
the container will call the <code>@Timeout</code> method when the server is
restarted.</p>
</div>
<div class="paragraph">
<p>Nonpersistent programmatic timers are created by calling
<code>TimerConfig.setPersistent(false)</code> and passing the <code>TimerConfig</code> object
to one of the timer-creation methods.</p>
</div>
<div class="paragraph">
<p>The <code>Date</code> and <code>long</code> parameters of the <code>createTimer</code> methods represent
time with the resolution of milliseconds. However, because the timer
service is not intended for real-time applications, a callback to the
<code>@Timeout</code> method might not occur with millisecond precision. The timer
service is for business applications, which typically measure time in
hours, days, or longer durations.</p>
</div>
<div class="paragraph">
<p><a id="GIQMB"></a><a id="automatic-timers"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_automatic_timers">3.5.3. Automatic Timers</h4>
<div class="paragraph">
<p>Automatic timers are created by the Enterprise Bean container when an enterprise
bean that contains methods annotated with the <code>@Schedule</code> or
<code>@Schedules</code> annotations is deployed. An enterprise bean can have
multiple automatic timeout methods, unlike a programmatic timer, which
allows only one method annotated with the <code>@Timeout</code> annotation in the
enterprise bean class.</p>
</div>
<div class="paragraph">
<p>Automatic timers can be configured through annotations or through the
<code>ejb-jar.xml</code> deployment descriptor.</p>
</div>
<div class="paragraph">
<p>Adding a <code>@Schedule</code> annotation on an enterprise bean marks that method
as a timeout method according to the calendar schedule specified in the
attributes of <code>@Schedule</code>.</p>
</div>
<div class="paragraph">
<p>The <code>@Schedule</code> annotation has elements that correspond to the calendar
expressions detailed in <a href="#GIQLK">Creating Calendar-Based Timer
Expressions</a> and the <code>persistent</code>, <code>info</code>, and <code>timezone</code> elements.</p>
</div>
<div class="paragraph">
<p>The optional <code>persistent</code> element takes a Boolean value and is used to
specify whether the automatic timer should survive a server restart or
crash. By default, all automatic timers are persistent.</p>
</div>
<div class="paragraph">
<p>The optional <code>timezone</code> element is used to specify that the automatic
timer is associated with a particular time zone. If set, this element
will evaluate all timer expressions in relation to the specified time
zone, regardless of the time zone in which the Enterprise Bean container is running.
By default, all automatic timers set are in relation to the default time
zone of the server.</p>
</div>
<div class="paragraph">
<p>The optional <code>info</code> element is used to set an informational description
of the timer. A timer&#8217;s information can be retrieved later by using
<code>Timer.getInfo</code>.</p>
</div>
<div class="paragraph">
<p>The following timeout method uses <code>@Schedule</code> to set a timer that will
expire every Sunday at midnight:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Schedule</span>(dayOfWeek=<span class="string"><span class="delimiter">&quot;</span><span class="content">Sun</span><span class="delimiter">&quot;</span></span>, hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> cleanupWeekData() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Schedules</code> annotation is used to specify multiple calendar-based
timer expressions for a given timeout method.</p>
</div>
<div class="paragraph">
<p>The following timeout method uses the <code>@Schedules</code> annotation to set
multiple calendar-based timer expressions. The first expression sets a
timer to expire on the last day of every month. The second expression
sets a timer to expire every Friday at 11:00 p.m.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Schedules</span> ({
    <span class="annotation">@Schedule</span>(dayOfMonth=<span class="string"><span class="delimiter">&quot;</span><span class="content">Last</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@Schedule</span>(dayOfWeek=<span class="string"><span class="delimiter">&quot;</span><span class="content">Fri</span><span class="delimiter">&quot;</span></span>, hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">23</span><span class="delimiter">&quot;</span></span>)
})
<span class="directive">public</span> <span class="type">void</span> doPeriodicCleanup() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="BNBPB"></a><a id="canceling-and-saving-timers"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_canceling_and_saving_timers">3.5.4. Canceling and Saving Timers</h4>
<div class="paragraph">
<p>Timers can be cancelled by the following events.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a single-event timer expires, the Enterprise Bean container calls the
associated timeout method and then cancels the timer.</p>
</li>
<li>
<p>When the bean invokes the <code>cancel</code> method of the <code>Timer</code> interface,
the container cancels the timer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a method is invoked on a cancelled timer, the container throws the
<code>javax.ejb.NoSuchObjectLocalException</code>.</p>
</div>
<div class="paragraph">
<p>To save a <code>Timer</code> object for future reference, invoke its <code>getHandle</code>
method and store the <code>TimerHandle</code> object in a database. (A
<code>TimerHandle</code> object is serializable.) To reinstantiate the <code>Timer</code>
object, retrieve the handle from the database and invoke <code>getTimer</code> on
the handle. A <code>TimerHandle</code> object cannot be passed as an argument of a
method defined in a remote or web service interface. In other words,
remote clients and web service clients cannot access a bean&#8217;s
<code>TimerHandle</code> object. Local clients, however, do not have this
restriction.</p>
</div>
<div class="paragraph">
<p><a id="BNBPC"></a><a id="getting-timer-information"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_getting_timer_information">3.5.5. Getting Timer Information</h4>
<div class="paragraph">
<p>In addition to defining the <code>cancel</code> and <code>getHandle</code> methods, the
<code>Timer</code> interface defines methods for obtaining information about
timers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">long</span> getTimeRemaining();
<span class="directive">public</span> java.util.Date getNextTimeout();
<span class="directive">public</span> java.io.Serializable getInfo();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getInfo</code> method returns the object that was the last parameter of
the <code>createTimer</code> invocation. For example, in the <code>createTimer</code> code
snippet of the preceding section, this information parameter is a
<code>String</code> object with the value <code>created timer</code>.</p>
</div>
<div class="paragraph">
<p>To retrieve all of a bean&#8217;s active timers, call the <code>getTimers</code> method
of the <code>TimerService</code> interface. The <code>getTimers</code> method returns a
collection of <code>Timer</code> objects.</p>
</div>
<div class="paragraph">
<p><a id="BNBPD"></a><a id="transactions-and-timers"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_transactions_and_timers">3.5.6. Transactions and Timers</h4>
<div class="paragraph">
<p>An enterprise bean usually creates a timer within a transaction. If this
transaction is rolled back, the timer creation also is rolled back.
Similarly, if a bean cancels a timer within a transaction that gets
rolled back, the timer cancellation is rolled back. In this case, the
timer&#8217;s duration is reset as if the cancellation had never occurred.</p>
</div>
<div class="paragraph">
<p>In beans that use container-managed transactions, the <code>@Timeout</code> method
usually has the <code>Required</code> or <code>RequiresNew</code> transaction attribute to
preserve transaction integrity. With these attributes, the Enterprise Bean container
begins the new transaction before calling the <code>@Timeout</code> method. If the
transaction is rolled back, the container will call the <code>@Timeout</code>
method at least one more time.</p>
</div>
<div class="paragraph">
<p><a id="BNBPE"></a><a id="the-timersession-example"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_the_timersession_example">3.5.7. The timersession Example</h4>
<div class="paragraph">
<p>The source code for this example is in the
<code><em>tut-install</em>/examples/ejb/timersession/src/main/java/</code> directory.</p>
</div>
<div class="paragraph">
<p><code>TimerSessionBean</code> is a singleton session bean that shows how to set
both an automatic timer and a programmatic timer. In the source code
listing of <code>TimerSessionBean</code> that follows, the <code>setTimer</code> and
<code>@Timeout</code> methods are used to set a programmatic timer. A
<code>TimerService</code> instance is injected by the container when the bean is
created. Because it&#8217;s a business method, <code>setTimer</code> is exposed to the
local, no-interface view of <code>TimerSessionBean</code> and can be invoked by the
client. In this example, the client invokes <code>setTimer</code> with an interval
duration of 8,000 milliseconds, or 8 seconds. The <code>setTimer</code> method
creates a new timer by invoking the <code>createTimer</code> method of
<code>TimerService</code>. Now that the timer is set, the Enterprise Bean container will invoke
the <code>programmaticTimeout</code> method of <code>TimerSessionBean</code> when the timer
expires, in about 8 seconds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
    public <span class="type">void</span> setTimer(<span class="type">long</span> intervalDuration) {
        logger.log(<span class="predefined-type">Level</span>.INFO,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Setting a programmatic timeout for {0} milliseconds from now.</span><span class="delimiter">&quot;</span></span>,
                intervalDuration);
        <span class="predefined-type">Timer</span> timer = timerService.createTimer(intervalDuration,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Created new programmatic timer</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Timeout</span>
    <span class="directive">public</span> <span class="type">void</span> programmaticTimeout(<span class="predefined-type">Timer</span> timer) {
        <span class="local-variable">this</span>.setLastProgrammaticTimeout(<span class="keyword">new</span> <span class="predefined-type">Date</span>());
        logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Programmatic timeout occurred.</span><span class="delimiter">&quot;</span></span>);
    }
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>TimerSessionBean</code> also has an automatic timer and timeout method,
<code>automaticTimeout</code>. The automatic timer is set to expire every 1 minute
and is set by using a calendar-based timer expression in the <code>@Schedule</code>
annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
    <span class="annotation">@Schedule</span>(minute = <span class="string"><span class="delimiter">&quot;</span><span class="content">*/1</span><span class="delimiter">&quot;</span></span>, hour = <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, persistent = <span class="predefined-constant">false</span>)
    <span class="directive">public</span> <span class="type">void</span> automaticTimeout() {
        <span class="local-variable">this</span>.setLastAutomaticTimeout(<span class="keyword">new</span> <span class="predefined-type">Date</span>());
        logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Automatic timeout occured</span><span class="delimiter">&quot;</span></span>);
    }
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>TimerSessionBean</code> also has two business methods:
<code>getLastProgrammaticTimeout</code> and <code>getLastAutomaticTimeout</code>. Clients call
these methods to get the date and time of the last timeout for the
programmatic timer and automatic timer, respectively.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the source code for the <code>TimerSessionBean</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">jakarta.tutorial.timersession.ejb</span>;

<span class="keyword">import</span> <span class="include">java.util.Date</span>;
<span class="keyword">import</span> <span class="include">java.util.logging.Level</span>;
<span class="keyword">import</span> <span class="include">java.util.logging.Logger</span>;
<span class="keyword">import</span> <span class="include">javax.annotation.Resource</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.Schedule</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.Singleton</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.Startup</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.Timeout</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.Timer</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.TimerService</span>;

<span class="annotation">@Singleton</span>
<span class="annotation">@Startup</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TimerSessionBean</span> {
    <span class="annotation">@Resource</span>
    TimerService timerService;

    <span class="directive">private</span> <span class="predefined-type">Date</span> lastProgrammaticTimeout;
    <span class="directive">private</span> <span class="predefined-type">Date</span> lastAutomaticTimeout;

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> logger =
            <span class="predefined-type">Logger</span>.getLogger(<span class="string"><span class="delimiter">&quot;</span><span class="content">timersession.ejb.TimerSessionBean</span><span class="delimiter">&quot;</span></span>);

    <span class="directive">public</span> <span class="type">void</span> setTimer(<span class="type">long</span> intervalDuration) {
        logger.log(<span class="predefined-type">Level</span>.INFO,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Setting a programmatic timeout for {0} milliseconds from now.</span><span class="delimiter">&quot;</span></span>,
                intervalDuration);
        <span class="predefined-type">Timer</span> timer = timerService.createTimer(intervalDuration,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Created new programmatic timer</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Timeout</span>
    <span class="directive">public</span> <span class="type">void</span> programmaticTimeout(<span class="predefined-type">Timer</span> timer) {
        <span class="local-variable">this</span>.setLastProgrammaticTimeout(<span class="keyword">new</span> <span class="predefined-type">Date</span>());
        logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Programmatic timeout occurred.</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Schedule</span>(minute = <span class="string"><span class="delimiter">&quot;</span><span class="content">*/1</span><span class="delimiter">&quot;</span></span>, hour = <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, persistent = <span class="predefined-constant">false</span>)
    <span class="directive">public</span> <span class="type">void</span> automaticTimeout() {
        <span class="local-variable">this</span>.setLastAutomaticTimeout(<span class="keyword">new</span> <span class="predefined-type">Date</span>());
        logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Automatic timeout occured</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getLastProgrammaticTimeout() {
        <span class="keyword">if</span> (lastProgrammaticTimeout != <span class="predefined-constant">null</span>) {
            <span class="keyword">return</span> lastProgrammaticTimeout.toString();
        } <span class="keyword">else</span> {
            <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">never</span><span class="delimiter">&quot;</span></span>;
        }
    }

    <span class="directive">public</span> <span class="type">void</span> setLastProgrammaticTimeout(<span class="predefined-type">Date</span> lastTimeout) {
        <span class="local-variable">this</span>.lastProgrammaticTimeout = lastTimeout;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getLastAutomaticTimeout() {
        <span class="keyword">if</span> (lastAutomaticTimeout != <span class="predefined-constant">null</span>) {
            <span class="keyword">return</span> lastAutomaticTimeout.toString();
        } <span class="keyword">else</span> {
            <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">never</span><span class="delimiter">&quot;</span></span>;
        }
    }

    <span class="directive">public</span> <span class="type">void</span> setLastAutomaticTimeout(<span class="predefined-type">Date</span> lastAutomaticTimeout) {
        <span class="local-variable">this</span>.lastAutomaticTimeout = lastAutomaticTimeout;
    }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Note:</p>
</div>
<div class="paragraph">
<p>GlassFish Server has a default minimum timeout value of 1,000
milliseconds, or 1 second. If you need to set the timeout value lower
than 1,000 milliseconds, change the value of the Minimum Delivery
Interval setting in the Administration Console. To modify the minimum
timeout value, in the Administration Console expand Configurations, then
expand server-config, select EJB Container, and click the EJB Timer
Service tab. Enter a new timeout value under Minimum Delivery Interval
and click Save. The lowest practical value for
<code>minimum-delivery-interval-in-millis</code> is around 10 milliseconds, owing
to virtual machine constraints.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="BNBPF"></a><a id="running-the-timersession-example"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_running_the_timersession_example">3.5.8. Running the timersession Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and
run the <code>timersession</code> example.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#GIQNI">To Run the timersession Example Using NetBeans IDE</a></p>
</li>
<li>
<p><a href="#GIQNQ">To Build, Package, and Deploy the timersession Example
Using Maven</a></p>
</li>
<li>
<p><a href="#GIQOP">To Run the Web Client</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GIQNI"></a><a id="to-run-the-timersession-example-using-netbeans-ide"></a></p>
</div>
<div class="sect4">
<h5 id="_to_run_the_timersession_example_using_netbeans_ide">To Run the timersession Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/ejb</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>timersession</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>From the Run menu, choose Run Project.</p>
<div class="paragraph">
<p>This builds and packages the application into a WAR file located at
<code><em>tut-install</em>/examples/ejb/timersession/target/timersession.war</code>, deploys
this WAR file to your GlassFish Server instance, and then runs the web
client.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GIQNQ"></a><a id="to-build-package-and-deploy-the-timersession-example-using-maven"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_build_package_and_deploy_the_timersession_example_using_maven">To Build, Package, and Deploy the timersession Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/ejb/timersession/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This builds and packages the application into a WAR file located at
<code><em>tut-install</em>/examples/ejb/timersession/target/timersession.war</code> and
deploys this WAR file to your GlassFish Server instance.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GIQOP"></a><a id="to-run-the-web-client"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_run_the_web_client">To Run the Web Client</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a web browser to the following URL:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/timersession</span></code></pre>
</div>
</div>
</li>
<li>
<p>Click Set Timer to set a programmatic timer.</p>
</li>
<li>
<p>Wait for a while and click the browser&#8217;s Refresh button.</p>
<div class="paragraph">
<p>You will see the date and time of the last programmatic and automatic
timeouts.</p>
</div>
<div class="paragraph">
<p>To see the messages that are logged when a timeout occurs, open the
<code>server.log</code> file located in domain-dir`/logs/`.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BNBPJ"></a><a id="handling-exceptions"></a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_handling_exceptions">3.6. Handling Exceptions</h3>
<div class="paragraph">
<p>The exceptions thrown by enterprise beans fall into two categories:
system and application.</p>
</div>
<div class="paragraph">
<p>A system exception indicates a problem with the services that support an
application. For example, a connection to an external resource cannot be
obtained, or an injected resource cannot be found. If it encounters a
system-level problem, your enterprise bean should throw a
<code>javax.ejb.EJBException</code>. Because the <code>EJBException</code> is a subclass of
<code>RuntimeException</code>, you do not have to specify it in the <code>throws</code> clause
of the method declaration. If a system exception is thrown, the Jakarta Enterprise Beans
container might destroy the bean instance. Therefore, a system exception
cannot be handled by the bean&#8217;s client program, but instead requires
intervention by a system administrator.</p>
</div>
<div class="paragraph">
<p>An application exception signals an error in the business logic of an
enterprise bean. Application exceptions are typically exceptions that
you&#8217;ve coded yourself, such as the <code>BookException</code> thrown by the
business methods of the <code>CartBean</code> example. When an enterprise bean
throws an application exception, the container does not wrap it in
another exception. The client should be able to handle any application
exception it receives.</p>
</div>
<div class="paragraph">
<p>If a system exception occurs within a transaction, the Enterprise Bean container
rolls back the transaction. However, if an application exception is
thrown within a transaction, the container does not roll back the
transaction.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_the_embedded_enterprise_bean_container">4. Using the Embedded Enterprise Bean Container</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="GKCQZ"></a><a id="using-the-embedded-enterprise-bean-container"></a></p>
</div>
<div class="paragraph">
<p>This chapter demonstrates how to use the embedded enterprise bean
container to run enterprise bean applications in the Java SE
environment, outside of a Jakarta EE server.</p>
</div>
<div class="paragraph">
<p><a id="GKFAE"></a><a id="overview-of-the-embedded-enterprise-bean-container"></a></p>
</div>
<div class="sect2">
<h3 id="_overview_of_the_embedded_enterprise_bean_container">4.1. Overview of the Embedded Enterprise Bean Container</h3>
<div class="paragraph">
<p>The embedded enterprise bean container is used to access enterprise bean
components from client code executed in a Java SE environment. The
container and the client code are executed within the same virtual
machine. The embedded enterprise bean container is typically used for
testing enterprise beans without having to deploy them to a server.</p>
</div>
<div class="paragraph">
<p>Most of the services present in the enterprise bean container in a Java
EE server are available in the embedded enterprise bean container,
including injection, container-managed transactions, and security.
Enterprise bean components execute similarly in both embedded and Jakakarta
EE environments, and therefore the same enterprise bean can be easily
reused in both standalone and networked applications.</p>
</div>
<div class="paragraph">
<p><a id="GKCRR"></a><a id="developing-embeddable-enterprise-bean-applications"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_developing_embeddable_enterprise_bean_applications">4.2. Developing Embeddable Enterprise Bean Applications</h3>
<div class="paragraph">
<p>All embeddable enterprise bean containers support the features listed in
<a href="#GKCQC">Table 38-1</a>.</p>
</div>
<div class="paragraph">
<p><a id="sthref157"></a><a id="GKCQC"></a></p>
</div>
<div class="paragraph">
<p><strong>Table 38-1 Required Enterprise Bean Features in the Embeddable Container</strong></p>
</div>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 37.5%;">
<col style="width: 62.5%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enterprise Bean Feature</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local session beans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local and no-interface view stateless, stateful,
and singleton session beans. All method access is synchronous. Session
beans must not be web service endpoints.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container-managed and bean-managed transactions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Security</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declarative and programmatic security.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interceptors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class-level and method-level interceptors for session
beans.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deployment descriptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The optional <code>ejb-jar.xml</code> deployment
descriptor, with the same overriding rules for the enterprise bean
container in Jakarta EE servers.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Container providers are allowed to support the full set of features in
enterprise beans, but applications that use the embedded container will
not be portable if they use enterprise bean features not listed in
<a href="#GKCQC">Table 38-1</a>, such as the timer service, session beans as web
service endpoints, or remote business interfaces.</p>
</div>
<div class="paragraph">
<p><a id="GKCQI"></a><a id="running-embedded-applications"></a></p>
</div>
<div class="sect3">
<h4 id="_running_embedded_applications">4.2.1. Running Embedded Applications</h4>
<div class="paragraph">
<p>The embedded container, the enterprise bean components, and the client
all are executed in the same virtual machine using the same classpath.
As a result, developers can run an application that uses the embedded
container just like a typical Java SE application, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">java -classpath mySessionBean.jar:containerProviderRuntime.jar:myClient.jar \
com.example.ejb.client.Main</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, <code>mySessionBean.jar</code> is an enterprise bean JAR containing a
local stateless session bean, <code>containerProviderRuntime.jar</code> is a JAR
file supplied by the enterprise bean provider that contains the needed
runtime classes for the embedded container, and <code>myClient.jar</code> is a JAR
file containing a Java SE application that calls the business methods in
the session bean through the embedded container.</p>
</div>
<div class="paragraph">
<p>In GlassFish Server, the runtime JAR that includes the classes for the
embedded container is <code>glassfish-embedded-all.jar</code>.</p>
</div>
<div class="paragraph">
<p><a id="GKCOV"></a><a id="creating-the-enterprise-bean-container"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_creating_the_enterprise_bean_container">4.2.2. Creating the Enterprise Bean Container</h4>
<div class="paragraph">
<p>The <code>javax.ejb.embedded.EJBContainer</code> abstract class represents an
instance of the enterprise bean container and includes factory methods
for creating a container instance. The <code>EJBContainer.createEJBContainer</code>
method is used to create and initialize an embedded container instance.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows how to create an embedded container
that is initialized with the container provider&#8217;s default settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EJBContainer ec = EJBContainer.createEJBContainer();</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the embedded container will search the virtual machine
classpath for enterprise bean modules: directories containing a
<code>META-INF/ejb-jar.xml</code> deployment descriptor, directories containing a
class file with one of the enterprise bean component annotations (such
as <code>@Stateless</code>), or JAR files containing an <code>ejb-jar.xml</code> deployment
descriptor or class file with an enterprise bean annotation. Any
matching entries are considered enterprise bean modules within the same
application. Once all the valid enterprise bean modules have been found
in the classpath, the container will begin initializing the modules.
When the <code>createEJBContainer</code> method successfully returns, the client
application can obtain references to the client view of any enterprise
bean module found by the embedded container.</p>
</div>
<div class="paragraph">
<p>An alternate version of the <code>EJBContainer.createEJBContainer</code> method
takes a <code>Map</code> of properties and settings for customizing the embeddable
container instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
props.setProperty(...);
...
EJBContainer ec = EJBContainer.createEJBContainer(props);</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GKCRP"></a><a id="explicitly-specifying-enterprise-bean-modules-to-be-initialized"></a></p>
</div>
<div class="sect4">
<h5 id="_explicitly_specifying_enterprise_bean_modules_to_be_initialized">Explicitly Specifying Enterprise Bean Modules to Be Initialized</h5>
<div class="paragraph">
<p>Developers can specify exactly which enterprise bean modules the
embedded container will initialize. To explicitly specify the enterprise
bean modules initialized by the embedded container, set the
<code>EJBContainer.MODULES</code> property.</p>
</div>
<div class="paragraph">
<p>The modules may be located either in the virtual machine classpath in
which the embedded container and client code run, or alternately outside
the virtual machine classpath.</p>
</div>
<div class="paragraph">
<p>To specify modules in the virtual machine classpath, set
<code>EJBContainer.MODULES</code> to a <code>String</code> to specify a single module name, or
a <code>String</code> array containing the module names. The embedded container
searches the virtual machine classpath for enterprise bean modules
matching the specified names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
props.setProperty(EJBContainer.MODULES, <span class="string"><span class="delimiter">&quot;</span><span class="content">mySessionBean</span><span class="delimiter">&quot;</span></span>);
EJBContainer ec = EJBContainer.createEJBContainer(props);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To specify enterprise bean modules outside the virtual machine
classpath, set <code>EJBContainer.MODULES</code> to a <code>java.io.File</code> object or an
array of <code>File</code> objects. Each <code>File</code> object refers to an enterprise bean JAR file,
or a directory containing an expanded enterprise bean JAR file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="predefined-type">File</span> ejbJarFile = <span class="keyword">new</span> <span class="predefined-type">File</span>(...);
props.setProperty(EJBContainer.MODULES, ejbJarFile);
EJBContainer ec = EJBContainer.createEJBContainer(props);</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GLHUR"></a><a id="looking-up-session-bean-references"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_looking_up_session_bean_references">4.2.3. Looking Up Session Bean References</h4>
<div class="paragraph">
<p>To look up session bean references in an application using the embedded
container:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use an instance of <code>EJBContainer</code> to retrieve a
<code>javax.naming.Context</code> object.</p>
<div class="paragraph">
<p>Call the <code>EJBContainer.getContext</code> method to retrieve the <code>Context</code>
object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EJBContainer ec = EJBContainer.createEJBContainer();
<span class="predefined-type">Context</span> ctx = ec.getContext();</code></pre>
</div>
</div>
<div class="paragraph">
<p>References to session beans can then be obtained using the portable JNDI
syntax detailed in <a href="#GIRGN">Portable JNDI Syntax</a>.
For example, to obtain a reference to <code>MySessionBean</code>, a local session
bean with a no-interface view, use the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MySessionBean msb = (MySessionBean)
            ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/mySessionBean/MySessionBean</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GKCRE"></a><a id="shutting-down-the-enterprise-bean-container"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_shutting_down_the_enterprise_bean_container">4.2.4. Shutting Down the Enterprise Bean Container</h4>
<div class="paragraph">
<p>To shut down the embedded container:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the client, call the <code>close</code> method of the instance of
<code>EJBContainer</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EJBContainer ec = EJBContainer.createEJBContainer();
...
ec.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>While clients are not required to shut down <code>EJBContainer</code> instances,
doing so frees resources consumed by the embedded container. This is
particularly important when the virtual machine under which the client
application is running has a longer lifetime than the client
application.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GKCPV"></a><a id="the-standalone-example-application"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_standalone_example_application">4.3. The standalone Example Application</h3>
<div class="paragraph">
<p>The <code>standalone</code> example application demonstrates how to create an
instance of the embedded enterprise bean container in a JUnit test class
and call a session bean business method.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BEIDAJAC">Overview of the standalone Example Application</a></p>
</li>
<li>
<p><a href="#GKCQP">To Run the standalone Example Application Using NetBeans
IDE</a></p>
</li>
<li>
<p><a href="#BEIGHEHJ">To Run the standalone Example Application Using Maven</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BEIDAJAC"></a><a id="overview-of-the-standalone-example-application"></a></p>
</div>
<div class="sect3">
<h4 id="_overview_of_the_standalone_example_application">4.3.1. Overview of the standalone Example Application</h4>
<div class="paragraph">
<p>Testing the business methods of an enterprise bean in a unit test allows
developers to exercise the business logic of an application separately
from the other application layers, such as the presentation layer, and
without having to deploy the application to a Jakarta EE server.</p>
</div>
<div class="paragraph">
<p>The <code>standalone</code> example has two main components: <code>StandaloneBean</code>, a
stateless session bean, and <code>StandaloneBeanTest</code>, a JUnit test class
that acts as a client to <code>StandaloneBean</code> using the embedded container.</p>
</div>
<div class="paragraph">
<p><code>StandaloneBean</code> is a simple session bean exposing a local, no-interface
view with a single business method, <code>returnMessage</code>, which returns
"Greetings!" as a <code>String</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">StandaloneBean</span> {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> message = <span class="string"><span class="delimiter">&quot;</span><span class="content">Greetings!</span><span class="delimiter">&quot;</span></span>;

    <span class="directive">public</span> <span class="predefined-type">String</span> returnMessage() {
        <span class="keyword">return</span> message;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>StandaloneBeanTest</code> calls <code>StandaloneBean.returnMessage</code> and tests that
the returned message is correct. First, an embedded container instance
and initial context are created within the <code>setUp</code> method, which is
annotated with <code>org.junit.Before</code> to indicate that the method should be
executed before the test methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Before</span>
<span class="directive">public</span> <span class="type">void</span> setUp() {
    ec = EJBContainer.createEJBContainer();
    ctx = ec.getContext();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>testReturnMessage</code> method, annotated with <code>org.junit.Test</code> to
indicate that the method includes a unit test, obtains a reference to
<code>StandaloneBean</code> through the <code>Context</code> instance, and calls
<code>StandaloneBean.returnMessage</code>. The result is compared with the expected
result using a JUnit assertion, <code>assertEquals</code>. If the string returned
from <code>StandaloneBean.returnMessage</code> is equal to "Greetings!" the test
passes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> testReturnMessage() <span class="directive">throws</span> <span class="exception">Exception</span> {
    logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Testing standalone.ejb.StandaloneBean.returnMessage()</span><span class="delimiter">&quot;</span></span>);
    StandaloneBean instance = (StandaloneBean)
            ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/classes/StandaloneBean</span><span class="delimiter">&quot;</span></span>);
    <span class="predefined-type">String</span> expResult = <span class="string"><span class="delimiter">&quot;</span><span class="content">Greetings!</span><span class="delimiter">&quot;</span></span>;
    <span class="predefined-type">String</span> result = instance.returnMessage();
    assertEquals(expResult, result);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the <code>tearDown</code> method, annotated with <code>org.junit.After</code> to
indicate that the method should be executed after all the unit tests
have run, closes the embedded container instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@After</span>
<span class="directive">public</span> <span class="type">void</span> tearDown() {
    <span class="keyword">if</span> (ec != <span class="predefined-constant">null</span>) {
        ec.close();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GKCQP"></a><a id="to-run-the-standalone-example-application-using-netbeans-ide"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_standalone_example_application_using_netbeans_ide">4.3.2. To Run the standalone Example Application Using NetBeans IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/ejb</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>standalone</code> folder and click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click <code>standalone</code> and select Test.</p>
<div class="paragraph">
<p>This will execute the JUnit test class <code>StandaloneBeanTest</code>. The Output
tab shows the progress of the test and the output log.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BEIGHEHJ"></a><a id="to-run-the-standalone-example-application-using-maven"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_to_run_the_standalone_example_application_using_maven">4.3.3. To Run the standalone Example Application Using Maven</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/ejb/standalone/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command compiles and packages the application into an JAR file, and
executes the JUnit test class <code>StandaloneBeanTest</code>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_asynchronous_method_invocation_in_session_beans">5. Using Asynchronous Method Invocation in Session Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="GKIDZ"></a><a id="using-asynchronous-method-invocation-in-session-beans"></a></p>
</div>
<div class="paragraph">
<p>This chapter discusses how to implement asynchronous business methods in
session beans and call them from enterprise bean clients.</p>
</div>
<div class="paragraph">
<p><a id="GKKQG"></a><a id="asynchronous-method-invocation"></a></p>
</div>
<div class="sect2">
<h3 id="_asynchronous_method_invocation">5.1. Asynchronous Method Invocation</h3>
<div class="paragraph">
<p>Session beans can implement asynchronous methods, business methods where
control is returned to the client by the enterprise bean container
before the method is invoked on the session bean instance. Clients may
then use the Java SE concurrency API to retrieve the result, cancel the
invocation, and check for exceptions. Asynchronous methods are typically
used for long-running operations, for processor-intensive tasks, for
background tasks, to increase application throughput, or to improve
application response time if the method invocation result isn&#8217;t required
immediately.</p>
</div>
<div class="paragraph">
<p>When a session bean client invokes a typical non-asynchronous business
method, control is not returned to the client until the method has
completed. Clients calling asynchronous methods, however, immediately
have control returned to them by the enterprise bean container. This
allows the client to perform other tasks while the method invocation
completes. If the method returns a result, the result is an
implementation of the <code>java.util.concurrent.Future&lt;V&gt;</code> interface, where
"V" is the result value type. The <code>Future&lt;V&gt;</code> interface defines methods
the client may use to check whether the computation is completed, wait
for the invocation to complete, retrieve the final result, and cancel
the invocation.</p>
</div>
<div class="paragraph">
<p><a id="GKIFJ"></a><a id="creating-an-asynchronous-business-method"></a></p>
</div>
<div class="sect3">
<h4 id="_creating_an_asynchronous_business_method">5.1.1. Creating an Asynchronous Business Method</h4>
<div class="paragraph">
<p>Annotate a business method with <code>javax.ejb.Asynchronous</code> to mark that
method as an asynchronous method, or apply <code>@Asynchronous</code> at the class
level to mark all the business methods of the session bean as
asynchronous methods. Session bean methods that expose web services
can&#8217;t be asynchronous.</p>
</div>
<div class="paragraph">
<p>Asynchronous methods must return either <code>void</code> or an implementation of
the <code>Future&lt;V&gt;</code> interface. Asynchronous methods that return <code>void</code> can&#8217;t
declare application exceptions, but if they return <code>Future&lt;V&gt;</code>, they may
declare application exceptions. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Asynchronous</span>
<span class="directive">public</span> <span class="predefined-type">Future</span>&lt;<span class="predefined-type">String</span>&gt; processPayment(Order order) <span class="directive">throws</span> PaymentException { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method will attempt to process the payment of an order, and return
the status as a <code>String</code>. Even if the payment processor takes a long
time, the client can continue working, and display the result when the
processing finally completes.</p>
</div>
<div class="paragraph">
<p>The <code>javax.ejb.AsyncResult&lt;V&gt;</code> class is a concrete implementation of the
<code>Future&lt;V&gt;</code> interface provided as a helper class for returning
asynchronous results. <code>AsyncResult</code> has a constructor with the result as
a parameter, making it easy to create <code>Future&lt;V&gt;</code> implementations. For
example, the <code>processPayment</code> method would use <code>AsyncResult</code> to return
the status as a <code>String</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Asynchronous</span>
<span class="directive">public</span> <span class="predefined-type">Future</span>&lt;<span class="predefined-type">String</span>&gt; processPayment(Order order) <span class="directive">throws</span> PaymentException {
    ...
    String status = ...;
    <span class="keyword">return</span> <span class="keyword">new</span> AsyncResult&lt;<span class="predefined-type">String</span>&gt;(status);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result is returned to the enterprise bean container, not directly to
the client, and the enterprise bean container makes the result available
to the client. The session bean can check whether the client requested
that the invocation be cancelled by calling the
<code>javax.ejb.SessionContext.wasCancelled</code> method. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Asynchronous</span>
<span class="directive">public</span> <span class="predefined-type">Future</span>&lt;<span class="predefined-type">String</span>&gt; processPayment(Order order) <span class="directive">throws</span> PaymentException {
    ...
    if (SessionContext.wasCancelled()) {
        <span class="comment">// clean up</span>
    } <span class="keyword">else</span> {
        <span class="comment">// process the payment</span>
    }
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="calling-asynchronous-methods-from-enterprise-bean-clients">5.1.2. Calling Asynchronous Methods from Enterprise Bean Clients</h4>
<div class="paragraph">
<p>Session bean clients call asynchronous methods just like
non-asynchronous business methods. If the asynchronous method returns a
result, the client receives a <code>Future&lt;V&gt;</code> instance as soon as the method
is invoked. This instance can be used to retrieve the final result,
cancel the invocation, check whether the invocation has completed, check
whether any exceptions were thrown during processing, and check whether
the invocation was cancelled.</p>
</div>
<div class="sect4">
<h5 id="retrieving-the-final-result-from-an-asynchronous-method-invocation">Retrieving the Final Result from an Asynchronous Method Invocation</h5>
<div class="paragraph">
<p>The client may retrieve the result using one of the <code>Future&lt;V&gt;.get</code>
methods. If processing hasn&#8217;t been completed by the session bean
handling the invocation, calling one of the <code>get</code> methods will result in
the client halting execution until the invocation completes. Use the
<code>Future&lt;V&gt;.isDone</code> method to determine whether processing has completed
before calling one of the <code>get</code> methods.</p>
</div>
<div class="paragraph">
<p>The <code>get()</code> method returns the result as the type specified in the type
value of the <code>Future&lt;V&gt;</code> instance. For example, calling
<code>Future&lt;String&gt;.get()</code> will return a <code>String</code> object. If the method
invocation was cancelled, calls to <code>get()</code> result in a
<code>java.util.concurrent.CancellationException</code> being thrown. If the
invocation resulted in an exception during processing by the session
bean, calls to <code>get()</code> result in a
<code>java.util.concurrent.ExecutionException</code> being thrown. The cause of the
<code>ExecutionException</code> may be retrieved by calling the
<code>ExecutionException.getCause</code> method.</p>
</div>
<div class="paragraph">
<p>The <code>get(long timeout, java.util.concurrent.TimeUnit unit)</code> method is
similar to the <code>get()</code> method, but allows the client to set a timeout
value. If the timeout value is exceeded, a
<code>java.util.concurrent.TimeoutException</code> is thrown. See the Javadoc for
the <code>TimeUnit</code> class for the available units of time to specify the
timeout value.</p>
</div>
</div>
<div class="sect4">
<h5 id="cancelling-an-asynchronous-method-invocation">Cancelling an Asynchronous Method Invocation</h5>
<div class="paragraph">
<p>Call the <code>cancel(boolean mayInterruptIfRunning)</code> method on the
<code>Future&lt;V&gt;</code> instance to attempt to cancel the method invocation. The
<code>cancel</code> method returns <code>true</code> if the cancellation was successful and
<code>false</code> if the method invocation cannot be cancelled.</p>
</div>
<div class="paragraph">
<p>When the invocation cannot be cancelled, the <code>mayInterruptIfRunning</code>
parameter is used to alert the session bean instance on which the method
invocation is running that the client attempted to cancel the
invocation. If <code>mayInterruptIfRunning</code> is set to <code>true</code>, calls to
<code>SessionContext.wasCancelled</code> by the session bean instance will return
<code>true</code>. If <code>mayInterruptIfRunning</code> is to set <code>false</code>, calls to
<code>SessionContext.wasCancelled</code> by the session bean instance will return
<code>false</code>.</p>
</div>
<div class="paragraph">
<p>The <code>Future&lt;V&gt;.isCancelled</code> method is used to check whether the method
invocation was cancelled before the asynchronous method invocation
completed by calling <code>Future&lt;V&gt;.cancel</code>. The <code>isCancelled</code> method
returns <code>true</code> if the invocation was cancelled.</p>
</div>
</div>
<div class="sect4">
<h5 id="checking-the-status-of-an-asynchronous-method-invocation">Checking the Status of an Asynchronous Method Invocation</h5>
<div class="paragraph">
<p>The <code>Future&lt;V&gt;.isDone</code> method returns <code>true</code> if the session bean
instance completed processing the method invocation. The <code>isDone</code> method
returns <code>true</code> if the asynchronous method invocation completed normally,
was cancelled, or resulted in an exception. That is, <code>isDone</code> indicates
only whether the session bean has completed processing the invocation.</p>
</div>
<div class="paragraph">
<p><a id="GKIEZ"></a><a id="the-async-example-application"></a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_async_example_application">5.2. The async Example Application</h3>
<div class="paragraph">
<p>The <code>async</code> example demonstrates how to define an asynchronous business
method on a session bean and call it from a web client. This example
contains two modules.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A web application (<code>async-war</code>) that contains a stateless session bean
and a Jakarta Server Faces interface. The <code>MailerBean</code> stateless session
bean defines an asynchronous method, <code>sendMessage</code>, which uses the
Jakarta Mail API to send an email to an specified email address.</p>
</li>
<li>
<p>An auxiliary Java SE program (<code>async-smtpd</code>) that simulates an SMTP
server. This program listens on TCP port 3025 for SMTP requests and
prints the email messages to the standard output (instead of delivering
them).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following section describes the architecture of the <code>async-war</code>
module.</p>
</div>
<div class="paragraph">
<p><a id="GKIQJ"></a><a id="architecture-of-the-async-war-module"></a></p>
</div>
<div class="sect3">
<h4 id="_architecture_of_the_async_war_module">5.2.1. Architecture of the async-war Module</h4>
<div class="paragraph">
<p>The <code>async-war</code> module consists of a single stateless session bean,
<code>MailerBean</code>, and a Jakarta Server Faces web application front end that uses
Facelets tags in XHTML files to display a form for users to enter the
email address for the recipient of an email. The status of the email is
updated when the email is finally sent.</p>
</div>
<div class="paragraph">
<p>The <code>MailerBean</code> session bean injects a Jakarta Mail resource used to send
an email message to an address specified by the user. The message is
created, modified, and sent using the Jakarta Mail API. The session bean
looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>
<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MailerBean</span> {
    <span class="annotation">@Resource</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">mail/myExampleSession</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> Session session;
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> logger =
            <span class="predefined-type">Logger</span>.getLogger(MailerBean.class.getName());

    <span class="annotation">@Asynchronous</span>
    <span class="directive">public</span> <span class="predefined-type">Future</span>&lt;<span class="predefined-type">String</span>&gt; sendMessage(<span class="predefined-type">String</span> email) {
        <span class="predefined-type">String</span> status;
        <span class="keyword">try</span> {
            <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();            properties.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">3025</span><span class="delimiter">&quot;</span></span>);            session = Session.getInstance(properties);                        Message message = <span class="keyword">new</span> MimeMessage(session);
            message.setFrom();
            message.setRecipients(Message.RecipientType.TO,
                    InternetAddress.parse(email, <span class="predefined-constant">false</span>));
            message.setSubject(<span class="string"><span class="delimiter">&quot;</span><span class="content">Test message from async example</span><span class="delimiter">&quot;</span></span>);
            message.setHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">X-Mailer</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Jakarta Mail</span><span class="delimiter">&quot;</span></span>);
            <span class="predefined-type">DateFormat</span> dateFormatter = <span class="predefined-type">DateFormat</span>
                    .getDateTimeInstance(<span class="predefined-type">DateFormat</span>.LONG, <span class="predefined-type">DateFormat</span>.SHORT);
            <span class="predefined-type">Date</span> timeStamp = <span class="keyword">new</span> <span class="predefined-type">Date</span>();
            <span class="predefined-type">String</span> messageBody = <span class="string"><span class="delimiter">&quot;</span><span class="content">This is a test message from the async </span><span class="delimiter">&quot;</span></span>
                    + <span class="string"><span class="delimiter">&quot;</span><span class="content">example of the Jakarta EE Tutorial. It was sent on </span><span class="delimiter">&quot;</span></span>
                    + dateFormatter.format(timeStamp)
                    + <span class="string"><span class="delimiter">&quot;</span><span class="content">.</span><span class="delimiter">&quot;</span></span>;
            message.setText(messageBody);
            message.setSentDate(timeStamp);
            Transport.send(message);
            status = <span class="string"><span class="delimiter">&quot;</span><span class="content">Sent</span><span class="delimiter">&quot;</span></span>;
            logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Mail sent to {0}</span><span class="delimiter">&quot;</span></span>, email);
        } <span class="keyword">catch</span> (MessagingException ex) {
            logger.severe(<span class="string"><span class="delimiter">&quot;</span><span class="content">Error in sending message.</span><span class="delimiter">&quot;</span></span>);
            status = <span class="string"><span class="delimiter">&quot;</span><span class="content">Encountered an error: </span><span class="delimiter">&quot;</span></span> + ex.getMessage();
            logger.severe(ex.getMessage());
        }
        <span class="keyword">return</span> <span class="keyword">new</span> AsyncResult&lt;&gt;(status);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The injected Jakarta Mail resource can be configured through the GlassFish
Server Administration Console, through a GlassFish Server administrative
command, or through a resource configuration file packaged with the
application. The resource configuration can be modified at runtime by
the GlassFish Server administrator to use a different mail server or
transport protocol.</p>
</div>
<div class="paragraph">
<p>The web client consists of a Facelets template, <code>template.xhtml</code>; two
Facelets clients, <code>index.xhtml</code> and <code>response.xhtml</code>; and a JavaServer
Faces managed bean, <code>MailerManagedBean</code>. The <code>index.xhtml</code> file contains
a form for the target email address. When the user submits the form, the
<code>MailerManagedBean.send</code> method is called. This method uses an injected
instance of the <code>MailerBean</code> session bean to call
<code>MailerBean.sendMessage</code>. The result is sent to the <code>response.xhtml</code>
Facelets view.</p>
</div>
</div>
<div class="sect3">
<h4 id="running-the-async-example">5.2.2. Running the async Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and
run the <code>async</code> example.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#GKINW">To Run the async Example Application Using NetBeans IDE</a></p>
</li>
<li>
<p><a href="#GKRFB">To Run the async Example Application Using Maven</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="to-run-the-async-example-application-using-netbeans-ide">To Run the async Example Application Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#BNADI">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/ejb</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>async</code> folder, select Open Required Projects, and click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>async-smtpd</code> project and select Run.</p>
<div class="paragraph">
<p>The SMTP server simulator starts accepting connections. The async-smptd output tab shows the following message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">[Test SMTP server listening on port <span class="integer">3025</span>]</code></pre>
</div>
</div>
</li>
<li>
<p>In the Projects tab, right-click the <code>async-war</code> project and select Build.</p>
<div class="paragraph">
<p>This command configures the Jakarta Mail resource using a GlassFish Server administrative command and builds, packages, and deploys the <code>async-war</code> module.</p>
</div>
</li>
<li>
<p>Open the following URL in a web browser window:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/async-war</span></code></pre>
</div>
</div>
</li>
<li>
<p>In the web browser window, enter an email address and click Send email.</p>
<div class="paragraph">
<p>The <code>MailerBean</code> stateless bean uses the Jakarta Mail API to deliver an email to the SMTP server simulator. The async-smptd output window in NetBeans IDE shows the resulting email message, including its headers.</p>
</div>
</li>
<li>
<p>To stop the SMTP server simulator, click the X button on the right side of the status bar in NetBeans IDE.</p>
</li>
<li>
<p>Delete the Jakarta Mail session resource.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Services tab, expand the Servers node, then expand the GlassFish Server server node.</p>
</li>
<li>
<p>Expand the Resources node, then expand the Jakarta Mail Sessions node.</p>
</li>
<li>
<p>Right-click mail/myExampleSession and select Unregister.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-async-example-application-using-maven">To Run the async Example Application Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/ejb/async/async-smtpd/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to build and package the SMTP server
simulator:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to start the STMP server simulator:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn exec:java</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following message appears:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">[Test SMTP server listening on port <span class="integer">3025</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Keep this terminal window open.</p>
</div>
</li>
<li>
<p>In a new terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/ejb/async/async-war</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to configure the Jakarta Mail resource and
to build, package, and deploy the <code>async-war</code> module:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Open the following URL in a web browser window:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/async-war</span></code></pre>
</div>
</div>
</li>
<li>
<p>In the web browser window, enter an email address and click Send
email.</p>
<div class="paragraph">
<p>The <code>MailerBean</code> stateless bean uses the Jakarta Mail API to deliver an
email to the SMTP server simulator. The resulting email message appears
on the first terminal window, including its headers.</p>
</div>
</li>
<li>
<p>To stop the SMTP server simulator, close the terminal window in
which you issued the command to start the STMP server simulator.</p>
</li>
<li>
<p>To delete the Jakarta Mail session resource, type the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">asadmin delete-javamail-resource mail/myExampleSession</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-04-26 19:19:24 UTC
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</body>
</html>