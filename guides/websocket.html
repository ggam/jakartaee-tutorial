<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.2">
<title>WebSocket</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement when using as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>WebSocket</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_jakarta_websocket">1. Jakarta WebSocket</a>
<ul class="sectlevel2">
<li><a href="#_introduction_to_websocket">1.1. Introduction to WebSocket</a></li>
<li><a href="#_creating_websocket_applications_in_the_jakarta_ee_platform">1.2. Creating WebSocket Applications in the Jakarta EE Platform</a></li>
<li><a href="#_programmatic_endpoints">1.3. Programmatic Endpoints</a></li>
<li><a href="#_annotated_endpoints">1.4. Annotated Endpoints</a></li>
<li><a href="#_sending_and_receiving_messages">1.5. Sending and Receiving Messages</a></li>
<li><a href="#_maintaining_client_state">1.6. Maintaining Client State</a></li>
<li><a href="#_using_encoders_and_decoders">1.7. Using Encoders and Decoders</a></li>
<li><a href="#_path_parameters">1.8. Path Parameters</a></li>
<li><a href="#_handling_errors">1.9. Handling Errors</a></li>
<li><a href="#_specifying_an_endpoint_configurator_class">1.10. Specifying an Endpoint Configurator Class</a></li>
<li><a href="#_the_dukeetf2_example_application">1.11. The dukeetf2 Example Application</a></li>
<li><a href="#_the_websocketbot_example_application">1.12. The websocketbot Example Application</a></li>
<li><a href="#_further_information_about_websocket">1.13. Further Information about WebSocket</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_jakarta_websocket">1. Jakarta WebSocket</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="GKJIQ5"></a><a id="java-api-for-websocket"></a></p>
</div>
<div class="paragraph">
<p>This chapter describes Jakarta WebSocket, which
provides support for creating WebSocket applications. WebSocket is an
application protocol that provides full-duplex communications between
two peers over the TCP protocol.</p>
</div>
<div class="paragraph">
<p><a id="BABDABHF"></a><a id="introduction-to-websocket"></a></p>
</div>
<div class="sect2">
<h3 id="_introduction_to_websocket">1.1. Introduction to WebSocket</h3>
<div class="paragraph">
<p>In the traditional request-response model used in HTTP, the client
requests resources, and the server provides responses. The exchange is
always initiated by the client; the server cannot send any data without
the client requesting it first. This model worked well for the World
Wide Web when clients made occasional requests for documents that
changed infrequently, but the limitations of this approach are
increasingly relevant as content changes quickly and users expect a more
interactive experience on the Web. The WebSocket protocol addresses
these limitations by providing a full-duplex communication channel
between the client and the server. Combined with other client
technologies, such as JavaScript and HTML5, WebSocket enables web
applications to deliver a richer user experience.</p>
</div>
<div class="paragraph">
<p>In a WebSocket application, the server publishes a WebSocket endpoint,
and the client uses the endpoint&#8217;s URI to connect to the server. The
WebSocket protocol is symmetrical after the connection has been
established; the client and the server can send messages to each other
at any time while the connection is open, and they can close the
connection at any time. Clients usually connect only to one server, and
servers accept connections from multiple clients.</p>
</div>
<div class="paragraph">
<p>The WebSocket protocol has two parts: handshake and data transfer. The
client initiates the handshake by sending a request to a WebSocket
endpoint using its URI. The handshake is compatible with existing
HTTP-based infrastructure: web servers interpret it as an HTTP
connection upgrade request. An example handshake from a client looks
like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GET /path/to/websocket/endpoint HTTP/<span class="float">1.1</span>
Host: localhost
Upgrade: websocket
<span class="predefined-type">Connection</span>: Upgrade
Sec-WebSocket-<span class="predefined-type">Key</span>: xqBt3ImNzJbYqRINxEFlkg==
Origin: http:<span class="comment">//localhost</span>
Sec-WebSocket-Version: <span class="integer">13</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An example handshake from the server in response to the client looks
like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HTTP/<span class="float">1.1</span> <span class="integer">101</span> Switching Protocols
Upgrade: websocket
<span class="predefined-type">Connection</span>: Upgrade
Sec-WebSocket-Accept: K7DJLdLooIwIG/MOpvWFB3y3FE8=</code></pre>
</div>
</div>
<div class="paragraph">
<p>The server applies a known operation to the value of the
<code>Sec-WebSocket-Key</code> header to generate the value of the
<code>Sec-WebSocket-Accept</code> header. The client applies the same operation to
the value of the <code>Sec-WebSocket-Key</code> header, and the connection is
established successfully if the result matches the value received from
the server. The client and the server can send messages to each other
after a successful handshake.</p>
</div>
<div class="paragraph">
<p>WebSocket supports text messages (encoded as UTF-8) and binary messages.
The control frames in WebSocket are close, ping, and pong (a response to
a ping frame). Ping and pong frames may also contain application data.</p>
</div>
<div class="paragraph">
<p>WebSocket endpoints are represented by URIs that have the following
form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ws:<span class="comment">//host:port/path?query</span>
wss:<span class="comment">//host:port/path?query</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ws</code> scheme represents an unencrypted WebSocket connection, and the
<code>wss</code> scheme represents an encrypted connection. The <code>port</code> component is
optional; the default port number is 80 for unencrypted connections and
443 for encrypted connections. The <code>path</code> component indicates the
location of an endpoint within a server. The <code>query</code> component is
optional.</p>
</div>
<div class="paragraph">
<p>Modern web browsers implement the WebSocket protocol and provide a
JavaScript API to connect to endpoints, send messages, and assign
callback methods for WebSocket events (such as opened connections,
received messages, and closed connections).</p>
</div>
<div class="paragraph">
<p><a id="BABEAEFC"></a><a id="creating-websocket-applications-in-the-jakarta-ee-platform"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_websocket_applications_in_the_jakarta_ee_platform">1.2. Creating WebSocket Applications in the Jakarta EE Platform</h3>
<div class="paragraph">
<p>The Jakarta EE platform includes Jakarta WebSocket,
which enables you to create, configure, and deploy WebSocket endpoints
in web applications. The WebSocket client API specified in Jakarta WebSocket also
enables you to access remote WebSocket endpoints from any Java
application.</p>
</div>
<div class="paragraph">
<p>Jakarta WebSocket consists of the following packages.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>javax.websocket.server</code> package contains annotations, classes,
and interfaces to create and configure server endpoints.</p>
</li>
<li>
<p>The <code>javax.websocket</code> package contains annotations, classes,
interfaces, and exceptions that are common to client and server
endpoints.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>WebSocket endpoints are instances of the <code>javax.websocket.Endpoint</code>
class. Jakarta WebSocket enables you to create two kinds of
endpoints: programmatic endpoints and annotated endpoints. To create a
programmatic endpoint, you extend the <code>Endpoint</code> class and override its
lifecycle methods. To create an annotated endpoint, you decorate a Java
class and some of its methods with the annotations provided by the
packages mentioned previously. After you have created an endpoint, you
deploy it to an specific URI in the application so that remote clients
can connect to it.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Note:</p>
</div>
<div class="paragraph">
<p>In most cases, it is easier to create and deploy an annotated endpoint
than a programmatic endpoint. This chapter provides a simple example of
a programmatic endpoint, but it focuses on annotated endpoints.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="sthref114"></a><a id="creating-and-deploying-a-websocket-endpoint"></a></p>
</div>
<div class="sect3">
<h4 id="_creating_and_deploying_a_websocket_endpoint">1.2.1. Creating and Deploying a WebSocket Endpoint</h4>
<div class="paragraph">
<p>The process for creating and deploying a WebSocket endpoint:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an endpoint class.</p>
</li>
<li>
<p>Implement the lifecycle methods of the endpoint.</p>
</li>
<li>
<p>Add your business logic to the endpoint.</p>
</li>
<li>
<p>Deploy the endpoint inside a web application.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The process is slightly different for programmatic endpoints and
annotated endpoints, and it is covered in detail in the following
sections.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Note:</p>
</div>
<div class="paragraph">
<p>As opposed to servlets, WebSocket endpoints are instantiated multiple
times. The container creates an instance of an endpoint per connection
to its deployment URI. Each instance is associated with one and only one
connection. This facilitates keeping user state for each connection and
makes development easier, because there is only one thread executing the
code of an endpoint instance at any given time.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="BABGJEIG"></a><a id="programmatic-endpoints"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_programmatic_endpoints">1.3. Programmatic Endpoints</h3>
<div class="paragraph">
<p>The following example shows how to create an endpoint by extending the
<code>Endpoint</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">EchoEndpoint</span> <span class="directive">extends</span> Endpoint {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> onOpen(<span class="directive">final</span> Session session, EndpointConfig config) {
      session.addMessageHandler(<span class="keyword">new</span> MessageHandler.Whole&lt;<span class="predefined-type">String</span>&gt;() {
         <span class="annotation">@Override</span>
         <span class="directive">public</span> <span class="type">void</span> onMessage(<span class="predefined-type">String</span> msg) {
            <span class="keyword">try</span> {
               session.getBasicRemote().sendText(msg);
            } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) { ... }
         }
      });
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This endpoint echoes every message received. The <code>Endpoint</code> class
defines three lifecycle methods: <code>onOpen</code>, <code>onClose</code>, and <code>onError</code>. The
<code>EchoEndpoint</code> class implements the <code>onOpen</code> method, which is the only
abstract method in the <code>Endpoint</code> class.</p>
</div>
<div class="paragraph">
<p>The <code>Session</code> parameter represents a conversation between this endpoint
and the remote endpoint. The <code>addMessageHandler</code> method registers
message handlers, and the <code>getBasicRemote</code> method returns an object that
represents the remote endpoint. The <code>Session</code> interface is covered in
detail in the rest of this chapter.</p>
</div>
<div class="paragraph">
<p>The message handler is implemented as an anonymous inner class. The
<code>onMessage</code> method of the message handler is invoked when the endpoint
receives a text message.</p>
</div>
<div class="paragraph">
<p>To deploy this programmatic endpoint, use the following code in your
Jakarta EE application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ServerEndpointConfig.Builder.create(EchoEndpoint.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">/echo</span><span class="delimiter">&quot;</span></span>).build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you deploy your application, the endpoint is available at
<code>ws://&lt;host&gt;:&lt;port&gt;/&lt;application&gt;/echo</code>; for example,
<code>ws://localhost:8080/echoapp/echo</code>.</p>
</div>
<div class="paragraph">
<p><a id="BABFEBGA"></a><a id="annotated-endpoints"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_annotated_endpoints">1.4. Annotated Endpoints</h3>
<div class="paragraph">
<p>The following example shows how to create the same endpoint from
<a href="#BABGJEIG">Programmatic Endpoints</a> using annotations
instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/echo</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EchoEndpoint</span> {
   <span class="annotation">@OnMessage</span>
   <span class="directive">public</span> <span class="type">void</span> onMessage(Session session, <span class="predefined-type">String</span> msg) {
      <span class="keyword">try</span> {
         session.getBasicRemote().sendText(msg);
      } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) { ... }
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotated endpoint is simpler than the equivalent programmatic
endpoint, and it is deployed automatically with the application to the
relative path defined in the <code>ServerEndpoint</code> annotation. Instead of
having to create an additional class for the message handler, this
example uses the <code>OnMessage</code> annotation to designate the method invoked
to handle messages.</p>
</div>
<div class="paragraph">
<p><a href="#BABDGEJH">Table 19-1</a> lists the annotations available in the
<code>javax.websocket</code> package to designate the methods that handle lifecycle
events. The examples in the table show the most common parameters for
these methods. See the API reference for details on what combinations of
parameters are allowed in each case.</p>
</div>
<div class="paragraph">
<p><a id="sthref115"></a><a id="BABDGEJH"></a></p>
</div>
<div class="paragraph">
<p><strong>Table 19-1 WebSocket Endpoint Lifecycle Annotations</strong></p>
</div>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Annotation</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Example</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OnOpen</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection opened</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OnOpen</span>
<span class="directive">public</span> <span class="type">void</span> open(Session session,
                 EndpointConfig conf) { }</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OnMessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message received</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OnMessage</span>
<span class="directive">public</span> <span class="type">void</span> message(Session session,
                    <span class="predefined-type">String</span> msg) { }</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OnError</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection error</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OnError</span>
<span class="directive">public</span> <span class="type">void</span> error(Session session,
                  <span class="predefined-type">Throwable</span> error) { }</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OnClose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection closed</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OnClose</span>
<span class="directive">public</span> <span class="type">void</span> close(Session session,
                  CloseReason reason) { }</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="BABFCGBJ"></a><a id="sending-and-receiving-messages"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_sending_and_receiving_messages">1.5. Sending and Receiving Messages</h3>
<div class="paragraph">
<p>WebSocket endpoints can send and receive text and binary messages. In
addition, they can also send ping frames and receive pong frames. This
section describes how to use the <code>Session</code> and <code>RemoteEndpoint</code>
interfaces to send messages to the connected peer and how to use the
<code>OnMessage</code> annotation to receive messages from it.</p>
</div>
<div class="paragraph">
<p><a id="CIHEHFCB"></a><a id="sending-messages"></a></p>
</div>
<div class="sect3">
<h4 id="_sending_messages">1.5.1. Sending Messages</h4>
<div class="paragraph">
<p>Follow these steps to send messages in an endpoint.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Obtain the <code>Session</code> object from the connection.</p>
<div class="paragraph">
<p>The <code>Session</code> object is available as a parameter in the annotated
lifecycle methods of the endpoint, like those in
<a href="#BABDGEJH">Table 19-1</a>. When your message is a
response to a message from the peer, you have the <code>Session</code> object
available inside the method that received the message (the method
annotated with <code>@OnMessage</code>). If you have to send messages that are not
responses, store the <code>Session</code> object as an instance variable of the
endpoint class in the method annotated with <code>@OnOpen</code> so that you can
access it from other methods.</p>
</div>
</li>
<li>
<p>Use the <code>Session</code> object to obtain a <code>RemoteEndpoint</code> object.</p>
<div class="paragraph">
<p>The <code>Session.getBasicRemote</code> method and the <code>Session.getAsyncRemote</code>
method return <code>RemoteEndpoint.Basic</code> and <code>RemoteEndpoint.Async</code> objects
respectively. The <code>RemoteEndpoint.Basic</code> interface provides blocking
methods to send messages; the <code>RemoteEndpoint.Async</code> interface provides
nonblocking methods.</p>
</div>
</li>
<li>
<p>Use the <code>RemoteEndpoint</code> object to send messages to the peer.</p>
<div class="paragraph">
<p>The following list shows some of the methods you can use to send
messages to the peer.
* <code>void RemoteEndpoint.Basic.sendText(String text)</code></p>
</div>
<div class="paragraph">
<p>+
Send a text message to the peer. This method blocks until the whole
message has been transmitted.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>void RemoteEndpoint.Basic.sendBinary(ByteBuffer data)</code></p>
<div class="paragraph">
<p>Send a binary message to the peer. This method blocks until the whole
message has been transmitted.</p>
</div>
</li>
<li>
<p><code>void RemoteEndpoint.sendPing(ByteBuffer appData)</code></p>
<div class="paragraph">
<p>Send a ping frame to the peer.</p>
</div>
</li>
<li>
<p><code>void RemoteEndpoint.sendPong(ByteBuffer appData)</code></p>
<div class="paragraph">
<p>Send a pong frame to the peer.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The example in <a href="#BABFEBGA">Annotated Endpoints</a>
demonstrates how to use this procedure to reply to every incoming text
message.</p>
</div>
<div class="paragraph">
<p><a id="BABIFBCG"></a><a id="sending-messages-to-all-peers-connected-to-an-endpoint"></a></p>
</div>
<div class="sect4">
<h5 id="_sending_messages_to_all_peers_connected_to_an_endpoint">Sending Messages to All Peers Connected to an Endpoint</h5>
<div class="paragraph">
<p>Each instance of an endpoint class is associated with one and only one
connection and peer; however, there are cases in which an endpoint
instance needs to send messages to all connected peers. Examples include
chat applications and online auctions. The <code>Session</code> interface provides
the <code>getOpenSessions</code> method for this purpose. The following example
demonstrates how to use this method to forward incoming text messages to
all connected peers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/echoall</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EchoAllEndpoint</span> {
   <span class="annotation">@OnMessage</span>
   <span class="directive">public</span> <span class="type">void</span> onMessage(Session session, <span class="predefined-type">String</span> msg) {
      <span class="keyword">try</span> {
         <span class="keyword">for</span> (Session sess : session.getOpenSessions()) {
            <span class="keyword">if</span> (sess.isOpen())
               sess.getBasicRemote().sendText(msg);
         }
      } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) { ... }
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="CIHIDFHD"></a><a id="receiving-messages"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_receiving_messages">1.5.2. Receiving Messages</h4>
<div class="paragraph">
<p>The <code>OnMessage</code> annotation designates methods that handle incoming
messages. You can have at most three methods annotated with <code>@OnMessage</code>
in an endpoint, one for each message type: text, binary, and pong. The
following example demonstrates how to designate methods to receive all
three types of messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/receive</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ReceiveEndpoint</span> {
   <span class="annotation">@OnMessage</span>
   <span class="directive">public</span> <span class="type">void</span> textMessage(Session session, <span class="predefined-type">String</span> msg) {
      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Text message: </span><span class="delimiter">&quot;</span></span> + msg);
   }
   <span class="annotation">@OnMessage</span>
   <span class="directive">public</span> <span class="type">void</span> binaryMessage(Session session, <span class="predefined-type">ByteBuffer</span> msg) {
      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Binary message: </span><span class="delimiter">&quot;</span></span> + msg.toString());
   }
   <span class="annotation">@OnMessage</span>
   <span class="directive">public</span> <span class="type">void</span> pongMessage(Session session, PongMessage msg) {
      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Pong message: </span><span class="delimiter">&quot;</span></span> +
                          msg.getApplicationData().toString());
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="BABGJCAD"></a><a id="maintaining-client-state"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_maintaining_client_state">1.6. Maintaining Client State</h3>
<div class="paragraph">
<p>Because the container creates an instance of the endpoint class for
every connection, you can define and use instance variables to store
client state information. In addition, the <code>Session.getUserProperties</code>
method provides a modifiable map to store user properties. For example,
the following endpoint replies to incoming text messages with the
contents of the previous message from each client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/delayedecho</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">DelayedEchoEndpoint</span> {
   <span class="annotation">@OnOpen</span>
   <span class="directive">public</span> <span class="type">void</span> open(Session session) {
      session.getUserProperties().put(<span class="string"><span class="delimiter">&quot;</span><span class="content">previousMsg</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span>);
   }
   <span class="annotation">@OnMessage</span>
   <span class="directive">public</span> <span class="type">void</span> message(Session session, <span class="predefined-type">String</span> msg) {
      <span class="predefined-type">String</span> prev = (<span class="predefined-type">String</span>) session.getUserProperties()
                                    .get(<span class="string"><span class="delimiter">&quot;</span><span class="content">previousMsg</span><span class="delimiter">&quot;</span></span>);
      session.getUserProperties().put(<span class="string"><span class="delimiter">&quot;</span><span class="content">previousMsg</span><span class="delimiter">&quot;</span></span>, msg);
      <span class="keyword">try</span> {
         session.getBasicRemote().sendText(prev);
      } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) { ... }
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To store information common to all connected clients, you can use class
(static) variables; however, you are responsible for ensuring
thread-safe access to them.</p>
</div>
<div class="paragraph">
<p><a id="BABGADFG"></a><a id="using-encoders-and-decoders"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_using_encoders_and_decoders">1.7. Using Encoders and Decoders</h3>
<div class="paragraph">
<p>Jakarta WebSocket provides support for converting between
WebSocket messages and custom Java types using encoders and decoders. An
encoder takes a Java object and produces a representation that can be
transmitted as a WebSocket message; for example, encoders typically
produce JSON, XML, or binary representations. A decoder performs the
reverse function; it reads a WebSocket message and creates a Java
object.</p>
</div>
<div class="paragraph">
<p>This mechanism simplifies WebSocket applications, because it decouples
the business logic from the serialization and deserialization of
objects.</p>
</div>
<div class="paragraph">
<p><a id="CIHBIGBI"></a><a id="implementing-encoders-to-convert-java-objects-into-websocket-messages"></a></p>
</div>
<div class="sect3">
<h4 id="_implementing_encoders_to_convert_java_objects_into_websocket_messages">1.7.1. Implementing Encoders to Convert Java Objects into WebSocket Messages</h4>
<div class="paragraph">
<p>The procedure to implement and use encoders in endpoints follows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Implement one of the following interfaces:</p>
<div class="ulist">
<ul>
<li>
<p><code>Encoder.Text&lt;T&gt;</code> for text messages</p>
</li>
<li>
<p><code>Encoder.Binary&lt;T&gt;</code> for binary messages</p>
<div class="paragraph">
<p>These interfaces specify the <code>encode</code> method. Implement an encoder class
for each custom Java type that you want to send as a WebSocket message.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Add the names of your encoder implementations to the <code>encoders</code>
optional parameter of the <code>ServerEndpoint</code> annotation.</p>
</li>
<li>
<p>Use the <code>sendObject(Object data)</code> method of the
<code>RemoteEndpoint.Basic</code> or <code>RemoteEndpoint.Async</code> interfaces to send your
objects as messages. The container looks for an encoder that matches
your type and uses it to convert the object to a WebSocket message.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, if you have two Java types (<code>MessageA</code> and <code>MessageB</code>) that
you want to send as text messages, implement the
<code>Encoder.Text&lt;MessageA&gt;</code> and <code>Encoder.Text&lt;MessageB&gt;</code> interfaces as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MessageATextEncoder</span> <span class="directive">implements</span> <span class="predefined-type">Encoder</span>.Text&lt;MessageA&gt; {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> init(EndpointConfig ec) { }
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> destroy() { }
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="predefined-type">String</span> encode(MessageA msgA) <span class="directive">throws</span> EncodeException {
      <span class="comment">// Access msgA's properties and convert to JSON text...</span>
      <span class="keyword">return</span> msgAJsonString;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Implement <code>Encoder.Text&lt;MessageB&gt;</code> similarly. Then, add the <code>encoders</code>
parameter to the <code>ServerEndpoint</code> annotation as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(
   value = <span class="string"><span class="delimiter">&quot;</span><span class="content">/myendpoint</span><span class="delimiter">&quot;</span></span>,
   encoders = { MessageATextEncoder.class, MessageBTextEncoder.class }
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EncEndpoint</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, you can send <code>MessageA</code> and <code>MessageB</code> objects as WebSocket
messages using the <code>sendObject</code> method as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MessageA msgA = <span class="keyword">new</span> MessageA(...);
MessageB msgB = <span class="keyword">new</span> MessageB(...);
session.getBasicRemote.sendObject(msgA);
session.getBasicRemote.sendObject(msgB);</code></pre>
</div>
</div>
<div class="paragraph">
<p>As in this example, you can have more than one encoder for text messages
and more than one encoder for binary messages. Like endpoints, encoder
instances are associated with one and only one WebSocket connection and
peer, so there is only one thread executing the code of an encoder
instance at any given time.</p>
</div>
<div class="paragraph">
<p><a id="CIHGDJFG"></a><a id="implementing-decoders-to-convert-websocket-messages-into-java-objects"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_implementing_decoders_to_convert_websocket_messages_into_java_objects">1.7.2. Implementing Decoders to Convert WebSocket Messages into Java Objects</h4>
<div class="paragraph">
<p>The procedure to implement and use decoders in endpoints follows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Implement one of the following interfaces:</p>
<div class="ulist">
<ul>
<li>
<p><code>Decoder.Text&lt;T&gt;</code> for text messages</p>
</li>
<li>
<p><code>Decoder.Binary&lt;T&gt;</code> for binary messages</p>
<div class="paragraph">
<p>These interfaces specify the <code>willDecode</code> and <code>decode</code> methods.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Note:</p>
</div>
<div class="paragraph">
<p>Unlike with encoders, you can specify at most one decoder for binary
messages and one decoder for text messages.</p>
</div></div></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</li>
<li>
<p>Add the names of your decoder implementations to the <code>decoders</code>
optional parameter of the <code>ServerEndpoint</code> annotation.</p>
</li>
<li>
<p>Use the <code>OnMessage</code> annotation in the endpoint to designate a method
that takes your custom Java type as a parameter. When the endpoint
receives a message that can be decoded by one of the decoders you
specified, the container calls the method annotated with <code>@OnMessage</code>
that takes your custom Java type as a parameter if this method exists.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, if you have two Java types (<code>MessageA</code> and <code>MessageB</code>) that
you want to send and receive as text messages, define them so that they
extend a common class (<code>Message</code>). Because you can only define one
decoder for text messages, implement a decoder for the <code>Message</code> class
as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MessageTextDecoder</span> <span class="directive">implements</span> Decoder.Text&lt;Message&gt; {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> init(EndpointConfig ec) { }
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> destroy() { }
   <span class="annotation">@Override</span>
   <span class="directive">public</span> Message decode(<span class="predefined-type">String</span> string) <span class="directive">throws</span> DecodeException {
      <span class="comment">// Read message...</span>
      <span class="keyword">if</span> ( <span class="comment">/* message is an A message */</span> )
         <span class="keyword">return</span> <span class="keyword">new</span> MessageA(...);
      <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="comment">/* message is a B message */</span> )
         <span class="keyword">return</span> <span class="keyword">new</span> MessageB(...);
   }
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">boolean</span> willDecode(<span class="predefined-type">String</span> string) {
      <span class="comment">// Determine if the message can be converted into either a</span>
      <span class="comment">// MessageA object or a MessageB object...</span>
      <span class="keyword">return</span> canDecode;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, add the <code>decoder</code> parameter to the <code>ServerEndpoint</code> annotation as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(
   value = <span class="string"><span class="delimiter">&quot;</span><span class="content">/myendpoint</span><span class="delimiter">&quot;</span></span>,
   encoders = { MessageATextEncoder.class, MessageBTextEncoder.class },
   decoders = { MessageTextDecoder.class }
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EncDecEndpoint</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, define a method in the endpoint class that receives <code>MessageA</code> and
<code>MessageB</code> objects as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OnMessage</span>
<span class="directive">public</span> <span class="type">void</span> message(Session session, Message msg) {
   <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> MessageA) {
      <span class="comment">// We received a MessageA object...</span>
   } <span class="keyword">else</span> <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> MessageB) {
      <span class="comment">// We received a MessageB object...</span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Like endpoints, decoder instances are associated with one and only one
WebSocket connection and peer, so there is only one thread executing the
code of a decoder instance at any given time.</p>
</div>
<div class="paragraph">
<p><a id="BABEJIJI"></a><a id="path-parameters"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_path_parameters">1.8. Path Parameters</h3>
<div class="paragraph">
<p>The <code>ServerEndpoint</code> annotation enables you to use URI templates to
specify parts of an endpoint deployment URI as application parameters.
For example, consider this endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/chatrooms/{room-name}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ChatEndpoint</span> {
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the endpoint is deployed inside a web application called <code>chatapp</code> at
a local Jakarta EE server in port 8080, clients can connect to the endpoint
using any of the following URIs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/chatapp/chatrooms/currentnews</span>
http:<span class="comment">//localhost:8080/chatapp/chatrooms/music</span>
http:<span class="comment">//localhost:8080/chatapp/chatrooms/cars</span>
http:<span class="comment">//localhost:8080/chatapp/chatrooms/technology</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Annotated endpoints can receive path parameters as arguments in methods
annotated with <code>@OnOpen</code>, <code>@OnMessage</code>, and <code>@OnClose</code>. In this example,
the endpoint uses the parameter in the <code>@OnOpen</code> method to determine
which chat room the client wants to join:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/chatrooms/{room-name}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ChatEndpoint</span> {
   <span class="annotation">@OnOpen</span>
   <span class="directive">public</span> <span class="type">void</span> open(Session session,
                    EndpointConfig c,
                    <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">room-name</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> roomName) {
      <span class="comment">// Add the client to the chat room of their choice ...</span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The path parameters used as arguments in these methods can be strings,
primitive types, or the corresponding wrapper types.</p>
</div>
<div class="paragraph">
<p><a id="BABDEJHB"></a><a id="handling-errors"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_handling_errors">1.9. Handling Errors</h3>
<div class="paragraph">
<p>To designate a method that handles errors in an annotated WebSocket
endpoint, decorate it with <code>@OnError</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/testendpoint</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TestEndpoint</span> {
   ...
   <span class="annotation">@OnError</span>
   <span class="directive">public</span> <span class="type">void</span> error(Session session, <span class="predefined-type">Throwable</span> t) {
      t.printStackTrace();
      ...
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method is invoked when there are connection problems, runtime
errors from message handlers, or conversion errors when decoding
messages.</p>
</div>
<div class="paragraph">
<p><a id="BABJAIGH"></a><a id="specifying-an-endpoint-configurator-class"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_specifying_an_endpoint_configurator_class">1.10. Specifying an Endpoint Configurator Class</h3>
<div class="paragraph">
<p>Jakarta WebSocket enables you to configure how the container
creates server endpoint instances. You can provide custom endpoint
configuration logic to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Access the details of the initial HTTP request for a WebSocket
connection</p>
</li>
<li>
<p>Perform custom checks on the <code>Origin</code> HTTP header</p>
</li>
<li>
<p>Modify the WebSocket handshake response</p>
</li>
<li>
<p>Choose a WebSocket subprotocol from those requested by the client</p>
</li>
<li>
<p>Control the instantiation and initialization of endpoint instances</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To provide custom endpoint configuration logic, you extend the
<code>ServerEndpointConfig.Configurator</code> class and override some of its
methods. In the endpoint class, you specify the configurator class using
the <code>configurator</code> parameter of the <code>ServerEndpoint</code> annotation.</p>
</div>
<div class="paragraph">
<p>For example, the following configurator class makes the handshake
request object available to endpoint instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomConfigurator</span> <span class="directive">extends</span> ServerEndpointConfig.Configurator {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> modifyHandshake(ServerEndpointConfig conf,
                                HandshakeRequest req,
                                HandshakeResponse resp) {

        conf.getUserProperties().put(<span class="string"><span class="delimiter">&quot;</span><span class="content">handshakereq</span><span class="delimiter">&quot;</span></span>, req);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following endpoint class configures endpoint instances with the
custom configurator, which enables them to access the handshake request
object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(
    value = <span class="string"><span class="delimiter">&quot;</span><span class="content">/myendpoint</span><span class="delimiter">&quot;</span></span>,
    configurator = CustomConfigurator.class
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyEndpoint</span> {

    <span class="annotation">@OnOpen</span>
    <span class="directive">public</span> <span class="type">void</span> open(Session s, EndpointConfig conf) {
        HandshakeRequest req = (HandshakeRequest) conf.getUserProperties()
                                                      .get(<span class="string"><span class="delimiter">&quot;</span><span class="content">handshakereq</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>,<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt;&gt; headers = req.getHeaders();
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The endpoint class can use the handshake request object to access the
details of the initial HTTP request, such as its headers or the
<code>HttpSession</code> object.</p>
</div>
<div class="paragraph">
<p>For more information on endpoint configuration, see the API reference
for the <code>ServerEndpointConfig.Configurator</code> class.</p>
</div>
<div class="paragraph">
<p><a id="BABGCEHE"></a><a id="the-dukeetf2-example-application"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_the_dukeetf2_example_application">1.11. The dukeetf2 Example Application</h3>
<div class="paragraph">
<p>The <code>dukeetf2</code> example application, located in the
tut-install`/examples/web/websocket/dukeetf2/` directory, demonstrates
how to use a WebSocket endpoint to provide data updates to web clients.
The example resembles a service that provides periodic updates on the
price and trading volume of an electronically traded fund (ETF).</p>
</div>
<div class="paragraph">
<p><a id="CIHJHJCD"></a><a id="architecture-of-the-dukeetf2-sample-application"></a></p>
</div>
<div class="sect3">
<h4 id="_architecture_of_the_dukeetf2_sample_application">1.11.1. Architecture of the dukeetf2 Sample Application</h4>
<div class="paragraph">
<p>The <code>dukeetf2</code> example application consists of a WebSocket endpoint, an
enterprise bean, and an HTML page.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The endpoint accepts connections from clients and sends them updates
when new data for price and trading volume becomes available.</p>
</li>
<li>
<p>The enterprise bean updates the price and volume information once
every second.</p>
</li>
<li>
<p>The HTML page uses JavaScript code to connect to the WebSocket
endpoint, parse incoming messages, and update the price and volume
information without reloading the page.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="sthref116"></a><a id="the-endpoint"></a></p>
</div>
<div class="sect4">
<h5 id="_the_endpoint">The Endpoint</h5>
<div class="paragraph">
<p>The WebSocket endpoint is implemented in the <code>ETFEndpoint</code> class, which
stores all connected sessions in a queue and provides a method that the
enterprise bean calls when there is new information available to send:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/dukeetf</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ETFEndpoint</span> {
   <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(<span class="string"><span class="delimiter">&quot;</span><span class="content">ETFEndpoint</span><span class="delimiter">&quot;</span></span>);
   <span class="comment">/* Queue for all open WebSocket sessions */</span>
   <span class="directive">static</span> <span class="predefined-type">Queue</span>&lt;Session&gt; queue = <span class="keyword">new</span> <span class="predefined-type">ConcurrentLinkedQueue</span>&lt;&gt;();

   <span class="comment">/* PriceVolumeBean calls this method to send updates */</span>
   <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> send(<span class="type">double</span> price, <span class="type">int</span> volume) {
      <span class="predefined-type">String</span> msg = <span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">%.2f / %d</span><span class="delimiter">&quot;</span></span>, price, volume);
      <span class="keyword">try</span> {
         <span class="comment">/* Send updates to all open WebSocket sessions */</span>
         <span class="keyword">for</span> (Session session : queue) {
            session.getBasicRemote().sendText(msg);
            logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Sent: {0}</span><span class="delimiter">&quot;</span></span>, msg);
         }
      } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) {
         logger.log(<span class="predefined-type">Level</span>.INFO, e.toString());
      }
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The lifecycle methods of the endpoint add and remove sessions to and
from the queue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/dukeetf</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ETFEndpoint</span> {
   ...
   <span class="annotation">@OnOpen</span>
   <span class="directive">public</span> <span class="type">void</span> openConnection(Session session) {
      <span class="comment">/* Register this connection in the queue */</span>
      queue.add(session);
      logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Connection opened.</span><span class="delimiter">&quot;</span></span>);
   }

   <span class="annotation">@OnClose</span>
   <span class="directive">public</span> <span class="type">void</span> closedConnection(Session session) {
      <span class="comment">/* Remove this connection from the queue */</span>
      queue.remove(session);
      logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Connection closed.</span><span class="delimiter">&quot;</span></span>);
   }

   <span class="annotation">@OnError</span>
   <span class="directive">public</span> <span class="type">void</span> error(Session session, <span class="predefined-type">Throwable</span> t) {
      <span class="comment">/* Remove this connection from the queue */</span>
      queue.remove(session);
      logger.log(<span class="predefined-type">Level</span>.INFO, t.toString());
      logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Connection error.</span><span class="delimiter">&quot;</span></span>);
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="sthref117"></a><a id="the-enterprise-bean"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_the_enterprise_bean">The Enterprise Bean</h5>
<div class="paragraph">
<p>The enterprise bean uses the timer service to generate new price and
volume information every second:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Startup</span>
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PriceVolumeBean</span> {
   <span class="comment">/* Use the container's timer service */</span>
   <span class="annotation">@Resource</span> TimerService tservice;
   <span class="directive">private</span> <span class="predefined-type">Random</span> random;
   <span class="directive">private</span> <span class="directive">volatile</span> <span class="type">double</span> price = <span class="float">100.0</span>;
   <span class="directive">private</span> <span class="directive">volatile</span> <span class="type">int</span> volume = <span class="integer">300000</span>;
   <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(<span class="string"><span class="delimiter">&quot;</span><span class="content">PriceVolumeBean</span><span class="delimiter">&quot;</span></span>);

   <span class="annotation">@PostConstruct</span>
   <span class="directive">public</span> <span class="type">void</span> init() {
       <span class="comment">/* Initialize the EJB and create a timer */</span>
       logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Initializing EJB.</span><span class="delimiter">&quot;</span></span>);
       random = <span class="keyword">new</span> <span class="predefined-type">Random</span>();
       tservice.createIntervalTimer(<span class="integer">1000</span>, <span class="integer">1000</span>, <span class="keyword">new</span> TimerConfig());
   }

   <span class="annotation">@Timeout</span>
   <span class="directive">public</span> <span class="type">void</span> timeout() {
       <span class="comment">/* Adjust price and volume and send updates */</span>
       price += <span class="float">1.0</span>*(random.nextInt(<span class="integer">100</span>)-<span class="integer">50</span>)/<span class="float">100.0</span>;
       volume += random.nextInt(<span class="integer">5000</span>) - <span class="integer">2500</span>;
       ETFEndpoint.send(price, volume);
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The enterprise bean calls the <code>send</code> method of the <code>ETFEndpoint</code> class
in the timeout method. See <a href="#BNBOY">Using the
Timer Service</a> in <a href="#GIJRB">Chapter 37, "Running
the Enterprise Bean Examples"</a> for more information on the timer
service.</p>
</div>
<div class="paragraph">
<p><a id="CIHHIEFH"></a><a id="the-html-page"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_the_html_page">The HTML Page</h5>
<div class="paragraph">
<p>The HTML page consists of a table and some JavaScript code. The table
contains two fields referenced from JavaScript code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html&gt;</span>
<span class="tag">&lt;head&gt;</span>...<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body&gt;</span>
  ...
  <span class="tag">&lt;table&gt;</span>
    ...
    <span class="tag">&lt;td</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>--.--<span class="tag">&lt;/td&gt;</span>
    ...
    <span class="tag">&lt;td</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">volume</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>--<span class="tag">&lt;/td&gt;</span>
    ...
  <span class="tag">&lt;/table&gt;</span>
<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The JavaScript code uses the WebSocket API to connect to the server
endpoint and to designate a callback method for incoming messages. The
callback method updates the page with the new information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var wsocket;
function connect() {
   wsocket = <span class="keyword">new</span> WebSocket(<span class="string"><span class="delimiter">&quot;</span><span class="content">ws://localhost:8080/dukeetf2/dukeetf</span><span class="delimiter">&quot;</span></span>);
   wsocket.onmessage = onMessage;
}
function onMessage(evt) {
   var arraypv = evt.data.split(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>);
   document.getElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>).innerHTML = arraypv[<span class="integer">0</span>];
   document.getElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">volume</span><span class="delimiter">&quot;</span></span>).innerHTML = arraypv[<span class="integer">1</span>];
}
window.addEventListener(<span class="string"><span class="delimiter">&quot;</span><span class="content">load</span><span class="delimiter">&quot;</span></span>, connect, <span class="predefined-constant">false</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The WebSocket API is supported by most modern browsers, and it is widely
used in HTML5 web client development.</p>
</div>
<div class="paragraph">
<p><a id="CIHHBAIC"></a><a id="running-the-dukeetf2-example-application"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_running_the_dukeetf2_example_application">1.11.2. Running the dukeetf2 Example Application</h4>
<div class="paragraph">
<p>This section describes how to run the <code>dukeetf2</code> example application
using NetBeans IDE and from the command line.</p>
</div>
<div class="paragraph">
<p><a id="CIHEBIAH"></a><a id="to-run-the-dukeetf2-example-application-using-netbeans-ide"></a></p>
</div>
<div class="sect4">
<h5 id="_to_run_the_dukeetf2_example_application_using_netbeans_ide">To Run the dukeetf2 Example Application Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/web/websocket</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>dukeetf2</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>dukeetf2</code> project and select
Run.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file
(<code>dukeetf2.war</code>) located in the <code>target/</code> directory, deploys it to the
server, and launches a web browser window with the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/dukeetf2/</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Open the same URL on a different web browser tab or window to see how
both pages get price and volume updates simultaneously.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="CIHDJCGJ"></a><a id="to-run-the-dukeetf2-example-application-using-maven"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_run_the_dukeetf2_example_application_using_maven">To Run the dukeetf2 Example Application Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/web/websocket/dukeetf2/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Open a web browser window and enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/dukeetf2/</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Open the same URL on a different web browser tab or window to see how
both pages get price and volume updates simultaneously.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BABCDBBC"></a><a id="the-websocketbot-example-application"></a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_websocketbot_example_application">1.12. The websocketbot Example Application</h3>
<div class="paragraph">
<p>The <code>websocketbot</code> example application, located in the
tut-install`/examples/web/websocket/websocketbot/` directory,
demonstrates how to use a WebSocket endpoint to implement a chat. The
example resembles a chat room in which many users can join and have a
conversation. Users can ask simple questions to a bot agent that is
always available in the chat room.</p>
</div>
<div class="paragraph">
<p><a id="CIHICIDE"></a><a id="architecture-of-the-websocketbot-example-application"></a></p>
</div>
<div class="sect3">
<h4 id="_architecture_of_the_websocketbot_example_application">1.12.1. Architecture of the websocketbot Example Application</h4>
<div class="paragraph">
<p>The <code>websocketbot</code> example application consists of the following
elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CIHDAEHF">The CDI Bean</a> – A CDI bean (<code>BotBean</code>) that contains
the logic for the bot agent to reply to messages</p>
</li>
<li>
<p><a href="#CIHJJJHG">The WebSocket Endpoint</a> – A WebSocket endpoint
(<code>BotEndpoint</code>) that implements the chat room</p>
</li>
<li>
<p><a href="#CIHFDGHG">The Application Messages</a> – A set of classes
(<code>Message</code>, <code>ChatMessage</code>, <code>InfoMessage</code>, <code>JoinMessage</code>, and
<code>UsersMessage</code>) that represent application messages</p>
</li>
<li>
<p><a href="#CIHGHHBD">The Encoder Classes</a> – A set of classes
(<code>ChatMessageEncoder</code>, <code>InfoMessageEncoder</code>, <code>JoinMessageEncoder</code>, and
<code>UsersMessageEncoder</code>) that encode application messages into WebSocket
text messages as JSON data</p>
</li>
<li>
<p><a href="#CIHHFICG">The Message Decoder</a> – A class (<code>MessageDecoder</code>) the
parses WebSocket text messages as JSON data and decodes them into
<code>JoinMessage</code> or <code>ChatMessage</code> objects</p>
</li>
<li>
<p><a href="#CIHHIEFH">The HTML Page</a> – An HTML page
(<code>index.html</code>) that uses JavaScript code to implement the client for the
chat room</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="CIHDAEHF"></a><a id="the-cdi-bean"></a></p>
</div>
<div class="sect4">
<h5 id="_the_cdi_bean">The CDI Bean</h5>
<div class="paragraph">
<p>The CDI bean (<code>BotBean</code>) is a Java class that contains the <code>respond</code>
method. This method compares the incoming chat message with a set of
predefined questions and returns a chat response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BotBean</span> {
    <span class="directive">public</span> <span class="predefined-type">String</span> respond(<span class="predefined-type">String</span> msg) { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="CIHJJJHG"></a><a id="the-websocket-endpoint"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_the_websocket_endpoint">The WebSocket Endpoint</h5>
<div class="paragraph">
<p>The WebSocket endpoint (<code>BotEndpoint</code>) is an annotated endpoint that
performs the following functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Receives messages from clients</p>
</li>
<li>
<p>Forwards messages to clients</p>
</li>
<li>
<p>Maintains a list of connected clients</p>
</li>
<li>
<p>Invokes the bot agent functionality</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The endpoint specifies its deployment URI and the message encoders and
decoders using the <code>ServerEndpoint</code> annotation. The endpoint obtains an
instance of the <code>BotBean</code> class and a managed executor service resource
through dependency injection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(
   value = <span class="string"><span class="delimiter">&quot;</span><span class="content">/websocketbot</span><span class="delimiter">&quot;</span></span>,
   decoders = { MessageDecoder.class },
   encoders = { JoinMessageEncoder.class, ChatMessageEncoder.class,
                InfoMessageEncoder.class, UsersMessageEncoder.class }
)
<span class="comment">/* There is a BotEndpoint instance per connection */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BotEndpoint</span> {
   <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(<span class="string"><span class="delimiter">&quot;</span><span class="content">BotEndpoint</span><span class="delimiter">&quot;</span></span>);
   <span class="comment">/* Bot functionality bean */</span>
   <span class="annotation">@Inject</span> <span class="directive">private</span> BotBean botbean;
   <span class="comment">/* Executor service for asynchronous processing */</span>
   <span class="annotation">@Resource</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">comp/DefaultManagedExecutorService</span><span class="delimiter">&quot;</span></span>)
   <span class="directive">private</span> ManagedExecutorService mes;

   <span class="annotation">@OnOpen</span>
   <span class="directive">public</span> <span class="type">void</span> openConnection(Session session) {
       logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Connection opened.</span><span class="delimiter">&quot;</span></span>);
   }
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>message</code> method processes incoming messages from clients. The
decoder converts incoming text messages into <code>JoinMessage</code> or
<code>ChatMessage</code> objects, which inherit from the <code>Message</code> class. The
<code>message</code> method receives a <code>Message</code> object as a parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OnMessage</span>
<span class="directive">public</span> <span class="type">void</span> message(Session session, Message msg) {
   logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Received: {0}</span><span class="delimiter">&quot;</span></span>, msg.toString());

   <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> JoinMessage) {
      <span class="comment">/* Add the new user and notify everybody */</span>
      JoinMessage jmsg = (JoinMessage) msg;
      session.getUserProperties().put(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, jmsg.getName());
      session.getUserProperties().put(<span class="string"><span class="delimiter">&quot;</span><span class="content">active</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>);
      logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Received: {0}</span><span class="delimiter">&quot;</span></span>, jmsg.toString());
      sendAll(session, <span class="keyword">new</span> InfoMessage(jmsg.getName() +
              <span class="string"><span class="delimiter">&quot;</span><span class="content"> has joined the chat</span><span class="delimiter">&quot;</span></span>));
      sendAll(session, <span class="keyword">new</span> ChatMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke</span><span class="delimiter">&quot;</span></span>, jmsg.getName(),
              <span class="string"><span class="delimiter">&quot;</span><span class="content">Hi there!!</span><span class="delimiter">&quot;</span></span>));
      sendAll(session, <span class="keyword">new</span> UsersMessage(<span class="local-variable">this</span>.getUserList(session)));

   } <span class="keyword">else</span> <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> ChatMessage) {
      <span class="comment">/* Forward the message to everybody */</span>
      ChatMessage cmsg = (ChatMessage) msg;
      logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Received: {0}</span><span class="delimiter">&quot;</span></span>, cmsg.toString());
      sendAll(session, cmsg);
      <span class="keyword">if</span> (cmsg.getTarget().compareTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke</span><span class="delimiter">&quot;</span></span>) == <span class="integer">0</span>) {
         <span class="comment">/* The bot replies to the message */</span>
         mes.submit(<span class="keyword">new</span> <span class="predefined-type">Runnable</span>() {
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> run() {
               <span class="predefined-type">String</span> resp = botbean.respond(cmsg.getMessage());
               sendAll(session, <span class="keyword">new</span> ChatMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke</span><span class="delimiter">&quot;</span></span>,
                       cmsg.getName(), resp));
            }
         });
      }
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the message is a join message, the endpoint adds the new user to the
list and notifies all connected clients. If the message is a chat
message, the endpoint forwards it to all connected clients.</p>
</div>
<div class="paragraph">
<p>If a chat message is for the bot agent, the endpoint obtains a response
using the <code>BotBean</code> instance and sends it to all connected clients. The
<code>sendAll</code> method is similar to the example in
<a href="#BABIFBCG">Sending Messages to All Peers Connected
to an Endpoint</a>.</p>
</div>
<div class="paragraph">
<p>Asynchronous Processing and Concurrency Considerations</p>
</div>
<div class="paragraph">
<p>The WebSocket endpoint calls the <code>BotBean.respond</code> method to obtain a
response from the bot. In this example, this is a blocking operation;
the user that sent the associated message would not be able to send or
receive other chat messages until the operation completes. To avoid this
problem, the endpoint obtains an executor service from the container and
executes the blocking operation in a different thread using the
<code>ManagedExecutorService.submit</code> method from Concurrency Utilities for
Jakarta EE.</p>
</div>
<div class="paragraph">
<p>Jakarta WebSocket specification requires that Jakarta EE
implementations instantiate endpoint classes once per connection. This
facilitates the development of WebSocket endpoints, because you are
guaranteed that only one thread is executing the code in a WebSocket
endpoint class at any given time. When you introduce a new thread in an
endpoint, as in this example, you must ensure that variables and methods
accessed by more than one thread are thread safe. In this example, the
code in <code>BotBean</code> is thread safe, and the <code>BotEndpoint.sendAll</code> method
has been declared <code>synchronized</code>.</p>
</div>
<div class="paragraph">
<p>Refer to <a href="#GKJIQ8">Chapter 59, "Concurrency
Utilities for Jakarta EE"</a> for more information on the managed executor
service and Concurrency Utilities for Jakarta EE.</p>
</div>
<div class="paragraph">
<p><a id="CIHFDGHG"></a><a id="the-application-messages"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_the_application_messages">The Application Messages</h5>
<div class="paragraph">
<p>The classes that represent application messages (<code>Message</code>,
<code>ChatMessage</code>, <code>InfoMessage</code>, <code>JoinMessage</code>, and <code>UsersMessage</code>) contain
only properties and getter and setter methods. For example, the
<code>ChatMessage</code> class looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ChatMessage</span> <span class="directive">extends</span> Message {
    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="predefined-type">String</span> target;
    <span class="directive">private</span> <span class="predefined-type">String</span> message;
    <span class="comment">/* ... Constructor, getters, and setters ... */</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="CIHGHHBD"></a><a id="the-encoder-classes"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_the_encoder_classes">The Encoder Classes</h5>
<div class="paragraph">
<p>The encoder classes convert application message objects into JSON text
using the Java API for JSON Processing. For example, the
<code>ChatMessageEncoder</code> class is implemented as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/* Encode a ChatMessage as JSON.
 * For example, (new ChatMessage(&quot;Peter&quot;,&quot;Duke&quot;,&quot;How are you?&quot;))
 * is encoded as follows:
 * {&quot;type&quot;:&quot;chat&quot;,&quot;target&quot;:&quot;Duke&quot;,&quot;message&quot;:&quot;How are you?&quot;}
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ChatMessageEncoder</span> <span class="directive">implements</span> <span class="predefined-type">Encoder</span>.Text&lt;ChatMessage&gt; {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> init(EndpointConfig ec) { }
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> destroy() { }
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="predefined-type">String</span> encode(ChatMessage chatMessage) <span class="directive">throws</span> EncodeException {
      <span class="comment">// Access properties in chatMessage and write JSON text...</span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#GLRBB">JSON
Processing</a> for more information on the Java API for JSON Processing.</p>
</div>
<div class="paragraph">
<p><a id="CIHHFICG"></a><a id="the-message-decoder"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_the_message_decoder">The Message Decoder</h5>
<div class="paragraph">
<p>The message decoder (<code>MessageDecoder</code>) class converts WebSocket text
messages into application messages by parsing JSON text. It is
implemented as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/* Decode a JSON message into a JoinMessage or a ChatMessage.
 * For example, the incoming message
 * {&quot;type&quot;:&quot;chat&quot;,&quot;name&quot;:&quot;Peter&quot;,&quot;target&quot;:&quot;Duke&quot;,&quot;message&quot;:&quot;How are you?&quot;}
 * is decoded as (new ChatMessage(&quot;Peter&quot;, &quot;Duke&quot;, &quot;How are you?&quot;))
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MessageDecoder</span> <span class="directive">implements</span> Decoder.Text&lt;Message&gt; {
    <span class="comment">/* Stores the name-value pairs from a JSON message as a Map */</span>
    <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>,<span class="predefined-type">String</span>&gt; messageMap;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(EndpointConfig ec) { }
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> destroy() { }

    <span class="comment">/* Create a new Message object if the message can be decoded */</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> Message decode(<span class="predefined-type">String</span> string) <span class="directive">throws</span> DecodeException {
       Message msg = <span class="predefined-constant">null</span>;
       <span class="keyword">if</span> (willDecode(string)) {
          <span class="keyword">switch</span> (messageMap.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>)) {
             <span class="keyword">case</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">join</span><span class="delimiter">&quot;</span></span>:
                msg = <span class="keyword">new</span> JoinMessage(messageMap.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>));
                <span class="keyword">break</span>;
             <span class="keyword">case</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">chat</span><span class="delimiter">&quot;</span></span>:
                msg = <span class="keyword">new</span> ChatMessage(messageMap.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>),
                                      messageMap.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">target</span><span class="delimiter">&quot;</span></span>),
                                      messageMap.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>));
          }
       } <span class="keyword">else</span> {
          <span class="keyword">throw</span> <span class="keyword">new</span> DecodeException(string, <span class="string"><span class="delimiter">&quot;</span><span class="content">[Message] Can't decode.</span><span class="delimiter">&quot;</span></span>);
       }
       <span class="keyword">return</span> msg;
   }

   <span class="comment">/* Decode a JSON message into a Map and check if it contains
    * all the required fields according to its type. */</span>
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">boolean</span> willDecode(<span class="predefined-type">String</span> string) {
      <span class="comment">// Convert JSON data from the message into a name-value map...</span>
      <span class="comment">// Check if the message has all the fields for its message type...</span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="CIHGDBGF"></a><a id="the-html-page"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_the_html_page_2">The HTML Page</h5>
<div class="paragraph">
<p>The HTML page (<code>index.html</code>) contains a field for the user name. After
the user types a name and clicks Join, three text areas are available:
one to type and send messages, one for the chat room, and one with the
list of users. The page also contains a WebSocket console that shows the
messages sent and received as JSON text.</p>
</div>
<div class="paragraph">
<p>The JavaScript code on the page uses the WebSocket API to connect to the
endpoint, send messages, and designate callback methods. The WebSocket
API is supported by most modern browsers and is widely used for web
client development with HTML5.</p>
</div>
<div class="paragraph">
<p><a id="CIHHJHDB"></a><a id="running-the-websocketbot-example-application"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_running_the_websocketbot_example_application">1.12.2. Running the websocketbot Example Application</h4>
<div class="paragraph">
<p>This section describes how to run the <code>websocketbot</code> example application
using NetBeans IDE and from the command line.</p>
</div>
<div class="paragraph">
<p><a id="CIHFDDGE"></a><a id="to-run-the-websocketbot-example-application-using-netbeans-ide"></a></p>
</div>
<div class="sect4">
<h5 id="_to_run_the_websocketbot_example_application_using_netbeans_ide">To Run the websocketbot Example Application Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/web/websocket</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>websocketbot</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>websocketbot</code> project and
select Run.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file,
<code>websocketbot.war</code>, located in the <code>target/</code> directory; deploys it to
the server; and launches a web browser window with the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/websocketbot/</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#BABDDAAG">To Test the websocketbot Example Application</a> for
more information.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="CIHEDEHB"></a><a id="to-run-the-websocketbot-example-application-using-maven"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_run_the_websocketbot_example_application_using_maven">To Run the websocketbot Example Application Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#BNADI">Starting and Stopping GlassFish
Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/web/websocket/websocketbot/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Open a web browser window and type the following address:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/websocketbot/</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#BABDDAAG">To Test the websocketbot Example Application</a> for
more information.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BABDDAAG"></a><a id="to-test-the-websocketbot-example-application"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_test_the_websocketbot_example_application">To Test the websocketbot Example Application</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the main page, type your name on the first text field and press
the Enter key.</p>
<div class="paragraph">
<p>The list of connected users appears on the text area on the right. The
text area on the left is the chat room.</p>
</div>
</li>
<li>
<p>Type a message on the text area below the login button. For example,
type the messages in bold and press enter to obtain responses similar to
the following:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">[--Peter has joined the chat--]
Duke: <span class="annotation">@Peter</span> Hi there!!
Peter: <span class="annotation">@Duke</span> how are you?
Duke: <span class="annotation">@Peter</span> I<span class="string"><span class="delimiter">'</span><span class="content">m doing great, thank you!
Peter: @Duke when is your birthday?
Duke: @Peter My birthday is on May 23rd. Thanks for asking!</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>Join the chat from another browser window by copying and pasting the
URI on the address bar and joining with a different name.</p>
<div class="paragraph">
<p>The new user name appears in the list of users in both browser windows.
You can send messages from either window and see how they appear in the
other.</p>
</div>
</li>
<li>
<p>Click Show WebSocket Console.</p>
<div class="paragraph">
<p>The console shows the messages sent and received as JSON text.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BABDFIFD"></a><a id="further-information-about-websocket"></a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_further_information_about_websocket">1.13. Further Information about WebSocket</h3>
<div class="paragraph">
<p>For more information on WebSocket in Jakarta EE, see the Jakarta WebSocket specification:</p>
</div>
<div class="paragraph">
<p><code><a href="https://jakarta.ee/specifications/websocket/1.1/" class="bare">https://jakarta.ee/specifications/websocket/1.1/</a></code></p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-01-08 17:03:44 UTC
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</body>
</html>