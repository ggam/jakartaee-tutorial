<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.2">
<title>Security</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement when using as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Security</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction_to_security_in_the_jakarta_ee_platform">1. Introduction to Security in the Jakarta EE Platform</a>
<ul class="sectlevel2">
<li><a href="#_overview_of_jakarta_security">1.1. Overview of Jakarta Security</a></li>
<li><a href="#_security_mechanisms">1.2. Security Mechanisms</a></li>
<li><a href="#using-pluggable-providers">1.3. Using Pluggable Providers</a></li>
<li><a href="#_securing_containers">1.4. Securing Containers</a></li>
<li><a href="#_securing_glassfish_server">1.5. Securing GlassFish Server</a></li>
<li><a href="#working-with-identity-stores">1.6. Working with Identity Stores</a></li>
<li><a href="#_working_with_realms_users_groups_and_roles">1.7. Working with Realms, Users, Groups, and Roles</a></li>
<li><a href="#_establishing_a_secure_connection_using_ssl">1.8. Establishing a Secure Connection Using SSL</a></li>
<li><a href="#_further_information_about_security">1.9. Further Information about Security</a></li>
</ul>
</li>
<li><a href="#_getting_started_securing_web_applications">2. Getting Started Securing Web Applications</a>
<ul class="sectlevel2">
<li><a href="#_overview_of_web_application_security">2.1. Overview of Web Application Security</a></li>
<li><a href="#_securing_web_applications">2.2. Securing Web Applications</a></li>
<li><a href="#_using_programmatic_security_with_web_applications">2.3. Using Programmatic Security with Web Applications</a></li>
<li><a href="#security-context">2.4. SecurityContext</a></li>
<li><a href="#httpservletrequest">2.5. HttpServletRequest</a></li>
<li><a href="#_examples_securing_web_applications">2.6. Examples: Securing Web Applications</a></li>
</ul>
</li>
<li><a href="#_getting_started_securing_enterprise_applications">3. Getting Started Securing Enterprise Applications</a>
<ul class="sectlevel2">
<li><a href="#_basic_security_tasks_for_enterprise_applications">3.1. Basic Security Tasks for Enterprise Applications</a></li>
<li><a href="#_securing_enterprise_beans">3.2. Securing Enterprise Beans</a></li>
<li><a href="#_examples_securing_enterprise_beans">3.3. Examples: Securing Enterprise Beans</a></li>
</ul>
</li>
<li><a href="#_using_jakarta_security">4. Using Jakarta Security</a>
<ul class="sectlevel2">
<li><a href="#about-the-jakarta-ee-security-api">4.1. About Jakarta Security</a></li>
<li><a href="#overview-of-the-http-authentication-mechanism-interface">4.2. Overview of the HTTP Authentication Mechanism Interface</a></li>
<li><a href="#overview-of-the-identity-store-interfaces">4.3. Overview of the Identity Store Interfaces</a></li>
<li><a href="#running-the-built-in-database-identity-store-example">4.4. Running the Built-In Database Identity Store Example</a></li>
<li><a href="#running-the-custom-identity-store-example">4.5. Running the Custom Identity Store Example</a></li>
</ul>
</li>
<li><a href="#_jakarta_ee_security_advanced_topics">5. Jakarta EE Security: Advanced Topics</a>
<ul class="sectlevel2">
<li><a href="#_working_with_digital_certificates">5.1. Working with Digital Certificates</a></li>
<li><a href="#_authentication_mechanisms">5.2. Authentication Mechanisms</a></li>
<li><a href="#_using_the_jdbc_realm_for_user_authentication">5.3. Using the JDBC Realm for User Authentication</a></li>
<li><a href="#_securing_http_resources">5.4. Securing HTTP Resources</a></li>
<li><a href="#_securing_application_clients">5.5. Securing Application Clients</a></li>
<li><a href="#_securing_enterprise_information_systems_applications">5.6. Securing Enterprise Information Systems Applications</a></li>
<li><a href="#_configuring_security_using_deployment_descriptors">5.7. Configuring Security Using Deployment Descriptors</a></li>
<li><a href="#_further_information_about_advanced_security_topics">5.8. Further Information about Advanced Security Topics</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction_to_security_in_the_jakarta_ee_platform">1. Introduction to Security in the Jakarta EE Platform</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="BNBWJ"></a><a id="introduction-to-security-in-the-jakarta-ee-platform"></a></p>
</div>
<div class="paragraph">
<p>This chapter introduces basic security concepts and security mechanisms.
More information on these concepts and mechanisms can be found in the
chapter on security in the Jakarta EE 8 specification.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Note:</strong></p>
</div>
<div class="paragraph">
<p>The SDK may include additional material demonstrating key features of Jakarta Security. Please check the latest SDK release notes for additional details.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="BNBWK"></a><a id="overview-of-jakarta-ee-security"></a></p>
</div>
<div class="sect2">
<h3 id="_overview_of_jakarta_security">1.1. Overview of Jakarta Security</h3>
<div class="paragraph">
<p>Every enterprise that has either sensitive resources that can be
accessed by many users or resources that traverse unprotected, open
networks, such as the Internet, needs to be protected.</p>
</div>
<div class="paragraph">
<p>Enterprise tier and web tier applications are made up of components that
are deployed into various containers. These components are combined to
build a multitier enterprise application. Security for components is
provided by their containers. A container provides two kinds of
security: declarative and programmatic.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Declarative security expresses an application component&#8217;s security
requirements by using either deployment descriptors or annotations.</p>
<div class="paragraph">
<p>A deployment descriptor is an XML file that is external to the
application and that expresses an application&#8217;s security structure,
including security roles, access control, and authentication
requirements. For more information about deployment descriptors, read
<a href="#BNBXF">Using Deployment Descriptors for
Declarative Security</a>.</p>
</div>
<div class="paragraph">
<p>Annotations, also called metadata, are used to specify information about
security within a class file. When the application is deployed, this
information can be either used by or overridden by the application
deployment descriptor. Annotations save you from having to write
declarative information inside XML descriptors. Instead, you simply put
annotations on the code, and the required information gets generated.
For this tutorial, annotations are used for securing applications
wherever possible. For more information about annotations, see
<a href="#BNBXG">Using Annotations to Specify Security
Information</a>.</p>
</div>
</li>
<li>
<p>Programmatic security is embedded in an application and is used to
make security decisions. Programmatic security is useful when
declarative security alone is not sufficient to express the security
model of an application. For more information about programmatic
security, read <a href="#BNBXH">Using Programmatic
Security</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Jakarta EE 8 includes a Security API specification that defines portable,
plug-in interfaces for authentication and identity stores, and a new
injectable-type SecurityContext interface that provides an access point for
programmatic security. You can use the built-in implementations of these APIs,
or define custom implementations.</p>
</div>
<div class="paragraph">
<p>More information on these concepts and mechanismsMore information on these concepts
and mechanisms can be found in the chapter on security in the Jakarta EE 8
specification.</p>
</div>
<div class="paragraph">
<p>Other chapters in this Part discuss security requirements in web tier
and enterprise tier applications, and the Jakarta Security.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BNCAS">Chapter 51, "Getting Started Securing
Web Applications"</a> explains how to add security to web components, such
as servlets.</p>
</li>
<li>
<p><a href="#BNBYK">Chapter 52, "Getting Started Securing
Enterprise Applications"</a> explains how to add security to Jakarta EE
components, such as enterprise beans and application clients.</p>
</li>
<li>
<p><a href="#using-the-jakarta-ee-security-api">53 Using Jakarta Security</a>
describes the authentication and credential validation funtionality provided by
Jakarta Security, and provides examples.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BNBWL"></a><a id="a-simple-application-security-walkthrough"></a></p>
</div>
<div class="sect3">
<h4 id="_a_simple_application_security_walkthrough">1.1.1. A Simple Application Security Walkthrough</h4>
<div class="paragraph">
<p>The security behavior of a Jakarta EE environment may be better understood
by examining what happens in a simple application with a web client, a
user interface, and enterprise bean business logic.</p>
</div>
<div class="paragraph">
<p>In the following example, which is taken from the Jakarta EE
Specification, the web client relies on the web server to act as its
authentication proxy by collecting user authentication data from the
client and using it to establish an authenticated session.</p>
</div>
<div class="paragraph">
<p><a id="BNBWM"></a><a id="step-1-initial-request"></a></p>
</div>
<div class="sect4">
<h5 id="_step_1_initial_request">Step 1: Initial Request</h5>
<div class="paragraph">
<p>In the first step of this example, the web client requests the main
application URL. This action is shown in <a href="#BNBWN">Figure 50-1</a>.</p>
</div>
<div id="BNBWN" class="paragraph">
<div class="title"><strong>Figure 50-1 Initial Request</strong></div>
<p><span class="image"><img src="../images/jakartaeett_dt_039.png" alt="Diagram of initial request from web client to web server for access to a protected resource"></span></p>
</div>
<div class="paragraph">
<p>Since the client has not yet authenticated itself to the application
environment, the server responsible for delivering the web portion of
the application, hereafter referred to as the web server, detects this
and invokes the appropriate authentication mechanism for this resource.
For more information on these mechanisms, see
<a href="#BNBWY">Security Mechanisms</a>.</p>
</div>
<div class="paragraph">
<p><a id="BNBWO"></a><a id="step-2-initial-authentication"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_step_2_initial_authentication">Step 2: Initial Authentication</h5>
<div class="paragraph">
<p>The web server returns a form that the web client uses to collect
authentication data, such as user name and password, from the user. The
web client forwards the authentication data to the web server, where it
is validated by the web server, as shown in <a href="#BNBWP">Figure 50-2</a>.
The validation mechanism may be local to a server or may leverage the
underlying security services. On the basis of the validation, the web
server sets a credential for the user.</p>
</div>
<div id="BNBWP" class="paragraph">
<div class="title"><strong>Figure 50-2 Initial Authentication</strong></div>
<p><span class="image"><img src="../images/jakartaeett_dt_040.png" alt="Diagram of initial authentication: server sends form to client, which sends authentication data to server for validation"></span></p>
</div>
<div class="paragraph">
<p><a id="BNBWQ"></a><a id="step-3-url-authorization"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_step_3_url_authorization">Step 3: URL Authorization</h5>
<div class="paragraph">
<p>The credential is used for future determinations of whether the user is
authorized to access restricted resources it may request. The web server
consults the security policy associated with the web resource to
determine the security roles that are permitted access to the resource.
The security policy is derived from annotations or from the deployment
descriptor. The web container then tests the user&#8217;s credential against
each role to determine whether it can map the user to the role.
<a href="#BNBWR">Figure 50-3</a> shows this process.</p>
</div>
<div id="BNBWR" class="paragraph">
<div class="title"><strong>Figure 50-3 URL Authorization</strong></div>
<p><span class="image"><img src="../images/jakartaeett_dt_041.png" alt="Diagram of URL authorization"></span></p>
</div>
<div class="paragraph">
<p>The web server&#8217;s evaluation stops with an "is authorized" outcome when
the web server is able to map the user to a role. A "not authorized"
outcome is reached if the web server is unable to map the user to any of
the permitted roles.</p>
</div>
<div class="paragraph">
<p><a id="BNBWS"></a><a id="step-4-fulfilling-the-original-request"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_step_4_fulfilling_the_original_request">Step 4: Fulfilling the Original Request</h5>
<div class="paragraph">
<p>If the user is authorized, the web server returns the result of the
original URL request, as shown in <a href="#BNBWT">Figure 50-4</a>.</p>
</div>
<div id="BNBWT" class="paragraph">
<div class="title"><strong>Figure 50-4 Fulfilling the Original Request</strong></div>
<p><span class="image"><img src="../images/jakartaeett_dt_042.png" alt="Diagram of request fulfillment, showing server returning result to client"></span></p>
</div>
<div class="paragraph">
<p>In our example, the response URL of a web page is returned, enabling the
user to post form data that needs to be handled by the business-logic
component of the application. See
<a href="#BNCAS">Chapter 51, "Getting Started Securing
Web Applications"</a> for more information on protecting web applications.</p>
</div>
<div class="paragraph">
<p><a id="BNBWU"></a><a id="step-5-invoking-enterprise-bean-business-methods"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_step_5_invoking_enterprise_bean_business_methods">Step 5: Invoking Enterprise Bean Business Methods</h5>
<div class="paragraph">
<p>The web page performs the remote method call to the enterprise bean,
using the user&#8217;s credential to establish a secure association between
the web page and the enterprise bean, as shown in <a href="#BNBWV">Figure
50-5</a>. The association is implemented as two related security contexts:
one in the web server and one in the enterprise bean container.</p>
</div>
<div id="BNBWV" class="paragraph">
<div class="title"><strong>Figure 50-5 Invoking an Enterprise Bean Business Method</strong></div>
<p><span class="image"><img src="../images/jakartaeett_dt_043.png" alt="Diagram of authorization process between web component and enterprise bean"></span></p>
</div>
<div class="paragraph">
<p>The enterprise container is responsible for enforcing access control on the
enterprise bean method. The container consults the security policy
associated with the enterprise bean to determine the security roles that
are permitted access to the method. The security policy is derived from
annotations or from the deployment descriptor. For each role, the enterprise bean
container determines whether it can map the caller to the role by using
the security context associated with the call.</p>
</div>
<div class="paragraph">
<p>The container&#8217;s evaluation stops with an "is authorized" outcome when
the container is able to map the caller&#8217;s credential to a role. A "not
authorized" outcome is reached if the container is unable to map the
caller to any of the permitted roles. A "not authorized" result causes
an exception to be thrown by the container and propagated back to the
calling web page.</p>
</div>
<div class="paragraph">
<p>If the call is authorized, the container dispatches control to the
enterprise bean method. The result of the bean&#8217;s execution of the call
is returned to the web page and ultimately to the user by the web server
and the web client.</p>
</div>
<div class="paragraph">
<p><a id="BNBWW"></a><a id="features-of-a-security-mechanism"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_features_of_a_security_mechanism">1.1.2. Features of a Security Mechanism</h4>
<div class="paragraph">
<p>A properly implemented security mechanism will provide the following
functionality:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prevent unauthorized access to application functions and business or
personal data (authentication)</p>
</li>
<li>
<p>Hold system users accountable for operations they perform
(non-repudiation)</p>
</li>
<li>
<p>Protect a system from service interruptions and other breaches that
affect quality of service</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ideally, properly implemented security mechanisms will also be</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Easy to administer</p>
</li>
<li>
<p>Transparent to system users</p>
</li>
<li>
<p>Interoperable across application and enterprise boundaries</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BNBWX"></a><a id="characteristics-of-application-security"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_characteristics_of_application_security">1.1.3. Characteristics of Application Security</h4>
<div class="paragraph">
<p>Jakarta EE applications consist of components that can contain both
protected and unprotected resources. Often, you need to protect
resources to ensure that only authorized users have access.
Authorization provides controlled access to protected resources.
Authorization is based on identification and authentication.
Identification is a process that enables recognition of an entity by a
system, and authentication is a process that verifies the identity of a
user, device, or other entity in a computer system, usually as a
prerequisite to allowing access to resources in a system.</p>
</div>
<div class="paragraph">
<p>Authorization and authentication are not required for an entity to
access unprotected resources. Accessing a resource without
authentication is referred to as unauthenticated, or anonymous, access.</p>
</div>
<div class="paragraph">
<p>The characteristics of application security that, when properly
addressed, help to minimize the security threats faced by an enterprise
include the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authentication: The means by which communicating entities, such as
client and server, prove to each other that they are acting on behalf of
specific identities that are authorized for access. This ensures that
users are who they say they are.</p>
</li>
<li>
<p>Authorization, or access control: The means by which interactions with
resources are limited to collections of users or programs for the
purpose of enforcing integrity, confidentiality, or availability
constraints. This ensures that users have permission to perform
operations or access data.</p>
</li>
<li>
<p>Data integrity: The means used to prove that information has not been
modified by a third party, an entity other than the source of the
information. For example, a recipient of data sent over an open network
must be able to detect and discard messages that were modified after
they were sent. This ensures that only authorized users can modify data.</p>
</li>
<li>
<p>Confidentiality, or data privacy: The means used to ensure that
information is made available only to users who are authorized to access
it. This ensures that only authorized users can view sensitive data.</p>
</li>
<li>
<p>Non-repudiation: The means used to prove that a user who performed
some action cannot reasonably deny having done so. This ensures that
transactions can be proved to have happened.</p>
</li>
<li>
<p>Quality of Service: The means used to provide better service to
selected network traffic over various technologies.</p>
</li>
<li>
<p>Auditing: The means used to capture a tamper-resistant record of
security-related events for the purpose of being able to evaluate the
effectiveness of security policies and mechanisms. To enable this, the
system maintains a record of transactions and security information.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BNBWY"></a><a id="security-mechanisms"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_security_mechanisms">1.2. Security Mechanisms</h3>
<div class="paragraph">
<p>The characteristics of an application should be considered when deciding
the layer and type of security to be provided for applications. The
following sections discuss the characteristics of the common mechanisms
that can be used to secure Jakarta EE applications. Each of these
mechanisms can be used individually or with others to provide protection
layers based on the specific needs of your implementation.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BNBWZ">Java SE Security Mechanisms</a></p>
</li>
<li>
<p><a href="#BNBXA">Jakarta EE Security Mechanisms</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BNBWZ"></a><a id="java-se-security-mechanisms"></a></p>
</div>
<div class="sect3">
<h4 id="_java_se_security_mechanisms">1.2.1. Java SE Security Mechanisms</h4>
<div class="paragraph">
<p>Java SE provides support for a variety of security features and
mechanisms.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java Authentication and Authorization Service (JAAS) is a set of APIs
that enable services to authenticate and enforce access controls upon
users. JAAS provides a pluggable and extensible framework for
programmatic user authentication and authorization. JAAS is a core Java
SE API and is an underlying technology for Jakarta EE security mechanisms.</p>
</li>
<li>
<p>Java Generic Security Services (Java GSS-API) is a token-based API
used to securely exchange messages between communicating applications.
The GSS-API offers application programmers uniform access to security
services atop a variety of underlying security mechanisms, including
Kerberos.</p>
</li>
<li>
<p>Java Cryptography Extension (JCE) provides a framework and
implementations for encryption, key generation and key agreement, and
Message Authentication Code (MAC) algorithms. Support for encryption
includes symmetric, asymmetric, block, and stream ciphers. Block ciphers
operate on groups of bytes; stream ciphers operate on one byte at a
time. The software also supports secure streams and sealed objects.</p>
</li>
<li>
<p>Java Secure Sockets Extension (JSSE) provides a framework and an
implementation for a Java version of the Secure Sockets Layer (SSL) and
Transport Layer Security (TLS) protocols and includes functionality for
data encryption, server authentication, message integrity, and optional
client authentication to enable secure Internet communications.</p>
</li>
<li>
<p>Simple Authentication and Security Layer (SASL) is an Internet
standard (RFC 2222) that specifies a protocol for authentication and
optional establishment of a security layer between client and server
applications. SASL defines how authentication data is to be exchanged
but does not itself specify the contents of that data. SASL is a
framework into which specific authentication mechanisms that specify the
contents and semantics of the authentication data can fit.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Java SE also provides a set of tools for managing keystores,
certificates, and policy files; generating and verifying JAR signatures;
and obtaining, listing, and managing Kerberos tickets.</p>
</div>
<div class="paragraph">
<p>For more information on Java SE security, visit
<code><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/" class="bare">http://docs.oracle.com/javase/8/docs/technotes/guides/security/</a></code>.</p>
</div>
<div class="paragraph">
<p><a id="BNBXA"></a><a id="jakarta-ee-security-mechanisms"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_jakarta_ee_security_mechanisms">1.2.2. Jakarta EE Security Mechanisms</h4>
<div class="paragraph">
<p>Jakarta EE security services are provided by the component container and
can be implemented by using declarative or programmatic techniques (see
<a href="#BNBXE">Securing Containers</a>). Jakarta EE security
services provide a robust and easily configured security mechanism for
authenticating users and authorizing access to application functions and
associated data at many different layers. Jakarta EE security services are
separate from the security mechanisms of the operating system.</p>
</div>
<div class="paragraph">
<p><a id="BNBXB"></a><a id="application-layer-security"></a></p>
</div>
<div class="sect4">
<h5 id="_application_layer_security">Application-Layer Security</h5>
<div class="paragraph">
<p>In Jakarta EE, component containers are responsible for providing
application-layer security, security services for a specific application
type tailored to the needs of the application. At the application layer,
application firewalls can be used to enhance application protection by
protecting the communication stream and all associated application
resources from attacks.</p>
</div>
<div class="paragraph">
<p>Jakarta Security is easy to implement and configure and can offer
fine-grained access control to application functions and data. However,
as is inherent to security applied at the application layer, security
properties are not transferable to applications running in other
environments and protect data only while it is residing in the
application environment. In the context of a traditional enterprise
application, this is not necessarily a problem, but when applied to a
web services application, in which data often travels across several
intermediaries, you would need to use the Jakarta EE security mechanisms
along with transport-layer security and message-layer security for a
complete security solution.</p>
</div>
<div class="paragraph">
<p>The advantages of using application-layer security include the
following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Security is uniquely suited to the needs of the application.</p>
</li>
<li>
<p>Security is fine grained, with application-specific settings.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The disadvantages of using application-layer security include the
following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The application is dependent on security attributes that are not
transferable between application types.</p>
</li>
<li>
<p>Support for multiple protocols makes this type of security vulnerable.</p>
</li>
<li>
<p>Data is close to or contained within the point of vulnerability.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on providing security at the application layer, see
<a href="#BNBXE">Securing Containers</a>.</p>
</div>
<div class="paragraph">
<p><a id="BNBXC"></a><a id="transport-layer-security"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_transport_layer_security">Transport-Layer Security</h5>
<div class="paragraph">
<p>Transport-layer security is provided by the transport mechanisms used to
transmit information over the wire between clients and providers; thus,
transport-layer security relies on secure HTTP transport (HTTPS) using
Secure Sockets Layer (SSL). Transport security is a point-to-point
security mechanism that can be used for authentication, message
integrity, and confidentiality. When running over an SSL-protected
session, the server and client can authenticate each other and negotiate
an encryption algorithm and cryptographic keys before the application
protocol transmits or receives its first byte of data. Security is
active from the time the data leaves the client until it arrives at its
destination, or vice versa, even across intermediaries. The problem is
that the data is not protected once it gets to the destination. One
solution is to encrypt the message before sending.</p>
</div>
<div class="paragraph">
<p>Transport-layer security is performed in a series of phases, as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The client and server agree on an appropriate algorithm.</p>
</li>
<li>
<p>A key is exchanged using public-key encryption and certificate-based
authentication.</p>
</li>
<li>
<p>A symmetric cipher is used during the information exchange.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Digital certificates are necessary when running HTTPS using SSL. The
HTTPS service of most web servers will not run unless a digital
certificate has been installed. Digital certificates have already been
created for GlassFish Server.</p>
</div>
<div class="paragraph">
<p>The advantages of using transport-layer security include the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is relatively simple, well-understood, standard technology.</p>
</li>
<li>
<p>It applies to both a message body and its attachments.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The disadvantages of using transport-layer security include the
following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is tightly coupled with the transport-layer protocol.</p>
</li>
<li>
<p>It represents an all-or-nothing approach to security. This implies
that the security mechanism is unaware of message contents, so that you
cannot selectively apply security to portions of the message as you can
with message-layer security.</p>
</li>
<li>
<p>Protection is transient. The message is protected only while in
transit. Protection is removed automatically by the endpoint when it
receives the message.</p>
</li>
<li>
<p>It is not an end-to-end solution, simply point-to-point.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on transport-layer security, see
<a href="#BNBXW">Establishing a Secure Connection Using
SSL</a>.</p>
</div>
<div class="paragraph">
<p><a id="BNBXD"></a><a id="message-layer-security"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_message_layer_security">Message-Layer Security</h5>
<div class="paragraph">
<p>In message-layer security, security information is contained within the
SOAP message and/or SOAP message attachment, which allows security
information to travel along with the message or attachment. For example,
a portion of the message may be signed by a sender and encrypted for a
particular receiver. When sent from the initial sender, the message may
pass through intermediate nodes before reaching its intended receiver.
In this scenario, the encrypted portions continue to be opaque to any
intermediate nodes and can be decrypted only by the intended receiver.
For this reason, message-layer security is also sometimes referred to as
end-to-end security.</p>
</div>
<div class="paragraph">
<p>The advantages of message-layer security include the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Security stays with the message over all hops and after the message
arrives at its destination.</p>
</li>
<li>
<p>Security can be selectively applied to different portions of a message
and, if using XML Web Services Security, to attachments.</p>
</li>
<li>
<p>Message security can be used with intermediaries over multiple hops.</p>
</li>
<li>
<p>Message security is independent of the application environment or
transport protocol.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The disadvantage of using message-layer security is that it is
relatively complex and adds some overhead to processing.</p>
</div>
<div class="paragraph">
<p>GlassFish Server supports message security using Metro, a web services
stack that uses Web Services Security (WSS) to secure messages. Because
this message security is specific to Metro and is not a part of the Jakarta
EE platform, this tutorial does not discuss using WSS to secure
messages. See the Metro User&#8217;s Guide at <code><a href="https://javaee.github.io/metro/" class="bare">https://javaee.github.io/metro/</a></code>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-pluggable-providers">1.3. Using Pluggable Providers</h3>
<div class="paragraph">
<p>Jakarta EE includes two specifications that define SPI interfaces for
pluggable security providers, JSR-196 and JSR-375. These specifications are
described in more detail in the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#jsr-196-java-authentication-service-provider-interface-for-containers-jaspic">JSR-196 Java
Authentication Service Provider Interface for Containers (JASPIC)</a></p>
</li>
<li>
<p><a href="#jsr-375-jakarta-ee-security-api">JSR-375 Jakarta EE Security API</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="jsr-196-java-authentication-service-provider-interface-for-containers-jaspic">1.3.1. JSR-196 Java Authentication Service Provider Interface for Containers (JASPIC)</h4>
<div class="paragraph">
<p>JSR-196 defines a model for securing messages sent between a client and server in
which the sender of a message "secures" it, and the receiver "validates" it.
The details of how messages are secured and validated are undefined by the model;
support for securing and validating particular types of messages is provided by
"auth modules"&#8201;&#8212;&#8201;implementations of the JASPIC <code>ClientAuthModule</code> and
<code>ServerAuthModule</code> interfaces&#8201;&#8212;&#8201;that support particular protocols or message types,
and that plug in to the JASPIC framework. (Note that it is not necessary for a
client and server to both use JASPIC, as long as both sides process messages
correctly for a given protocol.)</p>
</div>
<div class="paragraph">
<p>JASPIC defines two "profiles" for integrating JASPIC auth modules into Jakarta EE
containers: the Servlet Container Profile, and the SOAP Profile. Each specifies
how JASPIC message processing must be integrated into the request processing flow
of the container in question to validate incoming requests and secure outgoing
responses.</p>
</div>
<div class="paragraph">
<p>In the case of the Servlet Container Profile, if a <code>ServerAuthModule</code> is configured/available
for a given application context, then the modules&#8217;s <code>validateRequest()</code> method must be
invoked (and succeed) before authorizing access and calling the target servlet,
and the module&#8217;s <code>secureResponse()</code> method must be called before returning a response.
Typically, a <code>ServerAuthModule</code> written for the Servlet Container Profile looks for
user credentials or tokens in an incoming request, and then uses them to authenticate the caller and establish
the caller&#8217;s identity. A <code>ServerAuthModule</code> may also engage in a challenge/response
protocol with the client, or negotiate with a third party to establish/verify the
client&#8217;s identity.</p>
</div>
<div class="paragraph">
<p>As with the Servlet Container Profile, the SOAP Profile requires that
<code>validateRequest()</code> be called and succeed before proceeding to authorize access and
perform any further processing of an incoming message, and that <code>secureResponse()</code>
is called for the response before it is sent. In contrast to the Servlet
Container Profile, <code>validateRequest()</code> processing for SOAP messages typically involves
verifying signatures on signed elements, decrypting encrypted elements, and/or
establishing the identity of a SOAP actor based on a token included in the message,
while <code>secureResponse()</code> typically involves signing and/or encrypting elements
of the outbound message.</p>
</div>
<div class="paragraph">
<p>JASPIC does not define any standard or built-in ServerAuthModules; they must be
provided either by the application using the module, or as a non-standard
extension of a particular vendor&#8217;s Jakarta EE product. ServerAuthModules can
sometimes be directly configured for an application in a vendor-specific way, but
the standard mechanism for making a <code>ServerAuthModule</code> available to an application
is to register a corresponding <code>AuthConfigProvider</code> with the global <code>AuthConfigFactory</code>.
An <code>AuthConfigProvider</code> makes a <code>ServerAuthModule</code> available to the container, via a
series of intermediary objects, for runtime message processing.</p>
</div>
</div>
<div class="sect3">
<h4 id="jsr-375-jakarta-ee-security-api">1.3.2. JSR-375 Jakarta EE Security API</h4>
<div class="paragraph">
<p>JSR-375 defines the following authentication-related plugin SPIs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>HttpAuthenticationMechanism</code> - An interface for modules that authenticate callers
to a web application. It defines three methods that correspond to the methods of a
JASPIC <code>ServerAuthModule</code>, albeit with slightly different signatures.
An <code>HttpAuthenticationMechanism</code> provides similar functionality to a <code>ServerAuthModule</code>,
and the Servlet Container uses a special <code>ServerAuthModule</code> to invoke the
HttpAuthenticationMechanism&#8217;s methods, but HttpAuthenticationMechanisms are
simpler to write, and to deploy, than are ServerAuthModules.</p>
</li>
<li>
<p><code>IdentityStore</code> - This interface defines methods for validating a caller&#8217;s
credentials (such as username and password) and returning group membership information.
IdentityStores are invoked under the control of an <code>IdentityStoreHandler</code>, which, if
multiple IdentityStores are present, calls the available IdentityStores in a
specific order and aggregates the results.</p>
</li>
<li>
<p><code>RememberMeIdentityStore</code> - This interface is a variation on the <code>IdentityStore</code>
interface, intended specifically to address cases where an authenticated user&#8217;s
identity should be remembered for an extended period of time, so that the caller
can return to the application periodically without needing to present primary
authentication credentials each time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Implementations of these SPI interfaces are CDI beans, and, as such, applications
can provide implementations that support application-specific authentication
mechanisms, or validate user credentials against application-specific identity stores,
simply by including them in a bean archive that is part of the deployed application.
There are also several standard, built-in implementations of <code>HttpAuthenticationMechanism</code>
and <code>IdentityStore</code> that provide configurable support for common authentication and
credential validation use cases, without the need to write custom implementations.</p>
</div>
<div class="paragraph">
<p>Because these SPIs, related annotations, and the CDI deployment mechanism are all
part of standard Jakarta EE, implementations are completely portable (to the extent
they do not rely internally on platform-specific APIs or libraries) and can be
portably deployed to any Jakarta EE server.</p>
</div>
<div class="paragraph">
<p><a id="BNBXE"></a><a id="securing-containers"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_securing_containers">1.4. Securing Containers</h3>
<div class="paragraph">
<p>In Jakarta EE, the component containers are responsible for providing
application security. A container provides two types of security:
declarative and programmatic.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#using-annotations-to-specify-security-information">Using Annotations to Specify Security Information</a></p>
</li>
<li>
<p><a href="#using-deployment-descriptors-for-declarative-security">Using Deployment Descriptors for Declarative Security</a></p>
</li>
<li>
<p><a href="#using-programmatic-security">Using Programmatic Security</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BNBXG"></a><a id="using-annotations-to-specify-security-information"></a></p>
</div>
<div class="sect3">
<h4 id="_using_annotations_to_specify_security_information">1.4.1. Using Annotations to Specify Security Information</h4>
<div class="paragraph">
<p>Annotations enable a declarative style of programming and so encompass
both the declarative and programmatic security concepts. Users can
specify information about security within a class file by using
annotations. GlassFish Server uses this information when the application
is deployed. Not all security information can be specified by using
annotations, however. Some information must be specified in the
application deployment descriptors.</p>
</div>
<div class="paragraph">
<p>Specific annotations that can be used to specify security information
within an enterprise bean class file are described in
<a href="#GJGDI">Securing an Enterprise Bean Using
Declarative Security</a>. <a href="#BNCAS">Chapter 51,
"Getting Started Securing Web Applications"</a>, describes how to use
annotations to secure web applications where possible. Deployment
descriptors are described only where necessary.</p>
</div>
<div class="paragraph">
<p>For more information on annotations, see
<a href="#BNBYJ">Further Information about Security</a>.</p>
</div>
<div class="paragraph">
<p><a id="BNBXF"></a><a id="using-deployment-descriptors-for-declarative-security"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_using_deployment_descriptors_for_declarative_security">1.4.2. Using Deployment Descriptors for Declarative Security</h4>
<div class="paragraph">
<p>Declarative security can express an application component&#8217;s security
requirements by using deployment descriptors. Because deployment
descriptor information is declarative, it can be changed without the
need to modify the source code. At runtime, the Jakarta EE server reads the
deployment descriptor and acts upon the corresponding application,
module, or component accordingly. Deployment descriptors must provide
certain structural information for each component if this information
has not been provided in annotations or is not to be defaulted.</p>
</div>
<div class="paragraph">
<p>This part of the tutorial does not document how to create deployment
descriptors; it describes only the elements of the deployment descriptor
relevant to security. NetBeans IDE provides tools for creating and
modifying deployment descriptors.</p>
</div>
<div class="paragraph">
<p>Different types of components use different formats, or schemas, for
their deployment descriptors. The security elements of deployment
descriptors discussed in this tutorial include the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Web components may use a web application deployment descriptor named
<code>web.xml</code>.</p>
<div class="paragraph">
<p>The schema for web component deployment descriptors is provided in
Chapter 14 of the Jakarta Servlet 4.0 specification, which can be
downloaded from <code><a href="https://jakarta.ee/specifications/servlet/4.0/" class="bare">https://jakarta.ee/specifications/servlet/4.0/</a></code>.</p>
</div>
</li>
<li>
<p>Jakarta Enterprise Beans components may use an enterprise bean deployment descriptor
named <code>META-INF/ejb-jar.xml</code>, contained in the enterprise bean JAR file.</p>
<div class="paragraph">
<p>The schema for enterprise bean deployment descriptors is provided in
Chapter 14 of the Jakarta Enterprise Beans 3.2 Core Contracts and Requirements Specification,
which can be downloaded from
<code><a href="https://jakarta.ee/specifications/enterprise-beans/3.2/" class="bare">https://jakarta.ee/specifications/enterprise-beans/3.2/</a></code>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BNBXH"></a><a id="using-programmatic-security"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_using_programmatic_security">1.4.3. Using Programmatic Security</h4>
<div class="paragraph">
<p>Programmatic security is embedded in an application and is used to make
security decisions. Programmatic security is useful when declarative
security alone is not sufficient to express the security model of an
application. The API for programmatic security consists of methods of the Jakarta
Security <code>SecurityContext</code> interface, and methods of the enterprise bean <code>EJBContext</code>
interface and the servlet <code>HttpServletRequest</code> interface. These
methods allow components to make business-logic decisions based on the
security role of the caller or remote user.</p>
</div>
<div class="paragraph">
<p>Programmatic security is discussed in more detail in the following
sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#GJIIE">Using Programmatic Security with
Web Applications</a></p>
</li>
<li>
<p><a href="#GJGCS">Securing an Enterprise Bean
Programmatically</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BNBXI"></a><a id="securing-glassfish-server"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_securing_glassfish_server">1.5. Securing GlassFish Server</h3>
<div class="paragraph">
<p>This tutorial describes deployment to GlassFish Server, which provides
highly secure, interoperable, and distributed component computing based
on the Jakarta EE security model. GlassFish Server supports the Jakarta EE 8
security model. You can configure GlassFish Server for the following
purposes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding, deleting, or modifying authorized users. For more information
on this topic, see <a href="#BNBXJ">Working with Realms,
Users, Groups, and Roles</a>.</p>
</li>
<li>
<p>Configuring secure HTTP and Internet Inter-Orb Protocol (IIOP)
listeners.</p>
</li>
<li>
<p>Configuring secure Java Management Extensions (JMX) connectors.</p>
</li>
<li>
<p>Adding, deleting, or modifying existing or custom realms.</p>
</li>
<li>
<p>Defining an interface for pluggable authorization providers using Java
Authorization Contract for Containers (JACC). JACC defines security
contracts between GlassFish Server and authorization policy modules.
These contracts specify how the authorization providers are installed,
configured, and used in access decisions.</p>
</li>
<li>
<p>Using pluggable audit modules.</p>
</li>
<li>
<p>Customizing authentication mechanisms. All implementations of Jakarta EE
8 compatible web containers are required to support the Servlet Profile
of Jakarta Authentication, which offers an avenue for customizing the authentication
mechanism applied by the web container on behalf of one or more
applications.</p>
</li>
<li>
<p>Setting and changing policy permissions for an application.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="working-with-identity-stores">1.6. Working with Identity Stores</h3>
<div class="paragraph">
<p>An identity store is a database or directory (store) that contains identity information
about a collection of users that includes an application&#8217;s callers. An identity store
holds callers names, group membership information, and information sufficient
to allow it to validate a caller&#8217;s credentials. An identity store may also contain other
information, such as globally unique caller identifiers or other caller attributes.</p>
</div>
<div class="paragraph">
<p>As specified in the Jakarta EE Security API, the <code>IdentityStore</code> interface
provides an abstraction of an identity store. Implementations of the <code>IdentityStore</code>
interface interact with identity stores to authenticate users
and to retrieve caller group information. Most often, an implementation of the <code>IdentityStore</code>
interface interacts with an external identity store, such as an LDAP server,
but it can also manage user account data itself.</p>
</div>
<div class="paragraph">
<p>The <code>IdentityStore</code> interface is intended
primarily for use by the <code>HttpAuthenticationMechanism</code> (also specified in the
Jakarta EE Security API), but can be used by other implementations such as a JASPIC
<code>ServerAuthModule</code> or a container&#8217;s built-in authentication mechanisms. Using the
<code>HttpAuthenticationMechanism</code>
and <code>IdentityStore</code> implementations, both built-in and custom, provides a significant
advantage over the BASIC and FORM mechanisms
defined by Servlet 4.0 (and previous versions) and configured declaratively
using <code>&lt;login-config&gt;</code> in <code>web.xml</code>,
because it allows an application to control the identity stores it will
authenticate against in a standard, portable way.</p>
</div>
<div class="paragraph">
<p>An application can provide its own <code>IdentityStore</code>,
or use the built in LDAP or Database identity store implementations of the interface.
For details about the <code>IdentityStore</code> interfaces and examples of their usage, see
<a href="#overview-of-the-identity-store-interfaces">Overview of the Identity Store Interfaces</a>.</p>
</div>
<div class="paragraph">
<p><a id="BNBXJ"></a><a id="working-with-realms-users-groups-and-roles"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_realms_users_groups_and_roles">1.7. Working with Realms, Users, Groups, and Roles</h3>
<div class="paragraph">
<p>You often need to protect resources to ensure that only authorized users
have access. See <a href="#BNBWX">Characteristics of
Application Security</a> for an introduction to the concepts of
authentication, identification, and authorization.</p>
</div>
<div class="paragraph">
<p>This section discusses setting up users so that they can be correctly
identified and either given access to protected resources or denied
access if they are not authorized to access the protected resources. To
authenticate a user, you need to follow these basic steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The application developer writes code to prompt for a user name and
password. The various methods of authentication are discussed in
<a href="#GKBSA">Specifying Authentication
Mechanisms</a>.</p>
</li>
<li>
<p>The application developer communicates how to set up security for
the deployed application by use of a metadata annotation or deployment
descriptor. This step is discussed in <a href="#BNBXU">Setting Up Security
Roles</a>.</p>
</li>
<li>
<p>The server administrator sets up authorized users and groups in
GlassFish Server. This is discussed in <a href="#BNBXR">Managing Users and
Groups in GlassFish Server</a>.</p>
</li>
<li>
<p>The application deployer maps the application&#8217;s security roles to
users, groups, and principals defined in GlassFish Server. This topic is
discussed in <a href="#BNBXV">Mapping Roles to Users and Groups</a>.</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Note:</strong></p>
</div>
<div class="paragraph">
<p>By default, group principal names are mapped to roles of the same name.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="BNBXK"></a><a id="what-are-realms-users-groups-and-roles"></a></p>
</div>
<div class="sect3">
<h4 id="_what_are_realms_users_groups_and_roles">1.7.1. What Are Realms, Users, Groups, and Roles?</h4>
<div class="paragraph">
<p>A realm is a security policy domain defined for a web or application
server. A realm contains a collection of users, who may or may not be
assigned to a group. Managing users in GlassFish Server is discussed in
<a href="#BNBXR">Managing Users and Groups in GlassFish Server</a>.</p>
</div>
<div class="paragraph">
<p>An application will often prompt for a user name and password before
allowing access to a protected resource. After the user name and
password have been entered, that information is passed to the server,
which either authenticates the user and sends the protected resource or
does not authenticate the user, in which case access to the protected
resource is denied. This type of user authentication is discussed in
<a href="#BNCBN">Specifying an Authentication
Mechanism in the Deployment Descriptor</a>.</p>
</div>
<div class="paragraph">
<p>In some applications, authorized users are assigned to roles. In this
situation, the role assigned to the user in the application must be
mapped to a principal or group defined on the application server.
<a href="#BNBXL">Figure 50-6</a> shows this. More information on mapping roles
to users and groups can be found in <a href="#BNBXU">Setting Up Security
Roles</a>.</p>
</div>
<div id="BNBXL" class="paragraph">
<div class="title"><strong>Figure 50-6 Mapping Roles to Users and Groups</strong></div>
<p><span class="image"><img src="../images/jakartaeett_dt_044.png" alt="Diagram of role mapping, showing creation of users and groups, definition of roles, and mapping of roles to users and groups"></span></p>
</div>
<div class="paragraph">
<p>The following sections provide more information on realms, users,
groups, and roles.</p>
</div>
<div class="paragraph">
<p><a id="BNBXM"></a><a id="what-is-a-realm"></a></p>
</div>
<div class="sect4">
<h5 id="_what_is_a_realm">What Is a Realm?</h5>
<div class="paragraph">
<p>The protected resources on a server can be partitioned into a set of
protection spaces, each with its own authentication scheme and/or
authorization database containing a collection of users and groups. A
realm is a complete database of users and groups identified as valid
users of one or more applications and controlled by the same
authentication policy.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE server authentication service can govern users in multiple
realms. The <code>file</code>, <code>admin-realm</code>, and <code>certificate</code> realms come
preconfigured for GlassFish Server.</p>
</div>
<div class="paragraph">
<p>In the <code>file</code> realm, the server stores user credentials locally in a
file named <code>keyfile</code>. You can use the Administration Console to manage
users in the <code>file</code> realm. When using the <code>file</code> realm, the server
authentication service verifies user identity by checking the <code>file</code>
realm. This realm is used for the authentication of all clients except
for web browser clients that use HTTPS and certificates.</p>
</div>
<div class="paragraph">
<p>In the <code>certificate</code> realm, the server stores user credentials in a
certificate database. When using the <code>certificate</code> realm, the server
uses certificates with HTTPS to authenticate web clients. To verify the
identity of a user in the <code>certificate</code> realm, the authentication
service verifies an X.509 certificate. For step-by-step instructions for
creating this type of certificate, see
<a href="#BNBYB">Working with Digital Certificates</a>.
The common name field of the X.509 certificate is used as the principal
name.</p>
</div>
<div class="paragraph">
<p>The <code>admin-realm</code> is also a <code>file</code> realm and stores administrator user
credentials locally in a file named <code>admin-keyfile</code>. You can use the
Administration Console to manage users in this realm in the same way you
manage users in the <code>file</code> realm. For more information, see
<a href="#BNBXR">Managing Users and Groups in GlassFish Server</a>.</p>
</div>
<div class="paragraph">
<p><a id="BNBXN"></a><a id="what-is-a-user"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_what_is_a_user">What Is a User?</h5>
<div class="paragraph">
<p>A user is an individual or application program identity that has been
defined in GlassFish Server. In a web application, a user can have
associated with that identity a set of roles that entitle the user to
access all resources protected by those roles. Users can be associated
with a group.</p>
</div>
<div class="paragraph">
<p>A Jakarta EE user is similar to an operating system user. Typically, both
types of users represent people. However, these two types of users are
not the same. The Jakarta EE server authentication service has no knowledge
of the user name and password you provide when you log in to the
operating system. The Jakarta EE server authentication service is not
connected to the security mechanism of the operating system. The two
security services manage users that belong to different realms.</p>
</div>
<div class="paragraph">
<p><a id="BNBXO"></a><a id="what-is-a-group"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_what_is_a_group">What Is a Group?</h5>
<div class="paragraph">
<p>A group is a set of authenticated users, classified by common traits,
defined in GlassFish Server. A Jakarta EE user of the <code>file</code> realm can
belong to a group in GlassFish Server. (A user in the <code>certificate</code>
realm cannot.) A group in GlassFish Server is a category of users
classified by common traits, such as job title or customer profile. For
example, most customers of an e-commerce application might belong to the
<code>CUSTOMER</code> group, but the big spenders would belong to the <code>PREFERRED</code>
group. Categorizing users into groups makes it easier to control the
access of large numbers of users.</p>
</div>
<div class="paragraph">
<p>A group in GlassFish Server has a different scope from a role. A group
is designated for the entire GlassFish Server, whereas a role is
associated only with a specific application in GlassFish Server.</p>
</div>
<div class="paragraph">
<p><a id="BNBXP"></a><a id="what-is-a-role"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_what_is_a_role">What Is a Role?</h5>
<div class="paragraph">
<p>A role is an abstract name for the permission to access a particular set
of resources in an application. A role can be compared to a key that can
open a lock. Many people might have a copy of the key. The lock doesn&#8217;t
care who you are, only that you have the right key.</p>
</div>
<div class="paragraph">
<p><a id="BNBXQ"></a><a id="some-other-terminology"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_some_other_terminology">Some Other Terminology</h5>
<div class="paragraph">
<p>The following terminology is also used to describe the security
requirements of the Jakarta EE platform.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A principal is an entity that can be authenticated by an
authentication protocol in a security service that is deployed in an
enterprise. A principal is identified by using a principal name and
authenticated by using authentication data.</p>
</li>
<li>
<p>A security policy domain, also known as a security domain or realm, is
a scope over which a common security policy is defined and enforced by
the security administrator of the security service.</p>
</li>
<li>
<p>Security attributes are a set of attributes associated with every
principal. The security attributes have many uses: for example, access
to protected resources and auditing of users. Security attributes can be
associated with a principal by an authentication protocol.</p>
</li>
<li>
<p>A credential is an object that contains or references security
attributes used to authenticate a principal for Jakarta EE services. A
principal acquires a credential upon authentication or from another
principal that allows its credential to be used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BNBXR"></a><a id="managing-users-and-groups-in-glassfish-server"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_managing_users_and_groups_in_glassfish_server">1.7.2. Managing Users and Groups in GlassFish Server</h4>
<div class="paragraph">
<p>Follow these steps for managing users before you run the tutorial
examples.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BNBXS">To Add Users to GlassFish Server</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BNBXS"></a><a id="to-add-users-to-glassfish-server"></a></p>
</div>
<div class="sect4">
<h5 id="_to_add_users_to_glassfish_server">To Add Users to GlassFish Server</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start GlassFish Server, if you haven&#8217;t already done so.</p>
<div class="paragraph">
<p>Information on starting GlassFish Server is available in
<a href="#BNADI">Starting and Stopping GlassFish Server</a>.</p>
</div>
</li>
<li>
<p>Start the Administration Console, if you haven&#8217;t already done so.</p>
<div class="paragraph">
<p>To start the Administration Console, open a web browser and specify the
URL <code><a href="http://localhost:4848/" class="bare">http://localhost:4848/</a></code>. If you changed the default Admin port
during installation, enter the correct port number in place of <code>4848</code>.</p>
</div>
</li>
<li>
<p>In the navigation tree, expand the Configurations node, then expand
the server-config node.</p>
</li>
<li>
<p>Expand the Security node.</p>
</li>
<li>
<p>Expand the Realms node.</p>
</li>
<li>
<p>Select the realm to which you are adding users.</p>
<div class="ulist">
<ul>
<li>
<p>Select the <code>file</code> realm to add users you want to access applications
running in this realm.</p>
<div class="paragraph">
<p>For the example security applications, select the <code>file</code> realm.</p>
</div>
</li>
<li>
<p>Select the <code>admin-realm</code> to add users you want to enable as system
administrators of GlassFish Server.</p>
<div class="paragraph">
<p>You cannot add users to the <code>certificate</code> realm by using the
Administration Console. In the <code>certificate</code> realm, you can add only
certificates. For information on adding (importing) certificates to the
<code>certificate</code> realm, see <a href="#GLIFW">Adding
Users to the Certificate Realm</a>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>On the Edit Realm page, click Manage Users.</p>
</li>
<li>
<p>On the File Users or Admin Users page, click New to add a new user
to the realm.</p>
</li>
<li>
<p>On the New File Realm User page, enter values in the User ID, Group
List, New Password, and Confirm New Password fields.</p>
<div class="paragraph">
<p>For the Admin Realm, the Group List field is read-only, and the group
name is <code>asadmin</code>. Restart GlassFish Server and the Administration
Console after you add a user to the Admin Realm.</p>
</div>
<div class="paragraph">
<p>For more information on these properties, see <a href="#BNBXJ">Working with
Realms, Users, Groups, and Roles</a>.</p>
</div>
<div class="paragraph">
<p>For the example security applications, specify a user with any name and
password you like, but make sure that the user is assigned to the group
<code>TutorialUser</code>. The user name and password are case-sensitive. Keep a
record of the user name and password for working with the examples later
in this tutorial.</p>
</div>
</li>
<li>
<p>Click OK to add this user to the realm, or click Cancel to quit
without saving.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BNBXU"></a><a id="setting-up-security-roles"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_security_roles">1.7.3. Setting Up Security Roles</h4>
<div class="paragraph">
<p>When you design an enterprise bean or web component, you should always
think about the kinds of users who will access the component. For
example, a web application for a human resources department might have a
different request URL for someone who has been assigned the role of
<code>DEPT_ADMIN</code> than for someone who has been assigned the role of
<code>DIRECTOR</code>. The <code>DEPT_ADMIN</code> role may let you view employee data, but
the <code>DIRECTOR</code> role enables you to modify employee data, including
salary data. Each of these security roles is an abstract logical
grouping of users that is defined by the person who assembles the
application. When an application is deployed, the deployer will map the
roles to security identities in the operational environment, as shown in
<a href="#BNBXL">Figure 50-6</a>.</p>
</div>
<div class="paragraph">
<p>For Jakarta EE components, you define security roles using the
<code>@DeclareRoles</code> and <code>@RolesAllowed</code> metadata annotations.</p>
</div>
<div class="paragraph">
<p>The following is an example of an application in which the role of
<code>DEPT-ADMIN</code> is authorized for methods that review employee payroll
data, and the role of <code>DIRECTOR</code> is authorized for methods that change
employee payroll data.</p>
</div>
<div class="paragraph">
<p>The enterprise bean would be annotated as shown in the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">javax.annotation.security.DeclareRoles</span>;
<span class="keyword">import</span> <span class="include">javax.annotation.security.RolesAllowed</span>;
...
<span class="annotation">@DeclareRoles</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">DEPT-ADMIN</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">DIRECTOR</span><span class="delimiter">&quot;</span></span>})
<span class="annotation">@Stateless</span> <span class="directive">public</span> <span class="type">class</span> <span class="class">PayrollBean</span> <span class="directive">implements</span> Payroll {
    <span class="annotation">@Resource</span> SessionContext ctx;


    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">DEPT-ADMIN</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> reviewEmployeeInfo(EmplInfo info) {

        oldInfo = ... read from database;

        <span class="comment">// ...</span>
    }

    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">DIRECTOR</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> updateEmployeeInfo(EmplInfo info) {

        newInfo = ... update database;

        <span class="comment">// ...</span>
    }
    ...
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a servlet, you can use the <code>@HttpConstraint</code> annotation within the
<code>@ServletSecurity</code> annotation to specify the roles that are allowed to
access the servlet. For example, a servlet might be annotated as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">PayrollServlet</span><span class="delimiter">&quot;</span></span>, urlPatterns = {<span class="string"><span class="delimiter">&quot;</span><span class="content">/payroll</span><span class="delimiter">&quot;</span></span>})
<span class="annotation">@ServletSecurity</span>(
<span class="annotation">@HttpConstraint</span>(transportGuarantee = TransportGuarantee.CONFIDENTIAL,
    rolesAllowed = {<span class="string"><span class="delimiter">&quot;</span><span class="content">DEPT-ADMIN</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">DIRECTOR</span><span class="delimiter">&quot;</span></span>}))
<span class="directive">public</span> <span class="type">class</span> <span class="class">GreetingServlet</span> <span class="directive">extends</span> HttpServlet {</code></pre>
</div>
</div>
<div class="paragraph">
<p>These annotations are discussed in more detail in
<a href="#GJRMH">Specifying Security for Basic
Authentication Using Annotations</a> and
<a href="#GJGDI">Securing an Enterprise Bean Using
Declarative Security</a>.</p>
</div>
<div class="paragraph">
<p>After users have provided their login information and the application
has declared what roles are authorized to access protected parts of an
application, the next step is to map the security role to the name of a
user, or principal.</p>
</div>
<div class="paragraph">
<p><a id="BNBXV"></a><a id="mapping-roles-to-users-and-groups"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_mapping_roles_to_users_and_groups">1.7.4. Mapping Roles to Users and Groups</h4>
<div class="paragraph">
<p>When you are developing a Jakarta EE application, you don&#8217;t need to know
what categories of users have been defined for the realm in which the
application will be run. In the Jakarta EE platform, the security
architecture provides a mechanism for mapping the roles defined in the
application to the users or groups defined in the runtime realm.</p>
</div>
<div class="paragraph">
<p>The role names used in the application are often the same as the group
names defined in GlassFish Server. Jakarta Security requires that
group principal names are mapped
to roles of the same name by default. Accordingly, the <strong>Default Principal To Role Mapping</strong> setting
is enabled by default on the Security page of
the GlassFish Server Administration Console. All the tutorial security
examples use default principal-to-role mapping. With that setting
enabled, if the group name defined on GlassFish Server matches the role
name defined in the application, there is no need to use the runtime
deployment descriptor to provide a mapping. The application server will
implicitly make this mapping, as long as the names of the groups and
roles match.</p>
</div>
<div class="paragraph">
<p>If the role names used in an application are not the same as the group
names defined on the server, use the runtime deployment descriptor to
specify the mapping. The following example demonstrates how to do this
mapping in the <code>glassfish-web.xml</code> file, which is the file used for web
applications:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;glassfish-web-app&gt;</span>
    ...
    <span class="tag">&lt;security-role-mapping&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>Mascot<span class="tag">&lt;/role-name&gt;</span>
        <span class="tag">&lt;principal-name&gt;</span>Duke<span class="tag">&lt;/principal-name&gt;</span>
    <span class="tag">&lt;/security-role-mapping&gt;</span>

    <span class="tag">&lt;security-role-mapping&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>Admin<span class="tag">&lt;/role-name&gt;</span>
        <span class="tag">&lt;group-name&gt;</span>Director<span class="tag">&lt;/group-name&gt;</span>
    <span class="tag">&lt;/security-role-mapping&gt;</span>
    ...
<span class="tag">&lt;/glassfish-web-app&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A role can be mapped to specific principals, specific groups, or both.
The principal or group names must be valid principals or groups in the
current default realm or in the realm specified in the <code>login-config</code>
element. In this example, the role of <code>Mascot</code> used in the application
is mapped to a principal, named <code>Duke</code>, that exists on the application
server. Mapping a role to a specific principal is useful when the person
occupying that role may change. For this application, you would need to
modify only the runtime deployment descriptor rather than search and
replace throughout the application for references to this principal.</p>
</div>
<div class="paragraph">
<p>Also in this example, the role of <code>Admin</code> is mapped to a group of users
assigned the group name of <code>Director</code>. This is useful because the group
of people authorized to access director-level administrative data has to
be maintained only in GlassFish Server. The application developer does
not need to know who these people are, but only needs to define the
group of people who will be given access to the information.</p>
</div>
<div class="paragraph">
<p>The <code>role-name</code> must match the <code>role-name</code> in the <code>security-role</code>
element of the corresponding deployment descriptor or the role name
defined in a <code>@DeclareRoles</code> annotation.</p>
</div>
<div class="paragraph">
<p><a id="BNBXW"></a><a id="establishing-a-secure-connection-using-ssl"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_establishing_a_secure_connection_using_ssl">1.8. Establishing a Secure Connection Using SSL</h3>
<div class="paragraph">
<p>Secure Sockets Layer (SSL) technology is security that is implemented at
the transport layer (see
<a href="#BNBXC">Transport-Layer Security</a> for more
information about transport-layer security). SSL allows web browsers and
web servers to communicate over a secure connection. In this secure
connection, the data is encrypted before being sent and then is
decrypted upon receipt and before processing. Both the browser and the
server encrypt all traffic before sending any data.</p>
</div>
<div class="paragraph">
<p>SSL addresses the following important security considerations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authentication: During your initial attempt to communicate with a web
server over a secure connection, that server will present your web
browser with a set of credentials in the form of a server certificate
(also called a public key certificate). The purpose of the certificate
is to verify that the site is who and what it claims to be. In some
cases, the server may request a certificate proving that the client is
who and what it claims to be; this mechanism is known as client
authentication.</p>
</li>
<li>
<p>Confidentiality: When data is being passed between the client and the
server on a network, third parties can view and intercept this data. SSL
responses are encrypted so that the data cannot be deciphered by the
third party and the data remains confidential.</p>
</li>
<li>
<p>Integrity: When data is being passed between the client and the server
on a network, third parties can view and intercept this data. SSL helps
guarantee that the data will not be modified in transit by that third
party.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The SSL protocol is designed to be as efficient as securely possible.
However, encryption and decryption are computationally expensive
processes from a performance standpoint. It is not strictly necessary to
run an entire web application over SSL, and it is customary for a
developer to decide which pages require a secure connection and which do
not. Pages that might require a secure connection include those for
login, personal information, shopping cart checkouts, or credit card
information transmittal. Any page within an application can be requested
over a secure socket by simply prefixing the address with <code>https:</code>
instead of <code>http:</code>. Any pages that absolutely require a secure
connection should check the protocol type associated with the page
request and take the appropriate action if <code>https:</code> is not specified.</p>
</div>
<div class="paragraph">
<p>Using name-based virtual hosts on a secured connection can be
problematic. This is a design limitation of the SSL protocol itself. The
SSL handshake, whereby the client browser accepts the server
certificate, must occur before the HTTP request is accessed. As a
result, the request information containing the virtual host name cannot
be determined before authentication, and it is therefore not possible to
assign multiple certificates to a single IP address. If all virtual
hosts on a single IP address need to authenticate against the same
certificate, the addition of multiple virtual hosts should not interfere
with normal SSL operations on the server. Be aware, however, that most
client browsers will compare the server&#8217;s domain name against the domain
name listed in the certificate, if any; this is applicable primarily to
official certificates signed by a certificate authority (CA). If the
domain names do not match, these browsers will display a warning to the
client. In general, only address-based virtual hosts are commonly used
with SSL in a production environment.</p>
</div>
<div class="paragraph">
<p><a id="BNBXX"></a><a id="verifying-and-configuring-ssl-support"></a></p>
</div>
<div class="sect3">
<h4 id="_verifying_and_configuring_ssl_support">1.8.1. Verifying and Configuring SSL Support</h4>
<div class="paragraph">
<p>As a general rule, you must address the following issues to enable SSL
for a server.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There must be a <code>Connector</code> element for an SSL connector in the server
deployment descriptor.</p>
</li>
<li>
<p>There must be valid keystore and certificate files.</p>
</li>
<li>
<p>The location of the keystore file and its password must be specified
in the server deployment descriptor.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An SSL HTTPS connector is already enabled in GlassFish Server.</p>
</div>
<div class="paragraph">
<p>For testing purposes and to verify that SSL support has been correctly
installed, load the default introduction page with a URL that connects
to the port defined in the server deployment descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">https:<span class="comment">//localhost:8181/</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>https</code> in this URL indicates that the browser should be using the
SSL protocol. The <code>localhost</code> in this example assumes that you are
running the example on your local machine as part of the development
process. The <code>8181</code> in this example is the secure port that was
specified where the SSL connector was created. If you are using a
different server or port, modify this value accordingly.</p>
</div>
<div class="paragraph">
<p>The first time that you load this application, the New Site Certificate
or Security Alert dialog box appears. Click Next to move through the
series of dialog boxes, and click Finish when you reach the last dialog
box. The certificates will appear only the first time. When you accept
the certificates, subsequent hits to this site assume that you still
trust the content.</p>
</div>
<div class="paragraph">
<p><a id="BNBYJ"></a><a id="further-information-about-security"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_further_information_about_security">1.9. Further Information about Security</h3>
<div class="paragraph">
<p>For more information about security in Jakarta EE applications, see</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta EE 8 specification:</p>
<div class="paragraph">
<p>``https://jakarta.ee/specifications/platform/8/</p>
</div>
</li>
<li>
<p>Jakarta Security 1.0:</p>
<div class="paragraph">
<p><code><a href="https://jakarta.ee/specifications/security/1.0/" class="bare">https://jakarta.ee/specifications/security/1.0/</a></code></p>
</div>
</li>
<li>
<p>Jakarta Authentication 1.1:</p>
<div class="paragraph">
<p><code><a href="https://jakarta.ee/specifications/enterprise-beans/3.2/" class="bare">https://jakarta.ee/specifications/enterprise-beans/3.2/</a></code></p>
</div>
</li>
<li>
<p>Jakarta Enterprise Beans 3.2 specification:</p>
<div class="paragraph">
<p><code><a href="https://jakarta.ee/specifications/authentication/1.1/" class="bare">https://jakarta.ee/specifications/authentication/1.1/</a></code></p>
</div>
</li>
<li>
<p>Jakarta Enterprise Web Services 1.4 specification:</p>
<div class="paragraph">
<p><code><a href="https://jakarta.ee/specifications/enterprise-ws/1.4/" class="bare">https://jakarta.ee/specifications/enterprise-ws/1.4/</a></code></p>
</div>
</li>
<li>
<p>Java SE security information:</p>
<div class="paragraph">
<p><code><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/" class="bare">http://docs.oracle.com/javase/8/docs/technotes/guides/security/</a></code></p>
</div>
</li>
<li>
<p>Jakarta Servlet 4.0 specification:</p>
<div class="paragraph">
<p><code><a href="https://jakarta.ee/specifications/servlet/4.0/" class="bare">https://jakarta.ee/specifications/servlet/4.0/</a></code></p>
</div>
</li>
<li>
<p>Jakarta Authorization 1.5 specification:</p>
<div class="paragraph">
<p><code><a href="https://jakarta.ee/specifications/authorization/1.5/" class="bare">https://jakarta.ee/specifications/authorization/1.5/</a></code></p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started_securing_web_applications">2. Getting Started Securing Web Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="BNCAS"></a><a id="getting-started-securing-web-applications"></a></p>
</div>
<div class="paragraph">
<p>This chapter describes in greater detail the ways to implement security
for Jakarta EE web applications discussed in a general way in
<a href="#BNBXE">Securing Containers</a>. The detail and
examples in this chapter explore these security services as they relate
to web components.</p>
</div>
<div class="paragraph">
<p><a id="BNCAT"></a><a id="overview-of-web-application-security"></a></p>
</div>
<div class="sect2">
<h3 id="_overview_of_web_application_security">2.1. Overview of Web Application Security</h3>
<div class="paragraph">
<p>A web application is accessed using a web browser over a network, such
as the Internet or a company&#8217;s intranet. As discussed in
<a href="#BNAAY">Distributed Multitiered Applications</a>, the
Jakarta EE platform uses a distributed multitiered application model, and
web applications run in the web tier.</p>
</div>
<div class="paragraph">
<p>Web applications contain resources that can be accessed by many users.
These resources often traverse unprotected, open networks, such as the
Internet. In such an environment, a substantial number of web
applications will require some type of security.</p>
</div>
<div class="paragraph">
<p>Securing applications and their clients in the business tier and the EIS
tier is discussed in <a href="#BNBYK">Chapter 52, "Getting
Started Securing Enterprise Applications"</a>.</p>
</div>
<div class="paragraph">
<p>In the Jakarta EE platform, web components provide the dynamic extension
capabilities for a web server. Web components can be Jakarta servlets or
Jakarta Server Faces pages.</p>
</div>
<div class="paragraph">
<p>Certain aspects of web application security can be configured when the
application is installed, or deployed, to the web container. Annotations
and/or deployment descriptors are used to relay information to the
deployer about security and other aspects of the application. Specifying
this information in annotations or in the deployment descriptor helps
the deployer set up the appropriate security policy for the web
application. Any values explicitly specified in the deployment
descriptor override any values specified in annotations.</p>
</div>
<div class="paragraph">
<p>Security for Jakarta EE web applications can be implemented in the
following ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Declarative security can be implemented using either metadata
annotations or an application&#8217;s deployment descriptor. See
<a href="#BNBWK">Overview of Jakarta Security</a> for more
information.</p>
<div class="paragraph">
<p>Declarative security for web applications is described in
<a href="#GKBAA">Securing Web Applications</a>.</p>
</div>
</li>
<li>
<p>Programmatic security is embedded in an application and can be used to
make security decisions when declarative security alone is not
sufficient to express the security model of an application. Declarative
security alone may not be sufficient when conditional login in a
particular work flow, instead of for all cases, is required in the
middle of an application. See <a href="#BNBWK">Overview
of Jakarta Security</a> for more information.</p>
<div class="paragraph">
<p>Servlet 4.0 provides the <code>authenticate</code>, <code>login</code>, and <code>logout</code> methods
of the <code>HttpServletRequest</code> interface. With the addition of the
<code>authenticate</code>, <code>login</code>, and <code>logout</code> methods to the Servlet
specification, an application deployment descriptor is no longer
required for web applications but may still be used to further specify
security requirements beyond the basic default values.</p>
</div>
<div class="paragraph">
<p>Programmatic security is discussed in
<a href="#GJIIE">Using Programmatic Security with Web
Applications</a>.</p>
</div>
</li>
<li>
<p>Message security works with web services and incorporates security
features, such as digital signatures and encryption, into the header of
a SOAP message, working in the application layer, ensuring end-to-end
security. Message security is not a component of Jakarta EE and is
mentioned here for informational purposes only.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some of the material in this chapter builds on material presented
earlier in this tutorial. In particular, this chapter assumes that you
are familiar with the information in the following chapters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BNADR">Chapter 6, "Getting Started with Web
Applications"</a></p>
</li>
<li>
<p><a href="#BNAPH">Chapter 7, "Jakarta Server Faces Technology"</a></p>
</li>
<li>
<p><a href="#BNAFD">Chapter 18, "Jakarta Servlet Technology"</a></p>
</li>
<li>
<p><a href="#BNBWJ">Chapter 50, "Introduction to Security in
the Jakarta EE Platform"</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GKBAA"></a><a id="securing-web-applications"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_securing_web_applications">2.2. Securing Web Applications</h3>
<div class="paragraph">
<p>Web applications are created by application developers who give, sell,
or otherwise transfer the application to an application deployer for
installation into a runtime environment.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#overview-of-securing-web-applications">Overview of Securing Web Applications</a></p>
</li>
<li>
<p><a href="#specifying-security-constraints">Specifying Security Constraints</a></p>
</li>
<li>
<p><a href="#specifying-authentication-mechanisms">Specifying Authentication Mechanisms</a></p>
</li>
<li>
<p><a href="#specifying-an-authentication-mechanism-in-the-deployment-descriptor">Specifying an Authentication Mechanism in the Deployment
Descriptor</a></p>
</li>
<li>
<p><a href="#declaring-security-roles">Declaring Security Roles</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="CHDBIBHI"></a><a id="overview-of-securing-web-applications"></a></p>
</div>
<div class="sect3">
<h4 id="_overview_of_securing_web_applications">2.2.1. Overview of Securing Web Applications</h4>
<div class="paragraph">
<p>Application developers communicate how to set up security for the
deployed application by using annotations or deployment descriptors.
This information is passed on to the deployer, who uses it to define
method permissions for security roles, set up user authentication, and
set up the appropriate transport mechanism. If the application developer
doesn&#8217;t define security requirements, the deployer will have to
determine the security requirements independently.</p>
</div>
<div class="paragraph">
<p>Some elements necessary for security in a web application cannot be
specified as annotations for all types of web applications. This chapter
explains how to secure web applications using annotations wherever
possible. It explains how to use deployment descriptors where
annotations cannot be used.</p>
</div>
<div class="paragraph">
<p><a id="BNCBK"></a><a id="specifying-security-constraints"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_specifying_security_constraints">2.2.2. Specifying Security Constraints</h4>
<div class="paragraph">
<p>A security constraint is used to define the access privileges to a
collection of resources using their URL mapping.</p>
</div>
<div class="paragraph">
<p>If your web application uses a servlet, you can express the security
constraint information by using annotations. Specifically, you use the
<code>@HttpConstraint</code> and, optionally, the <code>@HttpMethodConstraint</code>
annotations within the <code>@ServletSecurity</code> annotation to specify a
security constraint.</p>
</div>
<div class="paragraph">
<p>If your web application does not use a servlet, however, you must
specify a <code>security-constraint</code> element in the deployment descriptor
file. The authentication mechanism cannot be expressed using
annotations, so if you use any authentication method other than <code>BASIC</code>
(the default), a deployment descriptor is required.</p>
</div>
<div class="paragraph">
<p>The following subelements can be part of a <code>security-constraint</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Web resource collection (<code>web-resource-collection</code>): A list of URL
patterns (the part of a URL after the host name and port you want to
constrain) and HTTP operations (the methods within the files that match
the URL pattern you want to constrain) that describe a set of resources
to be protected. Web resource collections are discussed in
<a href="#GJJCD">Specifying a Web Resource Collection</a>.</p>
</li>
<li>
<p>Authorization constraint (<code>auth-constraint</code>): Specifies whether
authentication is to be used and names the roles authorized to perform
the constrained requests. For more information about authorization
constraints, see <a href="#GJJCG">Specifying an Authorization Constraint</a>.</p>
</li>
<li>
<p>User data constraint (<code>user-data-constraint</code>): Specifies how data is
protected when transported between a client and a server. User data
constraints are discussed in <a href="#BNCBM">Specifying a Secure
Connection</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GJJCD"></a><a id="specifying-a-web-resource-collection"></a></p>
</div>
<div class="sect4">
<h5 id="_specifying_a_web_resource_collection">Specifying a Web Resource Collection</h5>
<div class="paragraph">
<p>A web resource collection consists of the following subelements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>web-resource-name</code> is the name you use for this resource. Its use is
optional.</p>
</li>
<li>
<p><code>url-pattern</code> is used to list the request URI to be protected. Many
applications have both unprotected and protected resources. To provide
unrestricted access to a resource, do not configure a security
constraint for that particular request URI.</p>
<div class="paragraph">
<p>The request URI is the part of a URL after the host name and port. For
example, let&#8217;s say that you have an e-commerce site with a catalog that
you would want anyone to be able to access and browse, and a shopping
cart area for customers only. You could set up the paths for your web
application so that the pattern <code>/cart/*</code> is protected but nothing else
is protected. Assuming that the application is installed at context path
<code>/myapp</code>, the following are true.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><a href="http://localhost:8080/myapp/index.xhtml" class="bare">http://localhost:8080/myapp/index.xhtml</a></code> is not protected.</p>
</li>
<li>
<p><code><a href="http://localhost:8080/myapp/cart/index.xhtml" class="bare">http://localhost:8080/myapp/cart/index.xhtml</a></code> is protected.</p>
<div class="paragraph">
<p>A user will be prompted to log in the first time he or she accesses a
resource in the <code>cart/</code> subdirectory.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code>http-method</code> or <code>http-method-omission</code> is used to specify which
methods should be protected or which methods should be omitted from
protection. An HTTP method is protected by a <code>web-resource-collection</code>
under any of the following circumstances:</p>
<div class="ulist">
<ul>
<li>
<p>If no HTTP methods are named in the collection (which means that all
are protected)</p>
</li>
<li>
<p>If the collection specifically names the HTTP method in an
<code>http-method</code> subelement</p>
</li>
<li>
<p>If the collection contains one or more <code>http-method-omission</code>
elements, none of which names the HTTP method</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GJJCG"></a><a id="specifying-an-authorization-constraint"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_an_authorization_constraint">Specifying an Authorization Constraint</h5>
<div class="paragraph">
<p>An authorization constraint (<code>auth-constraint</code>) contains the <code>role-name</code>
element. You can use as many <code>role-name</code> elements as needed here.</p>
</div>
<div class="paragraph">
<p>An authorization constraint establishes a requirement for authentication
and names the roles authorized to access the URL patterns and HTTP
methods declared by this security constraint. If there is no
authorization constraint, the container must accept the request without
requiring user authentication. If there is an authorization constraint
but no roles are specified within it, the container will not allow
access to constrained requests under any circumstances. Each role name
specified here must either correspond to the role name of one of the
<code>security-role</code> elements defined for this web application or be the
specially reserved role name <code>*</code>, which indicates all roles in the web
application. Role names are case sensitive. The roles defined for the
application must be mapped to users and groups defined on the server,
except when default principal-to-role mapping is used.</p>
</div>
<div class="paragraph">
<p>For more information about security roles, see <a href="#BNCAV">Declaring
Security Roles</a>. For information on mapping security roles, see
<a href="#BNBXV">Mapping Roles to Users and Groups</a>.</p>
</div>
<div class="paragraph">
<p>For a servlet, the <code>@HttpConstraint</code> and <code>@HttpMethodConstraint</code>
annotations accept a <code>rolesAllowed</code> element that specifies the
authorized roles.</p>
</div>
<div class="paragraph">
<p><a id="BNCBM"></a><a id="specifying-a-secure-connection"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_a_secure_connection">Specifying a Secure Connection</h5>
<div class="paragraph">
<p>A user data constraint (<code>user-data-constraint</code> in the deployment
descriptor) contains the <code>transport-guarantee</code> subelement. A user data
constraint can be used to require that a protected transport-layer
connection, such as HTTPS, be used for all constrained URL patterns and
HTTP methods specified in the security constraint. The choices for
transport guarantee are <code>CONFIDENTIAL</code>, <code>INTEGRAL</code>, or <code>NONE</code>. If you
specify <code>CONFIDENTIAL</code> or <code>INTEGRAL</code> as a security constraint, it
generally means that the use of SSL is required and applies to all
requests that match the URL patterns in the web resource collection, not
just to the login dialog box.</p>
</div>
<div class="paragraph">
<p>The strength of the required protection is defined by the value of the
transport guarantee, as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify <code>CONFIDENTIAL</code> when the application requires that data be
transmitted so as to prevent other entities from observing the contents
of the transmission.</p>
</li>
<li>
<p>Specify <code>INTEGRAL</code> when the application requires that the data be sent
between client and server in such a way that it cannot be changed in
transit.</p>
</li>
<li>
<p>Specify <code>NONE</code> to indicate that the container must accept the
constrained requests on any connection, including an unprotected one.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Note</strong>:</p>
</div>
<div class="paragraph">
<p>In practice, Jakarta EE servers treat the <code>CONFIDENTIAL</code> and <code>INTEGRAL</code>
transport guarantee values identically.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The user data constraint is handy to use in conjunction with basic and
form-based user authentication. When the login authentication method is
set to <code>BASIC</code> or <code>FORM</code>, passwords are not protected, meaning that
passwords sent between a client and a server on an unprotected session
can be viewed and intercepted by third parties. Using a user data
constraint with the user authentication mechanism can alleviate this
concern. Configuring a user authentication mechanism is described in
<a href="#BNCBN">Specifying an Authentication Mechanism in the Deployment
Descriptor</a>.</p>
</div>
<div class="paragraph">
<p>To guarantee that data is transported over a secure connection, ensure
that SSL support is configured for your server. SSL support is already
configured for GlassFish Server.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Note</strong>:</p>
</div>
<div class="paragraph">
<p>After you switch to SSL for a session, you should never accept any
non-SSL requests for the rest of that session. For example, a shopping
site might not use SSL until the checkout page, and then it might switch
to using SSL to accept your card number. After switching to SSL, you
should stop listening to non-SSL requests for this session. The reason
for this practice is that the session ID itself was not encrypted on the
earlier communications. This is not so bad when you&#8217;re only doing your
shopping, but after the credit card information is stored in the
session, you don&#8217;t want anyone to use that information to fake the
purchase transaction against your credit card. This practice could be
easily implemented by using a filter.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="BNCBL"></a><a id="specifying-security-constraints-for-resources"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_security_constraints_for_resources">Specifying Security Constraints for Resources</h5>
<div class="paragraph">
<p>You can create security constraints for resources within your
application. For example, you could allow users with the role of
<code>PARTNER</code> full access to all resources at the URL pattern
<code>/acme/wholesale/<strong></code> and allow users with the role of <code>CLIENT</code> full
access to all resources at the URL pattern <code>/acme/retail/</strong></code>. This is the
recommended way to protect resources if you do not want to protect some
HTTP methods while leaving other HTTP methods unprotected. An example of
a deployment descriptor that would demonstrate this functionality is the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- SECURITY CONSTRAINT #1 --&gt;</span>
<span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;web-resource-name&gt;</span>wholesale<span class="tag">&lt;/web-resource-name&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/acme/wholesale/*<span class="tag">&lt;/url-pattern&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>PARTNER<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/auth-constraint&gt;</span>
    <span class="tag">&lt;user-data-constraint&gt;</span>
        <span class="tag">&lt;transport-guarantee&gt;</span>CONFIDENTIAL<span class="tag">&lt;/transport-guarantee&gt;</span>
    <span class="tag">&lt;/user-data-constraint&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span>

<span class="comment">&lt;!-- SECURITY CONSTRAINT #2 --&gt;</span>
<span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;web-resource-name&gt;</span>retail<span class="tag">&lt;/web-resource-name&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/acme/retail/*<span class="tag">&lt;/url-pattern&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>CLIENT<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/auth-constraint&gt;</span>
    <span class="tag">&lt;user-data-constraint&gt;</span>
        <span class="tag">&lt;transport-guarantee&gt;</span>CONFIDENTIAL<span class="tag">&lt;/transport-guarantee&gt;</span>
    <span class="tag">&lt;/user-data-constraint&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GKBSA"></a><a id="specifying-authentication-mechanisms"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_specifying_authentication_mechanisms">2.2.3. Specifying Authentication Mechanisms</h4>
<div class="paragraph">
<p>This section describes built-in authentication mechanisms defined by
the Servlet specification.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Note</strong>:</p>
</div>
<div class="paragraph">
<p>An alternative way to perform user authentication, including BASIC
and FORM authentication, is to use the <code>HttpAuthenticationMechanism</code>, specified by
Jakarta Security, and documented in
<a href="#using-the-jakarta-ee-security-api">Chapter 53, "Using Jakarta Security"</a>.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A user authentication mechanism specifies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The way a user gains access to web content</p>
</li>
<li>
<p>With basic authentication, the realm in which the user will be
authenticated</p>
</li>
<li>
<p>With form-based authentication, additional attributes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When an authentication mechanism is specified, the user must be
authenticated before access is granted to any resource that is
constrained by a security constraint. There can be multiple security
constraints applying to multiple resources, but the same authentication
method will apply to all constrained resources in an application.</p>
</div>
<div class="paragraph">
<p>Before you can authenticate a user, you must have a database of user
names, passwords, and roles configured on your web or application
server. For information on setting up the user database, see
<a href="#BNBXR">Managing Users and Groups in GlassFish
Server</a>.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE platform supports the following authentication mechanisms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Basic authentication</p>
</li>
<li>
<p>Form-based authentication</p>
</li>
<li>
<p>Digest authentication</p>
</li>
<li>
<p>Client authentication</p>
</li>
<li>
<p>Mutual authentication</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Basic, form-based, and digest authentication are discussed in this
section. Client and mutual authentication are discussed in
<a href="#GJJWX">Chapter 54, "Jakarta EE Security: Advanced
Topics"</a>.</p>
</div>
<div class="paragraph">
<p>HTTP basic authentication and form-based authentication are not very
secure authentication mechanisms. Basic authentication sends user names
and passwords over the Internet as Base64-encoded text. Form-based
authentication sends this data as plain text. In both cases, the target
server is not authenticated. Therefore, these forms of authentication
leave user data exposed and vulnerable. If someone can intercept the
transmission, the user name and password information can easily be
decoded.</p>
</div>
<div class="paragraph">
<p>However, when a secure transport mechanism, such as SSL, or security at
the network level, such as the Internet Protocol Security (IPsec)
protocol or virtual private network (VPN) strategies, is used in
conjunction with basic or form-based authentication, some of these
concerns can be alleviated. To specify a secure transport mechanism, use
the elements described in <a href="#BNCBM">Specifying a Secure Connection</a>.</p>
</div>
<div class="paragraph">
<p><a id="BNCBO"></a><a id="http-basic-authentication"></a></p>
</div>
<div class="sect4">
<h5 id="_http_basic_authentication">HTTP Basic Authentication</h5>
<div class="paragraph">
<p>Specifying HTTP basic authentication requires that the server request a
user name and password from the web client and verify that the user name
and password are valid by comparing them against a database of
authorized users in the specified or default realm.</p>
</div>
<div class="paragraph">
<p>Basic authentication is the default when you do not specify an
authentication mechanism.</p>
</div>
<div class="paragraph">
<p>When basic authentication is used, the following actions occur.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A client requests access to a protected resource.</p>
</li>
<li>
<p>The web server returns a dialog box that requests the user name and
password.</p>
</li>
<li>
<p>The client submits the user name and password to the server.</p>
</li>
<li>
<p>The server authenticates the user in the specified realm and, if
successful, returns the requested resource.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="#BNCBP">Figure 51-1</a> shows what happens when you specify HTTP basic
authentication.</p>
</div>
<div id="BNCBP" class="paragraph">
<div class="title"><strong>Figure 51-1 HTTP Basic Authentication</strong></div>
<p><span class="image"><img src="../images/jakartaeett_dt_045.png" alt="Diagram of four steps in HTTP basic authentication between client and server"></span></p>
</div>
<div class="paragraph">
<p><a id="BNCBQ"></a><a id="form-based-authentication"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_form_based_authentication">Form-Based Authentication</h5>
<div class="paragraph">
<p>Form-based authentication allows the developer to control the look and
feel of the login authentication screens by customizing the login screen
and error pages that an HTTP browser presents to the end user. When
form-based authentication is declared, the following actions occur.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A client requests access to a protected resource.</p>
</li>
<li>
<p>If the client is unauthenticated, the server redirects the client to
a login page.</p>
</li>
<li>
<p>The client submits the login form to the server.</p>
</li>
<li>
<p>The server attempts to authenticate the user.</p>
<div class="ulist">
<ul>
<li>
<p>If authentication succeeds, the authenticated user&#8217;s principal is
checked to ensure that it is in a role that is authorized to access the
resource. If the user is authorized, the server redirects the client to
the resource by using the stored URL path.</p>
</li>
<li>
<p>If authentication fails, the client is forwarded or redirected to an
error page.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="#GEXFA">Figure 51-2</a> shows what happens when you specify form-based
authentication.</p>
</div>
<div id="GEXFA" class="paragraph">
<div class="title"><strong>Figure 51-2 Form-Based Authentication</strong></div>
<p><span class="image"><img src="../images/jakartaeett_dt_046.png" alt="Diagram of four steps in form-based authentication between client and server"></span></p>
</div>
<div class="paragraph">
<p>The section <a href="#BNCBY">The hello1-formauth
Example: Form-Based Authentication with a Jakarta Server Faces Application</a>
is an example application that uses form-based authentication.</p>
</div>
<div class="paragraph">
<p>When you create a form-based login, be sure to maintain sessions using
cookies or SSL session information.</p>
</div>
<div class="paragraph">
<p>For authentication to proceed appropriately, the action of the login
form must always be <code>j_security_check</code>. This restriction is made so that
the login form will work no matter which resource it is for and to avoid
requiring the server to specify the action field of the outbound form.
The following code snippet shows how the form should be coded into the
HTML page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;form method=<span class="string"><span class="delimiter">&quot;</span><span class="content">POST</span><span class="delimiter">&quot;</span></span> action=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_security_check</span><span class="delimiter">&quot;</span></span>&gt;
&lt;input type=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_username</span><span class="delimiter">&quot;</span></span>&gt;
&lt;input type=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_password</span><span class="delimiter">&quot;</span></span>&gt;
&lt;/form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="BNCBW"></a><a id="digest-authentication"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_digest_authentication">Digest Authentication</h5>
<div class="paragraph">
<p>Like basic authentication, digest authentication authenticates a user
based on a user name and a password. However, unlike basic
authentication, digest authentication does not send user passwords over
the network. Instead, the client sends a one-way cryptographic hash of
the password and additional data. Although passwords are not sent on the
wire, digest authentication requires that clear-text password
equivalents be available to the authenticating container so that it can
validate received authenticators by calculating the expected digest.</p>
</div>
<div class="paragraph">
<p><a id="BNCBN"></a><a id="specifying-an-authentication-mechanism-in-the-deployment-descriptor"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_specifying_an_authentication_mechanism_in_the_deployment_descriptor">2.2.4. Specifying an Authentication Mechanism in the Deployment Descriptor</h4>
<div class="paragraph">
<p>To specify an authentication mechanism, use the <code>login-config</code> element.
It can contain the following subelements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>auth-method</code> subelement configures the authentication mechanism
for the web application. The element content must be either <code>NONE</code>,
<code>BASIC</code>, <code>DIGEST</code>, <code>FORM</code>, or <code>CLIENT-CERT</code>.</p>
</li>
<li>
<p>The <code>realm-name</code> subelement indicates the realm name to use when the
basic authentication scheme is chosen for the web application.</p>
</li>
<li>
<p>The <code>form-login-config</code> subelement specifies the login and error pages
that should be used when form-based login is specified.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Note</strong>:</p>
</div>
<div class="paragraph">
<p>Another way to specify form-based authentication is to use the
<code>authenticate</code>, <code>login</code>, and <code>logout</code> methods of <code>HttpServletRequest</code>,
as discussed in <a href="#GIRCJ">Authenticating Users
Programmatically</a>.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When you try to access a web resource that is constrained by a
<code>security-constraint</code> element, the web container activates the
authentication mechanism that has been configured for that resource. The
authentication mechanism specifies how the user will be prompted to log
in. If the <code>login-config</code> element is present and the <code>auth-method</code>
element contains a value other than <code>NONE</code>, the user must be
authenticated to access the resource. If you do not specify an
authentication mechanism, authentication of the user is not required.</p>
</div>
<div class="paragraph">
<p>The following example shows how to declare form-based authentication in
your deployment descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;login-config&gt;</span>
    <span class="tag">&lt;auth-method&gt;</span>FORM<span class="tag">&lt;/auth-method&gt;</span>
    <span class="tag">&lt;realm-name&gt;</span>file<span class="tag">&lt;/realm-name&gt;</span>
    <span class="tag">&lt;form-login-config&gt;</span>
        <span class="tag">&lt;form-login-page&gt;</span>/login.xhtml<span class="tag">&lt;/form-login-page&gt;</span>
        <span class="tag">&lt;form-error-page&gt;</span>/error.xhtml<span class="tag">&lt;/form-error-page&gt;</span>
    <span class="tag">&lt;/form-login-config&gt;</span>
<span class="tag">&lt;/login-config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The login and error page locations are specified relative to the
location of the deployment descriptor. Examples of login and error pages
are shown in <a href="#BNCCA">Creating the Login Form
and the Error Page</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to declare digest authentication in your
deployment descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;login-config&gt;</span>
    <span class="tag">&lt;auth-method&gt;</span>DIGEST<span class="tag">&lt;/auth-method&gt;</span>
<span class="tag">&lt;/login-config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="BNCAV"></a><a id="declaring-security-roles"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_declaring_security_roles">2.2.5. Declaring Security Roles</h4>
<div class="paragraph">
<p>You can declare security role names used in web applications by using
the <code>security-role</code> element of the deployment descriptor. Use this
element to list all the security roles that you have referenced in your
application.</p>
</div>
<div class="paragraph">
<p>The following snippet of a deployment descriptor declares the roles that
will be used in an application using the <code>security-role</code> element and
specifies which of these roles is authorized to access protected
resources using the <code>auth-constraint</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;web-resource-name&gt;</span>Protected Area<span class="tag">&lt;/web-resource-name&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/security/protected/*<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;http-method&gt;</span>PUT<span class="tag">&lt;/http-method&gt;</span>
        <span class="tag">&lt;http-method&gt;</span>DELETE<span class="tag">&lt;/http-method&gt;</span>
        <span class="tag">&lt;http-method&gt;</span>GET<span class="tag">&lt;/http-method&gt;</span>
        <span class="tag">&lt;http-method&gt;</span>POST<span class="tag">&lt;/http-method&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>manager<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/auth-constraint&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span>

 <span class="comment">&lt;!-- Security roles used by this web application --&gt;</span>
<span class="tag">&lt;security-role&gt;</span>
    <span class="tag">&lt;role-name&gt;</span>manager<span class="tag">&lt;/role-name&gt;</span>
<span class="tag">&lt;/security-role&gt;</span>
<span class="tag">&lt;security-role&gt;</span>
    <span class="tag">&lt;role-name&gt;</span>employee<span class="tag">&lt;/role-name&gt;</span>
<span class="tag">&lt;/security-role&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>security-role</code> element lists all the security
roles used in the application: <code>manager</code> and <code>employee</code>. This enables
the deployer to map all the roles defined in the application to users
and groups defined in GlassFish Server.</p>
</div>
<div class="paragraph">
<p>The <code>auth-constraint</code> element specifies the role, <code>manager</code>, that can
access the HTTP methods PUT, DELETE, GET, and POST located in the
directory specified by the <code>url-pattern</code> element
(<code>/security/protected/*</code>).</p>
</div>
<div class="paragraph">
<p>The <code>@ServletSecurity</code> annotation cannot be used in this situation
because its constraints apply to all URL patterns specified by the
<code>@WebServlet</code> annotation.</p>
</div>
<div class="paragraph">
<p><a id="GJIIE"></a><a id="using-programmatic-security-with-web-applications"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_programmatic_security_with_web_applications">2.3. Using Programmatic Security with Web Applications</h3>
<div class="paragraph">
<p>Programmatic security is used by security-aware applications when
declarative security alone is not sufficient to express the security
model of the application.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#authenticating-users-programmatically">Authenticating Users Programmatically</a></p>
</li>
<li>
<p><a href="#checking-caller-identity-programmatically">Checking Caller Identity Programmatically</a></p>
</li>
<li>
<p><a href="#testing-access-to-a-resource-programmatically">Testing Access to a Resource Programmatically</a></p>
</li>
<li>
<p><a href="#example-code-for-programmatic-security">Example Code for Programmatic Security</a></p>
</li>
<li>
<p><a href="#declaring-and-linking-role-references">Declaring and Linking Role References</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GIRCJ"></a><a id="authenticating-users-programmatically"></a></p>
</div>
<div class="sect3">
<h4 id="_authenticating_users_programmatically">2.3.1. Authenticating Users Programmatically</h4>
<div class="paragraph">
<p>You can use the <code>SecurityContext</code> and <code>HttpServletRequest</code> interfaces to
authenticate users for a web application programmatically.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="security-context">2.4. SecurityContext</h3>
<div class="paragraph">
<p>The <code>SecurityContext</code> interface, as specified in the Jakarta EE Security API
specification, defines the following method to programmatically trigger the
authentication process:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>authenticate()</code> allows an application to signal to the container
that it should start the authentication process with the caller.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Programmatically triggering means that the container responds as if the caller
had attempted to access a constrained resource. It causes the container to invoke
the authentication mechanism configured for the application. If the configured
authentication mechanism is an <code>HttpAuthenticationMechanism</code>, then
the <code>AuthenticationParameters</code> argument is meaningful and extended capabilities of
<code>HttpAuthenticationMechanism</code> are available. If not, the behavior and result is
as if <code>HttpServletRequest.authenticate()</code> were called.</p>
</div>
</div>
<div class="sect2">
<h3 id="httpservletrequest">2.5. HttpServletRequest</h3>
<div class="paragraph">
<p>The <code>HttpServletRequest</code> interface defines the following methods that enable you
to authenticate users for a web application programmatically.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>authenticate</code> allows an application to instigate authentication of
the request caller by the container from within an unconstrained request
context. A login dialog box displays and collects the user name and
password for authentication purposes.</p>
</li>
<li>
<p><code>login</code> allows an application to collect user name and password
information as an alternative to specifying form-based authentication in
an application deployment descriptor.</p>
</li>
<li>
<p><code>logout</code> allows an application to reset the caller identity of a
request.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example code shows how to use the <code>login</code> and <code>logout</code>
methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">test</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.io.PrintWriter</span>;
<span class="keyword">import</span> <span class="include">java.math.BigDecimal</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.EJB</span>;
<span class="keyword">import</span> <span class="include">javax.servlet.ServletException</span>;
<span class="keyword">import</span> <span class="include">javax.servlet.annotation.WebServlet</span>;
<span class="keyword">import</span> <span class="include">javax.servlet.http.HttpServlet</span>;
<span class="keyword">import</span> <span class="include">javax.servlet.http.HttpServletRequest</span>;
<span class="keyword">import</span> <span class="include">javax.servlet.http.HttpServletResponse</span>;

<span class="annotation">@WebServlet</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialServlet</span><span class="delimiter">&quot;</span></span>, urlPatterns={<span class="string"><span class="delimiter">&quot;</span><span class="content">/TutorialServlet</span><span class="delimiter">&quot;</span></span>})
<span class="directive">public</span> <span class="type">class</span> <span class="class">TutorialServlet</span> <span class="directive">extends</span> HttpServlet {
    <span class="annotation">@EJB</span>
    <span class="directive">private</span> ConverterBean converterBean;

    <span class="comment">/**
     * Processes requests for both HTTP &lt;code&gt;GET&lt;/code&gt;
     *    and &lt;code&gt;POST&lt;/code&gt; methods.
     * @param request servlet request
     * @param response servlet response
     * @throws ServletException if a servlet-specific error occurs
     * @throws IOException if an I/O error occurs
     */</span>
    <span class="directive">protected</span> <span class="type">void</span> processRequest(HttpServletRequest request,
            HttpServletResponse response)
    <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {
        response.setContentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html;charset=UTF-8</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">PrintWriter</span> out = response.getWriter();
        <span class="keyword">try</span> {

            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;html&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;head&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;title&gt;Servlet TutorialServlet&lt;/title&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/head&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;body&gt;</span><span class="delimiter">&quot;</span></span>);
            request.login(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>);
            <span class="predefined-type">BigDecimal</span> result =
                converterBean.dollarToYen(<span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>));
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;h1&gt;Servlet TutorialServlet result of dollarToYen= </span><span class="delimiter">&quot;</span></span>
                + result + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/h1&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/body&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/html&gt;</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
            <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(e);
        } <span class="keyword">finally</span> {
            request.logout();
            out.close();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example code shows how to use the <code>authenticate</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.example.test</span>;

<span class="keyword">import</span> <span class="include">java.io</span>.*;
<span class="keyword">import</span> <span class="include">javax.servlet</span>.*;
<span class="keyword">import</span> <span class="include">javax.servlet.http</span>.*;

<span class="directive">public</span> <span class="type">class</span> <span class="class">TestServlet</span> <span class="directive">extends</span> HttpServlet {

    <span class="directive">protected</span> <span class="type">void</span> processRequest(HttpServletRequest request,
            HttpServletResponse response)
            <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {
        response.setContentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html;charset=UTF-8</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">PrintWriter</span> out = response.getWriter();
        <span class="keyword">try</span> {
            request.authenticate(response);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Authenticate Successful</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">finally</span> {
            out.close();
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="BNCBA"></a><a id="checking-caller-identity-programmatically"></a></p>
</div>
<div class="sect3">
<h4 id="_checking_caller_identity_programmatically">2.5.1. Checking Caller Identity Programmatically</h4>
<div class="paragraph">
<p>In general, the container enforces security management in a
manner that is transparent to the web component. Use the security APIs
described in this section only in the less frequent
situations in which the web component methods need to access the
security context information.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE Security API specification defines the following methods of the
<code>SecurityContext</code> interface that allow the application to test aspects of the
caller data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getCallerPrincipal()</code> retrieves the <code>Principal</code> representing the caller.
This is the container-specific representation of the caller principal,
and the type may differ from the type of the caller principal originally
established by an <code>HttpAuthenticationMechanism</code>. This method returns null for an
unauthenticated caller.</p>
</li>
<li>
<p><code>getPrincipalsByType()</code> retrieves all principals of the given type. This
method can be used to retrieve an application-specific caller principal
established during authentication. This method is primarily useful in the case
that the containers caller principal is a different type than the application
caller principal, and the application needs specific information behavior
available only from the application principal. This method returns an empty
<code>Set</code> if the caller is unauthenticated, or if the requested type is not found.</p>
<div class="paragraph">
<p>Where both a container caller principal and an application caller principal
are present, the value returned by <code>getName()</code> is the same for both
principals.</p>
</div>
</li>
<li>
<p><code>isCallerInRole()</code> takes a String argument that represents the role to be
tested. The specification does not define how the role determination is made,
but the result must be the same as if the corresponding container-specific call
had been made (for example <code>HttpServletRequest.isUserInRole()</code>,
<code>EJBContext.isCallerInRole()</code>), and must be consistent with the result implied
by specifications that prescribe role-mapping behavior.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Servlet 4.0 specifies the following methods that enable you to access
security information about the component&#8217;s caller.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getRemoteUser</code> determines the user name with which the client
authenticated. The <code>getRemoteUser</code> method returns the name of the remote
user (the caller) associated by the container with the request. If no
user has been authenticated, this method returns <code>null</code>.</p>
</li>
<li>
<p><code>isUserInRole</code> determines whether a remote user is in a specific
security role. If no user has been authenticated, this method returns
<code>false</code>. This method expects a <code>String</code> user <code>role-name</code> parameter.</p>
<div class="paragraph">
<p>The <code>security-role-ref</code> element should be declared in the deployment
descriptor with a <code>role-name</code> subelement containing the role name to be
passed to the method. Using security role references is discussed in
<a href="#BNCBB">Declaring and Linking Role References</a>.</p>
</div>
</li>
<li>
<p><code>getUserPrincipal</code> determines the principal name of the current user
and returns a <code>java.security.Principal</code> object. If no user has been
authenticated, this method returns <code>null</code>. Calling the <code>getName</code> method
on the <code>Principal</code> returned by <code>getUserPrincipal</code> returns the name of
the remote user.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Your application can make business-logic decisions based on the
information obtained using these APIs.</p>
</div>
</div>
<div class="sect3">
<h4 id="testing-access-to-a-resource-programmatically">2.5.2. Testing Access to a Resource Programmatically</h4>
<div class="paragraph">
<p>The <code>SecurityContext</code> interface, as specified in the Jakarta Security API
specification, defines the following method for programmatically testing
access to a resource:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hasAccessToWebResource()</code> method determines if the caller has access to
the specified web resource for the specified HTTP methods, as determined by
the security constraints configured for the application.</p>
<div class="paragraph">
<p>The resource
parameter is an <code>URLPatternSpec</code>, as defined by Jakarta Authorization
(<code><a href="https://jakarta.ee/specifications/authorization/1.5/" class="bare">https://jakarta.ee/specifications/authorization/1.5/</a></code>), that
identifies an application-specific web resource.</p>
</div>
<div class="paragraph">
<p>This method can be used to check access to resources in the current application
only  it cannot be called cross-application, or cross-container, to check
access to resources in a different application.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, consider the following Servlet definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/protectedServlet</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@ServletSecurity</span>(<span class="annotation">@HttpConstraint</span>(rolesAllowed = <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>))
<span class="directive">public</span> <span class="type">class</span> <span class="class">ProtectedServlet</span> <span class="directive">extends</span> HttpServlet { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the following call to <code>hasAccessToWebResource()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">securityContext.hasAccessToWebResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">/protectedServlet</span><span class="delimiter">&quot;</span></span>, GET)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above <code>hasAccessToWebResource()</code> call returns true if, and only if,
the caller is in role "foo".</p>
</div>
<div class="paragraph">
<p><a id="GJJLQ"></a><a id="example-code-for-programmatic-security"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_example_code_for_programmatic_security">2.5.3. Example Code for Programmatic Security</h4>
<div class="paragraph">
<p>The following code demonstrates the use of programmatic security for the
purposes of programmatic login. This servlet does the following.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It displays information about the current user.</p>
</li>
<li>
<p>It prompts the user to log in.</p>
</li>
<li>
<p>It prints out the information again to demonstrate the effect of the
<code>login</code> method.</p>
</li>
<li>
<p>It logs the user out.</p>
</li>
<li>
<p>It prints out the information again to demonstrate the effect of the
<code>logout</code> method.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">enterprise.programmatic_login</span>;

<span class="keyword">import</span> <span class="include">java.io</span>.*;
<span class="keyword">import</span> <span class="include">java.net</span>.*;
<span class="keyword">import</span> <span class="include">javax.annotation.security.DeclareRoles</span>;
<span class="keyword">import</span> <span class="include">javax.servlet</span>.*;
<span class="keyword">import</span> <span class="include">javax.servlet.http</span>.*;

<span class="annotation">@DeclareRoles</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaeeuser</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">LoginServlet</span> <span class="directive">extends</span> HttpServlet {

    <span class="comment">/**
     * Processes requests for both HTTP GET and POST methods.
     * @param request servlet request
     * @param response servlet response
     */</span>
    <span class="directive">protected</span> <span class="type">void</span> processRequest(HttpServletRequest request,
                 HttpServletResponse response)
            <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {
        response.setContentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html;charset=UTF-8</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">PrintWriter</span> out = response.getWriter();
        <span class="keyword">try</span> {
            <span class="predefined-type">String</span> userName = request.getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">txtUserName</span><span class="delimiter">&quot;</span></span>);
            <span class="predefined-type">String</span> password = request.getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">txtPassword</span><span class="delimiter">&quot;</span></span>);

            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Before Login</span><span class="delimiter">&quot;</span></span> + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">IsUserInRole?..</span><span class="delimiter">&quot;</span></span>
                        + request.isUserInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaeeuser</span><span class="delimiter">&quot;</span></span>)+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">getRemoteUser?..</span><span class="delimiter">&quot;</span></span> + request.getRemoteUser()+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">getUserPrincipal?..</span><span class="delimiter">&quot;</span></span>
                        + request.getUserPrincipal()+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">getAuthType?..</span><span class="delimiter">&quot;</span></span> + request.getAuthType()+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);

            <span class="keyword">try</span> {
                request.login(userName, password);
            } <span class="keyword">catch</span>(ServletException ex) {
                out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Login Failed with a ServletException..</span><span class="delimiter">&quot;</span></span>
                    + ex.getMessage());
                <span class="keyword">return</span>;
            }
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">After Login...</span><span class="delimiter">&quot;</span></span>+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">IsUserInRole?..</span><span class="delimiter">&quot;</span></span>
                        + request.isUserInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaeeuser</span><span class="delimiter">&quot;</span></span>)+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">getRemoteUser?..</span><span class="delimiter">&quot;</span></span> + request.getRemoteUser()+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">getUserPrincipal?..</span><span class="delimiter">&quot;</span></span>
                        + request.getUserPrincipal()+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">getAuthType?..</span><span class="delimiter">&quot;</span></span> + request.getAuthType()+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);

            request.logout();
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">After Logout...</span><span class="delimiter">&quot;</span></span>+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">IsUserInRole?..</span><span class="delimiter">&quot;</span></span>
                        + request.isUserInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaeeuser</span><span class="delimiter">&quot;</span></span>)+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">getRemoteUser?..</span><span class="delimiter">&quot;</span></span> + request.getRemoteUser()+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">getUserPrincipal?..</span><span class="delimiter">&quot;</span></span>
                        + request.getUserPrincipal()+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">getAuthType?..</span><span class="delimiter">&quot;</span></span> + request.getAuthType()+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">finally</span> {
            out.close();
        }
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="BNCBB"></a><a id="declaring-and-linking-role-references"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_declaring_and_linking_role_references">2.5.4. Declaring and Linking Role References</h4>
<div class="paragraph">
<p>A security role reference is a mapping between the name of a role that
is called from a web component using <code>isUserInRole(String role)</code> and the
name of a security role that has been defined for the application. If no
<code>security-role-ref</code> element is declared in a deployment descriptor and
the <code>isUserInRole</code> method is called, the container defaults to checking
the provided role name against the list of all security roles defined
for the web application. Using the default method instead of using the
<code>security-role-ref</code> element limits your flexibility to change role names
in an application without also recompiling the servlet making the call.</p>
</div>
<div class="paragraph">
<p>The <code>security-role-ref</code> element is used when an application uses the
<code>HttpServletRequest.isUserInRole(String role)</code>. The value passed to the
<code>isUserInRole</code> method is a <code>String</code> representing the role name of the
user. The value of the <code>role-name</code> element must be the <code>String</code> used as
the parameter to the <code>HttpServletRequest.isUserInRole(String role)</code>. The
<code>role-link</code> must contain the name of one of the security roles defined
in the <code>security-role</code> elements. The container uses the mapping of
<code>security-role-ref</code> to <code>security-role</code> when determining the return value
of the call.</p>
</div>
<div class="paragraph">
<p>For example, to map the security role reference <code>cust</code> to the security
role with role name <code>bankCustomer</code>, the elements would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet&gt;</span>
...
    <span class="tag">&lt;security-role-ref&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>cust<span class="tag">&lt;/role-name&gt;</span>
        <span class="tag">&lt;role-link&gt;</span>bankCustomer<span class="tag">&lt;/role-link&gt;</span>
    <span class="tag">&lt;/security-role-ref&gt;</span>
...
<span class="tag">&lt;/servlet&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the servlet method is called by a user in the <code>bankCustomer</code> security
role, <code>isUserInRole("cust")</code> returns <code>true</code>.</p>
</div>
<div class="paragraph">
<p>The <code>role-link</code> element in the <code>security-role-ref</code> element must match a
<code>role-name</code> defined in the <code>security-role</code> element of the same <code>web.xml</code>
deployment descriptor, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-role&gt;</span>
    <span class="tag">&lt;role-name&gt;</span>bankCustomer<span class="tag">&lt;/role-name&gt;</span>
<span class="tag">&lt;/security-role&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A security role reference, including the name defined by the reference,
is scoped to the component whose deployment descriptor contains the
<code>security-role-ref</code> deployment descriptor element.</p>
</div>
<div class="paragraph">
<p><a id="BNCBX"></a><a id="examples-securing-web-applications"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_examples_securing_web_applications">2.6. Examples: Securing Web Applications</h3>
<div class="paragraph">
<p>Some basic setup is required before any of the example applications will
run correctly.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#overview-of-examples-of-securing-web-applications">Overview of Examples of Securing Web Applications</a></p>
</li>
<li>
<p><a href="#to-set-up-your-system-for-running-the-security-examples">To Set Up Your System for Running the Security Examples</a></p>
</li>
<li>
<p><a href="#the-hello2-basicauth-example-basic-authentication-with-a-servlet">The hello2-basicauth Example: Basic Authentication with a
Servlet</a></p>
</li>
<li>
<p><a href="#the-hello1-formauth-example-form-based-authentication-with-a-javaserver-faces-application">The hello1-formauth Example: Form-Based Authentication
with a Jakarta Server Faces Application</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="CHDEBCHG"></a><a id="overview-of-examples-of-securing-web-applications"></a></p>
</div>
<div class="sect3">
<h4 id="_overview_of_examples_of_securing_web_applications">2.6.1. Overview of Examples of Securing Web Applications</h4>
<div class="paragraph">
<p>The examples use annotations, programmatic security, and/or declarative
security to demonstrate adding security to existing web applications.</p>
</div>
<div class="paragraph">
<p>Here are some other locations where you will find examples of securing
various types of applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BNBZK">The cart-secure Example: Securing an
Enterprise Bean with Declarative Security</a></p>
</li>
<li>
<p><a href="#BNCAA">The converter-secure Example:
Securing an Enterprise Bean with Programmatic Security</a></p>
</li>
<li>
<p>Java EE 8 GlassFish samples: <code><a href="https://javaee.github.io/glassfish-samples/" class="bare">https://javaee.github.io/glassfish-samples/</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GJJLK"></a><a id="to-set-up-your-system-for-running-the-security-examples"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_to_set_up_your_system_for_running_the_security_examples">2.6.2. To Set Up Your System for Running the Security Examples</h4>
<div class="paragraph">
<p>To set up your system for running the security examples, you need to
configure a user database that the application can use for
authenticating users. Before continuing, follow these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#BNADI">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>Add an authorized user to GlassFish Server. For the examples in this
chapter and in <a href="#BNBYK">Chapter 52, "Getting
Started Securing Enterprise Applications"</a>, add a user to the <code>file</code>
realm of GlassFish Server, and assign the user to the group
<code>TutorialUser</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From the Administration Console, expand the Configurations node,
then expand the server-config node.</p>
</li>
<li>
<p>Expand the Security node.</p>
</li>
<li>
<p>Expand the Realms node.</p>
</li>
<li>
<p>Select the File node.</p>
</li>
<li>
<p>On the Edit Realm page, click Manage Users.</p>
</li>
<li>
<p>On the File Users page, click New.</p>
</li>
<li>
<p>In the User ID field, enter a user ID.</p>
</li>
<li>
<p>In the Group List field, enter <code>TutorialUser</code>.</p>
</li>
<li>
<p>In the New Password and Confirm New Password fields, enter a password.</p>
</li>
<li>
<p>Click OK.</p>
<div class="paragraph">
<p>Be sure to write down the user name and password for the user you create
so that you can use it for testing the example applications.
Authentication is case sensitive for both the user name and password, so
write down the user name and password exactly. This topic is discussed
more in <a href="#BNBXR">Managing Users and Groups in
GlassFish Server</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Note:</strong></p>
</div>
<div class="paragraph">
<p>Jakarta Security requires that
group principal names are mapped
to roles of the same name by default. Therefore, the <strong>Default Principal To Role Mapping</strong> setting
is enabled by default on the Security page of
the console.</p>
</div></div></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BNCCK"></a><a id="the-hello2-basicauth-example-basic-authentication-with-a-servlet"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_the_hello2_basicauth_example_basic_authentication_with_a_servlet">2.6.3. The hello2-basicauth Example: Basic Authentication with a Servlet</h4>
<div class="paragraph">
<p>This example explains how to use basic authentication with a servlet.
With basic authentication of a servlet, the web browser presents a
standard login dialog box that is not customizable. When a user submits
his or her name and password, the server determines whether the user
name and password are those of an authorized user and sends the
requested web resource if the user is authorized to view it.</p>
</div>
<div class="paragraph">
<p>In general, the following steps are necessary for adding basic
authentication to an unsecured servlet, such as the ones described in
<a href="#BNADR">Chapter 6, "Getting Started with Web
Applications"</a>. In the example application included with this tutorial,
many of these steps have been completed for you and are listed here
simply to show what needs to be done should you wish to create a similar
application. This application can be found in the
<code><em>tut-install</em>/examples/security/hello2-basicauth/</code> directory.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="#GJJLK">To Set Up Your System for Running
the Security Examples</a>.</p>
</li>
<li>
<p>Create a web module for the servlet example, <code>hello2</code>, as described
in <a href="#BNADR">Chapter 6, "Getting Started with Web
Applications"</a>.</p>
</li>
<li>
<p>Add the appropriate security annotations to the servlet. The
security annotations are described in <a href="#GJRMH">Specifying Security
for Basic Authentication Using Annotations</a>.</p>
</li>
<li>
<p>Build, package, and deploy the web application by following the
steps in <a href="#GJQYS">To Build, Package, and Deploy the hello2-basicauth
Example Using NetBeans IDE</a> or <a href="#GJQZH">To Build, Package, and Deploy
the hello2-basicauth Example Using Maven</a>.</p>
</li>
<li>
<p>Run the web application by following the steps described in
<a href="#GJQZF">To Run the hello2-basicauth Example</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GJRMH"></a><a id="specifying-security-for-basic-authentication-using-annotations"></a></p>
</div>
<div class="sect4">
<h5 id="_specifying_security_for_basic_authentication_using_annotations">Specifying Security for Basic Authentication Using Annotations</h5>
<div class="paragraph">
<p>The default authentication mechanism used by GlassFish Server is basic
authentication. With basic authentication, GlassFish Server spawns a
standard login dialog box to collect user name and password data for a
protected resource. Once the user is authenticated, access to the
protected resource is permitted.</p>
</div>
<div class="paragraph">
<p>To specify security for a servlet, use the <code>@ServletSecurity</code>
annotation. This annotation allows you to specify both specific
constraints on HTTP methods and more general constraints that apply to
all HTTP methods for which no specific constraint is specified. Within
the <code>@ServletSecurity</code> annotation, you can specify the following
annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>@HttpMethodConstraint</code> annotation, which applies to a specific
HTTP method</p>
</li>
<li>
<p>The more general <code>@HttpConstraint</code> annotation, which applies to all
HTTP methods for which there is no corresponding <code>@HttpMethodConstraint</code>
annotation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both the <code>@HttpMethodConstraint</code> and <code>@HttpConstraint</code> annotations
within the <code>@ServletSecurity</code> annotation can specify the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>transportGuarantee</code> element that specifies the data protection
requirements (that is, whether or not SSL/TLS is required) that must be
satisfied by the connections on which requests arrive. Valid values for
this element are <code>NONE</code> and <code>CONFIDENTIAL</code>.</p>
</li>
<li>
<p>A <code>rolesAllowed</code> element that specifies the names of the authorized
roles.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the <code>hello2-basicauth</code> application, the <code>GreetingServlet</code> has the
following annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">GreetingServlet</span><span class="delimiter">&quot;</span></span>, urlPatterns = {<span class="string"><span class="delimiter">&quot;</span><span class="content">/greeting</span><span class="delimiter">&quot;</span></span>})
<span class="annotation">@ServletSecurity</span>(
<span class="annotation">@HttpConstraint</span>(transportGuarantee = TransportGuarantee.CONFIDENTIAL,
    rolesAllowed = {<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>}))</code></pre>
</div>
</div>
<div class="paragraph">
<p>These annotations specify that the request URI <code>/greeting</code> can be
accessed only by users who have been authorized to access this URL
because they have been verified to be in the role <code>TutorialUser</code>. The
data will be sent over a protected transport in order to keep the user
name and password data from being read in transit.</p>
</div>
<div class="paragraph">
<p>If you use the <code>@ServletSecurity</code> annotation, you do not need to specify
security settings in the deployment descriptor. Use the deployment
descriptor to specify settings for nondefault authentication mechanisms,
for which you cannot use the <code>@ServletSecurity</code> annotation.</p>
</div>
<div class="paragraph">
<p><a id="GJQYS"></a><a id="to-build-package-and-deploy-the-hello2-basicauth-example-using-netbeans-ide"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_build_package_and_deploy_the_hello2_basicauth_example_using_netbeans_ide">To Build, Package, and Deploy the hello2-basicauth Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="#GJJLK">To Set Up Your System for Running
the Security Examples</a>.</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/security</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>hello2-basicauth</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>hello2-basicauth</code> project and
select Build.</p>
<div class="paragraph">
<p>This command builds and deploys the example application to your
GlassFish Server instance.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GJQZH"></a><a id="to-build-package-and-deploy-the-hello2-basicauth-example-using-maven"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_build_package_and_deploy_the_hello2_basicauth_example_using_maven">To Build, Package, and Deploy the hello2-basicauth Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="#GJJLK">To Set Up Your System for Running
the Security Examples</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/security/hello2-basicauth/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file,
<code>hello2-basicauth.war</code>, that is located in the <code>target</code> directory, then
deploys the WAR file.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GJQZF"></a><a id="to-run-the-hello2-basicauth-example"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_run_the_hello2_basicauth_example">To Run the hello2-basicauth Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">https:<span class="comment">//localhost:8181/hello2-basicauth/greeting</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You may be prompted to accept the security certificate for the server.
If so, accept the security certificate. If the browser warns that the
certificate is invalid because it is self-signed, add a security
exception for the application.</p>
</div>
<div class="paragraph">
<p>An Authentication Required dialog box appears. Its appearance varies,
depending on the browser you use.</p>
</div>
</li>
<li>
<p>Enter a user name and password combination that corresponds to a
user who has already been created in the <code>file</code> realm of GlassFish
Server and has been assigned to the group <code>TutorialUser</code>; then click OK.</p>
<div class="paragraph">
<p>Basic authentication is case sensitive for both the user name and
password, so enter the user name and password exactly as defined for
GlassFish Server.</p>
</div>
<div class="paragraph">
<p>The server returns the requested resource if all the following
conditions are met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A user with the user name you entered is defined for GlassFish Server.</p>
</li>
<li>
<p>The user with the user name you entered has the password you entered.</p>
</li>
<li>
<p>The user name and password combination you entered is assigned to the
group <code>TutorialUser</code> in GlassFish Server.</p>
</li>
<li>
<p>The role of <code>TutorialUser</code>, as defined for the application, is mapped
to the group <code>TutorialUser</code>, as defined for GlassFish Server.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enter a name in the field and click Submit.</p>
<div class="paragraph">
<p>Because you have already been authorized, the name you enter in this
step does not have any limitations. You have unlimited access to the
application now.</p>
</div>
<div class="paragraph">
<p>The application responds by saying "Hello" to the name you entered.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BNCBY"></a><a id="the-hello1-formauth-example-form-based-authentication-with-a-javaserver-faces-application"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_hello1_formauth_example_form_based_authentication_with_a_jakarta_server_faces_application">2.6.4. The hello1-formauth Example: Form-Based Authentication with a Jakarta Server Faces Application</h4>
<div class="paragraph">
<p>This example explains how to use form-based authentication with a
Jakarta Server Faces application. With form-based authentication, you can
customize the login screen and error pages that are presented to the web
client for authentication of the user name and password. When a user
submits his or her name and password, the server determines whether the
user name and password are those of an authorized user and, if
authorized, sends the requested web resource.</p>
</div>
<div class="paragraph">
<p>This example, <code>hello1-formauth</code>, adds security to the basic Jakarta Server
Faces application shown in <a href="#BNADX">A Web Module That
Uses Jakarta Server Faces Technology: The hello1 Example</a>.</p>
</div>
<div class="paragraph">
<p>In general, the steps necessary for adding form-based authentication to
an unsecured Jakarta Server Faces application are similar to those described
in <a href="#BNCCK">The hello2-basicauth Example: Basic Authentication with a
Servlet</a>. The major difference is that you must use a deployment
descriptor to specify the use of form-based authentication, as described
in <a href="#BNCCB">Specifying Security for the Form-Based Authentication
Example</a>. In addition, you must create a login form page and a login
error page, as described in <a href="#BNCCA">Creating the Login Form and the
Error Page</a>.</p>
</div>
<div class="paragraph">
<p>This application can be found in the
<code><em>tut-install</em>/examples/security/hello1-formauth/</code> directory.</p>
</div>
<div class="paragraph">
<p><a id="BNCCA"></a><a id="creating-the-login-form-and-the-error-page"></a></p>
</div>
<div class="sect4">
<h5 id="_creating_the_login_form_and_the_error_page">Creating the Login Form and the Error Page</h5>
<div class="paragraph">
<p>When using form-based login mechanisms, you must specify a page that
contains the form you want to use to obtain the user name and password,
as well as a page to display if login authentication fails. This section
discusses the login form and the error page used in this example.
<a href="#BNCCB">Specifying Security for the Form-Based Authentication
Example</a> shows how you specify these pages in the deployment descriptor.</p>
</div>
<div class="paragraph">
<p>The login page can be an HTML page or a servlet, and it must return an
HTML page containing a form that conforms to specific naming conventions
(see the Jakarta Servlet 4.0 specification for more information on these
requirements). To do this, include the elements that accept user name
and password information between <code>&lt;form&gt;&lt;/form&gt;</code> tags in your login
page. The content of an HTML page or servlet for a login page should be
coded as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;form</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_security_check</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_username</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>= <span class="string"><span class="delimiter">&quot;</span><span class="content">j_password</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;/form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The full code for the login page used in this example can be found at
<code><em>tut-install</em>/examples/security/hello1-formauth/src/main/webapp/login.html</code>.
Here is the code for this page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;title&gt;</span>Login Form<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;/head&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;h2&gt;</span>Hello, please log in:<span class="tag">&lt;/h2&gt;</span>
        <span class="tag">&lt;form</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_security_check</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;table</span> <span class="attribute-name">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">presentation</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;tr&gt;</span>
                    <span class="tag">&lt;td&gt;</span>Please type your user name: <span class="tag">&lt;/td&gt;</span>
                    <span class="tag">&lt;td&gt;</span><span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_username</span><span class="delimiter">&quot;</span></span>
                               <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/td&gt;</span>
                <span class="tag">&lt;/tr&gt;</span>
                <span class="tag">&lt;tr&gt;</span>
                    <span class="tag">&lt;td&gt;</span>Please type your password: <span class="tag">&lt;/td&gt;</span>
                    <span class="tag">&lt;td&gt;</span><span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_password</span><span class="delimiter">&quot;</span></span>
                               <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/td&gt;</span>
                <span class="tag">&lt;/tr&gt;</span>
            <span class="tag">&lt;/table&gt;</span>
            <span class="tag">&lt;p&gt;</span><span class="tag">&lt;/p&gt;</span>
            <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Submit</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="entity">&amp;nbsp;</span>
            <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reset</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Reset</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/form&gt;</span>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The login error page is displayed if the user enters a user name and
password combination that is not authorized to access the protected URI.
For this example, the login error page can be found at
<code><em>tut-install</em>/examples/security/hello1-formauth/src/main/webapp/error.html</code>.
For this example, the login error page explains the reason for receiving
the error page and provides a link that will allow the user to try
again. Here is the code for this page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;title&gt;</span>Login Error<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;/head&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;h2&gt;</span>Invalid user name or password.<span class="tag">&lt;/h2&gt;</span>

        <span class="tag">&lt;p&gt;</span>Please enter a user name or password that is authorized to access
           this application. For this application, this means a user that
           has been created in the <span class="tag">&lt;code&gt;</span>file<span class="tag">&lt;/code&gt;</span> realm and has been
           assigned to the <span class="tag">&lt;em&gt;</span>group<span class="tag">&lt;/em&gt;</span> of <span class="tag">&lt;code&gt;</span>TutorialUser<span class="tag">&lt;/code&gt;</span>.<span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;p&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">login.html</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Return to login page<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="BNCCB"></a><a id="specifying-security-for-the-form-based-authentication-example"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_security_for_the_form_based_authentication_example">Specifying Security for the Form-Based Authentication Example</h5>
<div class="paragraph">
<p>This example takes a very simple servlet-based web application and adds
form-based security. To specify form-based instead of basic
authentication for a Jakarta Server Faces example, you must use the
deployment descriptor.</p>
</div>
<div class="paragraph">
<p>The following sample code shows the security elements added to the
deployment descriptor for this example, which can be found in
<code><em>tut-install</em>/examples/security/hello1-formauth/src/main/webapp/WEB-INF/web.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;security-constraint&gt;</span>
        <span class="tag">&lt;display-name&gt;</span>Constraint1<span class="tag">&lt;/display-name&gt;</span>
        <span class="tag">&lt;web-resource-collection&gt;</span>
            <span class="tag">&lt;web-resource-name&gt;</span>wrcoll<span class="tag">&lt;/web-resource-name&gt;</span>
            <span class="tag">&lt;description</span><span class="tag">/&gt;</span>
            <span class="tag">&lt;url-pattern&gt;</span>/*<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;/web-resource-collection&gt;</span>
        <span class="tag">&lt;auth-constraint&gt;</span>
            <span class="tag">&lt;description</span><span class="tag">/&gt;</span>
            <span class="tag">&lt;role-name&gt;</span>TutorialUser<span class="tag">&lt;/role-name&gt;</span>
        <span class="tag">&lt;/auth-constraint&gt;</span>
    <span class="tag">&lt;/security-constraint&gt;</span>

    <span class="tag">&lt;login-config&gt;</span>
        <span class="tag">&lt;auth-method&gt;</span>FORM<span class="tag">&lt;/auth-method&gt;</span>
        <span class="tag">&lt;realm-name&gt;</span>file<span class="tag">&lt;/realm-name&gt;</span>
        <span class="tag">&lt;form-login-config&gt;</span>
            <span class="tag">&lt;form-login-page&gt;</span>/login.xhtml<span class="tag">&lt;/form-login-page&gt;</span>
            <span class="tag">&lt;form-error-page&gt;</span>/error.xhtml<span class="tag">&lt;/form-error-page&gt;</span>
        <span class="tag">&lt;/form-login-config&gt;</span>
    <span class="tag">&lt;/login-config&gt;</span>

    <span class="tag">&lt;security-role&gt;</span>
        <span class="tag">&lt;description</span><span class="tag">/&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>TutorialUser<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/security-role&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GJRBA"></a><a id="to-build-package-and-deploy-the-hello1-formauth-example-using-netbeans-ide"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_build_package_and_deploy_the_hello1_formauth_example_using_netbeans_ide">To Build, Package, and Deploy the hello1-formauth Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="#GJJLK">To Set Up Your System for Running
the Security Examples</a>.</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/security</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>hello1-formauth</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>hello1-formauth</code> project and
select Run.</p>
<div class="paragraph">
<p>This command builds and deploys the example application to your
GlassFish Server instance, then opens it in a browser.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GJRAZ"></a><a id="to-build-package-and-deploy-the-hello1-formauth-example-using-maven-and-the-asadmin-command"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_build_package_and_deploy_the_hello1_formauth_example_using_maven_and_the_asadmin_command">To Build, Package, and Deploy the hello1-formauth Example Using Maven and the asadmin Command</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="#GJJLK">To Set Up Your System for Running
the Security Examples</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/security/hello1-formauth/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command at the terminal window or command
prompt:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file,
<code>hello1-formauth.war</code>, that is located in the <code>target</code> directory, then
deploys the WAR file to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GJRAL"></a><a id="to-run-the-hello1-formauth-example"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_run_the_hello1_formauth_example">To Run the hello1-formauth Example</h5>
<div class="paragraph">
<p>To run the web client for <code>hello1-formauth</code>, follow these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a web browser to the following URL:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/hello1-formauth/</span></code></pre>
</div>
</div>
</li>
<li>
<p>In the login form, enter a user name and password combination that
corresponds to a user who has already been created in the <code>file</code> realm
of GlassFish Server and has been assigned to the group <code>TutorialUser</code>.</p>
<div class="paragraph">
<p>Form-based authentication is case sensitive for both the user name and
password, so enter the user name and password exactly as defined for
GlassFish Server.</p>
</div>
</li>
<li>
<p>Click Submit.</p>
<div class="paragraph">
<p>If you entered <code>My_Name</code> as the name and <code>My_Pwd</code> for the password, the
server returns the requested resource if all the following conditions
are met.
* A user with the user name <code>My_Name</code> is defined for GlassFish Server.
* The user with the user name <code>My_Name</code> has a password <code>My_Pwd</code> defined
for GlassFish Server.
* The user <code>My_Name</code> with the password <code>My_Pwd</code> is assigned to the group
<code>TutorialUser</code> on GlassFish Server.
* The role <code>TutorialUser</code>, as defined for the application, is mapped to
the group <code>TutorialUser</code>, as defined for GlassFish Server.</p>
</div>
<div class="paragraph">
<p>+
When these conditions are met and the server has authenticated the user,
the application appears.</p>
</div>
</li>
<li>
<p>Enter your name and click Submit.</p>
<div class="paragraph">
<p>Because you have already been authorized, the name you enter in this
step does not have any limitations. You have unlimited access to the
application now.</p>
</div>
<div class="paragraph">
<p>The application responds by saying "Hello" to you.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Next Steps</p>
</div>
<div class="paragraph">
<p>For additional testing and to see the login error page generated, close
and reopen your browser, enter the application URL, and enter a user
name and password that are not authorized.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started_securing_enterprise_applications">3. Getting Started Securing Enterprise Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="BNBYK"></a><a id="getting-started-securing-enterprise-applications"></a></p>
</div>
<div class="paragraph">
<p>This chapter describes how to administer security for enterprise
applications.</p>
</div>
<div class="paragraph">
<p><a id="CACGIFHJ"></a><a id="basic-security-tasks-for-enterprise-applications"></a></p>
</div>
<div class="sect2">
<h3 id="_basic_security_tasks_for_enterprise_applications">3.1. Basic Security Tasks for Enterprise Applications</h3>
<div class="paragraph">
<p>System administrators, application developers, bean providers, and
deployers are responsible for administering security for enterprise
applications. The basic security tasks are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Setting up a database of users and assigning them to the proper group</p>
</li>
<li>
<p>Setting up identity propagation</p>
</li>
<li>
<p>Setting GlassFish Server properties that enable the applications to
run properly. Note that the the <strong>Default Principal To Role Mapping</strong> setting is
enabled by default in the GlassFish Server Administration Console.</p>
</li>
<li>
<p>Annotating the classes and methods of an enterprise application to
provide information about which methods need to have restricted access</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The sections on the security examples in this chapter and the previous
chapter explain how to perform these tasks.</p>
</div>
<div class="paragraph">
<p><a id="BNBYL"></a><a id="securing-enterprise-beans"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_securing_enterprise_beans">3.2. Securing Enterprise Beans</h3>
<div class="paragraph">
<p>Enterprise beans are Jakarta EE components that implement enterprise bean technology.
Enterprise beans run in the enterprise bean container, a runtime environment within
GlassFish Server. Although transparent to the application developer, the
enterprise bean container provides system-level services, such as transactions and
security to its enterprise beans, which form the core of transactional
Jakarta EE applications.</p>
</div>
<div class="paragraph">
<p>Enterprise bean methods can be secured in either of the following ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Declarative security (preferred): Expresses an application component&#8217;s
security requirements using either deployment descriptors or
annotations. The presence of an annotation in the business method of an
enterprise bean class that specifies method permissions is all that is
needed for method protection and authentication in some situations. This
section discusses this simple and efficient method of securing
enterprise beans.</p>
<div class="paragraph">
<p>Because of some limitations to the simplified method of securing
enterprise beans, you would want to continue to use the deployment
descriptor to specify security information in some instances. An
authentication mechanism must be configured on the server for the simple
solution to work. Basic authentication is GlassFish Server&#8217;s default
authentication method.</p>
</div>
<div class="paragraph">
<p>This tutorial explains how to invoke user name/password authentication
of authorized users by decorating the enterprise application&#8217;s business
methods with annotations that specify method permissions.</p>
</div>
<div class="paragraph">
<p>To make the deployer&#8217;s task easier, the application developer can define
security roles. A security role is a grouping of permissions that a
given type of application users must have in order to successfully use
the application. For example, in a payroll application, some users will
want to view their own payroll information (employee), some will need to
view others' payroll information (manager), and some will need to be
able to change others' payroll information (payrollDept). The
application developer would determine the potential users of the
application and which methods would be accessible to which users. The
application developer would then decorate classes or methods of the
enterprise bean with annotations that specify the types of users
authorized to access those methods. Using annotations to specify
authorized users is described in <a href="#GJGCQ">Specifying Authorized Users
by Declaring Security Roles</a>.</p>
</div>
<div class="paragraph">
<p>When one of the annotations is used to define method permissions, the
deployment system will automatically require user name/password
authentication. In this type of authentication, a user is prompted to
enter a user name and password, which will be compared against a
database of known users. If the user is found and the password matches,
the roles that the user is assigned will be compared against the roles
that are authorized to access the method. If the user is authenticated
and found to have a role that is authorized to access that method, the
data will be returned to the user.</p>
</div>
<div class="paragraph">
<p>Using declarative security is discussed in <a href="#GJGDI">Securing an
Enterprise Bean Using Declarative Security</a>.</p>
</div>
</li>
<li>
<p>Programmatic security: For an enterprise bean, code embedded in a
business method that is used to access a caller&#8217;s identity
programmatically and that uses this information to make security
decisions. Programmatic security is useful when declarative security
alone is not sufficient to express the security model of an application.</p>
<div class="paragraph">
<p>In general, security management should be enforced by the container in a
manner that is transparent to the enterprise beans' business methods.
The programmatic security APIs described in this chapter should be used
only in the less frequent situations in which the enterprise bean
business methods need to access the security-context information, such
as when you want to grant access based on the time of day or other
nontrivial condition checks for a particular role.</p>
</div>
<div class="paragraph">
<p>Programmatic security is discussed in <a href="#GJGCS">Securing an Enterprise
Bean Programmatically</a>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some of the material in this chapter assumes that you have already read
<a href="#GIJSZ">Chapter 35, "Enterprise Beans"</a>,
<a href="#GIJRE">Chapter 36, "Getting Started with
Enterprise Beans"</a>, and <a href="#BNBWJ">Chapter 50,
"Introduction to Security in the Jakarta EE Platform"</a>.</p>
</div>
<div class="paragraph">
<p>This section discusses securing a Jakarta EE application where one or more
modules, such as enterprise bean JAR files, are packaged into an EAR file, the
archive file that holds the application. Security annotations will be
used in the Java programming class files to specify authorized users and
basic, or user name/password, authentication.</p>
</div>
<div class="paragraph">
<p>Enterprise beans often provide the business logic of a web application.
In these cases, packaging the enterprise bean within the web
application&#8217;s WAR module simplifies deployment and application
organization. Enterprise beans may be packaged within a WAR module as
Java class files or within a JAR file that is bundled within the WAR
module. When a servlet or JavaServer Faces page handles the web front
end and the application is packaged into a WAR module as a Java class
file, security for the application can be handled in the application&#8217;s
<code>web.xml</code> file. The enterprise bean in the WAR file can have its own deployment
descriptor, <code>ejb-jar.xml</code>, if required. Securing web applications using
<code>web.xml</code> is discussed in <a href="#BNCAS">Chapter 51,
"Getting Started Securing Web Applications"</a>.</p>
</div>
<div class="paragraph">
<p>The following sections describe declarative and programmatic security
mechanisms that can be used to protect enterprise bean resources. The
protected resources include enterprise bean methods that are called from
application clients, web components, or other enterprise beans.</p>
</div>
<div class="paragraph">
<p>For more information on this topic, read the Jakarta Enterprise Beans 3.2
specification. This document can be downloaded from
<code><a href="https://jakarta.ee/specifications/enterprise-beans/3.2/" class="bare">https://jakarta.ee/specifications/enterprise-beans/3.2/</a></code>. Chapter 12 of this specification,
"Security Management," discusses security management for enterprise
beans.</p>
</div>
<div class="paragraph">
<p><a id="GJGDI"></a><a id="securing-an-enterprise-bean-using-declarative-security"></a></p>
</div>
<div class="sect3">
<h4 id="_securing_an_enterprise_bean_using_declarative_security">3.2.1. Securing an Enterprise Bean Using Declarative Security</h4>
<div class="paragraph">
<p>Declarative security enables the application developer to specify which
users are authorized to access which methods of the enterprise beans and
to authenticate these users with basic, or user name/password,
authentication. Frequently, the person who is developing an enterprise
application is not the same person who is responsible for deploying the
application. An application developer who uses declarative security to
define method permissions and authentication mechanisms is passing along
to the deployer a security view of the enterprise beans contained in the
enterprise bean JAR. When a security view is passed on to the deployer, he or she
uses this information to define method permissions for security roles.
If you don&#8217;t define a security view, the deployer will have to determine
what each business method does to determine which users are authorized
to call each method.</p>
</div>
<div class="paragraph">
<p>A security view consists of a set of security roles, a semantic grouping
of permissions that a given type of users of an application must have to
successfully access the application. Security roles are meant to be
logical roles, representing a type of user. You can define method
permissions for each security role. A method permission is a permission
to invoke a specified group of methods of an enterprise bean&#8217;s business
interface, home interface, component interface, and/or web service
endpoints. After method permissions are defined, user name/password
authentication will be used to verify the identity of the user.</p>
</div>
<div class="paragraph">
<p>It is important to keep in mind that security roles are used to define
the logical security view of an application. They should not be confused
with the user groups, users, principals, and other concepts that exist
in GlassFish Server. Note that the Jakarta Security requires that group
principal names be mapped to roles of the same name by default, but that implementations
of the standard may allow configuration of a different default. In GlassFish Server,
you do not need to perform any additional steps to map the roles
defined in the application to users, groups, and principals that are the
components of the user database in the <code>file</code> realm.
This mapping is set by default in the GlassFish Server Administration Console
as described in <a href="#BNBXV">Mapping
Roles to Users and Groups</a>.</p>
</div>
<div class="paragraph">
<p>The following sections show how an application developer uses
declarative security to either secure an application or to create a
security view to pass along to the deployer.</p>
</div>
<div class="paragraph">
<p><a id="GJGCQ"></a><a id="specifying-authorized-users-by-declaring-security-roles"></a></p>
</div>
<div class="sect4">
<h5 id="_specifying_authorized_users_by_declaring_security_roles">Specifying Authorized Users by Declaring Security Roles</h5>
<div class="paragraph">
<p>This section discusses how to use annotations to specify the method
permissions for the methods of a bean class. For more information on
these annotations, refer to Jakarta Annotations
specification at <code><a href="https://jakarta.ee/specifications/annotations/1.3/" class="bare">https://jakarta.ee/specifications/annotations/1.3/</a></code>.</p>
</div>
<div class="paragraph">
<p>Method permissions can be specified on the class, the business methods
of the class, or both. Method permissions can be specified on a method
of the bean class to override the method permissions value specified on
the entire bean class. The following annotations are used to specify
method permissions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@DeclareRoles</code>: Specifies all the roles that the application will
use, including roles not specifically named in a <code>@RolesAllowed</code>
annotation. The set of security roles the application uses is the total
of the security roles defined in the <code>@DeclareRoles</code> and <code>@RolesAllowed</code>
annotations.</p>
<div class="paragraph">
<p>The <code>@DeclareRoles</code> annotation is specified on a bean class, where it
serves to declare roles that can be tested (for example, by calling
<code>isCallerInRole</code>) from within the methods of the annotated class. When
declaring the name of a role used as a parameter to the
<code>isCallerInRole(String roleName)</code> method, the declared name must be the
same as the parameter value.</p>
</div>
<div class="paragraph">
<p>The following example code demonstrates the use of the <code>@DeclareRoles</code>
annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DeclareRoles</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">BusinessAdmin</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Calculator</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The syntax for declaring more than one role is as shown in the following
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DeclareRoles</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">Administrator</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Manager</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Employee</span><span class="delimiter">&quot;</span></span>})</code></pre>
</div>
</div>
</li>
<li>
<p><code>@RolesAllowed("<em>list-of-roles</em>")</code>: Specifies the security roles
permitted to access methods in an application. This annotation can be
specified on a class or on one or more methods. When specified at the
class level, the annotation applies to all methods in the class. When
specified on a method, the annotation applies to that method only and
overrides any values specified at the class level.</p>
<div class="paragraph">
<p>To specify that no roles are authorized to access methods in an
application, use the <code>@DenyAll</code> annotation. To specify that a user in
any role is authorized to access the application, use the <code>@PermitAll</code>
annotation.</p>
</div>
<div class="paragraph">
<p>When used in conjunction with the <code>@DeclareRoles</code> annotation, the
combined set of security roles is used by the application.</p>
</div>
<div class="paragraph">
<p>The following example code demonstrates the use of the <code>@RolesAllowed</code>
annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DeclareRoles</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">Administrator</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Manager</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Employee</span><span class="delimiter">&quot;</span></span>})
<span class="directive">public</span> <span class="type">class</span> <span class="class">Calculator</span> {

    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Administrator</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> setNewRate(<span class="type">int</span> rate) {
        ...
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p><code>@PermitAll</code>: Specifies that all security roles are permitted to
execute the specified method or methods. The user is not checked against
a database to ensure that he or she is authorized to access this
application.</p>
<div class="paragraph">
<p>This annotation can be specified on a class or on one or more methods.
Specifying this annotation on the class means that it applies to all
methods of the class. Specifying it at the method level means that it
applies to only that method.</p>
</div>
<div class="paragraph">
<p>The following example code demonstrates the use of the <code>@PermitAll</code>
annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">javax.annotation.security</span>.*;
<span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">RestrictedUsers</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Calculator</span> {

    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Administrator</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> setNewRate(<span class="type">int</span> rate) {
        <span class="comment">//...</span>
    }
    <span class="annotation">@PermitAll</span>
    <span class="directive">public</span> <span class="type">long</span> convertCurrency(<span class="type">long</span> amount) {
        <span class="comment">//...</span>
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p><code>@DenyAll</code>: Specifies that no security roles are permitted to execute
the specified method or methods. This means that these methods are
excluded from execution in the Jakarta EE container.</p>
<div class="paragraph">
<p>The following example code demonstrates the use of the <code>@DenyAll</code>
annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">javax.annotation.security</span>.*;
<span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Users</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Calculator</span> {
    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Administrator</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> setNewRate(<span class="type">int</span> rate) {
        <span class="comment">//...</span>
    }
    <span class="annotation">@DenyAll</span>
    <span class="directive">public</span> <span class="type">long</span> convertCurrency(<span class="type">long</span> amount) {
        <span class="comment">//...</span>
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following code snippet demonstrates the use of the <code>@DeclareRoles</code>
annotation with the <code>isCallerInRole</code> method. In this example, the
<code>@DeclareRoles</code> annotation declares a role that the enterprise bean
<code>PayrollBean</code> uses to make the security check by using
<code>isCallerInRole("payroll")</code> to verify that the caller is authorized to
change salary data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DeclareRoles</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">payroll</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Stateless</span> <span class="directive">public</span> <span class="type">class</span> <span class="class">PayrollBean</span> <span class="directive">implements</span> Payroll {
    <span class="annotation">@Resource</span> SessionContext ctx;

    <span class="directive">public</span> <span class="type">void</span> updateEmployeeInfo(EmplInfo info) {

        oldInfo = ... read from database;

        <span class="comment">// The salary field can be changed only by callers</span>
        <span class="comment">// who have the security role &quot;payroll&quot;</span>
        <span class="predefined-type">Principal</span> callerPrincipal = ctx.getCallerPrincipal();
        <span class="keyword">if</span> (info.salary != oldInfo.salary &amp;&amp; !ctx.isCallerInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">payroll</span><span class="delimiter">&quot;</span></span>)) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">SecurityException</span>(...);
        }
        ...
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example code illustrates the use of the <code>@RolesAllowed</code>
annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeClass</span> {
    <span class="directive">public</span> <span class="type">void</span> aMethod () {...}
    <span class="directive">public</span> <span class="type">void</span> bMethod () {...}
    ...
}

<span class="annotation">@Stateless</span> <span class="directive">public</span> <span class="type">class</span> <span class="class">MyBean</span> <span class="directive">extends</span> SomeClass <span class="directive">implements</span> A  {

    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">HR</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> aMethod () {...}

    <span class="directive">public</span> <span class="type">void</span> cMethod () {...}
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, assuming that <code>aMethod</code>, <code>bMethod</code>, and <code>cMethod</code> are
methods of business interface <code>A</code>, the method permissions values of
methods <code>aMethod</code> and <code>bMethod</code> are <code>@RolesAllowed("HR")</code> and
<code>@RolesAllowed("admin")</code>, respectively. The method permissions for
method <code>cMethod</code> have not been specified.</p>
</div>
<div class="paragraph">
<p>To clarify, the annotations are not inherited by the subclass itself.
Instead, the annotations apply to methods of the superclass that are
inherited by the subclass.</p>
</div>
<div class="paragraph">
<p><a id="BNBYU"></a><a id="specifying-an-authentication-mechanism-and-secure-connection"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_an_authentication_mechanism_and_secure_connection">Specifying an Authentication Mechanism and Secure Connection</h5>
<div class="paragraph">
<p>When method permissions are specified, basic user name/password
authentication will be invoked by GlassFish Server.</p>
</div>
<div class="paragraph">
<p>To use a different type of authentication or to require a secure
connection using SSL, specify this information in an application
deployment descriptor.</p>
</div>
<div class="paragraph">
<p><a id="GJGCS"></a><a id="securing-an-enterprise-bean-programmatically"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_securing_an_enterprise_bean_programmatically">3.2.2. Securing an Enterprise Bean Programmatically</h4>
<div class="paragraph">
<p>Programmatic security, code that is embedded in a business method, is
used to access a caller&#8217;s identity programmatically and uses this
information to make security decisions within the method itself.</p>
</div>
<div class="paragraph">
<p>In general, security management should be enforced by the container in a
manner that is transparent to the enterprise bean&#8217;s business methods. This section
describes the SecurityContext API and security-related methods of the EJBContext API.
The newer SecurityContext API duplicates some functions of the EJBContext API
because it is intended to provide a consistent API across containers.
These security APIs should be used only in the
less frequent situations in which the enterprise bean business methods
need to access the security context information.</p>
</div>
<div class="paragraph">
<p>The <code>SecurityContext</code> interface, as specified in the Jakarta EE Security API specification,
defines three methods
that allow the bean provider to access security information about the enterprise bean&#8217;s
caller:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getCallerPrincipal()</code> retrieves the <code>Principal</code> that represents the name
of the authenticated caller.
This is the container-specific representation of the caller principal,
and the type may differ from the type of the caller principal originally
established by an <code>HttpAuthenticationMechanism</code>. This method returns null for an
unauthenticated caller. Note that this behavior differs from the behavior of
the <code>EJBContext.getCallerPrincipal()</code> method,
which returns a (vendor-specific) special principal to represent an anonymous caller.</p>
</li>
<li>
<p><code>getPrincipalsByType()</code> retrieves all principals of the given type from the
authenticated caller&#8217;s Subject. This method returns an empty
<code>Set</code> if the caller is unauthenticated, or if the requested type is not found.</p>
<div class="paragraph">
<p>Where both a container caller principal and an application caller principal
are present, the value returned by <code>getName()</code> is the same for both
principals.</p>
</div>
</li>
<li>
<p><code>isCallerInRole()</code> takes a String argument that represents the role to be
tested. The specification does not define how the role determination is made,
but the result must be the same as if the corresponding container-specific call
had been made (for example <code>EJBContext.isCallerInRole()</code>), and must be consistent with
the result implied by specifications that prescribe role-mapping behavior.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>javax.ejb.EJBContext</code> interface provides two methods that allow the
bean provider to access security information about the enterprise bean&#8217;s
caller.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getCallerPrincipal</code> allows the enterprise bean methods to obtain the
current caller principal&#8217;s name. The methods might, for example, use the
name as a key to information in a database. This method never returns null. Instead,
it returns a (vendor-specific) principal with a special  username to indicate
an anonymous/unauthenticated caller.
Note that this behavior differs
from the behavior of the <code>SecurityContext.getCallerPrincipal()</code> method, which
returns null for an unauthenticated caller.</p>
<div class="paragraph">
<p>The following code sample illustrates the use of the
<code>getCallerPrincipal</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span> <span class="directive">public</span> <span class="type">class</span> <span class="class">EmployeeServiceBean</span> <span class="directive">implements</span> EmployeeService {
    <span class="annotation">@Resource</span> SessionContext ctx;
    <span class="annotation">@PersistenceContext</span> EntityManager em;

    <span class="directive">public</span> <span class="type">void</span> changePhoneNumber(...) {
        ...
        <span class="comment">// obtain the caller principal</span>
        callerPrincipal = ctx.getCallerPrincipal();

        <span class="comment">// obtain the caller principal's name</span>
        callerKey = callerPrincipal.getName();

        <span class="comment">// use callerKey as primary key to find EmployeeRecord</span>
        EmployeeRecord myEmployeeRecord =
            em.find(EmployeeRecord.class, callerKey);

        <span class="comment">// update phone number</span>
        myEmployeeRecord.setPhoneNumber(...);

        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the enterprise bean obtains the principal name of the
current caller and uses it as the primary key to locate an
<code>EmployeeRecord</code> entity. This example assumes that application has been
deployed such that the current caller principal contains the primary key
used for the identification of employees (for example, employee number).</p>
</div>
</li>
<li>
<p><code>isCallerInRole</code> allows the developer to code the security checks that
cannot be easily defined using method permissions. Such a check might
impose a role-based limit on a request, or it might depend on
information stored in the database.</p>
<div class="paragraph">
<p>The enterprise bean code can use the <code>isCallerInRole</code> method to test
whether the current caller has been assigned to a given security role.
Security roles are defined by the bean provider or the application
assembler and are assigned by the deployer to principals or principal
groups that exist in the operational environment.</p>
</div>
<div class="paragraph">
<p>The following code sample illustrates the use of the <code>isCallerInRole</code>
method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span> <span class="directive">public</span> <span class="type">class</span> <span class="class">PayrollBean</span> <span class="directive">implements</span> Payroll {
     <span class="annotation">@Resource</span> SessionContext ctx;

     <span class="directive">public</span> <span class="type">void</span> updateEmployeeInfo(EmplInfo info) {

         oldInfo = ... read from database;

         <span class="comment">// The salary field can be changed only by callers</span>
         <span class="comment">// who have the security role &quot;payroll&quot;</span>
         <span class="keyword">if</span> (info.salary != oldInfo.salary &amp;&amp;
             !ctx.isCallerInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">payroll</span><span class="delimiter">&quot;</span></span>)) {
                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">SecurityException</span>(...);
         }
         ...
     }
     ...
 }</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You would use programmatic security in this way to dynamically control
access to a method, for example, when you want to deny access except
during a particular time of day. An example application that uses the
<code>getCallerPrincipal</code> and <code>isCallerInRole</code> methods is described in
<a href="#BNCAA">The converter-secure Example: Securing
an Enterprise Bean with Programmatic Security</a>.</p>
</div>
<div class="paragraph">
<p><a id="BNBYR"></a><a id="propagating-a-security-identity-run-as"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_propagating_a_security_identity_run_as">3.2.3. Propagating a Security Identity (Run-As)</h4>
<div class="paragraph">
<p>You can specify whether a caller&#8217;s security identity should be used for
the execution of specified methods of an enterprise bean or whether a
specific run-as identity should be used. <a href="#BNBZA">Figure 52-1</a>
illustrates this concept.</p>
</div>
<div id="BNBZA" class="paragraph">
<div class="title"><strong>Figure 52-1 Security Identity Propagation</strong></div>
<p><span class="image"><img src="../images/jakartaeett_dt_047.png" alt="Diagram of security identity propagation from client to intermediate container to target container"></span></p>
</div>
<div class="paragraph">
<p>In this illustration, an application client is making a call to an
enterprise bean method in one enterprise bean container. This enterprise bean
method, in turn, makes a call to an enterprise bean method in another
container. The security identity during the first call is the identity
of the caller. The security identity during the second call can be any
of the following options.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By default, the identity of the caller of the intermediate component
is propagated to the target enterprise bean. This technique is used when
the target container trusts the intermediate container.</p>
</li>
<li>
<p>A specific identity is propagated to the target enterprise bean. This
technique is used when the target container expects access using a
specific identity.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To propagate an identity to the target enterprise bean, configure a
run-as identity for the bean, as described in
<a href="#configuring-a-components-propagated-security-identity">Configuring a
Component&#8217;s Propagated Security Identity</a>. Establishing a run-as
identity for an enterprise bean does not affect the identities of its
callers, which are the identities tested for permission to access the
methods of the enterprise bean. The run-as identity establishes the
identity that the enterprise bean will use when it makes calls.</p>
</div>
<div class="paragraph">
<p>The run-as identity applies to the enterprise bean as a whole, including
all the methods of the enterprise bean&#8217;s business interface, local and
remote interfaces, component interface, and web service endpoint
interfaces, the message listener methods of a message-driven bean, the
timeout method of an enterprise bean, and all internal methods of the
bean that might be called in turn.</p>
</div>
<div class="paragraph">
<p><a id="BNBZB"></a><a id="configuring-a-components-propagated-security-identity"></a></p>
</div>
<div class="sect4">
<h5 id="_configuring_a_components_propagated_security_identity">Configuring a Component&#8217;s Propagated Security Identity</h5>
<div class="paragraph">
<p>You can configure an enterprise bean&#8217;s run-as, or propagated, security
identity by using the <code>@RunAs</code> annotation, which defines the role of the
application during execution in a Jakarta EE container. The annotation can
be specified on a class, allowing developers to execute an application
under a particular role. The role must map to the user/group information
in the container&#8217;s security realm. The <code>@RunAs</code> annotation specifies the
name of a security role as its parameter.</p>
</div>
<div class="paragraph">
<p>The following code demonstrates the use of the <code>@RunAs</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunAs</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Admin</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Calculator</span> {
    <span class="comment">//....</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will have to map the run-as role name to a given principal defined
in GlassFish Server if the given roles are associated with more than one
user principal.</p>
</div>
<div class="paragraph">
<p><a id="BNBZC"></a><a id="trust-between-containers"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_trust_between_containers">Trust between Containers</h5>
<div class="paragraph">
<p>When an enterprise bean is designed so that either the original caller
identity or a designated identity is used to call a target bean, the
target bean will receive the propagated identity only. The target bean
will not receive any authentication data.</p>
</div>
<div class="paragraph">
<p>There is no way for the target container to authenticate the propagated
security identity. However, because the security identity is used in
authorization checks (for example, method permissions or with the
<code>isCallerInRole</code> method), it is vitally important that the security
identity be authentic. Because no authentication data is available to
authenticate the propagated identity, the target must trust that the
calling container has propagated an authenticated security identity.</p>
</div>
<div class="paragraph">
<p>By default, GlassFish Server is configured to trust identities that are
propagated from different containers. Therefore, you do not need to take
any special steps to set up a trust relationship.</p>
</div>
<div class="paragraph">
<p><a id="BNBZG"></a><a id="deploying-secure-enterprise-beans"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_deploying_secure_enterprise_beans">3.2.4. Deploying Secure Enterprise Beans</h4>
<div class="paragraph">
<p>The deployer is responsible for ensuring that an assembled application
is secure after it has been deployed in the target operational
environment. If a security view has been provided to the deployer
through the use of security annotations and/or a deployment descriptor,
the security view is mapped to the mechanisms and policies used by the
security domain in the target operational environment, which in this
case is GlassFish Server. If no security view is provided, the deployer
must set up the appropriate security policy for the enterprise bean
application.</p>
</div>
<div class="paragraph">
<p>Deployment information is specific to a web or application server.</p>
</div>
<div class="paragraph">
<p><a id="GKBSZ"></a><a id="examples-securing-enterprise-beans"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_examples_securing_enterprise_beans">3.3. Examples: Securing Enterprise Beans</h3>
<div class="paragraph">
<p>The following examples show how to secure enterprise beans using
declarative and programmatic security.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#the-cart-secure-example-securing-an-enterprise-bean-with-declarative-security">The cart-secure Example: Securing an Enterprise Bean with
Declarative Security</a></p>
</li>
<li>
<p><a href="#the-converter-secure-example-securing-an-enterprise-bean-with-programmatic-security">The converter-secure Example: Securing an Enterprise Bean
with Programmatic Security</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BNBZK"></a><a id="the-cart-secure-example-securing-an-enterprise-bean-with-declarative-security"></a></p>
</div>
<div class="sect3">
<h4 id="_the_cart_secure_example_securing_an_enterprise_bean_with_declarative_security">3.3.1. The cart-secure Example: Securing an Enterprise Bean with Declarative Security</h4>
<div class="paragraph">
<p>This section discusses how to configure an enterprise bean for basic
user name/password authentication. When a bean that is constrained in
this way is requested, the server requests a user name and password from
the client and verifies that the user name and password are valid by
comparing them against a database of authorized users in GlassFish
Server.</p>
</div>
<div class="paragraph">
<p>If the topic of authentication is new to you, see
<a href="#GKBSA">Specifying Authentication
Mechanisms</a>.</p>
</div>
<div class="paragraph">
<p>This example demonstrates security by starting with the unsecured
enterprise bean application, <code>cart</code>, which is found in the
<code><em>tut-install</em>/examples/ejb/cart/</code> directory and is discussed in
<a href="#BNBOD">The cart Example</a>.</p>
</div>
<div class="paragraph">
<p>In general, the following steps are necessary to add user name/password
authentication to an existing application that contains an enterprise
bean. In the example application included with this tutorial, these
steps have been completed for you and are listed here simply to show
what needs to be done should you wish to create a similar application.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an application like the one in
<a href="#BNBOD">The cart Example</a>. The example in
this tutorial starts with this example and demonstrates adding basic
authentication of the client to this application. The example
application discussed in this section can be found at
<code><em>tut-install</em>/examples/security/cart-secure/</code>.</p>
</li>
<li>
<p>If you have not already done so, complete the steps in
<a href="#GJJLK">To Set Up Your System for Running the
Security Examples</a> to configure your system for running the tutorial
applications.</p>
</li>
<li>
<p>Modify the source code for the enterprise bean, <code>CartBean.java</code>, to
specify which roles are authorized to access which protected methods.
This step is discussed in <a href="#BNBZL">Annotating the Bean</a>.</p>
</li>
<li>
<p>Build, package, and deploy the enterprise bean; then build and run
the client application by following the steps in <a href="#BNBZN">To Run the
cart-secure Example Using NetBeans IDE</a> or <a href="#BNBZO">To Run the
cart-secure Example Using Maven</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BNBZL"></a><a id="annotating-the-bean"></a></p>
</div>
<div class="sect4">
<h5 id="_annotating_the_bean">Annotating the Bean</h5>
<div class="paragraph">
<p>The source code for the original <code>cart</code> application was modified as
shown in the following code snippet (modifications in bold). The
resulting file can be found in the file
<code><em>tut-install</em>/examples/security/cart-secure/cart-secure-ejb/src/main/java/jakarta/tutorial/cart/ejb/CartBean.java</code>.</p>
</div>
<div class="paragraph">
<p>The code snippet is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">jakarta.tutorial.cartsecure.ejb</span>;

<span class="keyword">import</span> <span class="include">java.io.Serializable</span>;
<span class="keyword">import</span> <span class="include">java.util.ArrayList</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="keyword">import</span> <span class="include">jakarta.tutorial.cart.util.BookException</span>;
<span class="keyword">import</span> <span class="include">jakarta.tutorial.cart.util.IdVerifier</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.Remove</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.Stateful</span>;
<span class="keyword">import</span> <span class="include">javax.annotation.security.DeclareRoles</span>;
<span class="keyword">import</span> <span class="include">javax.annotation.security.RolesAllowed</span>;

<span class="annotation">@Stateful</span>
<span class="annotation">@DeclareRoles</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CartBean</span> <span class="directive">implements</span> Cart, <span class="predefined-type">Serializable</span> {
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; contents;
    <span class="predefined-type">String</span> customerId;
    <span class="predefined-type">String</span> customerName;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(<span class="predefined-type">String</span> person) <span class="directive">throws</span> BookException {
        <span class="keyword">if</span> (person == <span class="predefined-constant">null</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> BookException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Null person not allowed.</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">else</span> {
            customerName = person;
        }

        customerId = <span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>;
        contents = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(<span class="predefined-type">String</span> person, <span class="predefined-type">String</span> id) <span class="directive">throws</span> BookException {
        <span class="keyword">if</span> (person == <span class="predefined-constant">null</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> BookException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Null person not allowed.</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">else</span> {
            customerName = person;
        }

        IdVerifier idChecker = <span class="keyword">new</span> IdVerifier();

        <span class="keyword">if</span> (idChecker.validate(id)) {
            customerId = id;
        } <span class="keyword">else</span> {
            <span class="keyword">throw</span> <span class="keyword">new</span> BookException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid id: </span><span class="delimiter">&quot;</span></span> + id);
        }

        contents = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
    }

    <span class="annotation">@Override</span>
    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> addBook(<span class="predefined-type">String</span> title) {
        contents.add(title);
    }

    <span class="annotation">@Override</span>
    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> removeBook(<span class="predefined-type">String</span> title) <span class="directive">throws</span> BookException {
        <span class="type">boolean</span> result = contents.remove(title);

        <span class="keyword">if</span> (result == <span class="predefined-constant">false</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> BookException(<span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span> + title + <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="content"> not in cart.</span><span class="delimiter">&quot;</span></span>);
        }
    }

    <span class="annotation">@Override</span>
    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getContents() {
        <span class="keyword">return</span> contents;
    }

    <span class="annotation">@Override</span>
    <span class="annotation">@Remove</span>()
    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> remove() {
        contents = <span class="predefined-constant">null</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@RolesAllowed</code> annotation is specified on methods for which you
want to restrict access. In this example, only users in the role of
<code>TutorialUser</code> will be allowed to add and remove books from the cart and
to list the contents of the cart. A <code>@RolesAllowed</code> annotation
implicitly declares a role that will be referenced in the application;
therefore, no <code>@DeclareRoles</code> annotation is required. The presence of
the <code>@RolesAllowed</code> annotation also implicitly declares that
authentication will be required for a user to access these methods. If
no authentication method is specified in the deployment descriptor, the
type of authentication will be user name/password authentication.</p>
</div>
<div class="paragraph">
<p><a id="BNBZN"></a><a id="to-run-the-cart-secure-example-using-netbeans-ide"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_run_the_cart_secure_example_using_netbeans_ide">To Run the cart-secure Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="#GJJLK">To Set Up
Your System for Running the Security Examples</a>.</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/security</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>cart-secure</code> folder.</p>
</li>
<li>
<p>Select the Open Required Projects check box.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>cart-secure</code> project and
select Build.</p>
<div class="paragraph">
<p>This step builds and packages the application into <code>cart-secure.ear</code>,
located in the <code>cart-secure-ear/target/</code> directory, and deploys this EAR
file to your GlassFish Server instance, retrieves the client stubs, and
runs the client.</p>
</div>
</li>
<li>
<p>In the Login for user: dialog box, enter the user name and password
of a <code>file</code> realm user created in GlassFish Server and assigned to the
group <code>TutorialUser</code>; then click OK.</p>
<div class="paragraph">
<p>If the user name and password you enter are authenticated, the output of
the application client appears in the Output tab:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
Retrieving book title from cart: Infinite Jest
Retrieving book title from cart: Bel Canto
Retrieving book title from cart: Kafka on the Shore
Removing <span class="string"><span class="delimiter">&quot;</span><span class="content">Gravity's Rainbow</span><span class="delimiter">&quot;</span></span> from cart.
Caught a BookException: <span class="string"><span class="delimiter">&quot;</span><span class="content">Gravity's Rainbow</span><span class="delimiter">&quot;</span></span> not in cart.
Java <span class="predefined-type">Result</span>: <span class="integer">1</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the user name and password are not authenticated, the dialog box
reappears until you enter correct values.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BNBZO"></a><a id="to-run-the-cart-secure-example-using-maven"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_run_the_cart_secure_example_using_maven">To Run the cart-secure Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="#GJJLK">To Set Up
Your System for Running the Security Examples</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/security/cart-secure/</code></pre>
</div>
</div>
</li>
<li>
<p>To build the application, package it into an EAR file in the
<code>cart-secure-ear/target</code> subdirectory, deploy it, and run it, enter the
following command at the terminal window or command prompt:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>In the Login for user: dialog box, enter the user name and password
of a <code>file</code> realm user created in GlassFish Server and assigned to the
group <code>TutorialUser</code>; then click OK.</p>
<div class="paragraph">
<p>If the user name and password you enter are authenticated, the output of
the application client appears in the Output tab:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
Retrieving book title from cart: Infinite Jest
Retrieving book title from cart: Bel Canto
Retrieving book title from cart: Kafka on the Shore
Removing <span class="string"><span class="delimiter">&quot;</span><span class="content">Gravity's Rainbow</span><span class="delimiter">&quot;</span></span> from cart.
Caught a BookException: <span class="string"><span class="delimiter">&quot;</span><span class="content">Gravity's Rainbow</span><span class="delimiter">&quot;</span></span> not in cart.
Java <span class="predefined-type">Result</span>: <span class="integer">1</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the user name and password are not authenticated, the dialog box
reappears until you enter correct values.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BNCAA"></a><a id="the-converter-secure-example-securing-an-enterprise-bean-with-programmatic-security"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_converter_secure_example_securing_an_enterprise_bean_with_programmatic_security">3.3.2. The converter-secure Example: Securing an Enterprise Bean with Programmatic Security</h4>
<div class="paragraph">
<p>This example demonstrates how to use the <code>getCallerPrincipal</code> and
<code>isCallerInRole</code> methods with an enterprise bean. This example starts
with a very simple enterprise bean application, <code>converter</code>, and modifies the
methods of the <code>ConverterBean</code> so that currency conversion will occur
only when the requester is in the role of <code>TutorialUser</code>.</p>
</div>
<div class="paragraph">
<p>This example can be found in the
<code><em>tut-install</em>/examples/security/converter-secure</code> directory. This
example is based on the unsecured enterprise bean application,
<code>converter</code>, which is discussed in
<a href="#GIJRE">Chapter 36, "Getting Started with
Enterprise Beans"</a> and is found in the
<code><em>tut-install</em>/examples/ejb/converter/</code> directory. This section builds on
the example by adding the necessary elements to secure the application
by using the <code>getCallerPrincipal</code> and <code>isCallerInRole</code> methods, which
are discussed in more detail in
link:#securing-an-enterprise-bean-programmatically
[Securing an Enterprise Bean Programmatically].</p>
</div>
<div class="paragraph">
<p>In general, the following steps are necessary when using the
<code>getCallerPrincipal</code> and <code>isCallerInRole</code> methods with an enterprise
bean. In the example application included with this tutorial, many of
these steps have been completed for you and are listed here simply to
show what needs to be done should you wish to create a similar
application.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a simple enterprise bean application.</p>
</li>
<li>
<p>Set up a user on GlassFish Server in the <code>file</code> realm, in the group
<code>TutorialUser</code>, and set up default principal to role mapping. To do
this, follow the steps in <a href="#GJJLK">To Set Up
Your System for Running the Security Examples</a>.</p>
</li>
<li>
<p>Modify the bean to add the <code>getCallerPrincipal</code> and <code>isCallerInRole</code>
methods.</p>
</li>
<li>
<p>If the application contains a web client that is a servlet, specify
security for the servlet, as described in
<a href="#GJRMH">Specifying Security for Basic
Authentication Using Annotations</a>.</p>
</li>
<li>
<p>Build, package, deploy, and run the application.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BNCAB"></a><a id="modifying-converterbean"></a></p>
</div>
<div class="sect4">
<h5 id="_modifying_converterbean">Modifying ConverterBean</h5>
<div class="paragraph">
<p>The source code for the original <code>ConverterBean</code> class was modified to
add the <code>if..else</code> clause that tests whether the caller is in the role
of <code>TutorialUser</code>. If the user is in the correct role, the currency
conversion is computed and displayed. If the user is not in the correct
role, the computation is not performed, and the application displays the
result as <code>0</code>. The code example can be found in
<code><em>tut-install</em>/examples/security/converter-secure/converter-secure-ejb/src/main/java/jakarta/tutorial/converter/ejb/ConverterBean.java</code>.</p>
</div>
<div class="paragraph">
<p>The code snippet (with modifications shown in bold) is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">jakarta.tutorial.convertersecure.ejb</span>;

<span class="keyword">import</span> <span class="include">java.math.BigDecimal</span>;
<span class="keyword">import</span> <span class="include">java.security.Principal</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.Stateless</span>;
<span class="keyword">import</span> <span class="include">javax.annotation.Resource</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.SessionContext</span>;
<span class="keyword">import</span> <span class="include">javax.annotation.security.DeclareRoles</span>;
<span class="keyword">import</span> <span class="include">javax.annotation.security.RolesAllowed</span>;

<span class="annotation">@Stateless</span>()
<span class="annotation">@DeclareRoles</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ConverterBean</span>{

    <span class="annotation">@Resource</span> SessionContext ctx;
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">BigDecimal</span> yenRate = <span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">104.34</span><span class="delimiter">&quot;</span></span>);
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">BigDecimal</span> euroRate = <span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">0.007</span><span class="delimiter">&quot;</span></span>);

    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>)
     <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> dollarToYen(<span class="predefined-type">BigDecimal</span> dollars) {
        <span class="predefined-type">BigDecimal</span> result = <span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">0.0</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">Principal</span> callerPrincipal = ctx.getCallerPrincipal();
        <span class="keyword">if</span> (ctx.isCallerInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>)) {
            result = dollars.multiply(yenRate);
            <span class="keyword">return</span> result.setScale(<span class="integer">2</span>, <span class="predefined-type">BigDecimal</span>.ROUND_UP);
        } <span class="keyword">else</span> {
            <span class="keyword">return</span> result.setScale(<span class="integer">2</span>, <span class="predefined-type">BigDecimal</span>.ROUND_UP);
        }
    }

    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> yenToEuro(<span class="predefined-type">BigDecimal</span> yen) {
        <span class="predefined-type">BigDecimal</span> result = <span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">0.0</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">Principal</span> callerPrincipal = ctx.getCallerPrincipal();
        <span class="keyword">if</span> (ctx.isCallerInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>)) {
             result = yen.multiply(euroRate);
             <span class="keyword">return</span> result.setScale(<span class="integer">2</span>, <span class="predefined-type">BigDecimal</span>.ROUND_UP);
        } <span class="keyword">else</span> {
             <span class="keyword">return</span> result.setScale(<span class="integer">2</span>, <span class="predefined-type">BigDecimal</span>.ROUND_UP);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GKBSI"></a><a id="modifying-converterservlet"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_modifying_converterservlet">Modifying ConverterServlet</h5>
<div class="paragraph">
<p>The following annotations specify security for the <code>converter</code> web
client, <code>ConverterServlet</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(urlPatterns = {<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>})
<span class="annotation">@ServletSecurity</span>(
<span class="annotation">@HttpConstraint</span>(transportGuarantee = TransportGuarantee.CONFIDENTIAL,
    rolesAllowed = {<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>}))</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="BNCAD"></a><a id="to-run-the-converter-secure-example-using-netbeans-ide"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_run_the_converter_secure_example_using_netbeans_ide">To Run the converter-secure Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="#GJJLK">To Set Up
Your System for Running the Security Examples</a>.</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/security</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>converter-secure</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>Right-click the <code>converter-secure</code> project and select Build.</p>
<div class="paragraph">
<p>This command builds and deploys the example application to your
GlassFish Server instance.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BNCAE"></a><a id="to-run-the-converter-secure-example-using-maven"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_run_the_converter_secure_example_using_maven">To Run the converter-secure Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="#GJJLK">To Set Up
Your System for Running the Security Examples</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/security/converter-secure/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file,
<code>converter-secure.war</code>, that is located in the <code>target</code> directory, and
deploys the WAR file.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GJTDP"></a><a id="to-run-the-converter-secure-example"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_to_run_the_converter_secure_example">To Run the converter-secure Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a web browser to the following URL:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/converter-secure</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An Authentication Required dialog box appears.</p>
</div>
</li>
<li>
<p>Enter a user name and password combination that corresponds to a
user who has already been created in the <code>file</code> realm of GlassFish
Server and has been assigned to the group <code>TutorialUser</code>; then click OK.</p>
</li>
<li>
<p>Enter <code>100</code> in the input field and click Submit.</p>
<div class="paragraph">
<p>A second page appears, showing the converted values.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_jakarta_security">4. Using Jakarta Security</h2>
<div class="sectionbody">
<div id="using-the-jakarta-ee-security-api" class="paragraph">
<p>This chapter describes the authentication and credential validation
functionality provided by Jakarta Security. The API also
defines a SecurityContext access point for programmatic security.</p>
</div>
<div class="sect2">
<h3 id="about-the-jakarta-ee-security-api">4.1. About Jakarta Security</h3>
<div class="paragraph">
<p>Jakarta EE includes support for Jakarta Security, which defines portable, plug-in interfaces
for authentication and identity stores, and a new injectable-type SecurityContext
interface that provides an access point for programmatic security. You can use
the built-in implementations of these APIs, or define custom
implementations.</p>
</div>
<div class="paragraph">
<p>Jakarta Security contains the following packages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>javax.security.enterprise</code> package is the main Jakarta Security package
and contains classes and interfaces that span authentication, authorization, and
identity concerns. <a href="#main-classes-and-interfaces-in-enterprise">Table 51-1</a> lists
the main class and interfaces in this package.</p>
</li>
<li>
<p>The <code>javax.security.enterprise.authentication.mechanism.http</code> package contains
classes and interfaces associated with HTTP-based authentication mechanisms that
can interact with a caller or third-parties as part of an authentication protocol.
<a href="#main-classes-and-interfaces-in-authentication">Table 51-2</a> lists the main classes
and interfaces in this package.</p>
</li>
<li>
<p>The <code>javax.javax.security.enterprise.credential</code> package contains classes and
interfaces for representing user credentials. <a href="#main-classes-and-interfaces-in-credential">Table 51-3</a>
lists the main classes and interfaces in this package.</p>
</li>
<li>
<p>The <code>javax.security.enterprise.identitystore</code> package contains classes and
interfaces associated with identity stores that validate a caller&#8217;s credentials
and lookup caller groups. <a href="#main-classes-and-interfaces-in-identitystore">Table 51-4</a>
lists the main classes and interfaces in this package.</p>
</li>
</ul>
</div>
<div id="main-classes-and-interfaces-in-enterprise" class="paragraph">
<p><strong>Table 51-1  Main Classes and Interfaces in javax.security.enterprise</strong></p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class or Interface</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SecurityContext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Injectable-type interface that provides an access point for
programmatic security intended to be used by application code to query and interact
with the Jakarta EE Security API.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CallerPrincipal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Principal type that can represent the identity of the
application caller.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthenticationStatus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enum used to indicate the return value from an authentication
mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthenticationException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that a problem occurred during the
authentication process.</p></td>
</tr>
</tbody>
</table>
<div id="main-classes-and-interfaces-in-authentication" class="paragraph">
<p><strong>Table 51-2 Main Classes and Interfaces in javax.security.enterprise.authentication.mechanism.http</strong></p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class or Interface</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpAuthenticationMechanism</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface representing an HTTP authentication mechanism.
Developers can provide their own implementation of this interface, or use one of
several built-in HTTP authentication mechanisms.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpMessageContext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface representing the parameters passed to/from methods
of an <code>HttpAuthenticationMechanism</code> at runtime.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthenticationParameters</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class that carries parameters passed to the
<code>SecurityContext.authenticate()</code> method.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpMessageContextWrapper</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract class developers can extend to
customize <code>HttpMessageContext</code> behavior.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Note:</strong>
The <code>javax.security.enterprise.authentication.mechanism.http</code> package also includes
a number of annotation classes that are used to configure/enable the built-in
authentication mechanisms or to modify the behavior of an authentication mechanism.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div id="main-classes-and-interfaces-in-credential" class="paragraph">
<p><strong>Table 51-3 Main Classes and Interfaces in javax.security.enterprise.credential</strong></p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class or Interface</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Credential</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface that represents a generic credential and defines
several methods to operate on credentials. All other classes in this package
are implementations of the Credential interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AbstractClearableCredential</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract class implementing behavior common to
Credentials that can be meaningfully cleared.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BasicAuthenticationCredential</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class that extends <code>UsernamePasswordCredential</code>
to represent credentials used by HTTP Basic Authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CallerOnlyCredential</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Credential that contains a caller name only; can be
used to assert an identity, but not to authenticate a user, due to the lack of
any secret or other credential that can be validated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class that represents a text-based password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RememberMeCredential</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class that represents a credential presented as a token,
for the explicit usage with the JSR 375 remember me function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UsernamePasswordCredential</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class that represents the credentials typically
used by standard caller name/password authentication.</p></td>
</tr>
</tbody>
</table>
<div id="main-classes-and-interfaces-in-identitystore" class="paragraph">
<p><strong>Table 51-4 Main Classes and Interfaces in javax.security.enterprise.identitystore</strong></p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class or Interface</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IdentityStore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface representing an Identity Store.
Developers can provide their own implementation of this interface, or use one of
the built-in Identity Stores.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IdentityStoreHandler</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface that defines the method applications use to
interact with Identity Stores. Applications can use the built-in
IdentityStoreHandler, or supply their own implementation if custom behavior is desired.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PasswordHash</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface defining methods for generating and
validating password hashes, needed to securely validate passwords when using
the built-in Database Identity Store. Developers can implement this interface
to generate/validate password hashes using any desired algorithm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Pbkdf2PasswordHash</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marker interface implemented by the built-in PBKDF2
PasswordHash implementation. Developers can use this interface to select the
built-in PBKDF2 algorithm when configuring the Database Identity Store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RememberMeIdentityStore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface defining a special type of Identity Store,
used in conjunction with the RememberMe annotation to provide RememberMe
behavior for an application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CredentialValidationResult</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class that represents the result from an attempt
to validate a Credential.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IdentityStorePermission</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission required to invoke the <code>getGroups</code> method of an
IdentityStore, when a SecurityManager is configured.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="overview-of-the-http-authentication-mechanism-interface">4.2. Overview of the HTTP Authentication Mechanism Interface</h3>
<div class="paragraph">
<p>The <code>HttpAuthenticationMechanism</code> interface defines an SPI for writing
authentication mechanisms that can be provided with an application and
deployed using CDI. Developers can write their own implementations of <code>HttpAuthenticationMechanism</code>
to support specific authentication token types or protocols. There are also several
built-in authentication mechanisms that perform BASIC, FORM, and Custom FORM
authentication.</p>
</div>
<div class="paragraph">
<p>The built-in authentication mechanisms are enabled and configured through the use
of one of the following annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BasicAuthenticationMechanismDefinition&#8201;&#8212;&#8201;implements BASIC authentication that
conforms to the behavior of the servlet container when BASIC &lt;auth-method&gt; is
declared in web.xml.</p>
</li>
<li>
<p>FormAuthenticationMechanismDefinition&#8201;&#8212;&#8201;implements FORM authentication that
conforms to the behavior of the servlet container when the FORM &lt;auth-method&gt;
is declared in web.xml.</p>
</li>
<li>
<p>CustomFormAuthenticationMechanismDefinition&#8201;&#8212;&#8201;implements a modified version of
FORM authentication in which custom handling replaces the POST to j_security_check.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An implementation of HttpAuthenticationMechanism must be a CDI bean to be
recognized and deployed at runtime, and is assumed to be normal scoped.
During bean discovery, the servlet container looks for a bean that implements
<code>HttpAuthenticationMechanism</code>&#8201;&#8212;&#8201;there should be only one per application&#8201;&#8212;&#8201;and,
if found, arranges for it to be deployed to authenticate the application&#8217;s callers.</p>
</div>
<div class="paragraph">
<p>The servlet container leverages Jakarta Authentication  to deploy authentication mechanisms.
The container provides a Jakarta Authentication Server Auth Module (SAM) that can delegate to an
<code>HttpAuthenticationMechanism</code>, and arranges for that "bridge" SAM to be registered
with the Jakarta Authentication <code>AuthConfigFactory</code>. At runtime, normal Jakarta Authentication processing invokes
the bridge SAM, which then delegates to the <code>HttpAuthenticationMechanism</code> to
perform the authentication and drive any necessary dialog with the caller, or with
third parties involved in the authentication protocol flow.</p>
</div>
<div class="paragraph">
<p>The HttpAuthenticationMechanism interface defines the following three methods,
which correspond to the three methods defined by the Jakarta Authentication ServerAuth interface.
When one of the Jakarta Authentication methods is invoked on the bridge SAM, it delegates to the
corresponding method of the <code>HttpAuthenticationMechanism</code>. Although the method names
are identical, the method signatures are not; the bridge SAM maps back and forth
between the parameters passed to it by the Jakarta Authentication framework, and the parameters
expected by an <code>HttpAuthenticationMechanism</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>validateRequest()</code>&#8201;&#8212;&#8201;validate an incoming request and authenticates the caller.</p>
</li>
<li>
<p><code>secureResponse()</code>&#8201;&#8212;&#8201;(optional if default is sufficient) secure a response message.</p>
</li>
<li>
<p><code>cleanSubject()</code>&#8201;&#8212;&#8201;(optional if default is sufficient) clear the provided Subject of
principals and credentials.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only the <code>validateRequest()</code> method must be implemented by an <code>HttpAuthenticationMechanism</code>;
the interface includes default implementations for secureResponse()` and <code>cleanSubject()</code> that will
often be sufficient.</p>
</div>
<div class="paragraph">
<p>The following annotations can be used to add additional behaviors to an <code>HttpAuthenticationMechanism</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AutoApplySession</code>&#8201;&#8212;&#8201;indicates that the Jakarta Authentication <code>registerSession</code> functionality
should be enabled such that the the caller&#8217;s authenticated identity is
persisted in the caller&#8217;s servlet session.</p>
</li>
<li>
<p><code>LoginToContinue</code>&#8201;&#8212;&#8201;mechanism to specify properties for FORM login&#8201;&#8212;&#8201;login page, error page, etc. The built-in FORM authentication mechanisms use
LoginToContinue to configure the necessary parameters.</p>
</li>
<li>
<p><code>RememberMe</code>&#8201;&#8212;&#8201;specifies that a <code>RememberMe</code> identity store should be used to
enable <code>RememberMe</code> functionality for the authentication mechanism.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="overview-of-the-identity-store-interfaces">4.3. Overview of the Identity Store Interfaces</h3>
<div class="paragraph">
<p>The Identity Store Interfaces are described in the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#the-identitystore-interface">The IdentityStore Interface</a></p>
</li>
<li>
<p><a href="#the-remembermeidentitystore-interface">The RememberMeIdentityStore Interface</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="the-identitystore-interface">4.3.1. The IdentityStore Interface</h4>
<div class="paragraph">
<p>The <code>IdentityStore</code> interface defines an SPI for interacting with identity stores,
which are directories or databases containing user account information.
An implementation of the <code>IdentityStore</code> interface can validate users' credentials,
provide information about the groups they belong to, or both. Most often, an
<code>IdentityStore</code> implementation will interact with an external identity store&#8201;&#8212;&#8201;an LDAP server, for example&#8201;&#8212;&#8201;to perform the actual credential validation and
group lookups, but an <code>IdentityStore</code> may also manage user account data itself.</p>
</div>
<div class="paragraph">
<p>There are two built-in implementations of <code>IdentityStore</code>: an LDAP identity store,
and a Database identity store. These identity stores delegate to external stores
that must already exist; the IdentityStore implementations do not provide or
manage the external store. They are configured with the parameters necessary
to communicate with an external store using the following annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>LdapIdentityStoreDefinition</code>&#8201;&#8212;&#8201;configures an identity store with the parameters
necessary to communicate with an external LDAP server, validate user credentials,
and/or lookup user groups.</p>
</li>
<li>
<p><code>DatabaseIdentityStoreDefinition</code>&#8201;&#8212;&#8201;configures an identity store with the
parameters necessary to connect to an external database, validate user credentials,
and/or lookup user groups. You must supply a PasswordHash implementation when
configuring a Database Identity Store. See <a href="#the-passwordhash-interface">The PasswordHash Interface</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An application can provide its own custom identity store, or use the built-in LDAP or database
identity stores. For examples of both types, see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#running-the-built-in-database-identity-store-example">Running the Built-In Database Identity Store Example</a></p>
</li>
<li>
<p><a href="#running-the-custom-identity-store-example">Running the Custom Identity Store Example</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An implementation of <code>IdentityStore</code> must be a
CDI bean to be recognized and deployed at runtime, and is assumed to be normal scoped.
IdentityStores are primarily intended for use by implementations of
<code>HttpAuthenticationMechanisms</code>, but this is not a requirement.
They can be used by other types of authentication mechanisms as well, or by containers.</p>
</div>
<div class="paragraph">
<p>Multiple implementations of <code>IdentityStore</code> may be present. If so, they are invoked
under the control of an <code>IdentityStoreHandler</code>.</p>
</div>
<div class="sect4">
<h5 id="identitystorehandler">IdentityStoreHandler</h5>
<div class="paragraph">
<p>Authentication mechanisms do not interact with <code>IdentityStore</code> directly; instead,
they call an <code>IdentityStoreHandler</code>. An implementation of the <code>IdentityStoreHandler</code>
interface provides a single method, <code>validate(Credential)</code>, which, when invoked,
iterates over the available IdentityStores and returns an aggregated result.
An <code>IdentityStoreHandler</code> must also be a CDI bean, and is assumed to be normal scoped.
At runtime, an authentication mechanism injects the <code>IdentityStoreHandler</code> and
invokes on it. The <code>IdentityStoreHandler</code>, in turn, looks up the available IdentityStores
and invokes on them to determine the aggregate result.</p>
</div>
<div class="paragraph">
<p>There is a built-in <code>IdentityStoreHandler</code> that implements a standard algorithm
defined by Jakarta Security. The Jakarta Security specification provides a full description of
the algorithm, but it can be roughly summarized as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Iterate over the available validating IdentityStores, in priority order,
until the provided Credential is validated or there are no more IdentityStores.</p>
</li>
<li>
<p>If the Credential was validated, iterate over the available group-providing
IdentityStores, in priority order, aggregating the groups returned by each store.</p>
</li>
<li>
<p>Return the validated caller and group information.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An application may also supply its own <code>IdentityStoreHandler</code>, which can use any
desired algorithm to select and invoke on IdentityStores, and return an
aggregated (or non-aggregated) result.</p>
</div>
</div>
<div class="sect4">
<h5 id="identitystoreinterface-methods">IdentityStore Interface Methods</h5>
<div class="paragraph">
<p>The IdentityStore interface itself has four methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>validate(Credential)</code>&#8201;&#8212;&#8201;validate a Credential, and return the result of that
validation.</p>
</li>
<li>
<p><code>getCallerGroups(CredentialValidationResult)</code>&#8201;&#8212;&#8201;return the groups associated
with the caller indicated by the supplied <code>CredentialValidationResult</code>, which
represents the result of a previous, successful validation.</p>
</li>
<li>
<p><code>validationTypes()</code>&#8201;&#8212;&#8201;returns a Set of validation types (one or more of
<code>VALIDATE</code>, <code>PROVIDE_GROUPS</code>)
that indicate the operations supported by this instance of the <code>IdentityStore</code>.</p>
</li>
<li>
<p><code>priority()</code>&#8201;&#8212;&#8201;returns a positive integer representing the self-declared
priority of this IdentityStore. Lower values represent higher priority.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because <code>getCallerGroups()</code> is a sensitive operation&#8201;&#8212;&#8201;it can return information
about arbitrary users, and does not require that the caller provide the user&#8217;s
credential or proof of identity&#8201;&#8212;&#8201;the caller should have the
<code>IdentityStorePermission("getGroups")</code> permission. Enforcement of this check is
incumbent on the implementation of the <code>getCallerGroups()</code> method; the built-in
IdentityStores do check for this permission, if a SecurityManager is configured,
and the built-in IdentityStoreHandler invokes the <code>getCallerGroups()</code> method in
the context of a <code>PrivilegedAction</code> block.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-passwordhash-interface">The PasswordHash Interface</h5>
<div class="paragraph">
<p>Unlike some types of identity stores, for example LDAP directories,
databases can store and retrieve user passwords, but can&#8217;t verify them natively.
Therefore, the built-in Database identity store must verify user passwords itself.
Most often, this involves generating a hash of the user&#8217;s password for comparison
with a hash value stored in the database.</p>
</div>
<div class="paragraph">
<p>In order to provide maximum flexibility and interoperability, the Database identity
store does not implement any specific password hashing algorithms. Instead, it
defines the <code>PasswordHash</code> interface, and expects the application to provide an
implementation of <code>PasswordHash</code> that can verify passwords from the specific store
the application will use. The <code>PasswordHash</code> implementation must be made available
as a dependent-scoped bean, and is configured by providing the fully-qualified
name of the desired type as the <code>hashAlgorithm</code> value on a <code>DatabaseIdentityStoreDefinition</code>.</p>
</div>
<div class="paragraph">
<p>The <code>PasswordHash</code> algorithm defines three methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initialize(Map&lt;String,String&gt; parameters)</code>&#8201;&#8212;&#8201;initialize the PasswordHash with
the supplied Map of parameters. The Database identity store calls this method when
initializing, passing the <code>hashAlgorithmParameters</code> value of the
<code>DatabaseIdentityStoreDefinition</code> annotation (after conversion to a Map).</p>
</li>
<li>
<p><code>verify(char[] password, String hashedPassword)</code>&#8201;&#8212;&#8201;verify a caller-supplied
password against the caller&#8217;s stored password hash as retrieved from the database.
The <code>hashedPassword</code> value should be provided exactly as it was returned from the database.</p>
</li>
<li>
<p><code>generate(char[] password)</code>&#8201;&#8212;&#8201;generate a password hash from the supplied password.
The value returned should be formatted and encoded exactly it would be stored
in the database. While it is useful to generate the hash of a caller-supplied password
during <code>verify()</code>, this method is intended primarily for use by applications or
<code>IdentityStore</code> implementations that want to support password management/reset
capability without having to duplicate the code used to verify passwords.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that, while the interface is oriented toward hashing passwords, it can also
support alternative approaches, such as two-way encryption of stored passwords.</p>
</div>
<div class="paragraph">
<p>There is a built-in <code>Pbkdf2PasswordHash</code> implementation that supports, as it&#8217;s
name suggests, PBKDF2 password hashing. It supports several parameters that
control the generation of hash values
(key size, iterations, and so on&#8201;&#8212;&#8201;see the Javadoc),
and those parameters are encoded into the resulting hash value, so that hashes
can be verified even if the currently configured parameters are different from
the parameters in effect when a stored hash was generated.</p>
</div>
<div class="paragraph">
<p>While it is necessary to write a custom <code>PasswordHash</code> to enable interoperability
with a legacy identity store that stores password hashes in a format other
than the <code>Pbkdf2PasswordHash</code> format, developers should consider carefully
whether <code>Pbkdf2PasswordHash</code> is sufficient for new identity stores, and avoid
writing a new PasswordHash implementation without a solid understanding of the
cryptographic and other security considerations involved. Some of the
considerations specific to password hashing are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The requirements for hashing passwords differ considerably from the requirements
for hashing in other contexts. In particular, speed is normally a virtue when
generating hashes, but when generating password hashes, slower is better&#8201;&#8212;&#8201;to
slow down brute force attacks against hashed values.</p>
</li>
<li>
<p>The comparison of a generated hash with a stored hash should take constant time,
whether it succeeds or fails, in order to avoid giving an attacker clues about
the password value based on the timing of failed attempts.</p>
</li>
<li>
<p>A new random salt should be used each time a new password hash value is generated.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-remembermeidentitystore-interface">4.3.2. The RememberMeIdentityStore Interface</h4>
<div class="paragraph">
<p>The <code>RememberMeIdentityStore</code> interface represents a special type of identity store.
It is not directly related to the <code>IdentityStore</code> interface; that is, it does not
implement or extend it. It does, however, perform a similar, albeit specialized, function.</p>
</div>
<div class="paragraph">
<p>In some cases, an application wants to "remember" a user&#8217;s authenticated session
for an extended period. For example, a web site may remember you when you visit,
and prompt for your password only periodically, perhaps once every two weeks,
as long as you don&#8217;t explicitly log out.</p>
</div>
<div class="paragraph">
<p>RememberMe works as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a request from an unauthenicated user is received, the user is authenticated
using an <code>HttpAuthenticationMechanism</code> that is provided by the application
(this is required&#8201;&#8212;&#8201;<code>RememberMeIdentityStore</code> can only be used in conjunction with an
  application-supplied <code>HttpAuthenticationMechanism</code>).</p>
</li>
<li>
<p>After authentication, the configured <code>RememberMeIdentityStore</code> saves information
about the user&#8217;s authenticated identity, so that it be restored later, and
generates a long-lived "remember me" login token that is sent back to the client,
perhaps as a cookie.</p>
</li>
<li>
<p>On a subsequent visit to the application, the client presents the login token.
The <code>RememberMeIdentityStore</code> then validates the token and returns the stored user
identity, which is then established as the user&#8217;s authenticated identity.
If the token is invalid or expired, it is discarded, the user is authenticated
normally again, and a new login token is generated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>RememberMeIdentityStore</code> interface defines the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>generateLoginToken(CallerPrincipal caller, Set&lt;String&gt; groups)</code>&#8201;&#8212;&#8201;generate a
login token for a newly authenticated user, and associate it with the provided
caller/group information.</p>
</li>
<li>
<p><code>removeLoginToken(String token)</code>&#8201;&#8212;&#8201;remove the (presumably expired or invalid)
login token and any associated caller/group information.</p>
</li>
<li>
<p><code>validate(RememberMeCredential credential)</code>&#8201;&#8212;&#8201;validate the supplied credential, and,
if valid, return the associated caller/group information. (<code>RememberMeCredential</code> is
  essentially just a holder for a login token).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An implementation of <code>RememberMeIdentityStore</code> must be a CDI bean, and is assumed
to be normal scoped. It is configured by adding a <code>RememberMe</code> annotation to an
application&#8217;s <code>HttpAuthenticationMechanism</code>, which indicates that a
<code>RememberMeIdentityStore</code> is in use, and provides related configuration parameters.
A container-supplied interceptor then intercepts calls to the <code>HttpAuthenticationMechanism</code>,
invokes the <code>RememberMeIdentityStore</code> as necessary before and after calls to the
authentication mechanism, and ensures that the user&#8217;s identity is correctly
set for the session. The Jakarta Security specification provides a detailed description
of the required interceptor behavior.</p>
</div>
<div class="paragraph">
<p>Implementations of <code>RememberMeIdentityStore</code> should take care to manage tokens
and user identity information securely. For example, login tokens should not
contain sensitive user information, like credentials or sensitive attributes,
to avoid exposing that information if an attacker were able to gain access
to the token&#8201;&#8212;&#8201;even an encrypted token is potentially vulnerable to an
attacker with sufficient time/resources. Similarly, tokens should be
encrypted/signed wherever possible, and sent only over secure channels (HTTPS).
User identity information managed by a <code>RememberMeIdentityStore</code> should be stored
as securely as possible (but does not necessarily need to be reliably persisted&#8201;&#8212;&#8201;the only impact of a "forgotten" session is that the user will be prompted to
log in again).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-the-built-in-database-identity-store-example">4.4. Running the Built-In Database Identity Store Example</h3>
<div class="paragraph">
<p>The example described in this section demonstrates how to use the built-in database
identity store for credential validation.</p>
</div>
<div class="paragraph">
<p>Topics include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#overview-of-the-built-in-database-identity-store-example">Overview of the Built-In Database Identity Store Example</a></p>
</li>
<li>
<p><a href="#running-the-built-in-db-id-store-example">Running the built-in-db-identity-store Example</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="overview-of-the-built-in-database-identity-store-example">4.4.1. Overview of the Built-In Database Identity Store Example</h4>
<div class="paragraph">
<p>Jakarta Security mandates that a Jakarta EE container MUST support a built-in <code>IdentityStore</code>
backed by a database. To support this mandatory requirement, <code>DatabaseIdentityStore</code>
is bundled with GlassFish.</p>
</div>
<div class="paragraph">
<p>This example demonstrates how you can configure a <code>DatabaseIdentityStore</code> to point
to a backend database and then use it as an IdentityStore. The authentication mechanism used is
<code>BasicAuthenticationMechanism</code>.</p>
</div>
<div class="paragraph">
<p>The source code for this example is in the
<code><em>tut-install</em>/examples/security/security-api/built-in-db-identity-store</code> directory.</p>
</div>
<div class="paragraph">
<p>The following sections describe the high-level process for configuring the
<code>DatabaseIdentityStore</code>. Note that the configuration described in these sections has
already been completed in the application files, but is provided here to illustrate
what you need to do to use the built-in database identity store.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#define-the-users-and-groups-in-the-identity-store">Define the Users and Groups in the Identity Store</a></p>
</li>
<li>
<p><a href="#map-the-databaseidentitystore-to-the-default-data-source">Map the DatabaseIdentityStore to the Default Data source</a></p>
</li>
<li>
<p><a href="#specify-the-authentication-mechanism">Specify the Authentication Mechanism</a></p>
</li>
<li>
<p><a href="#declare-roles-in-the-servlet-container">Declare Roles in the Servlet Container</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a request that includes credentials is sent to the application,
it triggers the configured authentication mechanism
and authentication is performed against the <code>DatabaseIdentityStore</code> as defined
in the application.</p>
</div>
<div class="paragraph">
<p>Post authentication, the application also verifies the roles the caller is in
and sends the details as part of the response.</p>
</div>
<div class="paragraph">
<p>Note that in GlassFish, if the user provides the wrong credentials when using
<code>BasicAuthenticationMechanism</code>, then the <code>realmName</code>
is presented to user, as a hint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">curl -I -u Joe http:<span class="comment">//localhost:8080/built-in-db-identity-store/servlet</span>
Enter host password <span class="keyword">for</span> user <span class="string"><span class="delimiter">'</span><span class="content">Joe</span><span class="delimiter">'</span></span>:
HTTP/<span class="float">1.1</span> <span class="integer">401</span> Unauthorized
Server: GlassFish Server Open <span class="predefined-type">Source</span> Edition  <span class="float">5.0</span>
X-Powered-By: Servlet/<span class="float">3.1</span> JSP/<span class="float">2.3</span> (GlassFish Server Open <span class="predefined-type">Source</span> Edition  <span class="float">5.0</span>  Java/Oracle Corporation/<span class="float">1.8</span>)
WWW-Authenticate: Basic realm=<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span>
Content-Length: <span class="integer">1090</span>
Content-Language:
Content-<span class="predefined-type">Type</span>: text/html</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="define-the-users-and-groups-in-the-identity-store">Define the Users and Groups in the Identity Store</h5>
<div class="paragraph">
<p>The following table shows the users, passwords, and groups used in this example.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 40%;">
<colgroup>
<col style="width: 30%;">
<col style="width: 40%;">
<col style="width: 30%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>User</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Password</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Group</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Joe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">foo, bar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sam</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">foo, bar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">foo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">foo</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following code shows how to define credentials and the roles assigned to
users in the  <code>DatabaseSetup.java</code> file.</p>
</div>
<div class="paragraph">
<p>With <code>@Startup</code> annotation, this singleton enterprise bean is initialized during
application startup and the credentials are set in the underlying database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.sql.Connection</span>;
<span class="keyword">import</span> <span class="include">java.sql.PreparedStatement</span>;
<span class="keyword">import</span> <span class="include">java.sql.SQLException</span>;

<span class="keyword">import</span> <span class="include">javax.annotation.PostConstruct</span>;
<span class="keyword">import</span> <span class="include">javax.annotation.PreDestroy</span>;
<span class="keyword">import</span> <span class="include">javax.annotation.Resource</span>;
<span class="keyword">import</span> <span class="include">javax.annotation.sql.DataSourceDefinition</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.Singleton</span>;
<span class="keyword">import</span> <span class="include">javax.ejb.Startup</span>;
<span class="keyword">import</span> <span class="include">javax.sql.DataSource</span>;

<span class="annotation">@Singleton</span>
<span class="annotation">@Startup</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">DatabaseSetup</span> {

    <span class="comment">// The default datasource that is bundled with GlassFish is used to store // credentials.</span>
    <span class="annotation">@Resource</span>(lookup=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/DefaultDataSource</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">DataSource</span> dataSource;

    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> <span class="type">void</span> init() {

        <span class="comment">// ...</span>
        executeUpdate(dataSource, <span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO caller VALUES('Joe', '</span><span class="delimiter">&quot;</span></span> + passwordHash.generate(<span class="string"><span class="delimiter">&quot;</span><span class="content">secret1</span><span class="delimiter">&quot;</span></span>.toCharArray()) + <span class="string"><span class="delimiter">&quot;</span><span class="content">')</span><span class="delimiter">&quot;</span></span>);
        <span class="comment">// ...</span>
        executeUpdate(dataSource, <span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO caller_groups VALUES('Joe', 'foo')</span><span class="delimiter">&quot;</span></span>);
        executeUpdate(dataSource, <span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO caller_groups VALUES('Joe', 'bar')</span><span class="delimiter">&quot;</span></span>);
        <span class="comment">// ...</span>
    }

    <span class="annotation">@PreDestroy</span>
    <span class="directive">public</span> <span class="type">void</span> destroy() {
            <span class="comment">// ...</span>
    }

    <span class="directive">private</span> <span class="type">void</span> executeUpdate(<span class="predefined-type">DataSource</span> dataSource, <span class="predefined-type">String</span> query) {
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="map-the-databaseidentitystore-to-the-default-data-source">Map the DatabaseIdentityStore to the Default Data source</h5>
<div class="paragraph">
<p>Use the <code>@DatabaseIdentityStoreDefinition</code> annotation to map the built-in <code>DatabaseIdentityStore</code>
to the <code>DefaultDataSource</code> in
the <code>ApplicationConfig.java</code> file. This example also demonstrates the use of the
<code>Pbkdf2PasswordHash</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Database Definition for built-in DatabaseIdentityStore</span>
<span class="annotation">@DatabaseIdentityStoreDefinition</span>(
    callerQuery = <span class="string"><span class="delimiter">&quot;</span><span class="content">#{'select password from caller where name = ?'}</span><span class="delimiter">&quot;</span></span>,
    groupsQuery = <span class="string"><span class="delimiter">&quot;</span><span class="content">select group_name from caller_groups where caller_name = ?</span><span class="delimiter">&quot;</span></span>,
    hashAlgorithm = Pbkdf2PasswordHash.class,
    priorityExpression = <span class="string"><span class="delimiter">&quot;</span><span class="content">#{100}</span><span class="delimiter">&quot;</span></span>,
    hashAlgorithmParameters = {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Pbkdf2PasswordHash.Iterations=3072</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">${applicationConfig.dyna}</span><span class="delimiter">&quot;</span></span>
    }
)

<span class="annotation">@ApplicationScoped</span>
<span class="annotation">@Named</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ApplicationConfig</span> {

  <span class="directive">public</span> <span class="predefined-type">String</span><span class="type">[]</span> getDyna() {
       <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span>{<span class="string"><span class="delimiter">&quot;</span><span class="content">Pbkdf2PasswordHash.Algorithm=PBKDF2WithHmacSHA512</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Pbkdf2PasswordHash.SaltSizeBytes=64</span><span class="delimiter">&quot;</span></span>};
   }

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="specify-the-authentication-mechanism">Specify the Authentication Mechanism</h5>
<div class="paragraph">
<p>In this application, credentials are validated using the BASIC authentication mechanism.
Specify the <code>@BasicAuthenticationMechanismDefinition</code> annotation in the <code>ApplicationConfig.java</code>
to ensure that the <code>BasicAuthenticationMechanism</code>
is used to perform credential validation.</p>
</div>
<div class="paragraph">
<p>When a request is made to the servlet in question, the container delegates the request
to <code>org.glassfish.soteria.mechanisms.jaspic.HttpBridgeServerAuthModule</code>,
which then invokes the <code>BasicAuthenticationMechanism#validateRequest</code> method, and gets
the credential from the request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@BasicAuthenticationMechanismDefinition</span>(
        realmName = <span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span>
)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="declare-roles-in-the-servlet-container">Declare Roles in the Servlet Container</h5>
<div class="paragraph">
<p>When a request is made to the application, the roles the user is in are returned
as part of the response. Note that the container needs to be made aware of the
supported roles, which are defined using the <code>@DeclareRoles({ "foo", "bar", "kaz" })</code>
annotation as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/servlet</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@DeclareRoles</span>({ <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">kaz</span><span class="delimiter">&quot;</span></span> })
<span class="annotation">@ServletSecurity</span>(<span class="annotation">@HttpConstraint</span>(rolesAllowed = <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>))
<span class="directive">public</span> <span class="type">class</span> <span class="class">Servlet</span> <span class="directive">extends</span> HttpServlet {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1L</span>;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> doGet(HttpServletRequest request, HttpServletResponse response) <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {

        <span class="predefined-type">String</span> webName = <span class="predefined-constant">null</span>;
        <span class="keyword">if</span> (request.getUserPrincipal() != <span class="predefined-constant">null</span>) {
            webName = request.getUserPrincipal().getName();
        }

        response.getWriter().write(<span class="string"><span class="delimiter">&quot;</span><span class="content">web username: </span><span class="delimiter">&quot;</span></span> + webName + <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);

        response.getWriter().write(<span class="string"><span class="delimiter">&quot;</span><span class="content">web user has role </span><span class="char">\&quot;</span><span class="content">foo</span><span class="char">\&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span> + request.isUserInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>) + <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
        response.getWriter().write(<span class="string"><span class="delimiter">&quot;</span><span class="content">web user has role </span><span class="char">\&quot;</span><span class="content">bar</span><span class="char">\&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span> + request.isUserInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>) + <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
        response.getWriter().write(<span class="string"><span class="delimiter">&quot;</span><span class="content">web user has role </span><span class="char">\&quot;</span><span class="content">kaz</span><span class="char">\&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span> + request.isUserInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">kaz</span><span class="delimiter">&quot;</span></span>) + <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In GlassFish 5.1, group to role mapping is enabled by default. Therefore, you do
not need to bundle web.xml with the application to provide mapping between
roles and groups.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-built-in-db-identity-store-example">4.4.2. Running the built-in-db-identity-store Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>built-in-db-identity-store</code> application
as described in the following topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#to-build-package-and-deploy-the-built-in-db-identity-store-example-using-netbeans-ide">To Build, Package, and Deploy the built-in-db-identity-store Example Using NetBeans IDE</a></p>
</li>
<li>
<p><a href="#to-build-package-and-deploy-the-built-in-db-identity-store-example-using-using-maven">To Build, Package, and Deploy the built-in-db-identity-store Example Using Maven</a></p>
</li>
<li>
<p><a href="#to-run-the-built-in-db-identity-store-example">To Run the built-in-db-identity-store Example</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-built-in-db-identity-store-example-using-netbeans-ide">To Build, Package, and Deploy the built-in-db-identity-store Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you have not already done so, start the default database. This is necessary because
we are using the DefaultDataSource bundled with GlassFish for <code>DatabaseIdentityStore</code>.
See <a href="#starting-and-stopping-the-java-db-server">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>If you have not already done so, start the GlassFish server. See
<a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>.</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/security/security-api</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>built-in-db-identity-store</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>built-in-db-identity-store</code> project and
select Build.</p>
<div class="paragraph">
<p>This command builds and deploys the example application to your
GlassFish Server instance.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-built-in-db-identity-store-example-using-using-maven">To Build, Package, and Deploy the built-in-db-identity-store Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you have not already done so, start the default database. This is necessary because
we are using the DefaultDataSource bundled with GlassFish for <code>DatabaseIdentityStore</code>.
See <a href="#starting-and-stopping-the-java-db-server">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>If you have not already done so, start the GlassFish server. See
<a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/security/security-api/built-in-db-identity-store</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file,
<code>built-in-db-identity-store.war</code>, that is located in the <code>target</code> directory, then
deploys the WAR file.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-built-in-db-identity-store-example">To Run the built-in-db-identity-store Example</h5>
<div class="paragraph">
<p>In this example, use the credentials of user Joe to make a request and
to validate the response according to the credentials/roles defined in
<code>DatabaseSetup.java</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make a request to the deployed application by entering
the following request URL in your web browser:</p>
<div class="paragraph">
<p>Request URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/built-in-db-identity-store/servlet</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Because BASIC authentication is being used here, the container responds back
prompting for username and password.</p>
</div>
</li>
<li>
<p>Enter the username <code>Joe</code>, and the password <code>secret1</code> at the prompt.</p>
<div class="paragraph">
<p>Once you provide the credentials, the following process occurs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The client presents the request to the container with base64 encoded string and
with the <code>Authorization</code> header using the value in the format expected for
basic authentication.</p>
</li>
<li>
<p>With the username and password available to the container, validation is performed
against <code>DatabaseIdentityStore</code>.</p>
</li>
<li>
<p>The corresponding <code>UsernamePasswordCredential</code> object is passed as a parameter to
the <code>DatabaseIdentityStore#validate()</code> method.</p>
</li>
<li>
<p>The password is fetched from the database for user Joe.</p>
</li>
<li>
<p>The password stored in the database is hashed using the  <code>PBKDF2</code> algorithm and
verified by the built-in <code>Pbkdf2PasswordHash</code> implementation.</p>
</li>
<li>
<p>On successful verification, the request gets delegated to the servlet
in question and the following response is returned to the end user.</p>
<div class="paragraph">
<p>Response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">web username: Joe
web user has role <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">true</span>
web user has role <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">true</span>
web user has role <span class="string"><span class="delimiter">&quot;</span><span class="content">kaz</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">false</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Test the authentication using invalid credentials. Make a request to the
deployed application by entering the following request URL
in your web browser:</p>
<div class="paragraph">
<p>Request URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/built-in-db-identity-store/servlet</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, because BASIC authentication is being used here, the container responds back
prompting for username and password.</p>
</div>
</li>
<li>
<p>Enter an invalid username and password.
You are promted to enter the credentials again, but you are not authenticated.</p>
<div class="paragraph">
<p>When you click Cancel in the Authentication required window, the following
response is returned:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HTTP Status <span class="integer">401</span> - Unauthorized

type Status report

message Unauthorized

description This request requires HTTP authentication.

GlassFish Server Open <span class="predefined-type">Source</span> Edition <span class="integer">5</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-the-custom-identity-store-example">4.5. Running the Custom Identity Store Example</h3>
<div class="paragraph">
<p>The example described in this section demonstrates how to bundle and use a custom
identity store in your application for credential validation.</p>
</div>
<div class="paragraph">
<p>Topics include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#overview-of-the-custom-identity-store-example">Overview of the Custom Identity Store Example</a></p>
</li>
<li>
<p><a href="#running-the-custom-id-store-example">Running the custom-identity-store Example</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="overview-of-the-custom-identity-store-example">4.5.1. Overview of the Custom Identity Store Example</h4>
<div class="paragraph">
<p>As an alternative to using a built-in identity store, an application can provide
its own IdentityStore. When bundled with the application,
this custom identity store can then be used for authentication and authorization.</p>
</div>
<div class="paragraph">
<p>This example demonstrates how to define a custom identity store, <code>TestIdentityStore</code>, and
provide it as part of the application being deployed. The authentication mechanism used is
<code>BasicAuthenticationMechanism</code>.</p>
</div>
<div class="paragraph">
<p>The source code for this example is in the
<code><em>tut-install</em>/examples/security/security-api/custom-identity-store</code> directory.</p>
</div>
<div class="paragraph">
<p>The following sections describe the high-level process for defining
the <code>TestIdentityStore</code>. Note that the configuration described in these sections has
already been completed in the application files, but is provided here to illustrate
what you need to do to use a custom identity store.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#define-the-users-and-groups-in-the-identity-store-2">Define the Users and Groups in the Identity Store</a></p>
</li>
<li>
<p><a href="#specify-the-authentication-mechanism-2">Specify the Authentication Mechanism</a></p>
</li>
<li>
<p><a href="#declare-roles-in-the-servlet-container-2">Declare Roles in the Servlet Container</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a request that includes credentials is sent to the application, the configured
authentication mechanism comes into effect and authentication is performed
against the <code>TestIdentityStore</code> as defined in the application.</p>
</div>
<div class="paragraph">
<p>Post authentication, the application also verifies the roles the caller is in and
sends the details as part of the response.</p>
</div>
<div class="paragraph">
<p>Note that in GlassFish, if the user provides the wrong credentials when using
<code>BasicAuthenticationMechanism</code>, then the <code>realmName</code>
is presented to user, as a hint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">curl -I -u Joe http:<span class="comment">//localhost:8080/custom-identity-store/servlet</span>
Enter host password <span class="keyword">for</span> user <span class="string"><span class="delimiter">'</span><span class="content">Joe</span><span class="delimiter">'</span></span>:
HTTP/<span class="float">1.1</span> <span class="integer">401</span> Unauthorized
Server: GlassFish Server Open <span class="predefined-type">Source</span> Edition  <span class="float">5.0</span>
X-Powered-By: Servlet/<span class="float">3.1</span> JSP/<span class="float">2.3</span> (GlassFish Server Open <span class="predefined-type">Source</span> Edition  <span class="float">5.0</span>  Java/Oracle Corporation/<span class="float">1.8</span>)
WWW-Authenticate: Basic realm=<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span>
Content-Length: <span class="integer">1090</span>
Content-Language:
Content-<span class="predefined-type">Type</span>: text/html</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="define-the-users-and-groups-in-the-identity-store-2">Define the Users and Groups in the Identity Store</h5>
<div class="paragraph">
<p>The following table shows the user, password, and group used in this example.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 40%;">
<colgroup>
<col style="width: 30%;">
<col style="width: 40%;">
<col style="width: 30%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>User</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Password</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Group</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Joe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">foo, bar</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following code snippet shows how you define the credentials and the roles
assigned to users in the <code>TestIdentityStore.java</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">if</span> (usernamePasswordCredential.compareTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Joe</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">secret1</span><span class="delimiter">&quot;</span></span>)) {
    <span class="keyword">return</span> <span class="keyword">new</span> CredentialValidationResult(<span class="string"><span class="delimiter">&quot;</span><span class="content">Joe</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;&gt;(asList(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>)));
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="specify-the-authentication-mechanism-2">Specify the Authentication Mechanism</h5>
<div class="paragraph">
<p>In this application, credentials are validated using the BASIC authentication mechanism.
Specify the <code>@BasicAuthenticationMechanismDefinition</code> annotation in the <code>ApplicationConfig.java</code>
to ensure that the <code>BasicAuthenticationMechanism</code>
is used to perform credential validation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@BasicAuthenticationMechanismDefinition</span>(
        realmName = <span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span>
)

<span class="annotation">@ApplicationScoped</span>
<span class="annotation">@Named</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ApplicationConfig</span> {

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="declare-roles-in-the-servlet-container-2">Declare Roles in the Servlet Container</h5>
<div class="paragraph">
<p>When a request is made to the application, the roles the user is in are
returned as part of the response. Note that the container needs to be made aware
of the supported roles, which are defined using the <code>@Declareroles({ "foo", "bar", "kaz" })</code>
annotation as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DeclareRoles</span>({ <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">kaz</span><span class="delimiter">&quot;</span></span> })
<span class="annotation">@WebServlet</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/servlet</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Servlet</span> <span class="directive">extends</span> HttpServlet {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1L</span>;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> doGet(HttpServletRequest request, HttpServletResponse response) <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {

        <span class="predefined-type">String</span> webName = <span class="predefined-constant">null</span>;
        <span class="keyword">if</span> (request.getUserPrincipal() != <span class="predefined-constant">null</span>) {
            webName = request.getUserPrincipal().getName();
        }

        response.getWriter().write(<span class="string"><span class="delimiter">&quot;</span><span class="content">web username: </span><span class="delimiter">&quot;</span></span> + webName + <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);

        response.getWriter().write(<span class="string"><span class="delimiter">&quot;</span><span class="content">web user has role </span><span class="char">\&quot;</span><span class="content">foo</span><span class="char">\&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span> + request.isUserInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>) + <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
        response.getWriter().write(<span class="string"><span class="delimiter">&quot;</span><span class="content">web user has role </span><span class="char">\&quot;</span><span class="content">bar</span><span class="char">\&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span> + request.isUserInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>) + <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
        response.getWriter().write(<span class="string"><span class="delimiter">&quot;</span><span class="content">web user has role </span><span class="char">\&quot;</span><span class="content">kaz</span><span class="char">\&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span> + request.isUserInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">kaz</span><span class="delimiter">&quot;</span></span>) + <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In GlassFish 5.0, group to role mapping is enabled by default. Therefore, you do
not need to bundle <code>web.xml</code> with the application to provide mapping between roles
and groups.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-custom-id-store-example">4.5.2. Running the custom-identity-store Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>custom-identity-store</code> application
as described in the following topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#to-build-package-and-deploy-the-custom-identity-store-example-using-netbeans-ide">To Build, Package, and Deploy the custom-identity-store Example Using NetBeans IDE</a></p>
</li>
<li>
<p><a href="#to-build-package-and-deploy-the-custom-identity-store-example-using-using-maven">To Build, Package, and Deploy the custom-identity-store Example Using Maven</a></p>
</li>
<li>
<p><a href="#to-run-the-custom-identity-store-example">To Run the custom-identity-store Example</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-custom-identity-store-example-using-netbeans-ide">To Build, Package, and Deploy the custom-identity-store Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you have not already done so, start the GlassFish server. See
<a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>.</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/security/security-api</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>custom-identity-store</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>custom-identity-store</code> project and
select Build.</p>
<div class="paragraph">
<p>This command builds and deploys the example application to your
GlassFish Server instance.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-custom-identity-store-example-using-using-maven">To Build, Package, and Deploy the custom-identity-store Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you have not already done so, start the GlassFish server. See
<a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>..</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/security/security-api/custom-identity-store</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file,
<code>custom-identity-store.war</code>, that is located in the <code>target</code> directory, then
deploys the WAR file.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-custom-identity-store-example">To Run the custom-identity-store Example</h5>
<div class="paragraph">
<p>In this example, use the credentials of user <code>Joe</code> to make a request and
to validate the response according to the credentials defined in <code>TestIdentityStore</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make a request to the deployed application using valid credentials by entering
the following request URL in your web browser:</p>
<div class="paragraph">
<p>Request URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/custom-identity-store/servlet?name=Joe&amp;password=secret1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">web username: Joe
web user has role <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">true</span>
web user has role <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">true</span>
web user has role <span class="string"><span class="delimiter">&quot;</span><span class="content">kaz</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">false</span></code></pre>
</div>
</div>
</li>
<li>
<p>Test the authentication using invalid credentials. Make a request to the
deployed application by entering the following request URL
in your web browser:</p>
<div class="paragraph">
<p>Request URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//localhost:8080/custom-identity-store/servlet?name=Joe&amp;password=secret3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HTTP Status <span class="integer">401</span> - Unauthorized

type Status report

message Unauthorized

description This request requires HTTP authentication.

GlassFish Server Open <span class="predefined-type">Source</span> Edition <span class="integer">5</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jakarta_ee_security_advanced_topics">5. Jakarta EE Security: Advanced Topics</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="GJJWX"></a><a id="jakarta-ee-security-advanced-topics"></a></p>
</div>
<div class="paragraph">
<p>This chapter provides advanced information on securing Jakarta EE
applications.</p>
</div>
<div class="paragraph">
<p><a id="BNBYB"></a><a id="working-with-digital-certificates"></a></p>
</div>
<div class="sect2">
<h3 id="_working_with_digital_certificates">5.1. Working with Digital Certificates</h3>
<div class="paragraph">
<p>Digital certificates for GlassFish Server have already been generated
and can be found in the directory domain-dir`/config/`. These digital
certificates are self-signed and are intended for use in a development
environment; they are not intended for production purposes. For
production purposes, generate your own certificates and have them signed
by a Certificate Authority (CA).</p>
</div>
<div class="paragraph">
<p>To use the Secure Sockets Layer (SSL), an application or web server must
have an associated certificate for each external interface, or IP
address, that accepts secure connections. The theory behind this design
is that a server should provide some kind of reasonable assurance that
its owner is who you think it is, particularly before receiving any
sensitive information. It may be useful to think of a certificate as a
"digital driver&#8217;s license" for an Internet address. The certificate
states with which company the site is associated, along with some basic
contact information about the site owner or administrator.</p>
</div>
<div class="paragraph">
<p>The digital certificate is cryptographically signed by its owner and is
difficult for anyone else to forge. For sites involved in e-commerce or
in any other business transaction in which authentication of identity is
important, a certificate can be purchased from a well-known CA such as
VeriSign or Thawte. If your server certificate is self-signed, you must
install it in the GlassFish Server keystore file (<code>keystore.jks</code>). If
your client certificate is self-signed, you should install it in the
GlassFish Server truststore file (<code>cacerts.jks</code>).</p>
</div>
<div class="paragraph">
<p>Sometimes, authentication is not really a concern. For example, an
administrator might simply want to ensure that data being transmitted
and received by the server is private and cannot be snooped by anyone
eavesdropping on the connection. In such cases, you can save the time
and expense involved in obtaining a CA certificate and simply use a
self-signed certificate.</p>
</div>
<div class="paragraph">
<p>SSL uses public-key cryptography, which is based on key pairs. Key pairs
contain one public key and one private key. Data encrypted with one key
can be decrypted only with the other key of the pair. This property is
fundamental to establishing trust and privacy in transactions. For
example, using SSL, the server computes a value and encrypts it by using
its private key. The encrypted value is called a digital signature. The
client decrypts the encrypted value by using the server&#8217;s public key and
compares the value to its own computed value. If the two values match,
the client can trust that the signature is authentic, because only the
private key could have been used to produce such a signature.</p>
</div>
<div class="paragraph">
<p>Digital certificates are used with HTTPS to authenticate web clients.
The HTTPS service of most web servers will not run unless a digital
certificate has been installed. Use the procedure outlined in the next
section, <a href="#BNBYC">Creating a Server Certificate</a>, to set up a digital
certificate that can be used by your application or web server to enable
SSL.</p>
</div>
<div class="paragraph">
<p>One tool that can be used to set up a digital certificate is <code>keytool</code>,
a key and certificate management utility that ships with the JDK. This
tool enables users to administer their own public/private key pairs and
associated certificates for use in self-authentication, whereby the user
authenticates himself or herself to other users or services, or data
integrity and authentication services, using digital signatures. The
tool also allows users to cache the public keys, in the form of
certificates, of their communicating peers.</p>
</div>
<div class="paragraph">
<p>For a better understanding of <code>keytool</code> and public-key cryptography, see
<a href="#BABBGBBF">Further Information about
Advanced Security Topics</a> for a link to the <code>keytool</code> documentation.</p>
</div>
<div class="paragraph">
<p><a id="BNBYC"></a><a id="creating-a-server-certificate"></a></p>
</div>
<div class="sect3">
<h4 id="_creating_a_server_certificate">5.1.1. Creating a Server Certificate</h4>
<div class="paragraph">
<p>A server certificate has already been created for GlassFish Server and
can be found in the domain-dir`/config/` directory. The server
certificate is in <code>keystore.jks</code>. The <code>cacerts.jks</code> file contains all
the trusted certificates, including client certificates.</p>
</div>
<div class="paragraph">
<p>If necessary, you can use <code>keytool</code> to generate certificates. The
<code>keytool</code> utility stores the keys and certificates in a file termed a
keystore, a repository of certificates used for identifying a client or
a server. Typically, a keystore is a file that contains one client&#8217;s or
one server&#8217;s identity. The keystore protects private keys by using a
password.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t specify a directory when specifying the keystore file name,
the keystores are created in the directory from which the <code>keytool</code>
command is run. This can be the directory where the application resides,
or it can be a directory common to many applications.</p>
</div>
<div class="paragraph">
<p>The general steps for creating a server certificate are as follows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the keystore.</p>
</li>
<li>
<p>Export the certificate from the keystore.</p>
</li>
<li>
<p>Sign the certificate.</p>
</li>
<li>
<p>Import the certificate into a truststore: a repository of
certificates used for verifying the certificates. A truststore typically
contains more than one certificate.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The next section provides specific information on using the <code>keytool</code>
utility to perform these steps.</p>
</div>
<div class="paragraph">
<p><a id="GJRGY"></a><a id="to-use-keytool-to-create-a-server-certificate"></a></p>
</div>
<div class="sect4">
<h5 id="_to_use_keytool_to_create_a_server_certificate">To Use keytool to Create a Server Certificate</h5>
<div class="paragraph">
<p>Run <code>keytool</code> to generate a new key pair in the default development
keystore file, <code>keystore.jks</code>. This example uses the alias
<code>server-alias</code> to generate a new public/private key pair and wrap the
public key into a self-signed certificate inside <code>keystore.jks</code>. The key
pair is generated by using an algorithm of type RSA, with a default
password of <code>changeit</code>. For more information and other examples of
creating and managing keystore files, read the <code>keytool</code> documentation.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Note:</p>
</div>
<div class="paragraph">
<p>RSA is public-key encryption technology developed by RSA Data Security,
Inc.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>From the directory in which you want to create the key pair, run
<code>keytool</code> as shown in the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generate the server certificate.</p>
<div class="paragraph">
<p>Enter the <code>keytool</code> command all on one line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">java-home/bin/keytool -genkey -alias server-alias -keyalg RSA
-keypass changeit -storepass changeit -keystore keystore.jks</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you press Enter, <code>keytool</code> prompts you to enter the server name,
organizational unit, organization, locality, state, and country code.</p>
</div>
<div class="paragraph">
<p>You must enter the server name in response to <code>keytool&#8217;s first prompt,
in which it asks for first and last names. For testing purposes, this
can be `localhost</code>.</p>
</div>
</li>
<li>
<p>Export the generated server certificate in <code>keystore.jks</code> into the
file <code>server.cer</code>.</p>
<div class="paragraph">
<p>Enter the <code>keytool</code> command all on one line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">java-home/bin/keytool -<span class="keyword">export</span> -alias server-alias -storepass changeit
-file server.cer -keystore keystore.jks</code></pre>
</div>
</div>
</li>
<li>
<p>If you want to have the certificate signed by a CA, read the example
in the <code>keytool</code> documentation.</p>
</li>
<li>
<p>To add the server certificate to the truststore file, <code>cacerts.jks</code>,
run <code>keytool</code> from the directory where you created the keystore and
server certificate.</p>
<div class="paragraph">
<p>Use the following parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">java-home/bin/keytool -<span class="keyword">import</span> -<span class="include">v</span> -<span class="include">trustcacerts</span> -<span class="include">alias</span> <span class="include">server</span>-<span class="include">alias</span>
-<span class="include">file</span> <span class="include">server.cer</span> -<span class="include">keystore</span> <span class="include">cacerts.jks</span> -<span class="include">keypass</span> <span class="include">changeit</span>
-<span class="include">storepass</span> <span class="include">changeit</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Information on the certificate, such as that shown next, will appear:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Owner</span>: CN=localhost, OU=My Company, O=Software, L=Santa Clara, ST=CA, C=US
Issuer: CN=localhost, OU=My Company, O=Software, L=Santa Clara, ST=CA, C=US
Serial number: <span class="float">3e932169</span>
Valid from: Mon Nov <span class="integer">26</span> <span class="integer">18</span>:<span class="integer">15</span>:<span class="integer">47</span> EST <span class="integer">2012</span> until: Sun Feb <span class="integer">24</span> <span class="integer">18</span>:<span class="integer">15</span>:<span class="integer">47</span> EST <span class="integer">2013</span>
<span class="predefined-type">Certificate</span> fingerprints:
         MD5: <span class="integer">52</span>:<span class="float">9F</span>:<span class="integer">49</span>:<span class="integer">68</span>:ED:<span class="integer">78</span>:<span class="float">6F</span>:<span class="integer">39</span>:<span class="integer">87</span>:F3:<span class="integer">98</span>:B3:<span class="integer">6</span>A:<span class="integer">6</span>B:<span class="float">0F</span>:<span class="integer">90</span>
         SHA1: EE:<span class="integer">2</span>E:<span class="integer">2</span>A:A6:<span class="integer">9</span>E:<span class="octal">03</span>:<span class="integer">9</span>A:<span class="integer">3</span>A:<span class="integer">1</span>C:<span class="integer">17</span>:<span class="integer">4</span>A:<span class="integer">28</span>:<span class="integer">5</span>E:<span class="integer">97</span>:<span class="integer">20</span>:<span class="integer">78</span>:<span class="float">3F</span>:
         SHA256: <span class="integer">80</span>:<span class="octal">05</span>:EC:<span class="integer">7</span>E:<span class="integer">50</span>:<span class="integer">50</span>:<span class="float">5D</span>:AA:A3:<span class="integer">53</span>:F1:<span class="integer">11</span>:<span class="integer">9</span>B:<span class="integer">19</span>:EB:<span class="float">0D</span>:<span class="integer">20</span>:<span class="integer">67</span>:C1:<span class="integer">12</span>:
AF:<span class="integer">42</span>:EC:CD:<span class="integer">66</span>:<span class="integer">8</span>C:BD:<span class="integer">99</span>:AD:D9:<span class="integer">76</span>:<span class="integer">95</span>
         <span class="predefined-type">Signature</span> algorithm name: SHA256withRSA         Version: <span class="integer">3</span>
         ...
Trust <span class="local-variable">this</span> certificate? [no]:</code></pre>
</div>
</div>
</li>
<li>
<p>Enter <code>yes</code>, then press the Enter or Return key.</p>
<div class="paragraph">
<p>The following information appears:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Certificate</span> was added to keystore
[Storing cacerts.jks]</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GLIFW"></a><a id="adding-users-to-the-certificate-realm"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_adding_users_to_the_certificate_realm">5.1.2. Adding Users to the Certificate Realm</h4>
<div class="paragraph">
<p>In the <code>certificate</code> realm, user identity is set up in the GlassFish
Server security context and populated with user data obtained from
cryptographically verified client certificates. For step-by-step
instructions for creating this type of certificate, see
<a href="#BNBYB">Working with Digital Certificates</a>.</p>
</div>
<div class="paragraph">
<p><a id="BNBYF"></a><a id="using-a-different-server-certificate-with-glassfish-server"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_using_a_different_server_certificate_with_glassfish_server">5.1.3. Using a Different Server Certificate with GlassFish Server</h4>
<div class="paragraph">
<p>Follow the steps in <a href="#BNBYC">Creating a Server Certificate</a> to create
your own server certificate, have it signed by a CA, and import the
certificate into <code>keystore.jks</code>.</p>
</div>
<div class="paragraph">
<p>Make sure that when you create the certificate, you follow these rules.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When you create the server certificate, <code>keytool</code> prompts you to enter
your first and last name. In response to this prompt, you must enter the
name of your server. For testing purposes, this can be <code>localhost</code>.</p>
</li>
<li>
<p>If you want to replace the existing <code>keystore.jks</code>, you must either
change your keystore&#8217;s password to the default password (<code>changeit</code>) or
change the default password to your keystore&#8217;s password.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="sthref230"></a><a id="to-specify-a-different-server-certificate"></a></p>
</div>
<div class="sect4">
<h5 id="_to_specify_a_different_server_certificate">To Specify a Different Server Certificate</h5>
<div class="paragraph">
<p>To specify that GlassFish Server should use the new keystore for
authentication and authorization decisions, you must set the JVM options
for GlassFish Server so that they recognize the new keystore. To use a
different keystore from the one provided for development purposes,
follow these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start GlassFish Server if you haven&#8217;t already done so. Information
on starting the GlassFish Server can be found in
<a href="#BNADI">Starting and Stopping GlassFish Server</a>.</p>
</li>
<li>
<p>Open the GlassFish Server Administration Console in a web browser at
<code><a href="http://localhost:4848" class="bare">http://localhost:4848</a></code>.</p>
</li>
<li>
<p>Expand Configurations, then expand server-config, then click JVM
Settings.</p>
</li>
<li>
<p>Click the JVM Options tab.</p>
</li>
<li>
<p>Change the following JVM options so that they point to the location
and name of the new keystore. The current settings are shown below:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Djavax.net.ssl.keyStore=<span class="error">$</span>{com.sun.aas.instanceRoot}/config/keystore.jks
-Djavax.net.ssl.trustStore=<span class="error">$</span>{com.sun.aas.instanceRoot}/config/cacerts.jks</code></pre>
</div>
</div>
</li>
<li>
<p>If you&#8217;ve changed the keystore password from its default value, you
need to add the password option as well:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Djavax.net.ssl.keyStorePassword=your-<span class="keyword">new</span>-password</code></pre>
</div>
</div>
</li>
<li>
<p>Click Save, then restart GlassFish Server.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GLIEN"></a><a id="authentication-mechanisms"></a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_authentication_mechanisms">5.2. Authentication Mechanisms</h3>
<div class="paragraph">
<p>This section discusses the client authentication and mutual
authentication mechanisms.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#client-authentication">Client Authentication</a></p>
</li>
<li>
<p><a href="#mutual-authentication">Mutual Authentication</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GLIEQ"></a><a id="client-authentication"></a></p>
</div>
<div class="sect3">
<h4 id="_client_authentication">5.2.1. Client Authentication</h4>
<div class="paragraph">
<p>With client authentication, the web server authenticates the client by
using the client&#8217;s public key certificate. Client authentication is a
more secure method of authentication than either basic or form-based
authentication. It uses HTTP over SSL (HTTPS), in which the server
authenticates the client using the client&#8217;s public key certificate. SSL
technology provides data encryption, server authentication, message
integrity, and optional client authentication for a TCP/IP connection.
You can think of a public key certificate as the digital equivalent of a
passport. The certificate is issued by a trusted organization, a
certificate authority (CA), and provides identification for the bearer.</p>
</div>
<div class="paragraph">
<p>Before using client authentication, make sure that the client has a
valid public key certificate. For more information on creating and using
public key certificates, read
<a href="#BNBYB">Working with Digital Certificates</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to declare client authentication in your
deployment descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;login-config&gt;</span>
    <span class="tag">&lt;auth-method&gt;</span>CLIENT-CERT<span class="tag">&lt;/auth-method&gt;</span>
<span class="tag">&lt;/login-config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Jakarta Security provides an alternative means to configure client authentication
using the <code>HttpAuthenticationMechanism</code> interface. This
interface defines an SPI for writing
authentication mechanisms that can be provided with an application and
deployed using CDI. See <a href="#overview-of-the-http-authentication-mechanism-interface">Overview of
the HTTP Authentication Mechanism Interface</a>.</p>
</div>
<div class="paragraph">
<p><a id="GLIEL"></a><a id="mutual-authentication"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_mutual_authentication">5.2.2. Mutual Authentication</h4>
<div class="paragraph">
<p>With mutual authentication, the server and the client authenticate each
other. Mutual authentication is of two types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Certificate-based (see <a href="#GLIFJ">Figure 53-1</a>)</p>
</li>
<li>
<p>User name/password-based (see <a href="#GLIGQ">Figure 53-2</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When using certificate-based mutual authentication, the following
actions occur.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A client requests access to a protected resource.</p>
</li>
<li>
<p>The web server presents its certificate to the client.</p>
</li>
<li>
<p>The client verifies the server&#8217;s certificate.</p>
</li>
<li>
<p>If successful, the client sends its certificate to the server.</p>
</li>
<li>
<p>The server verifies the client&#8217;s credentials.</p>
</li>
<li>
<p>If successful, the server grants access to the protected resource
requested by the client.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="#GLIFJ">Figure 53-1</a> shows what occurs during certificate-based
mutual authentication.</p>
</div>
<div id="GLIFJ" class="paragraph">
<div class="title"><strong>Figure 53-1 Certificate-Based Mutual Authentication</strong></div>
<p><span class="image"><img src="../images/jakartaeett_dt_048.png" alt="Diagram of six steps in mutual authentication with certificates"></span></p>
</div>
<div class="paragraph">
<p>In user name/password-based mutual authentication, the following actions
occur.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A client requests access to a protected resource.</p>
</li>
<li>
<p>The web server presents its certificate to the client.</p>
</li>
<li>
<p>The client verifies the server&#8217;s certificate.</p>
</li>
<li>
<p>If successful, the client sends its user name and password to the
server.</p>
</li>
<li>
<p>The server verifies the client&#8217;s credentials</p>
</li>
<li>
<p>If the verification is successful, the server grants access to the
protected resource requested by the client.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="#GLIGQ">Figure 53-2</a> shows what occurs during user
name/password-based mutual authentication.</p>
</div>
<div id="GLIGQ" class="paragraph">
<div class="title"><strong>Figure 53-2 User Name/Password-Based Mutual Authentication</strong></div>
<p><span class="image"><img src="../images/jakartaeett_dt_049.png" alt="Diagram of five steps in mutual authentication with user name and password"></span></p>
</div>
<div class="paragraph">
<p><a id="BNBYH"></a><a id="enabling-mutual-authentication-over-ssl"></a></p>
</div>
<div class="sect4">
<h5 id="_enabling_mutual_authentication_over_ssl">Enabling Mutual Authentication over SSL</h5>
<div class="paragraph">
<p>This section discusses setting up client-side authentication. Enabling
both server-side and client-side authentication is called mutual, or
two-way, authentication. In client authentication, clients are required
to submit certificates issued by a certificate authority that you choose
to accept.</p>
</div>
<div class="paragraph">
<p>There are at least two ways to enable mutual authentication over SSL.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The preferred method is to set the method of authentication in the
<code>web.xml</code> application deployment descriptor to <code>CLIENT-CERT</code>. This
enforces mutual authentication by modifying the deployment descriptor of
the given application. In this way, client authentication is enabled
only for a specific resource controlled by the security constraint, and
the check is performed only when the application requires client
authentication.</p>
</li>
<li>
<p>A less commonly used method is to set the <code>clientAuth</code> property in the
<code>certificate</code> realm to <code>true</code> if you want the SSL stack to require a
valid certificate chain from the client before accepting a connection. A
<code>false</code> value (which is the default) will not require a certificate
chain unless the client requests a resource protected by a security
constraint that uses <code>CLIENT-CERT</code> authentication. When you enable
client authentication by setting the <code>clientAuth</code> property to <code>true</code>,
client authentication will be required for all the requests going
through the specified SSL port. If you turn <code>clientAuth</code> on, it is on
all of the time, which can severely degrade performance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When client authentication is enabled in both of these ways, client
authentication will be performed twice.</p>
</div>
<div class="paragraph">
<p><a id="BNBYI"></a><a id="creating-a-client-certificate-for-mutual-authentication"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_creating_a_client_certificate_for_mutual_authentication">Creating a Client Certificate for Mutual Authentication</h5>
<div class="paragraph">
<p>If you have a certificate signed by a trusted Certificate Authority (CA)
such as Verisign, and the GlassFish Server <code>cacerts.jks</code> file already
contains a certificate verified by that CA, you do not need to complete
this step. You need to install your certificate in the GlassFish Server
certificate file only when your certificate is self-signed.</p>
</div>
<div class="paragraph">
<p>From the directory where you want to create the client certificate, run
<code>keytool</code> as outlined here. When you press Enter, <code>keytool</code> prompts you
to enter the server name, organizational unit, organization, locality,
state, and country code.</p>
</div>
<div class="paragraph">
<p>You must enter the server name in response to <code>keytool&#8217;s first prompt,
in which it asks for first and last names. For testing purposes, this
can be `localhost</code>. If this example is to verify mutual authentication
and you receive a runtime error stating that the HTTPS host name is
wrong, re-create the client certificate, being sure to use the same host
name you will use when running the example. For example, if your machine
name is <code>duke</code>, then enter <code>duke</code> as the certificate CN or when prompted
for first and last names. When accessing the application, enter a URL
that points to the same location (for example,
<code><a href="https://duke:8181/mutualauth/hello" class="bare">https://duke:8181/mutualauth/hello</a></code>). This is necessary because during
SSL handshake, the server verifies the client certificate by comparing
the certificate name to the host name from which it originates.</p>
</div>
<div class="paragraph">
<p>To create a keystore named <code>client_keystore.jks</code> that contains a client
certificate named <code>client.cer</code>, follow these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a backup copy of the server truststore file. To do this,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Change to the directory containing the server&#8217;s keystore and truststore files, domain-dir`\config`.</p>
</li>
<li>
<p>Copy <code>cacerts.jks</code> to <code>cacerts.backup.jks</code>.</p>
</li>
<li>
<p>Copy <code>keystore.jks</code> to <code>keystore.backup.jks</code>.</p>
<div class="paragraph">
<p>Do not put client certificates in the <code>cacerts.jks</code> file. Any certificate you add to the <code>cacerts</code> file effectively can be a trusted root for any and all certificate chains. After you have completed development, delete the development version of the <code>cacerts</code> file and replace it with the original copy.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Generate the client certificate. Enter the following command from the directory where you want to generate the client certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">java-home\bin\keytool -genkey -alias client-alias -keyalg RSA -keypass changeit -storepass changeit -keystore client_keystore.jks</code></pre>
</div>
</div>
</li>
<li>
<p>Export the generated client certificate into the file <code>client.cer</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">java-home\bin\keytool -export -alias client-alias -storepass changeit -file client.cer -keystore client_keystore.jks</code></pre>
</div>
</div>
</li>
<li>
<p>Add the certificate to the truststore file domain-dir`/config/cacerts.jks`. Run <code>keytool</code> from the directory where you created the keystore and client certificate. Use the following parameters:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">java-home\bin\keytool -import -v -trustcacerts -alias client-alias
-file client.cer -keystore domain-dir/config/cacerts.jks
-keypass changeit -storepass changeit</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>keytool</code> utility returns a message like this one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Owner: CN=localhost, OU=My Company, O=Software, L=Santa Clara, ST=CA, C=US
Issuer: CN=localhost, OU=My Company, O=Software, L=Santa Clara, ST=CA, C=US
Serial number: 3e39e66a
Valid from: Tue Nov 27 12:22:47 EST 2012 until: Mon Feb 25 12:22:47 EST 2013
Certificate fingerprints:
    MD5: 5A:B0:4C:88:4E:F8:EF:E9:E5:8B:53:BD:D0:AA:8E:5A
    SHA1:90:00:36:5B:E0:A7:A2:BD:67:DB:EA:37:B9:61:3E:26:B3:89:46:32
    Signature algorithm name: SHA1withRSA
    Version: 3
Trust this certificate? [no]: yes
Certificate was added to keystore
[Storing cacerts.jks]</code></pre>
</div>
</div>
</li>
<li>
<p>Restart GlassFish Server.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BABEJJDE"></a><a id="using-the-jdbc-realm-for-user-authentication"></a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_jdbc_realm_for_user_authentication">5.3. Using the JDBC Realm for User Authentication</h3>
<div class="paragraph">
<p>An authentication realm, sometimes called a security policy domain or
security domain, is a scope over which an application server defines and
enforces a common security policy. A realm contains a collection of
users, who may or may not be assigned to a group. GlassFish Server comes
preconfigured with the file, certificate, and administration realms. An
administrator can also set up LDAP, JDBC, digest, or custom realms.</p>
</div>
<div class="paragraph">
<p>An application can specify in its deployment descriptor which realm to
use. If the application does not specify a realm, GlassFish Server uses
its default realm, the <code>file</code> realm. If an application specifies that a
JDBC realm is to be used for user authentication, GlassFish Server will
retrieve user credentials from a database. The application server uses
the database information and the enabled JDBC realm option in the
configuration file.</p>
</div>
<div class="paragraph">
<p>A database provides an easy way to add, edit, or delete users at runtime
and enables users to create their own accounts without any
administrative assistance. Using a database has an additional benefit:
providing a place to securely store any extra user information. A realm
can be thought of as a database of user names and passwords that
identify valid users of a web application or set of web applications
with an enumeration of the list of roles associated with each valid
user. Access to specific web application resources is granted to all
users in a particular role, instead of enumerating a list of associated
users. A user name can have any number of roles associated with it.</p>
</div>
<div class="paragraph">
<p>Two of the tutorial case studies, <a href="#GKAEE">Chapter
61, "Duke&#8217;s Tutoring Case Study Example,"</a> and
<a href="#GLNPW">Chapter 62, "Duke&#8217;s Forest Case Study
Example,"</a> use a JDBC realm for user authentication.</p>
</div>
<div class="paragraph">
<p><a id="sthref233"></a><a id="to-configure-a-jdbc-authentication-realm"></a></p>
</div>
<div class="sect3">
<h4 id="_to_configure_a_jdbc_authentication_realm">5.3.1. To Configure a JDBC Authentication Realm</h4>
<div class="paragraph">
<p>GlassFish Server enables administrators to specify a user&#8217;s credentials
(user name and password) in the JDBC realm instead of in the connection
pool. This prevents other applications from browsing the database tables
for user credentials. By default, storing passwords as clear text is not
supported in the JDBC realm. Under normal circumstances, passwords
should not be stored as clear text.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the database tables in which user credentials for the realm
will be stored.</p>
</li>
<li>
<p>Add user credentials to the database tables you created.</p>
</li>
<li>
<p>Create a JDBC connection pool for the database.</p>
<div class="paragraph">
<p>You can use the Administration Console or the command line to create a
connection pool.</p>
</div>
</li>
<li>
<p>Create a JDBC resource for the database.</p>
<div class="paragraph">
<p>You can use the Administration Console or the command line to create a
JDBC resource.</p>
</div>
</li>
<li>
<p>Create a realm.</p>
<div class="paragraph">
<p>This step needs to associate the resource with the realm, define the
tables and columns for users and groups used for authentication, and
define the digest algorithm that will be used for storing passwords in
the database.</p>
</div>
<div class="paragraph">
<p>You can use the Administration Console or the command line to create a
realm.</p>
</div>
</li>
<li>
<p>Modify the deployment descriptor for your application to specify the
JDBC realm.</p>
<div class="ulist">
<ul>
<li>
<p>For an enterprise application in an EAR file, modify the
<code>glassfish-application.xml</code> file.</p>
</li>
<li>
<p>For a web application in a WAR file, modify the <code>web.xml</code> file.</p>
</li>
<li>
<p>For an enterprise bean in an EJB JAR file, modify the
<code>glassfish-ejb-jar.xml</code> file.</p>
<div class="paragraph">
<p>For example, for a hypothetical application, the <code>web.xml</code> file could
specify the <code>jdbcRealm</code> realm, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;login-config&gt;</span>
    <span class="tag">&lt;auth-method&gt;</span>FORM<span class="tag">&lt;/auth-method&gt;</span>
    <span class="tag">&lt;realm-name&gt;</span>jdbcRealm<span class="tag">&lt;/realm-name&gt;</span>
    <span class="tag">&lt;form-login-config&gt;</span>
        <span class="tag">&lt;form-login-page&gt;</span>/login.xhtml<span class="tag">&lt;/form-login-page&gt;</span>
        <span class="tag">&lt;form-error-page&gt;</span>/login.xhtml<span class="tag">&lt;/form-error-page&gt;</span>
    <span class="tag">&lt;/form-login-config&gt;</span>
<span class="tag">&lt;/login-config&gt;</span>
<span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;web-resource-name&gt;</span>Secure Pages<span class="tag">&lt;/web-resource-name&gt;</span>
        <span class="tag">&lt;description</span><span class="tag">/&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/admin/*<span class="tag">&lt;/url-pattern&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>ADMINS<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/auth-constraint&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Form-based login is specified for all web pages under <code>/admin</code>. Access
to those pages will be allowed only to users in the <code>ADMINS</code> role.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Assign security roles to users or groups of users in the realm.</p>
<div class="paragraph">
<p>To assign a security role to a group or to a user, add a
security-role-mapping element to the application server-specific
deployment descriptor, in this case <code>glassfish-web.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-role-mapping&gt;</span>
    <span class="tag">&lt;role-name&gt;</span>USERS<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;group-name&gt;</span>USERS<span class="tag">&lt;/group-name&gt;</span>
<span class="tag">&lt;/security-role-mapping&gt;</span>
<span class="tag">&lt;security-role-mapping&gt;</span>
    <span class="tag">&lt;role-name&gt;</span>ADMINS<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;group-name&gt;</span>ADMINS<span class="tag">&lt;/group-name&gt;</span>
<span class="tag">&lt;/security-role-mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Since GlassFish Server users are assigned to groups during the user
creation process, this is more efficient than mapping security roles to
individual users.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="BABGEJJJ"></a><a id="securing-http-resources"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_securing_http_resources">5.4. Securing HTTP Resources</h3>
<div class="paragraph">
<p>When a request URI is matched by multiple constrained URL patterns, the
constraints that apply to the request are those that are associated with
the best matching URL pattern. The servlet matching rules defined in
Chapter 12, "Mapping Requests To Servlets," in the Jakarta Servlet 4.0
Specification, are used to determine the best matching URL pattern to
the request URI. No protection requirements apply to a request URI that
is not matched by a constrained URL pattern. The HTTP method of the
request plays no role in selecting the best matching URL pattern for a
request.</p>
</div>
<div class="paragraph">
<p>When HTTP methods are listed within a constraint definition, the
protections defined by the constraint are applied to the listed methods
only.</p>
</div>
<div class="paragraph">
<p>When HTTP methods are not listed within a constraint definition, the
protections defined by the constraint apply to the complete set of HTTP
methods, including HTTP extension methods.</p>
</div>
<div class="paragraph">
<p>When constraints with different protection requirements apply to the
same combination of URL patterns and HTTP methods, the rules for
combining the protection requirements are as defined in Section 13.8.1,
"Combining Constraints," in the Jakarta Servlet 4.0 Specification.</p>
</div>
<div class="paragraph">
<p>Follow these guidelines to properly secure a web application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Do not list HTTP methods within constraint definitions. This is the
simplest way to ensure that you are not leaving HTTP methods
unprotected. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- SECURITY CONSTRAINT #1 --&gt;</span>
<span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;display-name&gt;</span>Do not enumerate Http Methods<span class="tag">&lt;/display-name&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/company/*<span class="tag">&lt;/url-pattern&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>sales<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/auth-constraint&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you list methods in a constraint, all non-listed methods of the
effectively infinite set of possible HTTP methods, including extension
methods, will be unprotected. Use such a constraint only if you are
certain that this is the protection scheme you intend to define. The
following example shows a constraint that lists the GET method and thus
defines no protection on any of the other possible HTTP methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- SECURITY CONSTRAINT #2 --&gt;</span>
<span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;display-name&gt;</span>
        Protect GET only, leave all other methods unprotected
    <span class="tag">&lt;/display-name&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/company/*<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;http-method&gt;</span>GET<span class="tag">&lt;/http-method&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>sales<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/auth-constraint&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>If you need to apply specific types of protection to specific HTTP
methods, make sure that you define constraints to cover every method
that you want to permit, with or without constraint, at the
corresponding URL patterns. If there are any methods that you do not
want to permit, you must also create a constraint that denies access to
those methods at the same patterns; for an example, see security
constraint #5 in the next bullet.</p>
<div class="paragraph">
<p>For example, to permit GET and POST, where POST requires authentication
and GET is permitted without constraint, you could define the following
constraints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- SECURITY CONSTRAINT #3 --&gt;</span>
<span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;display-name&gt;</span>Allow unprotected GET<span class="tag">&lt;/display-name&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/company/*<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;http-method&gt;</span>GET<span class="tag">&lt;/http-method&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span>

<span class="comment">&lt;!-- SECURITY CONSTRAINT #4 --&gt;</span>
<span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;display-name&gt;</span>Require authentication for POST<span class="tag">&lt;/display-name&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/company/*<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;http-method&gt;</span>POST<span class="tag">&lt;/http-method&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>sales<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/auth-constraint&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>The simplest way to ensure that you deny all HTTP methods except those
that you want to be permitted is to use <code>http-method-omission</code> elements
to omit those HTTP methods from the security constraint, and also to
define an <code>auth-constraint</code> that names no roles. The security constraint
will apply to all methods except those that were named in the omissions,
and the constraint will apply only to the resources matched by the
patterns in the constraint.</p>
<div class="paragraph">
<p>For example, the following constraint excludes access to all methods
except GET and POST at the resources matched by the pattern
<code>/company/*</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- SECURITY CONSTRAINT #5 --&gt;</span>
<span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;display-name&gt;</span>Deny all HTTP methods except GET and POST<span class="tag">&lt;/display-name&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/company/*<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;http-method-omission&gt;</span>GET<span class="tag">&lt;/http-method-omission&gt;</span>
        <span class="tag">&lt;http-method-omission&gt;</span>POST<span class="tag">&lt;/http-method-omission&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint</span><span class="tag">/&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to extend these exclusions to the unconstrained parts of
your application, also include the URL pattern <code>/</code> (forward slash):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- SECURITY CONSTRAINT #6 --&gt;</span>
<span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;display-name&gt;</span>Deny all HTTP methods except GET and POST<span class="tag">&lt;/display-name&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/company/*<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;http-method-omission&gt;</span>GET<span class="tag">&lt;/http-method-omission&gt;</span>
        <span class="tag">&lt;http-method-omission&gt;</span>POST<span class="tag">&lt;/http-method-omission&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint</span><span class="tag">/&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>If, for your web application, you do not want any resource to be
accessible unless you explicitly define a constraint that permits access
to it, you can define an <code>auth-constraint</code> that names no roles and
associate it with the URL pattern <code>/</code>. The URL pattern <code>/</code> is the
weakest matching pattern. Do not list any HTTP methods in this
constraint:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- SECURITY CONSTRAINT #7 --&gt;</span>
<span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;display-name&gt;</span>
        Switch from Constraint to Permission model
        (where everything is denied by default)
    <span class="tag">&lt;/display-name&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/<span class="tag">&lt;/url-pattern&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint</span><span class="tag">/&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GLIGC"></a><a id="securing-application-clients"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_securing_application_clients">5.5. Securing Application Clients</h3>
<div class="paragraph">
<p>The Jakarta EE authentication requirements for application clients are the
same as for other Jakarta EE components, and the same authentication
techniques can be used as for other Jakarta EE application components. No
authentication is necessary when accessing unprotected web resources.</p>
</div>
<div class="paragraph">
<p>When accessing protected web resources, the usual varieties of
authentication can be used: HTTP basic authentication, HTTP login-form
authentication, or SSL client authentication.
<a href="#BNCBN">Specifying an Authentication
Mechanism in the Deployment Descriptor</a> describes how to specify HTTP
basic authentication and HTTP login-form authentication.
<a href="#GLIEQ">Client Authentication</a> describes how
to specify SSL client authentication.</p>
</div>
<div class="paragraph">
<p>Authentication is required when accessing protected enterprise beans.
The authentication mechanisms for enterprise beans are discussed in
<a href="#BNBYL">Securing Enterprise Beans</a>.</p>
</div>
<div class="paragraph">
<p>An application client makes use of an authentication service provided by
the application client container for authenticating its users. The
container&#8217;s service can be integrated with the native platform&#8217;s
authentication system so that a single sign-on capability is used. The
container can authenticate the user either when the application is
started or when a protected resource is accessed.</p>
</div>
<div class="paragraph">
<p>An application client can provide a class, called a login module, to
gather authentication data. If so, the
<code>javax.security.auth.callback.CallbackHandler</code> interface must be
implemented, and the class name must be specified in its deployment
descriptor. The application&#8217;s callback handler must fully support
<code>Callback</code> objects specified in the <code>javax.security.auth.callback</code>
package.</p>
</div>
<div class="paragraph">
<p><a id="GLIDW"></a><a id="using-login-modules"></a></p>
</div>
<div class="sect3">
<h4 id="_using_login_modules">5.5.1. Using Login Modules</h4>
<div class="paragraph">
<p>An application client can use the Java Authentication and Authorization
Service (JAAS) to create login modules for authentication. A JAAS-based
application implements the
<code>javax.security.auth.callback.CallbackHandler</code> interface so that it can
interact with users to enter specific authentication data, such as user
names or passwords, or to display error and warning messages.</p>
</div>
<div class="paragraph">
<p>Applications implement the <code>CallbackHandler</code> interface and pass it to
the login context, which forwards it directly to the underlying login
modules. A login module uses the callback handler both to gather input,
such as a password or smart card PIN, from users and to supply
information, such as status information, to users. Because the
application specifies the callback handler, an underlying login module
can remain independent of the various ways applications interact with
users.</p>
</div>
<div class="paragraph">
<p>For example, the implementation of a callback handler for a GUI
application might display a window to solicit user input, or the
implementation of a callback handler for a command-line tool might
simply prompt the user for input directly from the command line.</p>
</div>
<div class="paragraph">
<p>The login module passes an array of appropriate callbacks to the
callback handler&#8217;s <code>handle</code> method, such as a <code>NameCallback</code> for the
user name and a <code>PasswordCallback</code> for the password; the callback
handler performs the requested user interaction and sets appropriate
values in the callbacks. For example, to process a <code>NameCallback</code>, the
<code>CallbackHandler</code> might prompt for a name, retrieve the value from the
user, and call the <code>setName</code> method of the <code>NameCallback</code> to store the
name.</p>
</div>
<div class="paragraph">
<p>For more information on using JAAS for authentication in login modules,
refer to the documentation listed in
<a href="#BABBGBBF">Further Information about
Advanced Security Topics</a>.</p>
</div>
<div class="paragraph">
<p><a id="GLIHQ"></a><a id="using-programmatic-login"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_using_programmatic_login">5.5.2. Using Programmatic Login</h4>
<div class="paragraph">
<p>Programmatic login enables the client code to supply user credentials.
If you are using an enterprise bean client, you can use the
<code>com.sun.appserv.security.ProgrammaticLogin</code> class with its convenient
<code>login</code> and <code>logout</code> methods. Programmatic login is specific to a
server.</p>
</div>
<div class="paragraph">
<p><a id="GLIFD"></a><a id="securing-enterprise-information-systems-applications"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_securing_enterprise_information_systems_applications">5.6. Securing Enterprise Information Systems Applications</h3>
<div class="paragraph">
<p>In Enterprise Information Systems (EIS) applications, components request
a connection to an EIS resource.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#overview-of-securing-enterprise-information-systems-applications">Overview of Securing Enterprise Information Systems
Applications</a></p>
</li>
<li>
<p><a href="#container-managed-sign-on">Container-Managed Sign-On</a></p>
</li>
<li>
<p><a href="#component-managed-sign-on">Component-Managed Sign-On</a></p>
</li>
<li>
<p><a href="#configuring-resource-adapter-security">Configuring Resource Adapter Security</a></p>
</li>
<li>
<p><a href="#mapping-an-application-principal-to-eis-principals">Mapping an Application Principal to EIS Principals</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BABBJHIC"></a><a id="overview-of-securing-enterprise-information-systems-applications"></a></p>
</div>
<div class="sect3">
<h4 id="_overview_of_securing_enterprise_information_systems_applications">5.6.1. Overview of Securing Enterprise Information Systems Applications</h4>
<div class="paragraph">
<p>As part of this connection, the EIS can require a sign-on for the
requester to access the resource. The application component provider has
two choices for the design of the EIS sign-on.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Container-managed sign-on: The application component lets the
container take the responsibility of configuring and managing the EIS
sign-on. The container determines the user name and password for
establishing a connection to an EIS instance.</p>
</li>
<li>
<p>Component-managed sign-on: The application component code manages EIS
sign-on by including code that performs the sign-on process to an EIS.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also configure security for resource adapters. See
<a href="#GLIGS">Configuring Resource Adapter Security</a>.</p>
</div>
<div class="paragraph">
<p><a id="GLIHL"></a><a id="container-managed-sign-on"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_container_managed_sign_on">5.6.2. Container-Managed Sign-On</h4>
<div class="paragraph">
<p>In container-managed sign-on, an application component does not have to
pass any sign-on security information to the <code>getConnection()</code> method.
The security information is supplied by the container, as shown in the
following example (the method call is highlighted in bold):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Business method in an application component</span>
<span class="predefined-type">Context</span> initctx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
<span class="comment">// Perform JNDI lookup to obtain a connection factory</span>
javax.resource.cci.ConnectionFactory cxf =
    (javax.resource.cci.ConnectionFactory)initctx.lookup(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/eis/MainframeCxFactory</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// Invoke factory to obtain a connection. The security</span>
<span class="comment">// information is not passed in the getConnection method</span>
javax.resource.cci.Connection cx = cxf.getConnection();
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GLIDP"></a><a id="component-managed-sign-on"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_component_managed_sign_on">5.6.3. Component-Managed Sign-On</h4>
<div class="paragraph">
<p>In component-managed sign-on, an application component is responsible
for passing the needed sign-on security information for the resource to
the <code>getConnection</code> method. For example, security information might be a
user name and password, as shown here (the method call is highlighted in
bold):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Method in an application component</span>
<span class="predefined-type">Context</span> initctx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();

<span class="comment">// Perform JNDI lookup to obtain a connection factory</span>
javax.resource.cci.ConnectionFactory cxf =
    (javax.resource.cci.ConnectionFactory)initctx.lookup(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/eis/MainframeCxFactory</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Get a new ConnectionSpec</span>
com.myeis.ConnectionSpecImpl properties = <span class="comment">//..</span>

<span class="comment">// Invoke factory to obtain a connection</span>
properties.setUserName(<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>);
properties.setPassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>);
javax.resource.cci.Connection cx =
    cxf.getConnection(properties);
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GLIGS"></a><a id="configuring-resource-adapter-security"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_resource_adapter_security">5.6.4. Configuring Resource Adapter Security</h4>
<div class="paragraph">
<p>A resource adapter is a system-level software component that typically
implements network connectivity to an external resource manager. A
resource adapter can extend the functionality of the Jakarta EE platform
either by implementing one of the Jakarta EE standard service APIs, such as
a JDBC driver, or by defining and implementing a resource adapter for a
connector to an external application system. Resource adapters can also
provide services that are entirely local, perhaps interacting with
native resources. Resource adapters interface with the Jakarta EE platform
through the Jakarta EE service provider interfaces (Jakarta EE SPI). A
resource adapter that uses the Jakarta EE SPIs to attach to the Jakarta EE
platform will be able to work with all Jakarta EE products.</p>
</div>
<div class="paragraph">
<p>To configure the security settings for a resource adapter, you need to
edit the resource adapter descriptor file, <code>ra.xml</code>. Here is an example
of the part of an <code>ra.xml</code> file that configures security properties for
a resource adapter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;authentication-mechanism&gt;</span>
    <span class="tag">&lt;authentication-mechanism-type&gt;</span>
        BasicPassword
    <span class="tag">&lt;/authentication-mechanism-type&gt;</span>
    <span class="tag">&lt;credential-interface&gt;</span>
        javax.resource.spi.security.PasswordCredential
    <span class="tag">&lt;/credential-interface&gt;</span>
<span class="tag">&lt;/authentication-mechanism&gt;</span>
<span class="tag">&lt;reauthentication-support&gt;</span>false<span class="tag">&lt;/reauthentication-support&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find out more about the options for configuring resource adapter
security by reviewing <code><em>as-install</em>/lib/schemas/connector_1_7.xsd</code>. You
can configure the following elements in the resource adapter deployment
descriptor file.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authentication mechanisms: Use the <code>authentication-mechanism</code> element
to specify an authentication mechanism supported by the resource
adapter. This support is for the resource adapter, not for the
underlying EIS instance.</p>
<div class="paragraph">
<p>There are two supported mechanism types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BasicPassword</code>, which supports the following interface:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">javax.resource.spi.security.PasswordCredential</code></pre>
</div>
</div>
</li>
<li>
<p><code>Kerbv5</code>, which supports the following interface:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">javax.resource.spi.security.GenericCredential</code></pre>
</div>
</div>
<div class="paragraph">
<p>GlassFish Server does not currently support this mechanism type.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Reauthentication support: Use the <code>reauthentication-support</code> element
to specify whether the resource adapter implementation supports
reauthentication of existing <code>Managed-Connection</code> instances. Options are
<code>true</code> or <code>false</code>.</p>
</li>
<li>
<p>Security permissions: Use the <code>security-permission</code> element to specify
a security permission that is required by the resource adapter code.
Support for security permissions is optional and is not supported in the
current release of GlassFish Server. You can, however, manually update
the <code>server.policy</code> file to add the relevant permissions for the
resource adapter.</p>
<div class="paragraph">
<p>The security permissions listed in the deployment descriptor are
different from those required by the default permission set as specified
in the connector specification.</p>
</div>
<div class="paragraph">
<p>For more information on the implementation of the security permission
specification, see the security policy file documentation listed in
<a href="#BABBGBBF">Further Information about
Advanced Security Topics</a>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to specifying resource adapter security in the <code>ra.xml</code>
file, you can create a security map for a connector connection pool to
map an application principal or a user group to a back-end EIS
principal. The security map is usually used if one or more EIS back-end
principals are used to execute operations (on the EIS) initiated by
various principals or user groups in the application.</p>
</div>
<div class="paragraph">
<p><a id="GLIGW"></a><a id="mapping-an-application-principal-to-eis-principals"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_mapping_an_application_principal_to_eis_principals">5.6.5. Mapping an Application Principal to EIS Principals</h4>
<div class="paragraph">
<p>When using GlassFish Server, you can use security maps to map the caller
identity of the application (principal or user group) to a suitable EIS
principal in container-managed transaction-based scenarios. When an
application principal initiates a request to an EIS, GlassFish Server
first checks for an exact principal by using the security map defined
for the connector connection pool to determine the mapped back-end EIS
principal. If there is no exact match, GlassFish Server uses the
wildcard character specification, if any, to determine the mapped
back-end EIS principal. Security maps are used when an application user
needs to execute an EIS operation that requires execution as a specific
identity in the EIS.</p>
</div>
<div class="paragraph">
<p>To work with security maps, use the Administration Console. From the
Administration Console, follow these steps to get to the security maps
page.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the navigation tree, expand the Resources node.</p>
</li>
<li>
<p>Expand the Connectors node.</p>
</li>
<li>
<p>Select the Connector Connection Pools node.</p>
</li>
<li>
<p>On the Connector Connection Pools page, click the name of the
connection pool for which you want to create a security map.</p>
</li>
<li>
<p>Click the Security Maps tab.</p>
</li>
<li>
<p>Click New to create a new security map for the connection pool.</p>
</li>
<li>
<p>Enter a name by which you will refer to the security map, as well as
the other required information.</p>
<div class="paragraph">
<p>Click Help for more information on the individual options.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GKHRL"></a><a id="configuring-security-using-deployment-descriptors"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_security_using_deployment_descriptors">5.7. Configuring Security Using Deployment Descriptors</h3>
<div class="paragraph">
<p>The recommended way to configure security in the Jakarta EE 8 platform is
with annotations. If you wish to override the security settings at
deployment time, you can use security elements in the <code>web.xml</code>
deployment descriptor to do so. This section describes how to use the
deployment descriptor to specify basic authentication and to override
default principal-to-role mapping.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#specifying-security-for-basic-authentication-in-the-deployment-descriptor">Specifying Security for Basic Authentication in the
Deployment Descriptor</a></p>
</li>
<li>
<p><a href="#specifying-non-default-principal-to-role-mapping-in-the-deployment-descriptor">Specifying Non-Default Principal-to-Role Mapping in the
Deployment Descriptor</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="BNCCM"></a><a id="specifying-security-for-basic-authentication-in-the-deployment-descriptor"></a></p>
</div>
<div class="sect3">
<h4 id="_specifying_security_for_basic_authentication_in_the_deployment_descriptor">5.7.1. Specifying Security for Basic Authentication in the Deployment Descriptor</h4>
<div class="paragraph">
<p>The elements of the deployment descriptor that add basic authentication
to an example tell the server or browser to perform the following tasks.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Send a standard login dialog box to collect user name and password
data.</p>
</li>
<li>
<p>Verify that the user is authorized to access the application.</p>
</li>
<li>
<p>If authorized, display the servlet to the user.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following sample code shows the security elements for a deployment
descriptor that could be used in the example of basic authentication
found in the tut-install`/examples/security/hello2_basicauth/`
directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;security-constraint&gt;</span>
        <span class="tag">&lt;display-name&gt;</span>SecurityConstraint<span class="tag">&lt;/display-name&gt;</span>
        <span class="tag">&lt;web-resource-collection&gt;</span>
             <span class="tag">&lt;web-resource-name&gt;</span>WRCollection<span class="tag">&lt;/web-resource-name&gt;</span>
            <span class="tag">&lt;url-pattern&gt;</span>/greeting<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;/web-resource-collection&gt;</span>
        <span class="tag">&lt;auth-constraint&gt;</span>
            <span class="tag">&lt;role-name&gt;</span>TutorialUser<span class="tag">&lt;/role-name&gt;</span>
        <span class="tag">&lt;/auth-constraint&gt;</span>
        <span class="tag">&lt;user-data-constraint&gt;</span>
             <span class="tag">&lt;transport-guarantee&gt;</span>CONFIDENTIAL<span class="tag">&lt;/transport-guarantee&gt;</span>
        <span class="tag">&lt;/user-data-constraint&gt;</span>
    <span class="tag">&lt;/security-constraint&gt;</span>
    <span class="tag">&lt;login-config&gt;</span>
        <span class="tag">&lt;auth-method&gt;</span>BASIC<span class="tag">&lt;/auth-method&gt;</span>
        <span class="tag">&lt;realm-name&gt;</span>file<span class="tag">&lt;/realm-name&gt;</span>
    <span class="tag">&lt;/login-config&gt;</span>
    <span class="tag">&lt;security-role&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>TutorialUser<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/security-role&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This deployment descriptor specifies that the request URI <code>/greeting</code>
can be accessed only by users who have entered their user names and
passwords and have been authorized to access this URL because they have
been verified to be in the role <code>TutorialUser</code>. The user name and
password data will be sent over a protected transport in order to keep
it from being read in transit.</p>
</div>
<div class="paragraph">
<p><a id="GKAFQ"></a><a id="specifying-non-default-principal-to-role-mapping-in-the-deployment-descriptor"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_specifying_non_default_principal_to_role_mapping_in_the_deployment_descriptor">5.7.2. Specifying Non-Default Principal-to-Role Mapping in the Deployment Descriptor</h4>
<div class="paragraph">
<p>Jakarta Security requires that group principal names be mapped to
roles of the same name by default. GlassFish adheres to this standard, by default,
and provides group principal to role mapping. Implementations of the standard
can, however, provide mechanisms to configure a different default.</p>
</div>
<div class="paragraph">
<p>To map a role name permitted by the application or module to principals
(users) and groups defined on the server, use the
<code>security-role-mapping</code> element in the runtime deployment descriptor
file (<code>glassfish-application.xml</code>, <code>glassfish-web.xml</code>, or
<code>glassfish-ejb-jar.xml</code>). The entry needs to declare a mapping between a
security role used in the application and one or more groups or
principals defined for the applicable realm of GlassFish Server. An
example for the <code>glassfish-web.xml</code> file is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;glassfish-web-app&gt;</span>
    <span class="tag">&lt;security-role-mapping&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>DIRECTOR<span class="tag">&lt;/role-name&gt;</span>
        <span class="tag">&lt;principal-name&gt;</span>schwartz<span class="tag">&lt;/principal-name&gt;</span>
    <span class="tag">&lt;/security-role-mapping&gt;</span>
    <span class="tag">&lt;security-role-mapping&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>DEPT-ADMIN<span class="tag">&lt;/role-name&gt;</span>
        <span class="tag">&lt;group-name&gt;</span>dept-admins<span class="tag">&lt;/group-name&gt;</span>
    <span class="tag">&lt;/security-role-mapping&gt;</span>
<span class="tag">&lt;/glassfish-web-app&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The role name can be mapped to either a specific principal (user), a
group, or both. The principal or group names referenced must be valid
principals or groups in the current default realm of GlassFish Server.
The <code>role-name</code> in this example must exactly match the <code>role-name</code> in
the <code>security-role</code> element of the corresponding <code>web.xml</code> file or the
role name defined in the <code>@DeclareRoles</code> and/or <code>@RolesAllowed</code>
annotations.</p>
</div>
<div class="paragraph">
<p><a id="BABBGBBF"></a><a id="further-information-about-advanced-security-topics"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_further_information_about_advanced_security_topics">5.8. Further Information about Advanced Security Topics</h3>
<div class="paragraph">
<p>For more information about the security topics covered in this chapter,
see</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Documentation on the <code>keytool</code> command:</p>
<div class="paragraph">
<p><code><a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html" class="bare">https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html</a></code></p>
</div>
</li>
<li>
<p>Java Authentication and Authorization Service (JAAS) Reference Guide:</p>
<div class="paragraph">
<p><code><a href="http://docs.oracle.com/javase/7/docs/technotes/guides/security/jaas/JAASRefGuide.html" class="bare">http://docs.oracle.com/javase/7/docs/technotes/guides/security/jaas/JAASRefGuide.html</a></code></p>
</div>
</li>
<li>
<p>Java Authentication and Authorization Service (JAAS): LoginModule
Developer&#8217;s Guide:</p>
<div class="paragraph">
<p><code><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/jaas/JAASLMDevGuide.html" class="bare">https://docs.oracle.com/javase/8/docs/technotes/guides/security/jaas/JAASLMDevGuide.html</a></code></p>
</div>
</li>
<li>
<p>Documentation on security policy file syntax:</p>
<div class="paragraph">
<p><code><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/PolicyFiles.html#FileSyntax" class="bare">https://docs.oracle.com/javase/8/docs/technotes/guides/security/PolicyFiles.html#FileSyntax</a></code></p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-04-26 19:19:24 UTC
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</body>
</html>